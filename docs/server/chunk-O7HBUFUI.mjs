import './polyfills.server.mjs';
import{l as m}from"./chunk-KFBAW3U7.mjs";import{C as l,F as u,b as i,yc as c}from"./chunk-A7GSAIJF.mjs";import{u as h}from"./chunk-FCXBGYVN.mjs";import{j as s}from"./chunk-EXD34EPT.mjs";var f=class n{constructor(e,t){this.afAuth=e;this.router=t}isAuthenticated=!1;login(e,t){return s(this,null,function*(){let r=yield this.afAuth.signInWithEmailAndPassword(e,t),a=yield r.user?.getIdToken();if(a){let o=r.user?.displayName||r.user?.email||"Desconocido";localStorage.setItem("authToken",a),localStorage.setItem("userName",o),this.isAuthenticated=!0}return a})}logout(){return s(this,null,function*(){yield this.afAuth.signOut(),this.isAuthenticated=!1,localStorage.removeItem("userName"),this.router.navigate(["/login"])})}get authState(){return this.afAuth.authState}isLoggedIn(){return s(this,null,function*(){return!!(yield this.afAuth.currentUser)})}isAuthenticatedToken(){return!!(typeof window<"u"&&localStorage.getItem("authToken"))}register(e,t){return new i(r=>{this.afAuth.createUserWithEmailAndPassword(e,t).then(a=>{r.next(a),r.complete()}).catch(a=>{r.error(a)})})}resetPassword(e){return new i(t=>{this.afAuth.sendPasswordResetEmail(e).then(()=>{t.next(),t.complete()}).catch(r=>{t.error(r)})})}loginWithGoogle(){let e=new h.auth.GoogleAuthProvider;return new i(t=>{this.afAuth.signInWithPopup(e).then(r=>s(this,null,function*(){let a=r.user;if(a){let o=yield a.getIdToken(),g=a.displayName||a.email||"Desconocido";localStorage.setItem("authToken",o||""),localStorage.setItem("userName",g),this.isAuthenticated=!0}t.next(a),t.complete()})).catch(r=>{t.error(r)})})}getCurrentUserId(){return s(this,null,function*(){let e=yield this.afAuth.currentUser;return e?e.uid:null})}getCurrentUser(){return s(this,null,function*(){let e=yield this.afAuth.currentUser;if(e){let t=e.displayName||e.email||"Desconocido";return localStorage.setItem("userName",t),e}return null})}static \u0275fac=function(t){return new(t||n)(u(m),u(c))};static \u0275prov=l({token:n,factory:n.\u0275fac,providedIn:"root"})};export{f as a};
