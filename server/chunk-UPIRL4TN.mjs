import './polyfills.server.mjs';
import{A as Be,C as ee,D as og,G as $a,I as lg,J as ur,M as $c,N as jc,Z as cg,a as Vc,b as Uc,c as Ua,d as zc,e as Gc,f as Jt,g as rg,h as sg,i as ag,n as za,o as En,w as Ga,z as Oi}from"./chunk-KFBAW3U7.mjs";import{$ as Um,Aa as Je,Ac as lr,Ba as pe,Bb as ut,Ca as me,Cb as Un,D as Ue,Da as Pt,E as Bm,Ea as bs,Fa as Ss,Ga as St,H as Ts,Ha as Ii,I as at,J as ze,Ja as Sn,Jb as qa,K as Oc,Ka as he,La as qn,M as qm,Ma as Vn,Mb as zn,Na as Ai,O as kc,Ob as Gn,P as Ht,Pa as Di,Pb as $n,Q as Kt,Qa as Ri,Qb as Va,R as Oa,Ra as sr,Sa as xi,Sb as Me,T as ka,Ta as ar,U as Vm,Ub as Mc,V as ir,W as Na,X as Qt,_a as Pa,ab as La,b as Fm,bb as Fa,fb as jm,ha as Nc,ia as zm,ic as Wm,ja as ae,jc as Pc,ka as Fe,l as xa,la as Gm,lb as or,lc as Lc,nc as Fc,oa as rr,oc as Bc,pa as $m,qc,ra as Ma,sa as Bn,ta as ve,va as be,wa as X,yb as Ba}from"./chunk-A7GSAIJF.mjs";import{b as Hm,d as Km,e as Qm,f as Ym,h as Jm,j as Yt,k as Xm,l as Cn,m as Zm,n as eg,o as tg,p as ng,r as ig,t as cr,v as uS}from"./chunk-FCXBGYVN.mjs";import{a as _s,c as le,f as w,h as xc,j as R}from"./chunk-EXD34EPT.mjs";var oe=w(Ct=>{"use strict";Object.defineProperty(Ct,"__esModule",{value:!0});Ct.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=Ct.DEFAULT_MAX_SEND_MESSAGE_LENGTH=Ct.Propagate=Ct.LogVerbosity=Ct.Status=void 0;var gg=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n}(gg||(Ct.Status=gg={})),yg=function(n){return n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.ERROR=2]="ERROR",n[n.NONE=3]="NONE",n}(yg||(Ct.LogVerbosity=yg={})),vg=function(n){return n[n.DEADLINE=1]="DEADLINE",n[n.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",n[n.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",n[n.CANCELLATION=8]="CANCELLATION",n[n.DEFAULTS=65535]="DEFAULTS",n}(vg||(Ct.Propagate=vg={}));Ct.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1;Ct.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4*1024*1024});var tu=w((mB,HC)=>{HC.exports={name:"@grpc/grpc-js",version:"1.9.15",description:"gRPC Library for Node - pure JS implementation",homepage:"https://grpc.io/",repository:"https://github.com/grpc/grpc-node/tree/master/packages/grpc-js",main:"build/src/index.js",engines:{node:"^8.13.0 || >=10.10.0"},keywords:[],author:{name:"Google Inc."},types:"build/src/index.d.ts",license:"Apache-2.0",devDependencies:{"@types/gulp":"^4.0.6","@types/gulp-mocha":"0.0.32","@types/lodash":"^4.14.186","@types/mocha":"^5.2.6","@types/ncp":"^2.0.1","@types/pify":"^3.0.2","@types/semver":"^7.3.9","@typescript-eslint/eslint-plugin":"^5.59.11","@typescript-eslint/parser":"^5.59.11","@typescript-eslint/typescript-estree":"^5.59.11","clang-format":"^1.0.55",eslint:"^8.42.0","eslint-config-prettier":"^8.8.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^4.2.1",execa:"^2.0.3",gulp:"^4.0.2","gulp-mocha":"^6.0.0",lodash:"^4.17.4",madge:"^5.0.1","mocha-jenkins-reporter":"^0.4.1",ncp:"^2.0.0",pify:"^4.0.1",prettier:"^2.8.8",rimraf:"^3.0.2",semver:"^7.3.5","ts-node":"^10.9.1",typescript:"^5.1.3"},contributors:[{name:"Google Inc."}],scripts:{build:"npm run compile",clean:"rimraf ./build",compile:"tsc -p .",format:'clang-format -i -style="{Language: JavaScript, BasedOnStyle: Google, ColumnLimit: 80}" src/*.ts test/*.ts',lint:"eslint src/*.ts test/*.ts",prepare:"npm run generate-types && npm run compile",test:"gulp test",check:"npm run lint",fix:"eslint --fix src/*.ts test/*.ts",pretest:"npm run generate-types && npm run generate-test-types && npm run compile",posttest:"npm run check && madge -c ./build/src","generate-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --includeDirs proto/ --include-dirs test/fixtures/ -O src/generated/ --grpcLib ../index channelz.proto","generate-test-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --include-dirs test/fixtures/ -O test/generated/ --grpcLib ../../src/index test_service.proto"},dependencies:{"@grpc/proto-loader":"^0.7.8","@types/node":">=12.12.47"},files:["src/**/*.ts","build/src/**/*.{js,d.ts,js.map}","proto/*.proto","LICENSE","deps/envoy-api/envoy/api/v2/**/*.proto","deps/envoy-api/envoy/config/**/*.proto","deps/envoy-api/envoy/service/**/*.proto","deps/envoy-api/envoy/type/**/*.proto","deps/udpa/udpa/**/*.proto","deps/googleapis/google/api/*.proto","deps/googleapis/google/rpc/*.proto","deps/protoc-gen-validate/validate/**/*.proto"]}});var Ie=w(ot=>{"use strict";var nu,iu,ru,su;Object.defineProperty(ot,"__esModule",{value:!0});ot.isTracerEnabled=ot.trace=ot.log=ot.setLoggerVerbosity=ot.setLogger=ot.getLogger=void 0;var Wn=oe(),KC=le("process"),QC=tu().version,YC={error:(n,...e)=>{console.error("E "+n,...e)},info:(n,...e)=>{console.error("I "+n,...e)},debug:(n,...e)=>{console.error("D "+n,...e)}},ki=YC,dr=Wn.LogVerbosity.ERROR,JC=(iu=(nu=process.env.GRPC_NODE_VERBOSITY)!==null&&nu!==void 0?nu:process.env.GRPC_VERBOSITY)!==null&&iu!==void 0?iu:"";switch(JC.toUpperCase()){case"DEBUG":dr=Wn.LogVerbosity.DEBUG;break;case"INFO":dr=Wn.LogVerbosity.INFO;break;case"ERROR":dr=Wn.LogVerbosity.ERROR;break;case"NONE":dr=Wn.LogVerbosity.NONE;break;default:}var XC=()=>ki;ot.getLogger=XC;var ZC=n=>{ki=n};ot.setLogger=ZC;var eE=n=>{dr=n};ot.setLoggerVerbosity=eE;var tE=(n,...e)=>{let t;if(n>=dr){switch(n){case Wn.LogVerbosity.DEBUG:t=ki.debug;break;case Wn.LogVerbosity.INFO:t=ki.info;break;case Wn.LogVerbosity.ERROR:t=ki.error;break}t||(t=ki.error),t&&t.bind(ki)(...e)}};ot.log=tE;var nE=(su=(ru=process.env.GRPC_NODE_TRACE)!==null&&ru!==void 0?ru:process.env.GRPC_TRACE)!==null&&su!==void 0?su:"",au=new Set,_g=new Set;for(let n of nE.split(","))n.startsWith("-")?_g.add(n.substring(1)):au.add(n);var iE=au.has("all");function rE(n,e,t){Tg(e)&&(0,ot.log)(n,new Date().toISOString()+" | v"+QC+" "+KC.pid+" | "+e+" | "+t)}ot.trace=rE;function Tg(n){return!_g.has(n)&&(iE||au.has(n))}ot.isTracerEnabled=Tg});var ja=w(hr=>{"use strict";Object.defineProperty(hr,"__esModule",{value:!0});hr.getErrorCode=hr.getErrorMessage=void 0;function sE(n){return n instanceof Error?n.message:String(n)}hr.getErrorMessage=sE;function aE(n){return typeof n=="object"&&n!==null&&"code"in n&&typeof n.code=="number"?n.code:null}hr.getErrorCode=aE});var dt=w(Ha=>{"use strict";Object.defineProperty(Ha,"__esModule",{value:!0});Ha.Metadata=void 0;var oE=Ie(),lE=oe(),cE=ja(),uE=/^[0-9a-z_.-]+$/,dE=/^[ -~]*$/;function hE(n){return uE.test(n)}function fE(n){return dE.test(n)}function Sg(n){return n.endsWith("-bin")}function pE(n){return!n.startsWith("grpc-")}function Wa(n){return n.toLowerCase()}function bg(n,e){if(!hE(n))throw new Error('Metadata key "'+n+'" contains illegal characters');if(e!=null)if(Sg(n)){if(!Buffer.isBuffer(e))throw new Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(e))throw new Error("keys that don't end with '-bin' must have String values");if(!fE(e))throw new Error('Metadata string value "'+e+'" contains illegal characters')}}var ou=class n{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){e=Wa(e),bg(e,t),this.internalRepr.set(e,[t])}add(e,t){e=Wa(e),bg(e,t);let i=this.internalRepr.get(e);i===void 0?this.internalRepr.set(e,[t]):i.push(t)}remove(e){e=Wa(e),this.internalRepr.delete(e)}get(e){return e=Wa(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,i]of this.internalRepr)if(i.length>0){let r=i[0];e[t]=Buffer.isBuffer(r)?Buffer.from(r):r}return e}clone(){let e=new n(this.options),t=e.internalRepr;for(let[i,r]of this.internalRepr){let s=r.map(a=>Buffer.isBuffer(a)?Buffer.from(a):a);t.set(i,s)}return e}merge(e){for(let[t,i]of e.internalRepr){let r=(this.internalRepr.get(t)||[]).concat(i);this.internalRepr.set(t,r)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,i]of this.internalRepr)e[t]=i.map(mE);return e}toJSON(){let e={};for(let[t,i]of this.internalRepr)e[t]=i;return e}static fromHttp2Headers(e){let t=new n;for(let i of Object.keys(e)){if(i.charAt(0)===":")continue;let r=e[i];try{Sg(i)?Array.isArray(r)?r.forEach(s=>{t.add(i,Buffer.from(s,"base64"))}):r!==void 0&&(pE(i)?r.split(",").forEach(s=>{t.add(i,Buffer.from(s.trim(),"base64"))}):t.add(i,Buffer.from(r,"base64"))):Array.isArray(r)?r.forEach(s=>{t.add(i,s)}):r!==void 0&&t.add(i,r)}catch(s){let a=`Failed to add metadata entry ${i}: ${r}. ${(0,cE.getErrorMessage)(s)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,oE.log)(lE.LogVerbosity.ERROR,a)}}return t}};Ha.Metadata=ou;var mE=n=>Buffer.isBuffer(n)?n.toString("base64"):n});var hu=w(Ka=>{"use strict";Object.defineProperty(Ka,"__esModule",{value:!0});Ka.CallCredentials=void 0;var du=dt();function gE(n){return"getRequestHeaders"in n&&typeof n.getRequestHeaders=="function"}var fr=class n{static createFromMetadataGenerator(e){return new cu(e)}static createFromGoogleCredential(e){return n.createFromMetadataGenerator((t,i)=>{let r;gE(e)?r=e.getRequestHeaders(t.service_url):r=new Promise((s,a)=>{e.getRequestMetadata(t.service_url,(o,l)=>{if(o){a(o);return}if(!l){a(new Error("Headers not set by metadata plugin"));return}s(l)})}),r.then(s=>{let a=new du.Metadata;for(let o of Object.keys(s))a.add(o,s[o]);i(null,a)},s=>{i(s)})})}static createEmpty(){return new uu}};Ka.CallCredentials=fr;var lu=class n extends fr{constructor(e){super(),this.creds=e}generateMetadata(e){return R(this,null,function*(){let t=new du.Metadata,i=yield Promise.all(this.creds.map(r=>r.generateMetadata(e)));for(let r of i)t.merge(r);return t})}compose(e){return new n(this.creds.concat([e]))}_equals(e){return this===e?!0:e instanceof n?this.creds.every((t,i)=>t._equals(e.creds[i])):!1}},cu=class n extends fr{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,i)=>{this.metadataGenerator(e,(r,s)=>{s!==void 0?t(s):i(r)})})}compose(e){return new lu([this,e])}_equals(e){return this===e?!0:e instanceof n?this.metadataGenerator===e.metadataGenerator:!1}},uu=class n extends fr{generateMetadata(e){return Promise.resolve(new du.Metadata)}compose(e){return e}_equals(e){return e instanceof n}}});var pu=w(pr=>{"use strict";Object.defineProperty(pr,"__esModule",{value:!0});pr.getDefaultRootsData=pr.CIPHER_SUITES=void 0;var yE=le("fs");pr.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;var Cg=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,fu=null;function vE(){return Cg?(fu===null&&(fu=yE.readFileSync(Cg)),fu):null}pr.getDefaultRootsData=vE});var Ja=w(Ya=>{"use strict";Object.defineProperty(Ya,"__esModule",{value:!0});Ya.ChannelCredentials=void 0;var _E=le("tls"),TE=hu(),Eg=pu();function mu(n,e){if(n&&!(n instanceof Buffer))throw new TypeError(`${e}, if provided, must be a Buffer.`)}var mr=class{constructor(e){this.callCredentials=e||TE.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,i,r){var s;if(mu(e,"Root certificate"),mu(t,"Private key"),mu(i,"Certificate chain"),t&&!i)throw new Error("Private key must be given with accompanying certificate chain");if(!t&&i)throw new Error("Certificate chain must be given with accompanying private key");let a=(0,_E.createSecureContext)({ca:(s=e??(0,Eg.getDefaultRootsData)())!==null&&s!==void 0?s:void 0,key:t??void 0,cert:i??void 0,ciphers:Eg.CIPHER_SUITES});return new Qa(a,r??{})}static createFromSecureContext(e,t){return new Qa(e,t??{})}static createInsecure(){return new gu}};Ya.ChannelCredentials=mr;var gu=class n extends mr{constructor(e){super(e)}compose(e){throw new Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof n}},Qa=class n extends mr{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},t?.checkServerIdentity&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){let t=this.callCredentials.compose(e);return new yu(this,t)}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity:!1}},yu=class n extends mr{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new n(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials):!1}}});var Kn=w(Xe=>{"use strict";Object.defineProperty(Xe,"__esModule",{value:!0});Xe.validateLoadBalancingConfig=Xe.getFirstUsableConfig=Xe.isLoadBalancerNameRegistered=Xe.createLoadBalancer=Xe.registerDefaultLoadBalancerType=Xe.registerLoadBalancerType=Xe.createChildChannelControlHelper=void 0;function bE(n,e){var t,i,r,s,a,o,l,c,u,m;return{createSubchannel:(i=(t=e.createSubchannel)===null||t===void 0?void 0:t.bind(e))!==null&&i!==void 0?i:n.createSubchannel.bind(n),updateState:(s=(r=e.updateState)===null||r===void 0?void 0:r.bind(e))!==null&&s!==void 0?s:n.updateState.bind(n),requestReresolution:(o=(a=e.requestReresolution)===null||a===void 0?void 0:a.bind(e))!==null&&o!==void 0?o:n.requestReresolution.bind(n),addChannelzChild:(c=(l=e.addChannelzChild)===null||l===void 0?void 0:l.bind(e))!==null&&c!==void 0?c:n.addChannelzChild.bind(n),removeChannelzChild:(m=(u=e.removeChannelzChild)===null||u===void 0?void 0:u.bind(e))!==null&&m!==void 0?m:n.removeChannelzChild.bind(n)}}Xe.createChildChannelControlHelper=bE;var Hn={},vu=null;function SE(n,e,t){Hn[n]={LoadBalancer:e,LoadBalancingConfig:t}}Xe.registerLoadBalancerType=SE;function CE(n){vu=n}Xe.registerDefaultLoadBalancerType=CE;function EE(n,e){let t=n.getLoadBalancerName();return t in Hn?new Hn[t].LoadBalancer(e):null}Xe.createLoadBalancer=EE;function wE(n){return n in Hn}Xe.isLoadBalancerNameRegistered=wE;function IE(n,e=!1){for(let t of n)if(t.getLoadBalancerName()in Hn)return t;return e&&vu?new Hn[vu].LoadBalancingConfig:null}Xe.getFirstUsableConfig=IE;function AE(n){if(!(n!==null&&typeof n=="object"))throw new Error("Load balancing config must be an object");let e=Object.keys(n);if(e.length!==1)throw new Error("Provided load balancing config has multiple conflicting entries");let t=e[0];if(t in Hn)return Hn[t].LoadBalancingConfig.createFromJson(n[t]);throw new Error(`Unrecognized load balancing config name ${t}`)}Xe.validateLoadBalancingConfig=AE});var _u=w(Qn=>{"use strict";Object.defineProperty(Qn,"__esModule",{value:!0});Qn.extractAndSelectServiceConfig=Qn.validateServiceConfig=Qn.validateRetryThrottling=void 0;var DE=le("os"),Xa=oe(),RE=Kn(),Za=/^\d+(\.\d{1,9})?s$/,xE="node";function OE(n){if("service"in n&&n.service!==""){if(typeof n.service!="string")throw new Error(`Invalid method config name: invalid service: expected type string, got ${typeof n.service}`);if("method"in n&&n.method!==""){if(typeof n.method!="string")throw new Error(`Invalid method config name: invalid method: expected type string, got ${typeof n.service}`);return{service:n.service,method:n.method}}else return{service:n.service}}else{if("method"in n&&n.method!==void 0)throw new Error("Invalid method config name: method set with empty or unset service");return{}}}function kE(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in n)||typeof n.initialBackoff!="string"||!Za.test(n.initialBackoff))throw new Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in n)||typeof n.maxBackoff!="string"||!Za.test(n.maxBackoff))throw new Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in n)||typeof n.backoffMultiplier!="number"||n.backoffMultiplier<=0)throw new Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in n&&Array.isArray(n.retryableStatusCodes)))throw new Error("Invalid method config retry policy: retryableStatusCodes is required");if(n.retryableStatusCodes.length===0)throw new Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let e of n.retryableStatusCodes)if(typeof e=="number"){if(!Object.values(Xa.Status).includes(e))throw new Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if(typeof e=="string"){if(!Object.values(Xa.Status).includes(e.toUpperCase()))throw new Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw new Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:n.maxAttempts,initialBackoff:n.initialBackoff,maxBackoff:n.maxBackoff,backoffMultiplier:n.backoffMultiplier,retryableStatusCodes:n.retryableStatusCodes}}function NE(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in n&&(typeof n.hedgingDelay!="string"||!Za.test(n.hedgingDelay)))throw new Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in n&&Array.isArray(n.nonFatalStatusCodes))for(let t of n.nonFatalStatusCodes)if(typeof t=="number"){if(!Object.values(Xa.Status).includes(t))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if(typeof t=="string"){if(!Object.values(Xa.Status).includes(t.toUpperCase()))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let e={maxAttempts:n.maxAttempts};return n.hedgingDelay&&(e.hedgingDelay=n.hedgingDelay),n.nonFatalStatusCodes&&(e.nonFatalStatusCodes=n.nonFatalStatusCodes),e}function ME(n){var e;let t={name:[]};if(!("name"in n)||!Array.isArray(n.name))throw new Error("Invalid method config: invalid name array");for(let i of n.name)t.name.push(OE(i));if("waitForReady"in n){if(typeof n.waitForReady!="boolean")throw new Error("Invalid method config: invalid waitForReady");t.waitForReady=n.waitForReady}if("timeout"in n)if(typeof n.timeout=="object"){if(!("seconds"in n.timeout)||typeof n.timeout.seconds!="number")throw new Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in n.timeout)||typeof n.timeout.nanos!="number")throw new Error("Invalid method config: invalid timeout.nanos");t.timeout=n.timeout}else if(typeof n.timeout=="string"&&Za.test(n.timeout)){let i=n.timeout.substring(0,n.timeout.length-1).split(".");t.timeout={seconds:i[0]|0,nanos:((e=i[1])!==null&&e!==void 0?e:0)|0}}else throw new Error("Invalid method config: invalid timeout");if("maxRequestBytes"in n){if(typeof n.maxRequestBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxRequestBytes=n.maxRequestBytes}if("maxResponseBytes"in n){if(typeof n.maxResponseBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxResponseBytes=n.maxResponseBytes}if("retryPolicy"in n){if("hedgingPolicy"in n)throw new Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");t.retryPolicy=kE(n.retryPolicy)}else"hedgingPolicy"in n&&(t.hedgingPolicy=NE(n.hedgingPolicy));return t}function wg(n){if(!("maxTokens"in n)||typeof n.maxTokens!="number"||n.maxTokens<=0||n.maxTokens>1e3)throw new Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in n)||typeof n.tokenRatio!="number"||n.tokenRatio<=0)throw new Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+n.maxTokens.toFixed(3),tokenRatio:+n.tokenRatio.toFixed(3)}}Qn.validateRetryThrottling=wg;function Ig(n){let e={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in n)if(typeof n.loadBalancingPolicy=="string")e.loadBalancingPolicy=n.loadBalancingPolicy;else throw new Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in n)if(Array.isArray(n.loadBalancingConfig))for(let i of n.loadBalancingConfig)e.loadBalancingConfig.push((0,RE.validateLoadBalancingConfig)(i));else throw new Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in n&&Array.isArray(n.methodConfig))for(let i of n.methodConfig)e.methodConfig.push(ME(i));"retryThrottling"in n&&(e.retryThrottling=wg(n.retryThrottling));let t=[];for(let i of e.methodConfig)for(let r of i.name){for(let s of t)if(r.service===s.service&&r.method===s.method)throw new Error(`Invalid service config: duplicate name ${r.service}/${r.method}`);t.push(r)}return e}Qn.validateServiceConfig=Ig;function PE(n){if(!("serviceConfig"in n))throw new Error("Invalid service config choice: missing service config");let e={serviceConfig:Ig(n.serviceConfig)};if("clientLanguage"in n)if(Array.isArray(n.clientLanguage)){e.clientLanguage=[];for(let i of n.clientLanguage)if(typeof i=="string")e.clientLanguage.push(i);else throw new Error("Invalid service config choice: invalid clientLanguage")}else throw new Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in n)if(Array.isArray(n.clientHostname)){e.clientHostname=[];for(let i of n.clientHostname)if(typeof i=="string")e.clientHostname.push(i);else throw new Error("Invalid service config choice: invalid clientHostname")}else throw new Error("Invalid service config choice: invalid clientHostname");if("percentage"in n)if(typeof n.percentage=="number"&&0<=n.percentage&&n.percentage<=100)e.percentage=n.percentage;else throw new Error("Invalid service config choice: invalid percentage");let t=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let i in n)if(!t.includes(i))throw new Error(`Invalid service config choice: unexpected field ${i}`);return e}function LE(n,e){if(!Array.isArray(n))throw new Error("Invalid service config list");for(let t of n){let i=PE(t);if(!(typeof i.percentage=="number"&&e>i.percentage)){if(Array.isArray(i.clientHostname)){let r=!1;for(let s of i.clientHostname)s===DE.hostname()&&(r=!0);if(!r)continue}if(Array.isArray(i.clientLanguage)){let r=!1;for(let s of i.clientLanguage)s===xE&&(r=!0);if(!r)continue}return i.serviceConfig}}throw new Error("No matching service config found")}function FE(n,e){for(let t of n)if(t.length>0&&t[0].startsWith("grpc_config=")){let i=t.join("").substring(12),r=JSON.parse(i);return LE(r,e)}return null}Qn.extractAndSelectServiceConfig=FE});var Et=w(eo=>{"use strict";Object.defineProperty(eo,"__esModule",{value:!0});eo.ConnectivityState=void 0;var Ag=function(n){return n[n.IDLE=0]="IDLE",n[n.CONNECTING=1]="CONNECTING",n[n.READY=2]="READY",n[n.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",n[n.SHUTDOWN=4]="SHUTDOWN",n}(Ag||(eo.ConnectivityState=Ag={}))});var gt=w(Yn=>{"use strict";Object.defineProperty(Yn,"__esModule",{value:!0});Yn.uriToString=Yn.splitHostPort=Yn.parseUri=void 0;var BE=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function qE(n){let e=BE.exec(n);return e===null?null:{scheme:e[1],authority:e[2],path:e[3]}}Yn.parseUri=qE;var Dg=/^\d+$/;function VE(n){if(n.startsWith("[")){let e=n.indexOf("]");if(e===-1)return null;let t=n.substring(1,e);if(t.indexOf(":")===-1)return null;if(n.length>e+1)if(n[e+1]===":"){let i=n.substring(e+2);return Dg.test(i)?{host:t,port:+i}:null}else return null;else return{host:t}}else{let e=n.split(":");return e.length===2?Dg.test(e[1])?{host:e[0],port:+e[1]}:null:{host:n}}}Yn.splitHostPort=VE;function UE(n){let e="";return n.scheme!==void 0&&(e+=n.scheme+":"),n.authority!==void 0&&(e+="//"+n.authority+"/"),e+=n.path,e}Yn.uriToString=UE});var Zt=w(wt=>{"use strict";Object.defineProperty(wt,"__esModule",{value:!0});wt.mapUriDefaultScheme=wt.getDefaultAuthority=wt.createResolver=wt.registerDefaultScheme=wt.registerResolver=void 0;var bu=gt(),gr={},Tu=null;function zE(n,e){gr[n]=e}wt.registerResolver=zE;function GE(n){Tu=n}wt.registerDefaultScheme=GE;function $E(n,e,t){if(n.scheme!==void 0&&n.scheme in gr)return new gr[n.scheme](n,e,t);throw new Error(`No resolver could be created for target ${(0,bu.uriToString)(n)}`)}wt.createResolver=$E;function jE(n){if(n.scheme!==void 0&&n.scheme in gr)return gr[n.scheme].getDefaultAuthority(n);throw new Error(`Invalid target ${(0,bu.uriToString)(n)}`)}wt.getDefaultAuthority=jE;function WE(n){return n.scheme===void 0||!(n.scheme in gr)?Tu!==null?{scheme:Tu,authority:void 0,path:(0,bu.uriToString)(n)}:null:n}wt.mapUriDefaultScheme=WE});var Xn=w(Jn=>{"use strict";Object.defineProperty(Jn,"__esModule",{value:!0});Jn.QueuePicker=Jn.UnavailablePicker=Jn.PickResultType=void 0;var HE=dt(),KE=oe(),to=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.QUEUE=1]="QUEUE",n[n.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",n[n.DROP=3]="DROP",n}(to||(Jn.PickResultType=to={})),Su=class{constructor(e){this.status=Object.assign({code:KE.Status.UNAVAILABLE,details:"No connection established",metadata:new HE.Metadata},e)}pick(e){return{pickResultType:to.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}};Jn.UnavailablePicker=Su;var Cu=class{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:to.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}};Jn.QueuePicker=Cu});var Cs=w(no=>{"use strict";Object.defineProperty(no,"__esModule",{value:!0});no.BackoffTimeout=void 0;var QE=1e3,YE=1.6,JE=12e4,XE=.2;function ZE(n,e){return Math.random()*(e-n)+n}var Eu=class{constructor(e,t){this.callback=e,this.initialDelay=QE,this.multiplier=YE,this.maxDelay=JE,this.jitter=XE,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,i;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||(i=(t=this.timerId).unref)===null||i===void 0||i.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+ZE(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,(t=(e=this.timerId).ref)===null||t===void 0||t.call(e)}unref(){var e,t;this.hasRef=!1,(t=(e=this.timerId).unref)===null||t===void 0||t.call(e)}getEndTime(){return this.endTime}};no.BackoffTimeout=Eu});var ro=w(io=>{"use strict";Object.defineProperty(io,"__esModule",{value:!0});io.ChildLoadBalancerHandler=void 0;var ew=Kn(),tw=Et(),nw="child_load_balancer_helper",wu=class{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(t){this.parent=t,this.child=null}createSubchannel(t,i){return this.parent.channelControlHelper.createSubchannel(t,i)}updateState(t,i){var r;if(this.calledByPendingChild()){if(t===tw.ConnectivityState.CONNECTING)return;(r=this.parent.currentChild)===null||r===void 0||r.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(t,i)}requestReresolution(){var t;let i=(t=this.parent.pendingChild)!==null&&t!==void 0?t:this.parent.currentChild;this.child===i&&this.parent.channelControlHelper.requestReresolution()}setChild(t){this.child=t}addChannelzChild(t){this.parent.channelControlHelper.addChannelzChild(t)}removeChannelzChild(t){this.parent.channelControlHelper.removeChannelzChild(t)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,i){let r;if(this.currentChild===null||this.latestConfig===null||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let s=new this.ChildPolicyHelper(this),a=(0,ew.createLoadBalancer)(t,s);s.setChild(a),this.currentChild===null?(this.currentChild=a,r=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=a,r=this.pendingChild)}else this.pendingChild===null?r=this.currentChild:r=this.pendingChild;this.latestConfig=t,r.updateAddressList(e,t,i)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return nw}};io.ChildLoadBalancerHandler=wu});var xg=w(so=>{"use strict";Object.defineProperty(so,"__esModule",{value:!0});so.ResolvingLoadBalancer=void 0;var iw=Kn(),rw=_u(),ht=Et(),sw=Zt(),yr=Xn(),aw=Cs(),Iu=oe(),ow=dt(),lw=Ie(),cw=oe(),uw=gt(),dw=ro(),hw="resolving_load_balancer";function Rg(n){lw.trace(cw.LogVerbosity.DEBUG,hw,n)}var fw=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function pw(n,e,t,i){for(let r of t.name)switch(i){case"EMPTY":if(!r.service&&!r.method)return!0;break;case"SERVICE":if(r.service===n&&!r.method)return!0;break;case"SERVICE_AND_METHOD":if(r.service===n&&r.method===e)return!0}return!1}function mw(n,e,t,i){for(let r of t)if(pw(n,e,r,i))return r;return null}function gw(n){return function(t,i){var r,s;let a=t.split("/").filter(c=>c.length>0),o=(r=a[0])!==null&&r!==void 0?r:"",l=(s=a[1])!==null&&s!==void 0?s:"";if(n&&n.methodConfig)for(let c of fw){let u=mw(o,l,n.methodConfig,c);if(u)return{methodConfig:u,pickInformation:{},status:Iu.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:Iu.Status.OK,dynamicFilterFactories:[]}}}var Au=class{constructor(e,t,i,r,s){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=r,this.onFailedResolution=s,this.latestChildState=ht.ConnectivityState.IDLE,this.latestChildPicker=new yr.QueuePicker(this),this.currentState=ht.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,i["grpc.service_config"]?this.defaultServiceConfig=(0,rw.validateServiceConfig)(JSON.parse(i["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(ht.ConnectivityState.IDLE,new yr.QueuePicker(this)),this.childLoadBalancer=new dw.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(Rg("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(o,l)=>{this.latestChildState=o,this.latestChildPicker=l,this.updateState(o,l)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,sw.createResolver)(e,{onSuccessfulResolution:(o,l,c,u,m)=>{var p;this.backoffTimeout.stop(),this.backoffTimeout.reset();let T=null;l===null?c===null?(this.previousServiceConfig=null,T=this.defaultServiceConfig):this.previousServiceConfig===null?this.handleResolutionFailure(c):T=this.previousServiceConfig:(T=l,this.previousServiceConfig=l);let S=(p=T?.loadBalancingConfig)!==null&&p!==void 0?p:[],E=(0,iw.getFirstUsableConfig)(S,!0);if(E===null){this.handleResolutionFailure({code:Iu.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new ow.Metadata});return}this.childLoadBalancer.updateAddressList(o,E,m);let C=T??this.defaultServiceConfig;this.onSuccessfulResolution(C,u??gw(C))},onError:o=>{this.handleResolutionFailure(o)}},i);let a={initialDelay:i["grpc.initial_reconnect_backoff_ms"],maxDelay:i["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new aw.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},a),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===ht.ConnectivityState.IDLE&&this.updateState(ht.ConnectivityState.CONNECTING,new yr.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){Rg((0,uw.uriToString)(this.target)+" "+ht.ConnectivityState[this.currentState]+" -> "+ht.ConnectivityState[e]),e===ht.ConnectivityState.IDLE&&(t=new yr.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===ht.ConnectivityState.IDLE&&(this.updateState(ht.ConnectivityState.TRANSIENT_FAILURE,new yr.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===ht.ConnectivityState.IDLE||this.currentState===ht.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw new Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=ht.ConnectivityState.IDLE,this.latestChildPicker=new yr.QueuePicker(this),this.currentState=ht.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}};so.ResolvingLoadBalancer=Au});var Og=w(vr=>{"use strict";Object.defineProperty(vr,"__esModule",{value:!0});vr.channelOptionsEqual=vr.recognizedOptions=void 0;vr.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0};function yw(n,e){let t=Object.keys(n).sort(),i=Object.keys(e).sort();if(t.length!==i.length)return!1;for(let r=0;r<t.length;r+=1)if(t[r]!==i[r]||n[t[r]]!==e[i[r]])return!1;return!0}vr.channelOptionsEqual=yw});var tn=w(en=>{"use strict";Object.defineProperty(en,"__esModule",{value:!0});en.stringToSubchannelAddress=en.subchannelAddressToString=en.subchannelAddressEqual=en.isTcpSubchannelAddress=void 0;var vw=le("net");function Es(n){return"port"in n}en.isTcpSubchannelAddress=Es;function _w(n,e){return!n&&!e?!0:!n||!e?!1:Es(n)?Es(e)&&n.host===e.host&&n.port===e.port:!Es(e)&&n.path===e.path}en.subchannelAddressEqual=_w;function Tw(n){return Es(n)?n.host+":"+n.port:n.path}en.subchannelAddressToString=Tw;var bw=443;function Sw(n,e){return(0,vw.isIP)(n)?{host:n,port:e??bw}:{path:n}}en.stringToSubchannelAddress=Sw});var ao=w(_r=>{"use strict";Object.defineProperty(_r,"__esModule",{value:!0});_r.addAdminServicesToServer=_r.registerAdminService=void 0;var kg=[];function Cw(n,e){kg.push({getServiceDefinition:n,getHandlers:e})}_r.registerAdminService=Cw;function Ew(n){for(let{getServiceDefinition:e,getHandlers:t}of kg)n.addService(e(),t())}_r.addAdminServicesToServer=Ew});var Ng=w(It=>{"use strict";Object.defineProperty(It,"__esModule",{value:!0});It.ClientDuplexStreamImpl=It.ClientWritableStreamImpl=It.ClientReadableStreamImpl=It.ClientUnaryCallImpl=It.callErrorFromStatus=void 0;var ww=le("events"),ku=le("stream"),ws=oe();function Iw(n,e){let t=`${n.code} ${ws.Status[n.code]}: ${n.details}`,r=`${new Error(t).stack}
for call at
${e}`;return Object.assign(new Error(t),n,{stack:r})}It.callErrorFromStatus=Iw;var Du=class extends ww.EventEmitter{constructor(){super()}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(ws.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}};It.ClientUnaryCallImpl=Du;var Ru=class extends ku.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(ws.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}};It.ClientReadableStreamImpl=Ru;var xu=class extends ku.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(ws.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_write(e,t,i){var r;let s={callback:i},a=Number(t);Number.isNaN(a)||(s.flags=a),(r=this.call)===null||r===void 0||r.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};It.ClientWritableStreamImpl=xu;var Ou=class extends ku.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(ws.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}_write(e,t,i){var r;let s={callback:i},a=Number(t);Number.isNaN(a)||(s.flags=a),(r=this.call)===null||r===void 0||r.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};It.ClientDuplexStreamImpl=Ou});var Mg=w(Tr=>{"use strict";Object.defineProperty(Tr,"__esModule",{value:!0});Tr.InterceptingListenerImpl=Tr.isInterceptingListener=void 0;function Aw(n){return n.onReceiveMetadata!==void 0&&n.onReceiveMetadata.length===1}Tr.isInterceptingListener=Aw;var Nu=class{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,t=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(t),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,t=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=t,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(t),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,t=>{this.processingMetadata||this.processingMessage?this.pendingStatus=t:this.nextListener.onReceiveStatus(t)})}};Tr.InterceptingListenerImpl=Nu});var Vu=w(At=>{"use strict";Object.defineProperty(At,"__esModule",{value:!0});At.getInterceptingCall=At.InterceptingCall=At.RequesterBuilder=At.ListenerBuilder=At.InterceptorConfigurationError=void 0;var Dw=dt(),Pg=Mg(),Lg=oe(),Fg=ja(),As=class n extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,n)}};At.InterceptorConfigurationError=As;var Pu=class{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}};At.ListenerBuilder=Pu;var Lu=class{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}};At.RequesterBuilder=Lu;var Mu={onReceiveMetadata:(n,e)=>{e(n)},onReceiveMessage:(n,e)=>{e(n)},onReceiveStatus:(n,e)=>{e(n)}},Is={start:(n,e,t)=>{t(n,e)},sendMessage:(n,e)=>{e(n)},halfClose:n=>{n()},cancel:n=>{n()}},Fu=class{constructor(e,t){var i,r,s,a;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:(i=t.start)!==null&&i!==void 0?i:Is.start,sendMessage:(r=t.sendMessage)!==null&&r!==void 0?r:Is.sendMessage,halfClose:(s=t.halfClose)!==null&&s!==void 0?s:Is.halfClose,cancel:(a=t.cancel)!==null&&a!==void 0?a:Is.cancel}:this.requester=Is}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var i,r,s,a,o,l;let c={onReceiveMetadata:(r=(i=t?.onReceiveMetadata)===null||i===void 0?void 0:i.bind(t))!==null&&r!==void 0?r:u=>{},onReceiveMessage:(a=(s=t?.onReceiveMessage)===null||s===void 0?void 0:s.bind(t))!==null&&a!==void 0?a:u=>{},onReceiveStatus:(l=(o=t?.onReceiveStatus)===null||o===void 0?void 0:o.bind(t))!==null&&l!==void 0?l:u=>{}};this.processingMetadata=!0,this.requester.start(e,c,(u,m)=>{var p,T,S;this.processingMetadata=!1;let E;if((0,Pg.isInterceptingListener)(m))E=m;else{let C={onReceiveMetadata:(p=m.onReceiveMetadata)!==null&&p!==void 0?p:Mu.onReceiveMetadata,onReceiveMessage:(T=m.onReceiveMessage)!==null&&T!==void 0?T:Mu.onReceiveMessage,onReceiveStatus:(S=m.onReceiveStatus)!==null&&S!==void 0?S:Mu.onReceiveStatus};E=new Pg.InterceptingListenerImpl(C,c)}this.nextCall.start(u,E),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,i=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,i),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}};At.InterceptingCall=Fu;function Rw(n,e,t){var i,r;let s=(i=t.deadline)!==null&&i!==void 0?i:1/0,a=t.host,o=(r=t.parent)!==null&&r!==void 0?r:null,l=t.propagate_flags,c=t.credentials,u=n.createCall(e,s,a,o,l);return c&&u.setCredentials(c),u}var oo=class{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let i;try{i=this.methodDefinition.requestSerialize(t)}catch(r){this.call.cancelWithStatus(Lg.Status.INTERNAL,`Request message serialization failure: ${(0,Fg.getErrorMessage)(r)}`);return}this.call.sendMessageWithContext(e,i)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let i=null;this.call.start(e,{onReceiveMetadata:r=>{var s;(s=t?.onReceiveMetadata)===null||s===void 0||s.call(t,r)},onReceiveMessage:r=>{var s;let a;try{a=this.methodDefinition.responseDeserialize(r)}catch(o){i={code:Lg.Status.INTERNAL,details:`Response message parsing error: ${(0,Fg.getErrorMessage)(o)}`,metadata:new Dw.Metadata},this.call.cancelWithStatus(i.code,i.details);return}(s=t?.onReceiveMessage)===null||s===void 0||s.call(t,a)},onReceiveStatus:r=>{var s,a;i?(s=t?.onReceiveStatus)===null||s===void 0||s.call(t,i):(a=t?.onReceiveStatus)===null||a===void 0||a.call(t,r)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}},Bu=class extends oo{constructor(e,t){super(e,t)}start(e,t){var i,r;let s=!1,a={onReceiveMetadata:(r=(i=t?.onReceiveMetadata)===null||i===void 0?void 0:i.bind(t))!==null&&r!==void 0?r:o=>{},onReceiveMessage:o=>{var l;s=!0,(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,o)},onReceiveStatus:o=>{var l,c;s||(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,null),(c=t?.onReceiveStatus)===null||c===void 0||c.call(t,o)}};super.start(e,a),this.call.startRead()}},qu=class extends oo{};function xw(n,e,t){let i=Rw(n,t.path,e);return t.responseStream?new qu(i,t):new Bu(i,t)}function Ow(n,e,t,i){if(n.clientInterceptors.length>0&&n.clientInterceptorProviders.length>0)throw new As("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(n.callInterceptors.length>0&&n.callInterceptorProviders.length>0)throw new As("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let r=[];n.callInterceptors.length>0||n.callInterceptorProviders.length>0?r=[].concat(n.callInterceptors,n.callInterceptorProviders.map(o=>o(e))).filter(o=>o):r=[].concat(n.clientInterceptors,n.clientInterceptorProviders.map(o=>o(e))).filter(o=>o);let s=Object.assign({},t,{method_definition:e});return r.reduceRight((o,l)=>c=>l(c,o),o=>xw(i,o,e))(s)}At.getInterceptingCall=Ow});var Gu=w(co=>{"use strict";Object.defineProperty(co,"__esModule",{value:!0});co.Client=void 0;var nn=Ng(),kw=$u(),Nw=Et(),Zn=oe(),br=dt(),lo=Vu(),Lt=Symbol(),Sr=Symbol(),Cr=Symbol(),wn=Symbol();function Uu(n){return typeof n=="function"}function Er(n){return n.stack.split(`
`).slice(1).join(`
`)}var zu=class{constructor(e,t,i={}){var r,s;if(i=Object.assign({},i),this[Sr]=(r=i.interceptors)!==null&&r!==void 0?r:[],delete i.interceptors,this[Cr]=(s=i.interceptor_providers)!==null&&s!==void 0?s:[],delete i.interceptor_providers,this[Sr].length>0&&this[Cr].length>0)throw new Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[wn]=i.callInvocationTransformer,delete i.callInvocationTransformer,i.channelOverride)this[Lt]=i.channelOverride;else if(i.channelFactoryOverride){let a=i.channelFactoryOverride;delete i.channelFactoryOverride,this[Lt]=a(e,t,i)}else this[Lt]=new kw.ChannelImplementation(e,t,i)}close(){this[Lt].close()}getChannel(){return this[Lt]}waitForReady(e,t){let i=r=>{if(r){t(new Error("Failed to connect before the deadline"));return}let s;try{s=this[Lt].getConnectivityState(!0)}catch{t(new Error("The channel has been closed"));return}if(s===Nw.ConnectivityState.READY)t();else try{this[Lt].watchConnectivityState(s,e,i)}catch{t(new Error("The channel has been closed"))}};setImmediate(i)}checkOptionalUnaryResponseArguments(e,t,i){if(Uu(e))return{metadata:new br.Metadata,options:{},callback:e};if(Uu(t))return e instanceof br.Metadata?{metadata:e,options:{},callback:t}:{metadata:new br.Metadata,options:e,callback:t};if(!(e instanceof br.Metadata&&t instanceof Object&&Uu(i)))throw new Error("Incorrect arguments passed");return{metadata:e,options:t,callback:i}}makeUnaryRequest(e,t,i,r,s,a,o){var l,c;let u=this.checkOptionalUnaryResponseArguments(s,a,o),m={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:i},p={argument:r,metadata:u.metadata,call:new nn.ClientUnaryCallImpl,channel:this[Lt],methodDefinition:m,callOptions:u.options,callback:u.callback};this[wn]&&(p=this[wn](p));let T=p.call,S={clientInterceptors:this[Sr],clientInterceptorProviders:this[Cr],callInterceptors:(l=p.callOptions.interceptors)!==null&&l!==void 0?l:[],callInterceptorProviders:(c=p.callOptions.interceptor_providers)!==null&&c!==void 0?c:[]},E=(0,lo.getInterceptingCall)(S,p.methodDefinition,p.callOptions,p.channel);T.call=E;let C=null,O=!1,I=new Error;return E.start(p.metadata,{onReceiveMetadata:L=>{T.emit("metadata",L)},onReceiveMessage(L){C!==null&&E.cancelWithStatus(Zn.Status.INTERNAL,"Too many responses received"),C=L},onReceiveStatus(L){if(!O){if(O=!0,L.code===Zn.Status.OK)if(C===null){let M=Er(I);p.callback((0,nn.callErrorFromStatus)({code:Zn.Status.INTERNAL,details:"No message received",metadata:L.metadata},M))}else p.callback(null,C);else{let M=Er(I);p.callback((0,nn.callErrorFromStatus)(L,M))}I=null,T.emit("status",L)}}}),E.sendMessage(r),E.halfClose(),T}makeClientStreamRequest(e,t,i,r,s,a){var o,l;let c=this.checkOptionalUnaryResponseArguments(r,s,a),u={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:i},m={metadata:c.metadata,call:new nn.ClientWritableStreamImpl(t),channel:this[Lt],methodDefinition:u,callOptions:c.options,callback:c.callback};this[wn]&&(m=this[wn](m));let p=m.call,T={clientInterceptors:this[Sr],clientInterceptorProviders:this[Cr],callInterceptors:(o=m.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(l=m.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},S=(0,lo.getInterceptingCall)(T,m.methodDefinition,m.callOptions,m.channel);p.call=S;let E=null,C=!1,O=new Error;return S.start(m.metadata,{onReceiveMetadata:I=>{p.emit("metadata",I)},onReceiveMessage(I){E!==null&&S.cancelWithStatus(Zn.Status.INTERNAL,"Too many responses received"),E=I},onReceiveStatus(I){if(!C){if(C=!0,I.code===Zn.Status.OK)if(E===null){let L=Er(O);m.callback((0,nn.callErrorFromStatus)({code:Zn.Status.INTERNAL,details:"No message received",metadata:I.metadata},L))}else m.callback(null,E);else{let L=Er(O);m.callback((0,nn.callErrorFromStatus)(I,L))}O=null,p.emit("status",I)}}}),p}checkMetadataAndOptions(e,t){let i,r;return e instanceof br.Metadata?(i=e,t?r=t:r={}):(e?r=e:r={},i=new br.Metadata),{metadata:i,options:r}}makeServerStreamRequest(e,t,i,r,s,a){var o,l;let c=this.checkMetadataAndOptions(s,a),u={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:i},m={argument:r,metadata:c.metadata,call:new nn.ClientReadableStreamImpl(i),channel:this[Lt],methodDefinition:u,callOptions:c.options};this[wn]&&(m=this[wn](m));let p=m.call,T={clientInterceptors:this[Sr],clientInterceptorProviders:this[Cr],callInterceptors:(o=m.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(l=m.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},S=(0,lo.getInterceptingCall)(T,m.methodDefinition,m.callOptions,m.channel);p.call=S;let E=!1,C=new Error;return S.start(m.metadata,{onReceiveMetadata(O){p.emit("metadata",O)},onReceiveMessage(O){p.push(O)},onReceiveStatus(O){if(!E){if(E=!0,p.push(null),O.code!==Zn.Status.OK){let I=Er(C);p.emit("error",(0,nn.callErrorFromStatus)(O,I))}C=null,p.emit("status",O)}}}),S.sendMessage(r),S.halfClose(),p}makeBidiStreamRequest(e,t,i,r,s){var a,o;let l=this.checkMetadataAndOptions(r,s),c={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:i},u={metadata:l.metadata,call:new nn.ClientDuplexStreamImpl(t,i),channel:this[Lt],methodDefinition:c,callOptions:l.options};this[wn]&&(u=this[wn](u));let m=u.call,p={clientInterceptors:this[Sr],clientInterceptorProviders:this[Cr],callInterceptors:(a=u.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(o=u.callOptions.interceptor_providers)!==null&&o!==void 0?o:[]},T=(0,lo.getInterceptingCall)(p,u.methodDefinition,u.callOptions,u.channel);m.call=T;let S=!1,E=new Error;return T.start(u.metadata,{onReceiveMetadata(C){m.emit("metadata",C)},onReceiveMessage(C){m.push(C)},onReceiveStatus(C){if(!S){if(S=!0,m.push(null),C.code!==Zn.Status.OK){let O=Er(E);m.emit("error",(0,nn.callErrorFromStatus)(C,O))}E=null,m.emit("status",C)}}}),m}};co.Client=zu});var Wu=w(wr=>{"use strict";Object.defineProperty(wr,"__esModule",{value:!0});wr.loadPackageDefinition=wr.makeClientConstructor=void 0;var Ds=Gu(),Mw={unary:Ds.Client.prototype.makeUnaryRequest,server_stream:Ds.Client.prototype.makeServerStreamRequest,client_stream:Ds.Client.prototype.makeClientStreamRequest,bidi:Ds.Client.prototype.makeBidiStreamRequest};function ju(n){return["__proto__","prototype","constructor"].includes(n)}function Bg(n,e,t){t||(t={});class i extends Ds.Client{}return Object.keys(n).forEach(r=>{if(ju(r))return;let s=n[r],a;if(typeof r=="string"&&r.charAt(0)==="$")throw new Error("Method names cannot start with $");s.requestStream?s.responseStream?a="bidi":a="client_stream":s.responseStream?a="server_stream":a="unary";let o=s.requestSerialize,l=s.responseDeserialize,c=Pw(Mw[a],s.path,o,l);i.prototype[r]=c,Object.assign(i.prototype[r],s),s.originalName&&!ju(s.originalName)&&(i.prototype[s.originalName]=i.prototype[r])}),i.service=n,i.serviceName=e,i}wr.makeClientConstructor=Bg;function Pw(n,e,t,i){return function(...r){return n.call(this,e,t,i,...r)}}function Lw(n){return"format"in n}function Fw(n){let e={};for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let i=n[t],r=t.split(".");if(r.some(o=>ju(o)))continue;let s=r[r.length-1],a=e;for(let o of r.slice(0,-1))a[o]||(a[o]={}),a=a[o];Lw(i)?a[s]=i:a[s]=Bg(i,s,{})}return e}wr.loadPackageDefinition=Fw});var cy=w((UB,ly)=>{"use strict";var Bw=1/0,qw="[object Symbol]",Vw=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Uw=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ho="\\ud800-\\udfff",Wg="\\u0300-\\u036f\\ufe20-\\ufe23",Hg="\\u20d0-\\u20f0",Kg="\\u2700-\\u27bf",Qg="a-z\\xdf-\\xf6\\xf8-\\xff",zw="\\xac\\xb1\\xd7\\xf7",Gw="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",$w="\\u2000-\\u206f",jw=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Yg="A-Z\\xc0-\\xd6\\xd8-\\xde",Jg="\\ufe0e\\ufe0f",Xg=zw+Gw+$w+jw,Ku="['\u2019]",Ww="["+ho+"]",qg="["+Xg+"]",uo="["+Wg+Hg+"]",Zg="\\d+",Hw="["+Kg+"]",ey="["+Qg+"]",ty="[^"+ho+Xg+Zg+Kg+Qg+Yg+"]",Hu="\\ud83c[\\udffb-\\udfff]",Kw="(?:"+uo+"|"+Hu+")",ny="[^"+ho+"]",Qu="(?:\\ud83c[\\udde6-\\uddff]){2}",Yu="[\\ud800-\\udbff][\\udc00-\\udfff]",Ir="["+Yg+"]",iy="\\u200d",Vg="(?:"+ey+"|"+ty+")",Qw="(?:"+Ir+"|"+ty+")",Ug="(?:"+Ku+"(?:d|ll|m|re|s|t|ve))?",zg="(?:"+Ku+"(?:D|LL|M|RE|S|T|VE))?",ry=Kw+"?",sy="["+Jg+"]?",Yw="(?:"+iy+"(?:"+[ny,Qu,Yu].join("|")+")"+sy+ry+")*",ay=sy+ry+Yw,Jw="(?:"+[Hw,Qu,Yu].join("|")+")"+ay,Xw="(?:"+[ny+uo+"?",uo,Qu,Yu,Ww].join("|")+")",Zw=RegExp(Ku,"g"),eI=RegExp(uo,"g"),tI=RegExp(Hu+"(?="+Hu+")|"+Xw+ay,"g"),nI=RegExp([Ir+"?"+ey+"+"+Ug+"(?="+[qg,Ir,"$"].join("|")+")",Qw+"+"+zg+"(?="+[qg,Ir+Vg,"$"].join("|")+")",Ir+"?"+Vg+"+"+Ug,Ir+"+"+zg,Zg,Jw].join("|"),"g"),iI=RegExp("["+iy+ho+Wg+Hg+Jg+"]"),rI=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,sI={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"ss"},aI=typeof global=="object"&&global&&global.Object===Object&&global,oI=typeof self=="object"&&self&&self.Object===Object&&self,lI=aI||oI||Function("return this")();function cI(n,e,t,i){var r=-1,s=n?n.length:0;for(i&&s&&(t=n[++r]);++r<s;)t=e(t,n[r],r,n);return t}function uI(n){return n.split("")}function dI(n){return n.match(Vw)||[]}function hI(n){return function(e){return n?.[e]}}var fI=hI(sI);function oy(n){return iI.test(n)}function pI(n){return rI.test(n)}function mI(n){return oy(n)?gI(n):uI(n)}function gI(n){return n.match(tI)||[]}function yI(n){return n.match(nI)||[]}var vI=Object.prototype,_I=vI.toString,Gg=lI.Symbol,$g=Gg?Gg.prototype:void 0,jg=$g?$g.toString:void 0;function TI(n,e,t){var i=-1,r=n.length;e<0&&(e=-e>r?0:r+e),t=t>r?r:t,t<0&&(t+=r),r=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(r);++i<r;)s[i]=n[i+e];return s}function bI(n){if(typeof n=="string")return n;if(II(n))return jg?jg.call(n):"";var e=n+"";return e=="0"&&1/n==-Bw?"-0":e}function SI(n,e,t){var i=n.length;return t=t===void 0?i:t,!e&&t>=i?n:TI(n,e,t)}function CI(n){return function(e){e=fo(e);var t=oy(e)?mI(e):void 0,i=t?t[0]:e.charAt(0),r=t?SI(t,1).join(""):e.slice(1);return i[n]()+r}}function EI(n){return function(e){return cI(OI(RI(e).replace(Zw,"")),n,"")}}function wI(n){return!!n&&typeof n=="object"}function II(n){return typeof n=="symbol"||wI(n)&&_I.call(n)==qw}function fo(n){return n==null?"":bI(n)}var AI=EI(function(n,e,t){return e=e.toLowerCase(),n+(t?DI(e):e)});function DI(n){return xI(fo(n).toLowerCase())}function RI(n){return n=fo(n),n&&n.replace(Uw,fI).replace(eI,"")}var xI=CI("toUpperCase");function OI(n,e,t){return n=fo(n),e=t?void 0:e,e===void 0?pI(n)?yI(n):dI(n):n.match(e)||[]}ly.exports=AI});var Ju=w((zB,uy)=>{"use strict";uy.exports=kI;function kI(n,e){for(var t=new Array(arguments.length-1),i=0,r=2,s=!0;r<arguments.length;)t[i++]=arguments[r++];return new Promise(function(o,l){t[i]=function(u){if(s)if(s=!1,u)l(u);else{for(var m=new Array(arguments.length-1),p=0;p<m.length;)m[p++]=arguments[p];o.apply(null,m)}};try{n.apply(e||null,t)}catch(c){s&&(s=!1,l(c))}})}});var py=w(fy=>{"use strict";var po=fy;po.length=function(e){var t=e.length;if(!t)return 0;for(var i=0;--t%4>1&&e.charAt(t)==="=";)++i;return Math.ceil(e.length*3)/4-i};var Ar=new Array(64),hy=new Array(123);for(Ft=0;Ft<64;)hy[Ar[Ft]=Ft<26?Ft+65:Ft<52?Ft+71:Ft<62?Ft-4:Ft-59|43]=Ft++;var Ft;po.encode=function(e,t,i){for(var r=null,s=[],a=0,o=0,l;t<i;){var c=e[t++];switch(o){case 0:s[a++]=Ar[c>>2],l=(c&3)<<4,o=1;break;case 1:s[a++]=Ar[l|c>>4],l=(c&15)<<2,o=2;break;case 2:s[a++]=Ar[l|c>>6],s[a++]=Ar[c&63],o=0;break}a>8191&&((r||(r=[])).push(String.fromCharCode.apply(String,s)),a=0)}return o&&(s[a++]=Ar[l],s[a++]=61,o===1&&(s[a++]=61)),r?(a&&r.push(String.fromCharCode.apply(String,s.slice(0,a))),r.join("")):String.fromCharCode.apply(String,s.slice(0,a))};var dy="invalid encoding";po.decode=function(e,t,i){for(var r=i,s=0,a,o=0;o<e.length;){var l=e.charCodeAt(o++);if(l===61&&s>1)break;if((l=hy[l])===void 0)throw Error(dy);switch(s){case 0:a=l,s=1;break;case 1:t[i++]=a<<2|(l&48)>>4,a=l,s=2;break;case 2:t[i++]=(a&15)<<4|(l&60)>>2,a=l,s=3;break;case 3:t[i++]=(a&3)<<6|l,s=0;break}}if(s===1)throw Error(dy);return i-r};po.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var gy=w(($B,my)=>{"use strict";my.exports=mo;function mo(){this._listeners={}}mo.prototype.on=function(e,t,i){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:i||this}),this};mo.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var i=this._listeners[e],r=0;r<i.length;)i[r].fn===t?i.splice(r,1):++r;return this};mo.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var i=[],r=1;r<arguments.length;)i.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,i)}return this}});var Cy=w((jB,Sy)=>{"use strict";Sy.exports=yy(yy);function yy(n){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),i=t[3]===128;function r(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3]}function s(l,c,u){e[0]=l,c[u]=t[3],c[u+1]=t[2],c[u+2]=t[1],c[u+3]=t[0]}n.writeFloatLE=i?r:s,n.writeFloatBE=i?s:r;function a(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],e[0]}function o(l,c){return t[3]=l[c],t[2]=l[c+1],t[1]=l[c+2],t[0]=l[c+3],e[0]}n.readFloatLE=i?a:o,n.readFloatBE=i?o:a}():function(){function e(i,r,s,a){var o=r<0?1:0;if(o&&(r=-r),r===0)i(1/r>0?0:2147483648,s,a);else if(isNaN(r))i(2143289344,s,a);else if(r>34028234663852886e22)i((o<<31|2139095040)>>>0,s,a);else if(r<11754943508222875e-54)i((o<<31|Math.round(r/1401298464324817e-60))>>>0,s,a);else{var l=Math.floor(Math.log(r)/Math.LN2),c=Math.round(r*Math.pow(2,-l)*8388608)&8388607;i((o<<31|l+127<<23|c)>>>0,s,a)}}n.writeFloatLE=e.bind(null,vy),n.writeFloatBE=e.bind(null,_y);function t(i,r,s){var a=i(r,s),o=(a>>31)*2+1,l=a>>>23&255,c=a&8388607;return l===255?c?NaN:o*(1/0):l===0?o*1401298464324817e-60*c:o*Math.pow(2,l-150)*(c+8388608)}n.readFloatLE=t.bind(null,Ty),n.readFloatBE=t.bind(null,by)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),i=t[7]===128;function r(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3],c[u+4]=t[4],c[u+5]=t[5],c[u+6]=t[6],c[u+7]=t[7]}function s(l,c,u){e[0]=l,c[u]=t[7],c[u+1]=t[6],c[u+2]=t[5],c[u+3]=t[4],c[u+4]=t[3],c[u+5]=t[2],c[u+6]=t[1],c[u+7]=t[0]}n.writeDoubleLE=i?r:s,n.writeDoubleBE=i?s:r;function a(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],t[4]=l[c+4],t[5]=l[c+5],t[6]=l[c+6],t[7]=l[c+7],e[0]}function o(l,c){return t[7]=l[c],t[6]=l[c+1],t[5]=l[c+2],t[4]=l[c+3],t[3]=l[c+4],t[2]=l[c+5],t[1]=l[c+6],t[0]=l[c+7],e[0]}n.readDoubleLE=i?a:o,n.readDoubleBE=i?o:a}():function(){function e(i,r,s,a,o,l){var c=a<0?1:0;if(c&&(a=-a),a===0)i(0,o,l+r),i(1/a>0?0:2147483648,o,l+s);else if(isNaN(a))i(0,o,l+r),i(2146959360,o,l+s);else if(a>17976931348623157e292)i(0,o,l+r),i((c<<31|2146435072)>>>0,o,l+s);else{var u;if(a<22250738585072014e-324)u=a/5e-324,i(u>>>0,o,l+r),i((c<<31|u/4294967296)>>>0,o,l+s);else{var m=Math.floor(Math.log(a)/Math.LN2);m===1024&&(m=1023),u=a*Math.pow(2,-m),i(u*4503599627370496>>>0,o,l+r),i((c<<31|m+1023<<20|u*1048576&1048575)>>>0,o,l+s)}}}n.writeDoubleLE=e.bind(null,vy,0,4),n.writeDoubleBE=e.bind(null,_y,4,0);function t(i,r,s,a,o){var l=i(a,o+r),c=i(a,o+s),u=(c>>31)*2+1,m=c>>>20&2047,p=4294967296*(c&1048575)+l;return m===2047?p?NaN:u*(1/0):m===0?u*5e-324*p:u*Math.pow(2,m-1075)*(p+4503599627370496)}n.readDoubleLE=t.bind(null,Ty,0,4),n.readDoubleBE=t.bind(null,by,4,0)}(),n}function vy(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}function _y(n,e,t){e[t]=n>>>24,e[t+1]=n>>>16&255,e[t+2]=n>>>8&255,e[t+3]=n&255}function Ty(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0}function by(n,e){return(n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3])>>>0}});var Xu=w((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(n){}return null}});var wy=w(Ey=>{"use strict";var Zu=Ey;Zu.length=function(e){for(var t=0,i=0,r=0;r<e.length;++r)i=e.charCodeAt(r),i<128?t+=1:i<2048?t+=2:(i&64512)===55296&&(e.charCodeAt(r+1)&64512)===56320?(++r,t+=4):t+=3;return t};Zu.read=function(e,t,i){var r=i-t;if(r<1)return"";for(var s=null,a=[],o=0,l;t<i;)l=e[t++],l<128?a[o++]=l:l>191&&l<224?a[o++]=(l&31)<<6|e[t++]&63:l>239&&l<365?(l=((l&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,a[o++]=55296+(l>>10),a[o++]=56320+(l&1023)):a[o++]=(l&15)<<12|(e[t++]&63)<<6|e[t++]&63,o>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,a)),o=0);return s?(o&&s.push(String.fromCharCode.apply(String,a.slice(0,o))),s.join("")):String.fromCharCode.apply(String,a.slice(0,o))};Zu.write=function(e,t,i){for(var r=i,s,a,o=0;o<e.length;++o)s=e.charCodeAt(o),s<128?t[i++]=s:s<2048?(t[i++]=s>>6|192,t[i++]=s&63|128):(s&64512)===55296&&((a=e.charCodeAt(o+1))&64512)===56320?(s=65536+((s&1023)<<10)+(a&1023),++o,t[i++]=s>>18|240,t[i++]=s>>12&63|128,t[i++]=s>>6&63|128,t[i++]=s&63|128):(t[i++]=s>>12|224,t[i++]=s>>6&63|128,t[i++]=s&63|128);return i-r}});var Ay=w((HB,Iy)=>{"use strict";Iy.exports=NI;function NI(n,e,t){var i=t||8192,r=i>>>1,s=null,a=i;return function(l){if(l<1||l>r)return n(l);a+l>i&&(s=n(i),a=0);var c=e.call(s,a,a+=l);return a&7&&(a=(a|7)+1),c}}});var Ry=w((KB,Dy)=>{"use strict";Dy.exports=Ge;var Rs=rn();function Ge(n,e){this.lo=n>>>0,this.hi=e>>>0}var Ni=Ge.zero=new Ge(0,0);Ni.toNumber=function(){return 0};Ni.zzEncode=Ni.zzDecode=function(){return this};Ni.length=function(){return 1};var MI=Ge.zeroHash="\0\0\0\0\0\0\0\0";Ge.fromNumber=function(e){if(e===0)return Ni;var t=e<0;t&&(e=-e);var i=e>>>0,r=(e-i)/4294967296>>>0;return t&&(r=~r>>>0,i=~i>>>0,++i>4294967295&&(i=0,++r>4294967295&&(r=0))),new Ge(i,r)};Ge.from=function(e){if(typeof e=="number")return Ge.fromNumber(e);if(Rs.isString(e))if(Rs.Long)e=Rs.Long.fromString(e);else return Ge.fromNumber(parseInt(e,10));return e.low||e.high?new Ge(e.low>>>0,e.high>>>0):Ni};Ge.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,i=~this.hi>>>0;return t||(i=i+1>>>0),-(t+i*4294967296)}return this.lo+this.hi*4294967296};Ge.prototype.toLong=function(e){return Rs.Long?new Rs.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var ei=String.prototype.charCodeAt;Ge.fromHash=function(e){return e===MI?Ni:new Ge((ei.call(e,0)|ei.call(e,1)<<8|ei.call(e,2)<<16|ei.call(e,3)<<24)>>>0,(ei.call(e,4)|ei.call(e,5)<<8|ei.call(e,6)<<16|ei.call(e,7)<<24)>>>0)};Ge.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};Ge.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};Ge.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};Ge.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,i=this.hi>>>24;return i===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:i<128?9:10}});var rn=w(ed=>{"use strict";var q=ed;q.asPromise=Ju();q.base64=py();q.EventEmitter=gy();q.float=Cy();q.inquire=Xu();q.utf8=wy();q.pool=Ay();q.LongBits=Ry();q.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);q.global=q.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||ed;q.emptyArray=Object.freeze?Object.freeze([]):[];q.emptyObject=Object.freeze?Object.freeze({}):{};q.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};q.isString=function(e){return typeof e=="string"||e instanceof String};q.isObject=function(e){return e&&typeof e=="object"};q.isset=q.isSet=function(e,t){var i=e[t];return i!=null&&e.hasOwnProperty(t)?typeof i!="object"||(Array.isArray(i)?i.length:Object.keys(i).length)>0:!1};q.Buffer=function(){try{var n=q.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch{return null}}();q._Buffer_from=null;q._Buffer_allocUnsafe=null;q.newBuffer=function(e){return typeof e=="number"?q.Buffer?q._Buffer_allocUnsafe(e):new q.Array(e):q.Buffer?q._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};q.Array=typeof Uint8Array<"u"?Uint8Array:Array;q.Long=q.global.dcodeIO&&q.global.dcodeIO.Long||q.global.Long||q.inquire("long");q.key2Re=/^true|false|0|1$/;q.key32Re=/^-?(?:0|[1-9][0-9]*)$/;q.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;q.longToHash=function(e){return e?q.LongBits.from(e).toHash():q.LongBits.zeroHash};q.longFromHash=function(e,t){var i=q.LongBits.fromHash(e);return q.Long?q.Long.fromBits(i.lo,i.hi,t):i.toNumber(!!t)};function xy(n,e,t){for(var i=Object.keys(e),r=0;r<i.length;++r)(n[i[r]]===void 0||!t)&&(n[i[r]]=e[i[r]]);return n}q.merge=xy;q.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function Oy(n){function e(t,i){if(!(this instanceof e))return new e(t,i);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),i&&xy(this,i)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return n},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}q.newError=Oy;q.ProtocolError=Oy("ProtocolError");q.oneOfGetter=function(e){for(var t={},i=0;i<e.length;++i)t[e[i]]=1;return function(){for(var r=Object.keys(this),s=r.length-1;s>-1;--s)if(t[r[s]]===1&&this[r[s]]!==void 0&&this[r[s]]!==null)return r[s]}};q.oneOfSetter=function(e){return function(t){for(var i=0;i<e.length;++i)e[i]!==t&&delete this[e[i]]}};q.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};q._configure=function(){var n=q.Buffer;if(!n){q._Buffer_from=q._Buffer_allocUnsafe=null;return}q._Buffer_from=n.from!==Uint8Array.from&&n.from||function(t,i){return new n(t,i)},q._Buffer_allocUnsafe=n.allocUnsafe||function(t){return new n(t)}}});var yo=w((YB,Py)=>{"use strict";Py.exports=ie;var Dt=rn(),td,go=Dt.LongBits,ky=Dt.base64,Ny=Dt.utf8;function xs(n,e,t){this.fn=n,this.len=e,this.next=void 0,this.val=t}function id(){}function PI(n){this.head=n.head,this.tail=n.tail,this.len=n.len,this.next=n.states}function ie(){this.len=0,this.head=new xs(id,0,0),this.tail=this.head,this.states=null}var My=function(){return Dt.Buffer?function(){return(ie.create=function(){return new td})()}:function(){return new ie}};ie.create=My();ie.alloc=function(e){return new Dt.Array(e)};Dt.Array!==Array&&(ie.alloc=Dt.pool(ie.alloc,Dt.Array.prototype.subarray));ie.prototype._push=function(e,t,i){return this.tail=this.tail.next=new xs(e,t,i),this.len+=t,this};function rd(n,e,t){e[t]=n&255}function LI(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}function sd(n,e){this.len=n,this.next=void 0,this.val=e}sd.prototype=Object.create(xs.prototype);sd.prototype.fn=LI;ie.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new sd((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};ie.prototype.int32=function(e){return e<0?this._push(ad,10,go.fromNumber(e)):this.uint32(e)};ie.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function ad(n,e,t){for(;n.hi;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}ie.prototype.uint64=function(e){var t=go.from(e);return this._push(ad,t.length(),t)};ie.prototype.int64=ie.prototype.uint64;ie.prototype.sint64=function(e){var t=go.from(e).zzEncode();return this._push(ad,t.length(),t)};ie.prototype.bool=function(e){return this._push(rd,1,e?1:0)};function nd(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}ie.prototype.fixed32=function(e){return this._push(nd,4,e>>>0)};ie.prototype.sfixed32=ie.prototype.fixed32;ie.prototype.fixed64=function(e){var t=go.from(e);return this._push(nd,4,t.lo)._push(nd,4,t.hi)};ie.prototype.sfixed64=ie.prototype.fixed64;ie.prototype.float=function(e){return this._push(Dt.float.writeFloatLE,4,e)};ie.prototype.double=function(e){return this._push(Dt.float.writeDoubleLE,8,e)};var FI=Dt.Array.prototype.set?function(e,t,i){t.set(e,i)}:function(e,t,i){for(var r=0;r<e.length;++r)t[i+r]=e[r]};ie.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(rd,1,0);if(Dt.isString(e)){var i=ie.alloc(t=ky.length(e));ky.decode(e,i,0),e=i}return this.uint32(t)._push(FI,t,e)};ie.prototype.string=function(e){var t=Ny.length(e);return t?this.uint32(t)._push(Ny.write,t,e):this._push(rd,1,0)};ie.prototype.fork=function(){return this.states=new PI(this),this.head=this.tail=new xs(id,0,0),this.len=0,this};ie.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new xs(id,0,0),this.len=0),this};ie.prototype.ldelim=function(){var e=this.head,t=this.tail,i=this.len;return this.reset().uint32(i),i&&(this.tail.next=e.next,this.tail=t,this.len+=i),this};ie.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),i=0;e;)e.fn(e.val,t,i),i+=e.len,e=e.next;return t};ie._configure=function(n){td=n,ie.create=My(),td._configure()}});var By=w((JB,Fy)=>{"use strict";Fy.exports=sn;var Ly=yo();(sn.prototype=Object.create(Ly.prototype)).constructor=sn;var ti=rn();function sn(){Ly.call(this)}sn._configure=function(){sn.alloc=ti._Buffer_allocUnsafe,sn.writeBytesBuffer=ti.Buffer&&ti.Buffer.prototype instanceof Uint8Array&&ti.Buffer.prototype.set.name==="set"?function(e,t,i){t.set(e,i)}:function(e,t,i){if(e.copy)e.copy(t,i,0,e.length);else for(var r=0;r<e.length;)t[i++]=e[r++]}};sn.prototype.bytes=function(e){ti.isString(e)&&(e=ti._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(sn.writeBytesBuffer,t,e),this};function BI(n,e,t){n.length<40?ti.utf8.write(n,e,t):e.utf8Write?e.utf8Write(n,t):e.write(n,t)}sn.prototype.string=function(e){var t=ti.Buffer.byteLength(e);return this.uint32(t),t&&this._push(BI,t,e),this};sn._configure()});var _o=w((XB,Gy)=>{"use strict";Gy.exports=xe;var Bt=rn(),ld,Uy=Bt.LongBits,qI=Bt.utf8;function qt(n,e){return RangeError("index out of range: "+n.pos+" + "+(e||1)+" > "+n.len)}function xe(n){this.buf=n,this.pos=0,this.len=n.length}var qy=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new xe(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new xe(e);throw Error("illegal buffer")},zy=function(){return Bt.Buffer?function(t){return(xe.create=function(r){return Bt.Buffer.isBuffer(r)?new ld(r):qy(r)})(t)}:qy};xe.create=zy();xe.prototype._slice=Bt.Array.prototype.subarray||Bt.Array.prototype.slice;xe.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,qt(this,10);return e}}();xe.prototype.int32=function(){return this.uint32()|0};xe.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function od(){var n=new Uy(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n;if(n.lo=(n.lo|(this.buf[this.pos]&127)<<28)>>>0,n.hi=(n.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return n;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw qt(this);if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n}return n.lo=(n.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,n}if(this.len-this.pos>4){for(;e<5;++e)if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}else for(;e<5;++e){if(this.pos>=this.len)throw qt(this);if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}throw Error("invalid varint encoding")}xe.prototype.bool=function(){return this.uint32()!==0};function vo(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}xe.prototype.fixed32=function(){if(this.pos+4>this.len)throw qt(this,4);return vo(this.buf,this.pos+=4)};xe.prototype.sfixed32=function(){if(this.pos+4>this.len)throw qt(this,4);return vo(this.buf,this.pos+=4)|0};function Vy(){if(this.pos+8>this.len)throw qt(this,8);return new Uy(vo(this.buf,this.pos+=4),vo(this.buf,this.pos+=4))}xe.prototype.float=function(){if(this.pos+4>this.len)throw qt(this,4);var e=Bt.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};xe.prototype.double=function(){if(this.pos+8>this.len)throw qt(this,4);var e=Bt.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};xe.prototype.bytes=function(){var e=this.uint32(),t=this.pos,i=this.pos+e;if(i>this.len)throw qt(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,i);if(t===i){var r=Bt.Buffer;return r?r.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,i)};xe.prototype.string=function(){var e=this.bytes();return qI.read(e,0,e.length)};xe.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw qt(this,e);this.pos+=e}else do if(this.pos>=this.len)throw qt(this);while(this.buf[this.pos++]&128);return this};xe.prototype.skipType=function(n){switch(n){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(n=this.uint32()&7)!==4;)this.skipType(n);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+n+" at offset "+this.pos)}return this};xe._configure=function(n){ld=n,xe.create=zy(),ld._configure();var e=Bt.Long?"toLong":"toNumber";Bt.merge(xe.prototype,{int64:function(){return od.call(this)[e](!1)},uint64:function(){return od.call(this)[e](!0)},sint64:function(){return od.call(this).zzDecode()[e](!1)},fixed64:function(){return Vy.call(this)[e](!0)},sfixed64:function(){return Vy.call(this)[e](!1)}})}});var Hy=w((ZB,Wy)=>{"use strict";Wy.exports=Mi;var jy=_o();(Mi.prototype=Object.create(jy.prototype)).constructor=Mi;var $y=rn();function Mi(n){jy.call(this,n)}Mi._configure=function(){$y.Buffer&&(Mi.prototype._slice=$y.Buffer.prototype.slice)};Mi.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};Mi._configure()});var Qy=w((e3,Ky)=>{"use strict";Ky.exports=Os;var cd=rn();(Os.prototype=Object.create(cd.EventEmitter.prototype)).constructor=Os;function Os(n,e,t){if(typeof n!="function")throw TypeError("rpcImpl must be a function");cd.EventEmitter.call(this),this.rpcImpl=n,this.requestDelimited=!!e,this.responseDelimited=!!t}Os.prototype.rpcCall=function n(e,t,i,r,s){if(!r)throw TypeError("request must be specified");var a=this;if(!s)return cd.asPromise(n,a,e,t,i,r);if(!a.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return a.rpcImpl(e,t[a.requestDelimited?"encodeDelimited":"encode"](r).finish(),function(l,c){if(l)return a.emit("error",l,e),s(l);if(c===null){a.end(!0);return}if(!(c instanceof i))try{c=i[a.responseDelimited?"decodeDelimited":"decode"](c)}catch(u){return a.emit("error",u,e),s(u)}return a.emit("data",c,e),s(null,c)})}catch(o){a.emit("error",o,e),setTimeout(function(){s(o)},0);return}};Os.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var ud=w(Yy=>{"use strict";var VI=Yy;VI.Service=Qy()});var dd=w((n3,Jy)=>{"use strict";Jy.exports={}});var ev=w(Zy=>{"use strict";var ft=Zy;ft.build="minimal";ft.Writer=yo();ft.BufferWriter=By();ft.Reader=_o();ft.BufferReader=Hy();ft.util=rn();ft.rpc=ud();ft.roots=dd();ft.configure=Xy;function Xy(){ft.util._configure(),ft.Writer._configure(ft.BufferWriter),ft.Reader._configure(ft.BufferReader)}Xy()});var nv=w((r3,tv)=>{"use strict";tv.exports=hd;function hd(n,e){typeof n=="string"&&(e=n,n=void 0);var t=[];function i(s){if(typeof s!="string"){var a=r();if(hd.verbose&&console.log("codegen: "+a),a="return "+a,s){for(var o=Object.keys(s),l=new Array(o.length+1),c=new Array(o.length),u=0;u<o.length;)l[u]=o[u],c[u]=s[o[u++]];return l[u]=a,Function.apply(null,l).apply(null,c)}return Function(a)()}for(var m=new Array(arguments.length-1),p=0;p<m.length;)m[p]=arguments[++p];if(p=0,s=s.replace(/%([%dfijs])/g,function(S,E){var C=m[p++];switch(E){case"d":case"f":return String(Number(C));case"i":return String(Math.floor(C));case"j":return JSON.stringify(C);case"s":return String(C)}return"%"}),p!==m.length)throw Error("parameter count mismatch");return t.push(s),i}function r(s){return"function "+(s||e||"")+"("+(n&&n.join(",")||"")+`){
  `+t.join(`
  `)+`
}`}return i.toString=r,i}hd.verbose=!1});var rv=w((s3,iv)=>{"use strict";iv.exports=ks;var UI=Ju(),zI=Xu(),fd=zI("fs");function ks(n,e,t){return typeof e=="function"?(t=e,e={}):e||(e={}),t?!e.xhr&&fd&&fd.readFile?fd.readFile(n,function(r,s){return r&&typeof XMLHttpRequest<"u"?ks.xhr(n,e,t):r?t(r):t(null,e.binary?s:s.toString("utf8"))}):ks.xhr(n,e,t):UI(ks,this,n,e)}ks.xhr=function(e,t,i){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(r.readyState===4){if(r.status!==0&&r.status!==200)return i(Error("status "+r.status));if(t.binary){var a=r.response;if(!a){a=[];for(var o=0;o<r.responseText.length;++o)a.push(r.responseText.charCodeAt(o)&255)}return i(null,typeof Uint8Array<"u"?new Uint8Array(a):a)}return i(null,r.responseText)}},t.binary&&("overrideMimeType"in r&&r.overrideMimeType("text/plain; charset=x-user-defined"),r.responseType="arraybuffer"),r.open("GET",e),r.send()}});var ov=w(av=>{"use strict";var md=av,sv=md.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},pd=md.normalize=function(e){e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/");var t=e.split("/"),i=sv(e),r="";i&&(r=t.shift()+"/");for(var s=0;s<t.length;)t[s]===".."?s>0&&t[s-1]!==".."?t.splice(--s,2):i?t.splice(s,1):++s:t[s]==="."?t.splice(s,1):++s;return r+t.join("/")};md.resolve=function(e,t,i){return i||(t=pd(t)),sv(t)?t:(i||(e=pd(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?pd(e+"/"+t):t)}});var Pi=w(lv=>{"use strict";var Ns=lv,GI=$e(),$I=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function Ms(n,e){var t=0,i={};for(e|=0;t<n.length;)i[$I[t+e]]=n[t++];return i}Ns.basic=Ms([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]);Ns.defaults=Ms([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",GI.emptyArray,null]);Ns.long=Ms([0,0,0,1,1],7);Ns.mapKey=Ms([0,0,0,5,5,0,0,0,1,1,0,2],2);Ns.packed=Ms([1,5,0,0,0,5,5,0,0,0,1,1,0])});var ni=w((l3,dv)=>{"use strict";dv.exports=Rt;var To=Li();((Rt.prototype=Object.create(To.prototype)).constructor=Rt).className="Field";var cv=Vt(),uv=Pi(),Pe=$e(),gd,jI=/^required|optional|repeated$/;Rt.fromJSON=function(e,t){return new Rt(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)};function Rt(n,e,t,i,r,s,a){if(Pe.isObject(i)?(a=r,s=i,i=r=void 0):Pe.isObject(r)&&(a=s,s=r,r=void 0),To.call(this,n,s),!Pe.isInteger(e)||e<0)throw TypeError("id must be a non-negative integer");if(!Pe.isString(t))throw TypeError("type must be a string");if(i!==void 0&&!jI.test(i=i.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(r!==void 0&&!Pe.isString(r))throw TypeError("extend must be a string");i==="proto3_optional"&&(i="optional"),this.rule=i&&i!=="optional"?i:void 0,this.type=t,this.id=e,this.extend=r||void 0,this.required=i==="required",this.optional=!this.required,this.repeated=i==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=Pe.Long?uv.long[t]!==void 0:!1,this.bytes=t==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=a}Object.defineProperty(Rt.prototype,"packed",{get:function(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}});Rt.prototype.setOption=function(e,t,i){return e==="packed"&&(this._packed=null),To.prototype.setOption.call(this,e,t,i)};Rt.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Pe.toObject(["rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};Rt.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=uv.defaults[this.type])===void 0?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof gd?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof cv&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&((this.options.packed===!0||this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof cv))&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=Pe.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var e;Pe.base64.test(this.typeDefault)?Pe.base64.decode(this.typeDefault,e=Pe.newBuffer(Pe.base64.length(this.typeDefault)),0):Pe.utf8.write(this.typeDefault,e=Pe.newBuffer(Pe.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=Pe.emptyObject:this.repeated?this.defaultValue=Pe.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof gd&&(this.parent.ctor.prototype[this.name]=this.defaultValue),To.prototype.resolve.call(this)};Rt.d=function(e,t,i,r){return typeof t=="function"?t=Pe.decorateType(t).name:t&&typeof t=="object"&&(t=Pe.decorateEnum(t).name),function(a,o){Pe.decorateType(a.constructor).add(new Rt(o,e,t,i,{default:r}))}};Rt._configure=function(e){gd=e}});var Dr=w((c3,pv)=>{"use strict";pv.exports=xt;var So=Li();((xt.prototype=Object.create(So.prototype)).constructor=xt).className="OneOf";var hv=ni(),bo=$e();function xt(n,e,t,i){if(Array.isArray(e)||(t=e,e=void 0),So.call(this,n,t),!(e===void 0||Array.isArray(e)))throw TypeError("fieldNames must be an Array");this.oneof=e||[],this.fieldsArray=[],this.comment=i}xt.fromJSON=function(e,t){return new xt(e,t.oneof,t.options,t.comment)};xt.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return bo.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])};function fv(n){if(n.parent)for(var e=0;e<n.fieldsArray.length;++e)n.fieldsArray[e].parent||n.parent.add(n.fieldsArray[e])}xt.prototype.add=function(e){if(!(e instanceof hv))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,fv(this),this};xt.prototype.remove=function(e){if(!(e instanceof hv))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),t=this.oneof.indexOf(e.name),t>-1&&this.oneof.splice(t,1),e.partOf=null,this};xt.prototype.onAdd=function(e){So.prototype.onAdd.call(this,e);for(var t=this,i=0;i<this.oneof.length;++i){var r=e.get(this.oneof[i]);r&&!r.partOf&&(r.partOf=t,t.fieldsArray.push(r))}fv(this)};xt.prototype.onRemove=function(e){for(var t=0,i;t<this.fieldsArray.length;++t)(i=this.fieldsArray[t]).parent&&i.parent.remove(i);So.prototype.onRemove.call(this,e)};xt.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(r,s){bo.decorateType(r.constructor).add(new xt(s,e)),Object.defineProperty(r,s,{get:bo.oneOfGetter(e),set:bo.oneOfSetter(e)})}}});var Or=w((u3,vv)=>{"use strict";vv.exports=re;var yd=Li();((re.prototype=Object.create(yd.prototype)).constructor=re).className="Namespace";var mv=ni(),Co=$e(),WI=Dr(),Rr,Ps,xr;re.fromJSON=function(e,t){return new re(e,t.options).addJSON(t.nested)};function gv(n,e){if(n&&n.length){for(var t={},i=0;i<n.length;++i)t[n[i].name]=n[i].toJSON(e);return t}}re.arrayToJSON=gv;re.isReservedId=function(e,t){if(e){for(var i=0;i<e.length;++i)if(typeof e[i]!="string"&&e[i][0]<=t&&e[i][1]>t)return!0}return!1};re.isReservedName=function(e,t){if(e){for(var i=0;i<e.length;++i)if(e[i]===t)return!0}return!1};function re(n,e){yd.call(this,n,e),this.nested=void 0,this._nestedArray=null}function yv(n){return n._nestedArray=null,n}Object.defineProperty(re.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=Co.toArray(this.nested))}});re.prototype.toJSON=function(e){return Co.toObject(["options",this.options,"nested",gv(this.nestedArray,e)])};re.prototype.addJSON=function(e){var t=this;if(e)for(var i=Object.keys(e),r=0,s;r<i.length;++r)s=e[i[r]],t.add((s.fields!==void 0?Rr.fromJSON:s.values!==void 0?xr.fromJSON:s.methods!==void 0?Ps.fromJSON:s.id!==void 0?mv.fromJSON:re.fromJSON)(i[r],s));return this};re.prototype.get=function(e){return this.nested&&this.nested[e]||null};re.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof xr)return this.nested[e].values;throw Error("no such enum: "+e)};re.prototype.add=function(e){if(!(e instanceof mv&&e.extend!==void 0||e instanceof Rr||e instanceof WI||e instanceof xr||e instanceof Ps||e instanceof re))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{var t=this.get(e.name);if(t)if(t instanceof re&&e instanceof re&&!(t instanceof Rr||t instanceof Ps)){for(var i=t.nestedArray,r=0;r<i.length;++r)e.add(i[r]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}return this.nested[e.name]=e,e.onAdd(this),yv(this)};re.prototype.remove=function(e){if(!(e instanceof yd))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),yv(this)};re.prototype.define=function(e,t){if(Co.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&e[0]==="")throw Error("path must be relative");for(var i=this;e.length>0;){var r=e.shift();if(i.nested&&i.nested[r]){if(i=i.nested[r],!(i instanceof re))throw Error("path conflicts with non-namespace objects")}else i.add(i=new re(r))}return t&&i.addJSON(t),i};re.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof re?e[t++].resolveAll():e[t++].resolve();return this.resolve()};re.prototype.lookup=function(e,t,i){if(typeof t=="boolean"?(i=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),Co.isString(e)&&e.length){if(e===".")return this.root;e=e.split(".")}else if(!e.length)return this;if(e[0]==="")return this.root.lookup(e.slice(1),t);var r=this.get(e[0]);if(r){if(e.length===1){if(!t||t.indexOf(r.constructor)>-1)return r}else if(r instanceof re&&(r=r.lookup(e.slice(1),t,!0)))return r}else for(var s=0;s<this.nestedArray.length;++s)if(this._nestedArray[s]instanceof re&&(r=this._nestedArray[s].lookup(e,t,!0)))return r;return this.parent===null||i?null:this.parent.lookup(e,t)};re.prototype.lookupType=function(e){var t=this.lookup(e,[Rr]);if(!t)throw Error("no such type: "+e);return t};re.prototype.lookupEnum=function(e){var t=this.lookup(e,[xr]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t};re.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[Rr,xr]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t};re.prototype.lookupService=function(e){var t=this.lookup(e,[Ps]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t};re._configure=function(n,e,t){Rr=n,Ps=e,xr=t}});var Eo=w((d3,_v)=>{"use strict";_v.exports=In;var vd=ni();((In.prototype=Object.create(vd.prototype)).constructor=In).className="MapField";var HI=Pi(),Ls=$e();function In(n,e,t,i,r,s){if(vd.call(this,n,e,i,void 0,void 0,r,s),!Ls.isString(t))throw TypeError("keyType must be a string");this.keyType=t,this.resolvedKeyType=null,this.map=!0}In.fromJSON=function(e,t){return new In(e,t.id,t.keyType,t.type,t.options,t.comment)};In.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Ls.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};In.prototype.resolve=function(){if(this.resolved)return this;if(HI.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return vd.prototype.resolve.call(this)};In.d=function(e,t,i){return typeof i=="function"?i=Ls.decorateType(i).name:i&&typeof i=="object"&&(i=Ls.decorateEnum(i).name),function(s,a){Ls.decorateType(s.constructor).add(new In(a,e,t,i))}}});var wo=w((h3,Tv)=>{"use strict";Tv.exports=Fi;var _d=Li();((Fi.prototype=Object.create(_d.prototype)).constructor=Fi).className="Method";var kr=$e();function Fi(n,e,t,i,r,s,a,o,l){if(kr.isObject(r)?(a=r,r=s=void 0):kr.isObject(s)&&(a=s,s=void 0),!(e===void 0||kr.isString(e)))throw TypeError("type must be a string");if(!kr.isString(t))throw TypeError("requestType must be a string");if(!kr.isString(i))throw TypeError("responseType must be a string");_d.call(this,n,a),this.type=e||"rpc",this.requestType=t,this.requestStream=r?!0:void 0,this.responseType=i,this.responseStream=s?!0:void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=o,this.parsedOptions=l}Fi.fromJSON=function(e,t){return new Fi(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)};Fi.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return kr.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])};Fi.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),_d.prototype.resolve.call(this))}});var Io=w((f3,Sv)=>{"use strict";Sv.exports=Ot;var ii=Or();((Ot.prototype=Object.create(ii.prototype)).constructor=Ot).className="Service";var Td=wo(),Fs=$e(),KI=ud();function Ot(n,e){ii.call(this,n,e),this.methods={},this._methodsArray=null}Ot.fromJSON=function(e,t){var i=new Ot(e,t.options);if(t.methods)for(var r=Object.keys(t.methods),s=0;s<r.length;++s)i.add(Td.fromJSON(r[s],t.methods[r[s]]));return t.nested&&i.addJSON(t.nested),i.comment=t.comment,i};Ot.prototype.toJSON=function(e){var t=ii.prototype.toJSON.call(this,e),i=e?!!e.keepComments:!1;return Fs.toObject(["options",t&&t.options||void 0,"methods",ii.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",i?this.comment:void 0])};Object.defineProperty(Ot.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=Fs.toArray(this.methods))}});function bv(n){return n._methodsArray=null,n}Ot.prototype.get=function(e){return this.methods[e]||ii.prototype.get.call(this,e)};Ot.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return ii.prototype.resolve.call(this)};Ot.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof Td?(this.methods[e.name]=e,e.parent=this,bv(this)):ii.prototype.add.call(this,e)};Ot.prototype.remove=function(e){if(e instanceof Td){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,bv(this)}return ii.prototype.remove.call(this,e)};Ot.prototype.create=function(e,t,i){for(var r=new KI.Service(e,t,i),s=0,a;s<this.methodsArray.length;++s){var o=Fs.lcFirst((a=this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g,"");r[o]=Fs.codegen(["r","c"],Fs.isReserved(o)?o+"_":o)("return this.rpcCall(m,q,s,r,c)")({m:a,q:a.resolvedRequestType.ctor,s:a.resolvedResponseType.ctor})}return r}});var Ao=w((p3,Cv)=>{"use strict";Cv.exports=an;var QI=rn();function an(n){if(n)for(var e=Object.keys(n),t=0;t<e.length;++t)this[e[t]]=n[e[t]]}an.create=function(e){return this.$type.create(e)};an.encode=function(e,t){return this.$type.encode(e,t)};an.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)};an.decode=function(e){return this.$type.decode(e)};an.decodeDelimited=function(e){return this.$type.decodeDelimited(e)};an.verify=function(e){return this.$type.verify(e)};an.fromObject=function(e){return this.$type.fromObject(e)};an.toObject=function(e,t){return this.$type.toObject(e,t)};an.prototype.toJSON=function(){return this.$type.toObject(this,QI.toJSONOptions)}});var bd=w((m3,wv)=>{"use strict";wv.exports=XI;var YI=Vt(),An=Pi(),Ev=$e();function JI(n){return"missing required '"+n.name+"'"}function XI(n){var e=Ev.codegen(["r","l"],n.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(n.fieldsArray.filter(function(o){return o.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");n.group&&e("if((t&7)===4)")("break"),e("switch(t>>>3){");for(var t=0;t<n.fieldsArray.length;++t){var i=n._fieldsArray[t].resolve(),r=i.resolvedType instanceof YI?"int32":i.type,s="m"+Ev.safeProp(i.name);e("case %i: {",i.id),i.map?(e("if(%s===util.emptyObject)",s)("%s={}",s)("var c2 = r.uint32()+r.pos"),An.defaults[i.keyType]!==void 0?e("k=%j",An.defaults[i.keyType]):e("k=null"),An.defaults[r]!==void 0?e("value=%j",An.defaults[r]):e("value=null"),e("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",i.keyType)("case 2:"),An.basic[r]===void 0?e("value=types[%i].decode(r,r.uint32())",t):e("value=r.%s()",r),e("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),An.long[i.keyType]!==void 0?e('%s[typeof k==="object"?util.longToHash(k):k]=value',s):e("%s[k]=value",s)):i.repeated?(e("if(!(%s&&%s.length))",s,s)("%s=[]",s),An.packed[r]!==void 0&&e("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),An.basic[r]===void 0?e(i.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,t):e("%s.push(r.%s())",s,r)):An.basic[r]===void 0?e(i.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,t):e("%s=r.%s()",s,r),e("break")("}")}for(e("default:")("r.skipType(t&7)")("break")("}")("}"),t=0;t<n._fieldsArray.length;++t){var a=n._fieldsArray[t];a.required&&e("if(!m.hasOwnProperty(%j))",a.name)("throw util.ProtocolError(%j,{instance:m})",JI(a))}return e("return m")}});var Ed=w((g3,Iv)=>{"use strict";Iv.exports=t1;var ZI=Vt(),Sd=$e();function kt(n,e){return n.name+": "+e+(n.repeated&&e!=="array"?"[]":n.map&&e!=="object"?"{k:"+n.keyType+"}":"")+" expected"}function Cd(n,e,t,i){if(e.resolvedType)if(e.resolvedType instanceof ZI){n("switch(%s){",i)("default:")("return%j",kt(e,"enum value"));for(var r=Object.keys(e.resolvedType.values),s=0;s<r.length;++s)n("case %i:",e.resolvedType.values[r[s]]);n("break")("}")}else n("{")("var e=types[%i].verify(%s);",t,i)("if(e)")("return%j+e",e.name+".")("}");else switch(e.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.isInteger(%s))",i)("return%j",kt(e,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",i,i,i,i)("return%j",kt(e,"integer|Long"));break;case"float":case"double":n('if(typeof %s!=="number")',i)("return%j",kt(e,"number"));break;case"bool":n('if(typeof %s!=="boolean")',i)("return%j",kt(e,"boolean"));break;case"string":n("if(!util.isString(%s))",i)("return%j",kt(e,"string"));break;case"bytes":n('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',i,i,i)("return%j",kt(e,"buffer"));break}return n}function e1(n,e,t){switch(e.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.key32Re.test(%s))",t)("return%j",kt(e,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.key64Re.test(%s))",t)("return%j",kt(e,"integer|Long key"));break;case"bool":n("if(!util.key2Re.test(%s))",t)("return%j",kt(e,"boolean key"));break}return n}function t1(n){var e=Sd.codegen(["m"],n.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),t=n.oneofsArray,i={};t.length&&e("var p={}");for(var r=0;r<n.fieldsArray.length;++r){var s=n._fieldsArray[r].resolve(),a="m"+Sd.safeProp(s.name);if(s.optional&&e("if(%s!=null&&m.hasOwnProperty(%j)){",a,s.name),s.map)e("if(!util.isObject(%s))",a)("return%j",kt(s,"object"))("var k=Object.keys(%s)",a)("for(var i=0;i<k.length;++i){"),e1(e,s,"k[i]"),Cd(e,s,r,a+"[k[i]]")("}");else if(s.repeated)e("if(!Array.isArray(%s))",a)("return%j",kt(s,"array"))("for(var i=0;i<%s.length;++i){",a),Cd(e,s,r,a+"[i]")("}");else{if(s.partOf){var o=Sd.safeProp(s.partOf.name);i[s.partOf.name]===1&&e("if(p%s===1)",o)("return%j",s.partOf.name+": multiple values"),i[s.partOf.name]=1,e("p%s=1",o)}Cd(e,s,r,a)}s.optional&&e("}")}return e("return null")}});var Ad=w(Dv=>{"use strict";var Av=Dv,Bs=Vt(),on=$e();function wd(n,e,t,i){var r=!1;if(e.resolvedType)if(e.resolvedType instanceof Bs){n("switch(d%s){",i);for(var s=e.resolvedType.values,a=Object.keys(s),o=0;o<a.length;++o)s[a[o]]===e.typeDefault&&!r&&(n("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',i,i,i),e.repeated||n("break"),r=!0),n("case%j:",a[o])("case %i:",s[a[o]])("m%s=%j",i,s[a[o]])("break");n("}")}else n('if(typeof d%s!=="object")',i)("throw TypeError(%j)",e.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",i,t,i);else{var l=!1;switch(e.type){case"double":case"float":n("m%s=Number(d%s)",i,i);break;case"uint32":case"fixed32":n("m%s=d%s>>>0",i,i);break;case"int32":case"sint32":case"sfixed32":n("m%s=d%s|0",i,i);break;case"uint64":l=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",i,i,l)('else if(typeof d%s==="string")',i)("m%s=parseInt(d%s,10)",i,i)('else if(typeof d%s==="number")',i)("m%s=d%s",i,i)('else if(typeof d%s==="object")',i)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",i,i,i,l?"true":"");break;case"bytes":n('if(typeof d%s==="string")',i)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",i,i,i)("else if(d%s.length >= 0)",i)("m%s=d%s",i,i);break;case"string":n("m%s=String(d%s)",i,i);break;case"bool":n("m%s=Boolean(d%s)",i,i);break}}return n}Av.fromObject=function(e){var t=e.fieldsArray,i=on.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return i("return new this.ctor");i("var m=new this.ctor");for(var r=0;r<t.length;++r){var s=t[r].resolve(),a=on.safeProp(s.name);s.map?(i("if(d%s){",a)('if(typeof d%s!=="object")',a)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",a)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",a),wd(i,s,r,a+"[ks[i]]")("}")("}")):s.repeated?(i("if(d%s){",a)("if(!Array.isArray(d%s))",a)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",a)("for(var i=0;i<d%s.length;++i){",a),wd(i,s,r,a+"[i]")("}")("}")):(s.resolvedType instanceof Bs||i("if(d%s!=null){",a),wd(i,s,r,a),s.resolvedType instanceof Bs||i("}"))}return i("return m")};function Id(n,e,t,i){if(e.resolvedType)e.resolvedType instanceof Bs?n("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",i,t,i,i,t,i,i):n("d%s=types[%i].toObject(m%s,o)",i,t,i);else{var r=!1;switch(e.type){case"double":case"float":n("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",i,i,i,i);break;case"uint64":r=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n('if(typeof m%s==="number")',i)("d%s=o.longs===String?String(m%s):m%s",i,i,i)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",i,i,i,i,r?"true":"",i);break;case"bytes":n("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",i,i,i,i,i);break;default:n("d%s=m%s",i,i);break}}return n}Av.toObject=function(e){var t=e.fieldsArray.slice().sort(on.compareFieldsById);if(!t.length)return on.codegen()("return {}");for(var i=on.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),r=[],s=[],a=[],o=0;o<t.length;++o)t[o].partOf||(t[o].resolve().repeated?r:t[o].map?s:a).push(t[o]);if(r.length){for(i("if(o.arrays||o.defaults){"),o=0;o<r.length;++o)i("d%s=[]",on.safeProp(r[o].name));i("}")}if(s.length){for(i("if(o.objects||o.defaults){"),o=0;o<s.length;++o)i("d%s={}",on.safeProp(s[o].name));i("}")}if(a.length){for(i("if(o.defaults){"),o=0;o<a.length;++o){var l=a[o],c=on.safeProp(l.name);if(l.resolvedType instanceof Bs)i("d%s=o.enums===String?%j:%j",c,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)i("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",c)("}else")("d%s=o.longs===String?%j:%i",c,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var u="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";i("if(o.bytes===String)d%s=%j",c,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",c,u)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",c,c)("}")}else i("d%s=%j",c,l.typeDefault)}i("}")}var m=!1;for(o=0;o<t.length;++o){var l=t[o],p=e._fieldsArray.indexOf(l),c=on.safeProp(l.name);l.map?(m||(m=!0,i("var ks2")),i("if(m%s&&(ks2=Object.keys(m%s)).length){",c,c)("d%s={}",c)("for(var j=0;j<ks2.length;++j){"),Id(i,l,p,c+"[ks2[j]]")("}")):l.repeated?(i("if(m%s&&m%s.length){",c,c)("d%s=[]",c)("for(var j=0;j<m%s.length;++j){",c),Id(i,l,p,c+"[j]")("}")):(i("if(m%s!=null&&m.hasOwnProperty(%j)){",c,l.name),Id(i,l,p,c),l.partOf&&i("if(o.oneofs)")("d%s=%j",on.safeProp(l.partOf.name),l.name)),i("}")}return i("return d")}});var Dd=w(Rv=>{"use strict";var n1=Rv,i1=Ao();n1[".google.protobuf.Any"]={fromObject:function(n){if(n&&n["@type"]){var e=n["@type"].substring(n["@type"].lastIndexOf("/")+1),t=this.lookup(e);if(t){var i=n["@type"].charAt(0)==="."?n["@type"].slice(1):n["@type"];return i.indexOf("/")===-1&&(i="/"+i),this.create({type_url:i,value:t.encode(t.fromObject(n)).finish()})}}return this.fromObject(n)},toObject:function(n,e){var t="type.googleapis.com/",i="",r="";if(e&&e.json&&n.type_url&&n.value){r=n.type_url.substring(n.type_url.lastIndexOf("/")+1),i=n.type_url.substring(0,n.type_url.lastIndexOf("/")+1);var s=this.lookup(r);s&&(n=s.decode(n.value))}if(!(n instanceof this.ctor)&&n instanceof i1){var a=n.$type.toObject(n,e),o=n.$type.fullName[0]==="."?n.$type.fullName.slice(1):n.$type.fullName;return i===""&&(i=t),r=i+o,a["@type"]=r,a}return this.toObject(n,e)}}});var xo=w((_3,Ov)=>{"use strict";Ov.exports=ge;var Ut=Or();((ge.prototype=Object.create(Ut.prototype)).constructor=ge).className="Type";var r1=Vt(),Od=Dr(),Do=ni(),s1=Eo(),a1=Io(),Rd=Ao(),xd=_o(),o1=yo(),Ze=$e(),l1=kd(),c1=bd(),u1=Ed(),xv=Ad(),d1=Dd();function ge(n,e){Ut.call(this,n,e),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}Object.defineProperties(ge.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var n=Object.keys(this.fields),e=0;e<n.length;++e){var t=this.fields[n[e]],i=t.id;if(this._fieldsById[i])throw Error("duplicate id "+i+" in "+this);this._fieldsById[i]=t}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=Ze.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=Ze.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=ge.generateConstructor(this)())},set:function(n){var e=n.prototype;e instanceof Rd||((n.prototype=new Rd).constructor=n,Ze.merge(n.prototype,e)),n.$type=n.prototype.$type=this,Ze.merge(n,Rd,!0),this._ctor=n;for(var t=0;t<this.fieldsArray.length;++t)this._fieldsArray[t].resolve();var i={};for(t=0;t<this.oneofsArray.length;++t)i[this._oneofsArray[t].resolve().name]={get:Ze.oneOfGetter(this._oneofsArray[t].oneof),set:Ze.oneOfSetter(this._oneofsArray[t].oneof)};t&&Object.defineProperties(n.prototype,i)}}});ge.generateConstructor=function(e){for(var t=Ze.codegen(["p"],e.name),i=0,r;i<e.fieldsArray.length;++i)(r=e._fieldsArray[i]).map?t("this%s={}",Ze.safeProp(r.name)):r.repeated&&t("this%s=[]",Ze.safeProp(r.name));return t("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")};function Ro(n){return n._fieldsById=n._fieldsArray=n._oneofsArray=null,delete n.encode,delete n.decode,delete n.verify,n}ge.fromJSON=function(e,t){var i=new ge(e,t.options);i.extensions=t.extensions,i.reserved=t.reserved;for(var r=Object.keys(t.fields),s=0;s<r.length;++s)i.add((typeof t.fields[r[s]].keyType<"u"?s1.fromJSON:Do.fromJSON)(r[s],t.fields[r[s]]));if(t.oneofs)for(r=Object.keys(t.oneofs),s=0;s<r.length;++s)i.add(Od.fromJSON(r[s],t.oneofs[r[s]]));if(t.nested)for(r=Object.keys(t.nested),s=0;s<r.length;++s){var a=t.nested[r[s]];i.add((a.id!==void 0?Do.fromJSON:a.fields!==void 0?ge.fromJSON:a.values!==void 0?r1.fromJSON:a.methods!==void 0?a1.fromJSON:Ut.fromJSON)(r[s],a))}return t.extensions&&t.extensions.length&&(i.extensions=t.extensions),t.reserved&&t.reserved.length&&(i.reserved=t.reserved),t.group&&(i.group=!0),t.comment&&(i.comment=t.comment),i};ge.prototype.toJSON=function(e){var t=Ut.prototype.toJSON.call(this,e),i=e?!!e.keepComments:!1;return Ze.toObject(["options",t&&t.options||void 0,"oneofs",Ut.arrayToJSON(this.oneofsArray,e),"fields",Ut.arrayToJSON(this.fieldsArray.filter(function(r){return!r.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",i?this.comment:void 0])};ge.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var i=this.oneofsArray;for(t=0;t<i.length;)i[t++].resolve();return Ut.prototype.resolveAll.call(this)};ge.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null};ge.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof Do&&e.extend===void 0){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),Ro(this)}return e instanceof Od?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),Ro(this)):Ut.prototype.add.call(this,e)};ge.prototype.remove=function(e){if(e instanceof Do&&e.extend===void 0){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),Ro(this)}if(e instanceof Od){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),Ro(this)}return Ut.prototype.remove.call(this,e)};ge.prototype.isReservedId=function(e){return Ut.isReservedId(this.reserved,e)};ge.prototype.isReservedName=function(e){return Ut.isReservedName(this.reserved,e)};ge.prototype.create=function(e){return new this.ctor(e)};ge.prototype.setup=function(){for(var e=this.fullName,t=[],i=0;i<this.fieldsArray.length;++i)t.push(this._fieldsArray[i].resolve().resolvedType);this.encode=l1(this)({Writer:o1,types:t,util:Ze}),this.decode=c1(this)({Reader:xd,types:t,util:Ze}),this.verify=u1(this)({types:t,util:Ze}),this.fromObject=xv.fromObject(this)({types:t,util:Ze}),this.toObject=xv.toObject(this)({types:t,util:Ze});var r=d1[e];if(r){var s=Object.create(this);s.fromObject=this.fromObject,this.fromObject=r.fromObject.bind(s),s.toObject=this.toObject,this.toObject=r.toObject.bind(s)}return this};ge.prototype.encode=function(e,t){return this.setup().encode(e,t)};ge.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()};ge.prototype.decode=function(e,t){return this.setup().decode(e,t)};ge.prototype.decodeDelimited=function(e){return e instanceof xd||(e=xd.create(e)),this.decode(e,e.uint32())};ge.prototype.verify=function(e){return this.setup().verify(e)};ge.prototype.fromObject=function(e){return this.setup().fromObject(e)};ge.prototype.toObject=function(e,t){return this.setup().toObject(e,t)};ge.d=function(e){return function(i){Ze.decorateType(i,e)}}});var No=w((T3,Lv)=>{"use strict";Lv.exports=yt;var ko=Or();((yt.prototype=Object.create(ko.prototype)).constructor=yt).className="Root";var Md=ni(),Nv=Vt(),h1=Dr(),ri=$e(),Mv,Nd,qs;function yt(n){ko.call(this,"",n),this.deferred=[],this.files=[]}yt.fromJSON=function(e,t){return t||(t=new yt),e.options&&t.setOptions(e.options),t.addJSON(e.nested)};yt.prototype.resolvePath=ri.path.resolve;yt.prototype.fetch=ri.fetch;function Pv(){}yt.prototype.load=function n(e,t,i){typeof t=="function"&&(i=t,t=void 0);var r=this;if(!i)return ri.asPromise(n,r,e,t);var s=i===Pv;function a(T,S){if(i){if(s)throw T;var E=i;i=null,E(T,S)}}function o(T){var S=T.lastIndexOf("google/protobuf/");if(S>-1){var E=T.substring(S);if(E in qs)return E}return null}function l(T,S){try{if(ri.isString(S)&&S.charAt(0)==="{"&&(S=JSON.parse(S)),!ri.isString(S))r.setOptions(S.options).addJSON(S.nested);else{Nd.filename=T;var E=Nd(S,r,t),C,O=0;if(E.imports)for(;O<E.imports.length;++O)(C=o(E.imports[O])||r.resolvePath(T,E.imports[O]))&&c(C);if(E.weakImports)for(O=0;O<E.weakImports.length;++O)(C=o(E.weakImports[O])||r.resolvePath(T,E.weakImports[O]))&&c(C,!0)}}catch(I){a(I)}!s&&!u&&a(null,r)}function c(T,S){if(T=o(T)||T,!(r.files.indexOf(T)>-1)){if(r.files.push(T),T in qs){s?l(T,qs[T]):(++u,setTimeout(function(){--u,l(T,qs[T])}));return}if(s){var E;try{E=ri.fs.readFileSync(T).toString("utf8")}catch(C){S||a(C);return}l(T,E)}else++u,r.fetch(T,function(C,O){if(--u,!!i){if(C){S?u||a(null,r):a(C);return}l(T,O)}})}}var u=0;ri.isString(e)&&(e=[e]);for(var m=0,p;m<e.length;++m)(p=r.resolvePath("",e[m]))&&c(p);if(s)return r;u||a(null,r)};yt.prototype.loadSync=function(e,t){if(!ri.isNode)throw Error("not supported");return this.load(e,t,Pv)};yt.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return ko.prototype.resolveAll.call(this)};var Oo=/^[A-Z]/;function kv(n,e){var t=e.parent.lookup(e.extend);if(t){var i=new Md(e.fullName,e.id,e.type,e.rule,void 0,e.options);return t.get(i.name)||(i.declaringField=e,e.extensionField=i,t.add(i)),!0}return!1}yt.prototype._handleAdd=function(e){if(e instanceof Md)e.extend!==void 0&&!e.extensionField&&(kv(this,e)||this.deferred.push(e));else if(e instanceof Nv)Oo.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof h1)){if(e instanceof Mv)for(var t=0;t<this.deferred.length;)kv(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var i=0;i<e.nestedArray.length;++i)this._handleAdd(e._nestedArray[i]);Oo.test(e.name)&&(e.parent[e.name]=e)}};yt.prototype._handleRemove=function(e){if(e instanceof Md){if(e.extend!==void 0)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof Nv)Oo.test(e.name)&&delete e.parent[e.name];else if(e instanceof ko){for(var i=0;i<e.nestedArray.length;++i)this._handleRemove(e._nestedArray[i]);Oo.test(e.name)&&delete e.parent[e.name]}};yt._configure=function(n,e,t){Mv=n,Nd=e,qs=t}});var $e=w((b3,Bv)=>{"use strict";var Oe=Bv.exports=rn(),Fv=dd(),Pd,Ld;Oe.codegen=nv();Oe.fetch=rv();Oe.path=ov();Oe.fs=Oe.inquire("fs");Oe.toArray=function(e){if(e){for(var t=Object.keys(e),i=new Array(t.length),r=0;r<t.length;)i[r]=e[t[r++]];return i}return[]};Oe.toObject=function(e){for(var t={},i=0;i<e.length;){var r=e[i++],s=e[i++];s!==void 0&&(t[r]=s)}return t};var f1=/\\/g,p1=/"/g;Oe.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)};Oe.safeProp=function(e){return!/^[$\w_]+$/.test(e)||Oe.isReserved(e)?'["'+e.replace(f1,"\\\\").replace(p1,'\\"')+'"]':"."+e};Oe.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var m1=/_([a-z])/g;Oe.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(m1,function(t,i){return i.toUpperCase()})};Oe.compareFieldsById=function(e,t){return e.id-t.id};Oe.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(Oe.decorateRoot.remove(e.$type),e.$type.name=t,Oe.decorateRoot.add(e.$type)),e.$type;Pd||(Pd=xo());var i=new Pd(t||e.name);return Oe.decorateRoot.add(i),i.ctor=e,Object.defineProperty(e,"$type",{value:i,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:i,enumerable:!1}),i};var g1=0;Oe.decorateEnum=function(e){if(e.$type)return e.$type;Ld||(Ld=Vt());var t=new Ld("Enum"+g1++,e);return Oe.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t};Oe.setProperty=function(e,t,i){function r(s,a,o){var l=a.shift();if(l==="__proto__"||l==="prototype")return s;if(a.length>0)s[l]=r(s[l]||{},a,o);else{var c=s[l];c&&(o=[].concat(c).concat(o)),s[l]=o}return s}if(typeof e!="object")throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return t=t.split("."),r(e,t,i)};Object.defineProperty(Oe,"decorateRoot",{get:function(){return Fv.decorated||(Fv.decorated=new(No()))}})});var Li=w((S3,qv)=>{"use strict";qv.exports=vt;vt.className="ReflectionObject";var Mo=$e(),Po;function vt(n,e){if(!Mo.isString(n))throw TypeError("name must be a string");if(e&&!Mo.isObject(e))throw TypeError("options must be an object");this.options=e,this.parsedOptions=null,this.name=n,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(vt.prototype,{root:{get:function(){for(var n=this;n.parent!==null;)n=n.parent;return n}},fullName:{get:function(){for(var n=[this.name],e=this.parent;e;)n.unshift(e.name),e=e.parent;return n.join(".")}}});vt.prototype.toJSON=function(){throw Error()};vt.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof Po&&t._handleAdd(this)};vt.prototype.onRemove=function(e){var t=e.root;t instanceof Po&&t._handleRemove(this),this.parent=null,this.resolved=!1};vt.prototype.resolve=function(){return this.resolved?this:(this.root instanceof Po&&(this.resolved=!0),this)};vt.prototype.getOption=function(e){if(this.options)return this.options[e]};vt.prototype.setOption=function(e,t,i){return(!i||!this.options||this.options[e]===void 0)&&((this.options||(this.options={}))[e]=t),this};vt.prototype.setParsedOption=function(e,t,i){this.parsedOptions||(this.parsedOptions=[]);var r=this.parsedOptions;if(i){var s=r.find(function(l){return Object.prototype.hasOwnProperty.call(l,e)});if(s){var a=s[e];Mo.setProperty(a,i,t)}else s={},s[e]=Mo.setProperty({},i,t),r.push(s)}else{var o={};o[e]=t,r.push(o)}return this};vt.prototype.setOptions=function(e,t){if(e)for(var i=Object.keys(e),r=0;r<i.length;++r)this.setOption(i[r],e[i[r]],t);return this};vt.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e};vt._configure=function(n){Po=n}});var Vt=w((C3,zv)=>{"use strict";zv.exports=ln;var Vv=Li();((ln.prototype=Object.create(Vv.prototype)).constructor=ln).className="Enum";var Uv=Or(),Lo=$e();function ln(n,e,t,i,r,s){if(Vv.call(this,n,t),e&&typeof e!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=i,this.comments=r||{},this.valuesOptions=s,this.reserved=void 0,e)for(var a=Object.keys(e),o=0;o<a.length;++o)typeof e[a[o]]=="number"&&(this.valuesById[this.values[a[o]]=e[a[o]]]=a[o])}ln.fromJSON=function(e,t){var i=new ln(e,t.values,t.options,t.comment,t.comments);return i.reserved=t.reserved,i};ln.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Lo.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])};ln.prototype.add=function(e,t,i,r){if(!Lo.isString(e))throw TypeError("name must be a string");if(!Lo.isInteger(t))throw TypeError("id must be an integer");if(this.values[e]!==void 0)throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(this.valuesById[t]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return r&&(this.valuesOptions===void 0&&(this.valuesOptions={}),this.valuesOptions[e]=r||null),this.comments[e]=i||null,this};ln.prototype.remove=function(e){if(!Lo.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(t==null)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this};ln.prototype.isReservedId=function(e){return Uv.isReservedId(this.reserved,e)};ln.prototype.isReservedName=function(e){return Uv.isReservedName(this.reserved,e)}});var kd=w((E3,$v)=>{"use strict";$v.exports=v1;var y1=Vt(),Fd=Pi(),Bd=$e();function Gv(n,e,t,i){return e.resolvedType.group?n("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",t,i,(e.id<<3|3)>>>0,(e.id<<3|4)>>>0):n("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",t,i,(e.id<<3|2)>>>0)}function v1(n){for(var e=Bd.codegen(["m","w"],n.name+"$encode")("if(!w)")("w=Writer.create()"),t,i,r=n.fieldsArray.slice().sort(Bd.compareFieldsById),t=0;t<r.length;++t){var s=r[t].resolve(),a=n._fieldsArray.indexOf(s),o=s.resolvedType instanceof y1?"int32":s.type,l=Fd.basic[o];i="m"+Bd.safeProp(s.name),s.map?(e("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",i,s.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",i)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(s.id<<3|2)>>>0,8|Fd.mapKey[s.keyType],s.keyType),l===void 0?e("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",a,i):e(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|l,o,i),e("}")("}")):s.repeated?(e("if(%s!=null&&%s.length){",i,i),s.packed&&Fd.packed[o]!==void 0?e("w.uint32(%i).fork()",(s.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",i)("w.%s(%s[i])",o,i)("w.ldelim()"):(e("for(var i=0;i<%s.length;++i)",i),l===void 0?Gv(e,s,a,i+"[i]"):e("w.uint32(%i).%s(%s[i])",(s.id<<3|l)>>>0,o,i)),e("}")):(s.optional&&e("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",i,s.name),l===void 0?Gv(e,s,a,i):e("w.uint32(%i).%s(%s)",(s.id<<3|l)>>>0,o,i))}return e("return w")}});var Wv=w((w3,jv)=>{"use strict";var te=jv.exports=ev();te.build="light";function _1(n,e,t){return typeof e=="function"?(t=e,e=new te.Root):e||(e=new te.Root),e.load(n,t)}te.load=_1;function T1(n,e){return e||(e=new te.Root),e.loadSync(n)}te.loadSync=T1;te.encoder=kd();te.decoder=bd();te.verifier=Ed();te.converter=Ad();te.ReflectionObject=Li();te.Namespace=Or();te.Root=No();te.Enum=Vt();te.Type=xo();te.Field=ni();te.OneOf=Dr();te.MapField=Eo();te.Service=Io();te.Method=wo();te.Message=Ao();te.wrappers=Dd();te.types=Pi();te.util=$e();te.ReflectionObject._configure(te.Root);te.Namespace._configure(te.Type,te.Service,te.Enum);te.Root._configure(te.Type);te.Field._configure(te.Type)});var Vd=w((I3,Qv)=>{"use strict";Qv.exports=Kv;var qd=/[\s{}=;:[\],'"()<>]/g,b1=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,S1=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,C1=/^ *[*/]+ */,E1=/^\s*\*?\/*/,w1=/\n/g,I1=/\s/,A1=/\\(.?)/g,D1={0:"\0",r:"\r",n:`
`,t:"	"};function Hv(n){return n.replace(A1,function(e,t){switch(t){case"\\":case"":return t;default:return D1[t]||""}})}Kv.unescape=Hv;function Kv(n,e){n=n.toString();var t=0,i=n.length,r=1,s=0,a={},o=[],l=null;function c(M){return Error("illegal "+M+" (line "+r+")")}function u(){var M=l==="'"?S1:b1;M.lastIndex=t-1;var j=M.exec(n);if(!j)throw c("string");return t=M.lastIndex,C(l),l=null,Hv(j[1])}function m(M){return n.charAt(M)}function p(M,j,G){var _={type:n.charAt(M++),lineEmpty:!1,leading:G},g;e?g=2:g=3;var y=M-g,v;do if(--y<0||(v=n.charAt(y))===`
`){_.lineEmpty=!0;break}while(v===" "||v==="	");for(var h=n.substring(M,j).split(w1),b=0;b<h.length;++b)h[b]=h[b].replace(e?E1:C1,"").trim();_.text=h.join(`
`).trim(),a[r]=_,s=r}function T(M){var j=S(M),G=n.substring(M,j),_=/^\s*\/\//.test(G);return _}function S(M){for(var j=M;j<i&&m(j)!==`
`;)j++;return j}function E(){if(o.length>0)return o.shift();if(l)return u();var M,j,G,_,g,y=t===0;do{if(t===i)return null;for(M=!1;I1.test(G=m(t));)if(G===`
`&&(y=!0,++r),++t===i)return null;if(m(t)==="/"){if(++t===i)throw c("comment");if(m(t)==="/")if(e){if(_=t,g=!1,T(t-1)){g=!0;do if(t=S(t),t===i||(t++,!y))break;while(T(t))}else t=Math.min(i,S(t)+1);g&&(p(_,t,y),y=!0),r++,M=!0}else{for(g=m(_=t+1)==="/";m(++t)!==`
`;)if(t===i)return null;++t,g&&(p(_,t-1,y),y=!0),++r,M=!0}else if((G=m(t))==="*"){_=t+1,g=e||m(_)==="*";do{if(G===`
`&&++r,++t===i)throw c("comment");j=G,G=m(t)}while(j!=="*"||G!=="/");++t,g&&(p(_,t-2,y),y=!0),M=!0}else return"/"}}while(M);var v=t;qd.lastIndex=0;var h=qd.test(m(v++));if(!h)for(;v<i&&!qd.test(m(v));)++v;var b=n.substring(t,t=v);return(b==='"'||b==="'")&&(l=b),b}function C(M){o.push(M)}function O(){if(!o.length){var M=E();if(M===null)return null;C(M)}return o[0]}function I(M,j){var G=O(),_=G===M;if(_)return E(),!0;if(!j)throw c("token '"+G+"', '"+M+"' expected");return!1}function L(M){var j=null,G;return M===void 0?(G=a[r-1],delete a[r-1],G&&(e||G.type==="*"||G.lineEmpty)&&(j=G.leading?G.text:null)):(s<M&&O(),G=a[M],delete a[M],G&&!G.lineEmpty&&(e||G.type==="/")&&(j=G.leading?null:G.text)),j}return Object.defineProperty({next:E,peek:O,push:C,skip:I,cmnt:L},"line",{get:function(){return r}})}});var t0=w((A3,e0)=>{"use strict";e0.exports=Dn;Dn.filename=null;Dn.defaults={keepCase:!1};var R1=Vd(),Yv=No(),Jv=xo(),Xv=ni(),x1=Eo(),Zv=Dr(),O1=Vt(),k1=Io(),N1=wo(),Ud=Pi(),zd=$e(),M1=/^[1-9][0-9]*$/,P1=/^-?[1-9][0-9]*$/,L1=/^0[x][0-9a-fA-F]+$/,F1=/^-?0[x][0-9a-fA-F]+$/,B1=/^0[0-7]+$/,q1=/^-?0[0-7]+$/,V1=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,cn=/^[a-zA-Z_][a-zA-Z_0-9]*$/,un=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,U1=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function Dn(n,e,t){e instanceof Yv||(t=e,e=new Yv),t||(t=Dn.defaults);var i=t.preferTrailingComment||!1,r=R1(n,t.alternateCommentMode||!1),s=r.next,a=r.push,o=r.peek,l=r.skip,c=r.cmnt,u=!0,m,p,T,S,E=!1,C=e,O=t.keepCase?function(A){return A}:zd.camelCase;function I(A,D,N){var U=Dn.filename;return N||(Dn.filename=null),Error("illegal "+(D||"token")+" '"+A+"' ("+(U?U+", ":"")+"line "+r.line+")")}function L(){var A=[],D;do{if((D=s())!=='"'&&D!=="'")throw I(D);A.push(s()),l(D),D=o()}while(D==='"'||D==="'");return A.join("")}function M(A){var D=s();switch(D){case"'":case'"':return a(D),L();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return G(D,!0)}catch{if(A&&un.test(D))return D;throw I(D,"value")}}function j(A,D){var N,U;do D&&((N=o())==='"'||N==="'")?A.push(L()):A.push([U=_(s()),l("to",!0)?_(s()):U]);while(l(",",!0));var B={options:void 0};B.setOption=function(Y,Ee){this.options===void 0&&(this.options={}),this.options[Y]=Ee},b(B,function(Ee){if(Ee==="option")fe(B,Ee),l(";");else throw I(Ee)},function(){Ke(B)})}function G(A,D){var N=1;switch(A.charAt(0)==="-"&&(N=-1,A=A.substring(1)),A){case"inf":case"INF":case"Inf":return N*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(M1.test(A))return N*parseInt(A,10);if(L1.test(A))return N*parseInt(A,16);if(B1.test(A))return N*parseInt(A,8);if(V1.test(A))return N*parseFloat(A);throw I(A,"number",D)}function _(A,D){switch(A){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!D&&A.charAt(0)==="-")throw I(A,"id");if(P1.test(A))return parseInt(A,10);if(F1.test(A))return parseInt(A,16);if(q1.test(A))return parseInt(A,8);throw I(A,"id")}function g(){if(m!==void 0)throw I("package");if(m=s(),!un.test(m))throw I(m,"name");C=C.define(m),l(";")}function y(){var A=o(),D;switch(A){case"weak":D=T||(T=[]),s();break;case"public":s();default:D=p||(p=[]);break}A=L(),l(";"),D.push(A)}function v(){if(l("="),S=L(),E=S==="proto3",!E&&S!=="proto2")throw I(S,"syntax");e.setOption("syntax",S),l(";")}function h(A,D){switch(D){case"option":return fe(A,D),l(";"),!0;case"message":return d(A,D),!0;case"enum":return de(A,D),!0;case"service":return Ne(A,D),!0;case"extend":return nr(A,D),!0}return!1}function b(A,D,N){var U=r.line;if(A&&(typeof A.comment!="string"&&(A.comment=c()),A.filename=Dn.filename),l("{",!0)){for(var B;(B=s())!=="}";)D(B);l(";",!0)}else N&&N(),l(";"),A&&(typeof A.comment!="string"||i)&&(A.comment=c(U)||A.comment)}function d(A,D){if(!cn.test(D=s()))throw I(D,"type name");var N=new Jv(D);b(N,function(B){if(!h(N,B))switch(B){case"map":ne(N,B);break;case"required":case"repeated":f(N,B);break;case"optional":E?f(N,"proto3_optional"):f(N,"optional");break;case"oneof":Te(N,B);break;case"extensions":j(N.extensions||(N.extensions=[]));break;case"reserved":j(N.reserved||(N.reserved=[]),!0);break;default:if(!E||!un.test(B))throw I(B);a(B),f(N,"optional");break}}),A.add(N)}function f(A,D,N){var U=s();if(U==="group"){P(A,D);return}for(;U.endsWith(".")||o().startsWith(".");)U+=s();if(!un.test(U))throw I(U,"type");var B=s();if(!cn.test(B))throw I(B,"name");B=O(B),l("=");var Y=new Xv(B,_(s()),U,D,N);if(b(Y,function(mt){if(mt==="option")fe(Y,mt),l(";");else throw I(mt)},function(){Ke(Y)}),D==="proto3_optional"){var Ee=new Zv("_"+B);Y.setOption("proto3_optional",!0),Ee.add(Y),A.add(Ee)}else A.add(Y);!E&&Y.repeated&&(Ud.packed[U]!==void 0||Ud.basic[U]===void 0)&&Y.setOption("packed",!1,!0)}function P(A,D){var N=s();if(!cn.test(N))throw I(N,"name");var U=zd.lcFirst(N);N===U&&(N=zd.ucFirst(N)),l("=");var B=_(s()),Y=new Jv(N);Y.group=!0;var Ee=new Xv(U,B,N,D);Ee.filename=Dn.filename,b(Y,function(mt){switch(mt){case"option":fe(Y,mt),l(";");break;case"required":case"repeated":f(Y,mt);break;case"optional":E?f(Y,"proto3_optional"):f(Y,"optional");break;case"message":d(Y,mt);break;case"enum":de(Y,mt);break;default:throw I(mt)}}),A.add(Y).add(Ee)}function ne(A){l("<");var D=s();if(Ud.mapKey[D]===void 0)throw I(D,"type");l(",");var N=s();if(!un.test(N))throw I(N,"type");l(">");var U=s();if(!cn.test(U))throw I(U,"name");l("=");var B=new x1(O(U),_(s()),D,N);b(B,function(Ee){if(Ee==="option")fe(B,Ee),l(";");else throw I(Ee)},function(){Ke(B)}),A.add(B)}function Te(A,D){if(!cn.test(D=s()))throw I(D,"name");var N=new Zv(O(D));b(N,function(B){B==="option"?(fe(N,B),l(";")):(a(B),f(N,"optional"))}),A.add(N)}function de(A,D){if(!cn.test(D=s()))throw I(D,"name");var N=new O1(D);b(N,function(B){switch(B){case"option":fe(N,B),l(";");break;case"reserved":j(N.reserved||(N.reserved=[]),!0);break;default:Re(N,B)}}),A.add(N)}function Re(A,D){if(!cn.test(D))throw I(D,"name");l("=");var N=_(s(),!0),U={options:void 0};U.setOption=function(B,Y){this.options===void 0&&(this.options={}),this.options[B]=Y},b(U,function(Y){if(Y==="option")fe(U,Y),l(";");else throw I(Y)},function(){Ke(U)}),A.add(D,N,U.comment,U.options)}function fe(A,D){var N=l("(",!0);if(!un.test(D=s()))throw I(D,"name");var U=D,B=U,Y;N&&(l(")"),U="("+U+")",B=U,D=o(),U1.test(D)&&(Y=D.slice(1),U+=D,s())),l("=");var Ee=rt(A,U);we(A,B,Ee,Y)}function rt(A,D){if(l("{",!0)){for(var N={};!l("}",!0);){if(!cn.test(Ye=s()))throw I(Ye,"name");if(Ye===null)throw I(Ye,"end of input");var U,B=Ye;if(l(":",!0),o()==="{")U=rt(A,D+"."+Ye);else if(o()==="["){U=[];var Y;if(l("[",!0)){do Y=M(!0),U.push(Y);while(l(",",!0));l("]"),typeof Y<"u"&&ke(A,D+"."+Ye,Y)}}else U=M(!0),ke(A,D+"."+Ye,U);var Ee=N[B];Ee&&(U=[].concat(Ee).concat(U)),N[B]=U,l(",",!0),l(";",!0)}return N}var Fn=M(!0);return ke(A,D,Fn),Fn}function ke(A,D,N){A.setOption&&A.setOption(D,N)}function we(A,D,N,U){A.setParsedOption&&A.setParsedOption(D,N,U)}function Ke(A){if(l("[",!0)){do fe(A,"option");while(l(",",!0));l("]")}return A}function Ne(A,D){if(!cn.test(D=s()))throw I(D,"service name");var N=new k1(D);b(N,function(B){if(!h(N,B))if(B==="rpc")st(N,B);else throw I(B)}),A.add(N)}function st(A,D){var N=c(),U=D;if(!cn.test(D=s()))throw I(D,"name");var B=D,Y,Ee,Fn,mt;if(l("("),l("stream",!0)&&(Ee=!0),!un.test(D=s())||(Y=D,l(")"),l("returns"),l("("),l("stream",!0)&&(mt=!0),!un.test(D=s())))throw I(D);Fn=D,l(")");var Ra=new N1(B,U,Y,Fn,Ee,mt);Ra.comment=N,b(Ra,function(Rc){if(Rc==="option")fe(Ra,Rc),l(";");else throw I(Rc)}),A.add(Ra)}function nr(A,D){if(!un.test(D=s()))throw I(D,"reference");var N=D;b(null,function(B){switch(B){case"required":case"repeated":f(A,B,N);break;case"optional":E?f(A,"proto3_optional",N):f(A,"optional",N);break;default:if(!E||!un.test(B))throw I(B);a(B),f(A,"optional",N);break}})}for(var Ye;(Ye=s())!==null;)switch(Ye){case"package":if(!u)throw I(Ye);g();break;case"import":if(!u)throw I(Ye);y();break;case"syntax":if(!u)throw I(Ye);v();break;case"option":fe(C,Ye),l(";");break;default:if(h(C,Ye)){u=!1;continue}throw I(Ye)}return Dn.filename=null,{package:m,imports:p,weakImports:T,syntax:S,root:e}}});var r0=w((D3,i0)=>{"use strict";i0.exports=zt;var z1=/\/|\./;function zt(n,e){z1.test(n)||(n="google/protobuf/"+n+".proto",e={nested:{google:{nested:{protobuf:{nested:e}}}}}),zt[n]=e}zt("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}});var n0;zt("duration",{Duration:n0={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}});zt("timestamp",{Timestamp:n0});zt("empty",{Empty:{fields:{}}});zt("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}});zt("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}});zt("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}});zt.get=function(e){return zt[e]||null}});var a0=w((R3,s0)=>{"use strict";var si=s0.exports=Wv();si.build="full";si.tokenize=Vd();si.parse=t0();si.common=r0();si.Root._configure(si.Type,si.parse,si.common)});var Fo=w((x3,o0)=>{"use strict";o0.exports=a0()});var Gd=w((O3,G1)=>{G1.exports={nested:{google:{nested:{protobuf:{nested:{FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}}}}}}}}});var h0=w((J,d0)=>{"use strict";var lt=Fo();d0.exports=J=lt.descriptor=lt.Root.fromJSON(Gd()).lookup(".google.protobuf");var l0=lt.Namespace,Vs=lt.Root,Rn=lt.Enum,ai=lt.Type,oi=lt.Field,$1=lt.MapField,Bo=lt.OneOf,Us=lt.Service,qo=lt.Method;Vs.fromDescriptor=function(e){typeof e.length=="number"&&(e=J.FileDescriptorSet.decode(e));var t=new Vs;if(e.file)for(var i,r,s=0,a;s<e.file.length;++s){if(r=t,(i=e.file[s]).package&&i.package.length&&(r=t.define(i.package)),i.name&&i.name.length&&t.files.push(r.filename=i.name),i.messageType)for(a=0;a<i.messageType.length;++a)r.add(ai.fromDescriptor(i.messageType[a],i.syntax));if(i.enumType)for(a=0;a<i.enumType.length;++a)r.add(Rn.fromDescriptor(i.enumType[a]));if(i.extension)for(a=0;a<i.extension.length;++a)r.add(oi.fromDescriptor(i.extension[a]));if(i.service)for(a=0;a<i.service.length;++a)r.add(Us.fromDescriptor(i.service[a]));var o=Nr(i.options,J.FileOptions);if(o){var l=Object.keys(o);for(a=0;a<l.length;++a)r.setOption(l[a],o[l[a]])}}return t};Vs.prototype.toDescriptor=function(e){var t=J.FileDescriptorSet.create();return c0(this,t.file,e),t};function c0(n,e,t){var i=J.FileDescriptorProto.create({name:n.filename||(n.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});t&&(i.syntax=t),n instanceof Vs||(i.package=n.fullName.substring(1));for(var r=0,s;r<n.nestedArray.length;++r)(s=n._nestedArray[r])instanceof ai?i.messageType.push(s.toDescriptor(t)):s instanceof Rn?i.enumType.push(s.toDescriptor()):s instanceof oi?i.extension.push(s.toDescriptor(t)):s instanceof Us?i.service.push(s.toDescriptor()):s instanceof l0&&c0(s,e,t);i.options=Mr(n.options,J.FileOptions),i.messageType.length+i.enumType.length+i.extension.length+i.service.length&&e.push(i)}var j1=0;ai.fromDescriptor=function(e,t){typeof e.length=="number"&&(e=J.DescriptorProto.decode(e));var i=new ai(e.name.length?e.name:"Type"+j1++,Nr(e.options,J.MessageOptions)),r;if(e.oneofDecl)for(r=0;r<e.oneofDecl.length;++r)i.add(Bo.fromDescriptor(e.oneofDecl[r]));if(e.field)for(r=0;r<e.field.length;++r){var s=oi.fromDescriptor(e.field[r],t);i.add(s),e.field[r].hasOwnProperty("oneofIndex")&&i.oneofsArray[e.field[r].oneofIndex].add(s)}if(e.extension)for(r=0;r<e.extension.length;++r)i.add(oi.fromDescriptor(e.extension[r],t));if(e.nestedType)for(r=0;r<e.nestedType.length;++r)i.add(ai.fromDescriptor(e.nestedType[r],t)),e.nestedType[r].options&&e.nestedType[r].options.mapEntry&&i.setOption("map_entry",!0);if(e.enumType)for(r=0;r<e.enumType.length;++r)i.add(Rn.fromDescriptor(e.enumType[r]));if(e.extensionRange&&e.extensionRange.length)for(i.extensions=[],r=0;r<e.extensionRange.length;++r)i.extensions.push([e.extensionRange[r].start,e.extensionRange[r].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(i.reserved=[],e.reservedRange)for(r=0;r<e.reservedRange.length;++r)i.reserved.push([e.reservedRange[r].start,e.reservedRange[r].end]);if(e.reservedName)for(r=0;r<e.reservedName.length;++r)i.reserved.push(e.reservedName[r])}return i};ai.prototype.toDescriptor=function(e){var t=J.DescriptorProto.create({name:this.name}),i;for(i=0;i<this.fieldsArray.length;++i){var r;if(t.field.push(r=this._fieldsArray[i].toDescriptor(e)),this._fieldsArray[i]instanceof $1){var s=$d(this._fieldsArray[i].keyType,this._fieldsArray[i].resolvedKeyType),a=$d(this._fieldsArray[i].type,this._fieldsArray[i].resolvedType),o=a===11||a===14?this._fieldsArray[i].resolvedType&&u0(this.parent,this._fieldsArray[i].resolvedType)||this._fieldsArray[i].type:void 0;t.nestedType.push(J.DescriptorProto.create({name:r.typeName,field:[J.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),J.FieldDescriptorProto.create({name:"value",number:2,label:1,type:a,typeName:o})],options:J.MessageOptions.create({mapEntry:!0})}))}}for(i=0;i<this.oneofsArray.length;++i)t.oneofDecl.push(this._oneofsArray[i].toDescriptor());for(i=0;i<this.nestedArray.length;++i)this._nestedArray[i]instanceof oi?t.field.push(this._nestedArray[i].toDescriptor(e)):this._nestedArray[i]instanceof ai?t.nestedType.push(this._nestedArray[i].toDescriptor(e)):this._nestedArray[i]instanceof Rn&&t.enumType.push(this._nestedArray[i].toDescriptor());if(this.extensions)for(i=0;i<this.extensions.length;++i)t.extensionRange.push(J.DescriptorProto.ExtensionRange.create({start:this.extensions[i][0],end:this.extensions[i][1]}));if(this.reserved)for(i=0;i<this.reserved.length;++i)typeof this.reserved[i]=="string"?t.reservedName.push(this.reserved[i]):t.reservedRange.push(J.DescriptorProto.ReservedRange.create({start:this.reserved[i][0],end:this.reserved[i][1]}));return t.options=Mr(this.options,J.MessageOptions),t};var W1=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;oi.fromDescriptor=function(e,t){if(typeof e.length=="number"&&(e=J.DescriptorProto.decode(e)),typeof e.number!="number")throw Error("missing field id");var i;e.typeName&&e.typeName.length?i=e.typeName:i=J1(e.type);var r;switch(e.label){case 1:r=void 0;break;case 2:r="required";break;case 3:r="repeated";break;default:throw Error("illegal label: "+e.label)}var s=e.extendee;e.extendee!==void 0&&(s=s.length?s:void 0);var a=new oi(e.name.length?e.name:"field"+e.number,e.number,i,r,s);if(a.options=Nr(e.options,J.FieldOptions),e.defaultValue&&e.defaultValue.length){var o=e.defaultValue;switch(o){case"true":case"TRUE":o=!0;break;case"false":case"FALSE":o=!1;break;default:var l=W1.exec(o);l&&(o=parseInt(o));break}a.setOption("default",o)}return X1(e.type)&&(t==="proto3"?e.options&&!e.options.packed&&a.setOption("packed",!1):e.options&&e.options.packed||a.setOption("packed",!1)),a};oi.prototype.toDescriptor=function(e){var t=J.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=lt.util.ucFirst(this.name),t.label=3;else{switch(t.type=$d(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:t.typeName=this.resolvedType?u0(this.parent,this.resolvedType):this.type;break}switch(this.rule){case"repeated":t.label=3;break;case"required":t.label=2;break;default:t.label=1;break}}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=Mr(this.options,J.FieldOptions),this.options.default!=null&&(t.defaultValue=String(this.options.default))),e==="proto3"?this.packed||((t.options||(t.options=J.FieldOptions.create())).packed=!1):this.packed&&((t.options||(t.options=J.FieldOptions.create())).packed=!0),t};var H1=0;Rn.fromDescriptor=function(e){typeof e.length=="number"&&(e=J.EnumDescriptorProto.decode(e));var t={};if(e.value)for(var i=0;i<e.value.length;++i){var r=e.value[i].name,s=e.value[i].number||0;t[r&&r.length?r:"NAME"+s]=s}return new Rn(e.name&&e.name.length?e.name:"Enum"+H1++,t,Nr(e.options,J.EnumOptions))};Rn.prototype.toDescriptor=function(){for(var e=[],t=0,i=Object.keys(this.values);t<i.length;++t)e.push(J.EnumValueDescriptorProto.create({name:i[t],number:this.values[i[t]]}));return J.EnumDescriptorProto.create({name:this.name,value:e,options:Mr(this.options,J.EnumOptions)})};var K1=0;Bo.fromDescriptor=function(e){return typeof e.length=="number"&&(e=J.OneofDescriptorProto.decode(e)),new Bo(e.name&&e.name.length?e.name:"oneof"+K1++)};Bo.prototype.toDescriptor=function(){return J.OneofDescriptorProto.create({name:this.name})};var Q1=0;Us.fromDescriptor=function(e){typeof e.length=="number"&&(e=J.ServiceDescriptorProto.decode(e));var t=new Us(e.name&&e.name.length?e.name:"Service"+Q1++,Nr(e.options,J.ServiceOptions));if(e.method)for(var i=0;i<e.method.length;++i)t.add(qo.fromDescriptor(e.method[i]));return t};Us.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return J.ServiceDescriptorProto.create({name:this.name,method:e,options:Mr(this.options,J.ServiceOptions)})};var Y1=0;qo.fromDescriptor=function(e){return typeof e.length=="number"&&(e=J.MethodDescriptorProto.decode(e)),new qo(e.name&&e.name.length?e.name:"Method"+Y1++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,Nr(e.options,J.MethodOptions))};qo.prototype.toDescriptor=function(){return J.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:Mr(this.options,J.MethodOptions)})};function J1(n){switch(n){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+n)}function X1(n){switch(n){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function $d(n,e){switch(n){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(e instanceof Rn)return 14;if(e instanceof ai)return e.group?10:11;throw Error("illegal type: "+n)}function Nr(n,e){if(n){for(var t=[],i=0,r,s,a;i<e.fieldsArray.length;++i)(s=(r=e._fieldsArray[i]).name)!=="uninterpretedOption"&&n.hasOwnProperty(s)&&(a=n[s],r.resolvedType instanceof Rn&&typeof a=="number"&&r.resolvedType.valuesById[a]!==void 0&&(a=r.resolvedType.valuesById[a]),t.push(Z1(s),a));return t.length?lt.util.toObject(t):void 0}}function Mr(n,e){if(n){for(var t=[],i=0,r=Object.keys(n),s,a;i<r.length;++i)if(a=n[s=r[i]],s!=="default"){var o=e.fields[s];!o&&!(o=e.fields[s=lt.util.camelCase(s)])||t.push(s,a)}return t.length?e.fromObject(lt.util.toObject(t)):void 0}}function u0(n,e){var t=n.fullName.split("."),i=e.fullName.split("."),r=0,s=0,a=i.length-1;if(!(n instanceof Vs)&&e instanceof l0)for(;r<t.length&&s<a&&t[r]===i[s];){var o=e.lookup(t[r++],!0);if(o!==null&&o!==e)break;++s}else for(;r<t.length&&s<a&&t[r]===i[s];++r,++s);return i.slice(s).join(".")}function Z1(n){return n.substring(0,1)+n.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}});var f0=w((k3,eA)=>{eA.exports={nested:{google:{nested:{protobuf:{nested:{Api:{fields:{name:{type:"string",id:1},methods:{rule:"repeated",type:"Method",id:2},options:{rule:"repeated",type:"Option",id:3},version:{type:"string",id:4},sourceContext:{type:"SourceContext",id:5},mixins:{rule:"repeated",type:"Mixin",id:6},syntax:{type:"Syntax",id:7}}},Method:{fields:{name:{type:"string",id:1},requestTypeUrl:{type:"string",id:2},requestStreaming:{type:"bool",id:3},responseTypeUrl:{type:"string",id:4},responseStreaming:{type:"bool",id:5},options:{rule:"repeated",type:"Option",id:6},syntax:{type:"Syntax",id:7}}},Mixin:{fields:{name:{type:"string",id:1},root:{type:"string",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}}}}}}}}});var p0=w((N3,tA)=>{tA.exports={nested:{google:{nested:{protobuf:{nested:{SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var m0=w((M3,nA)=>{nA.exports={nested:{google:{nested:{protobuf:{nested:{Type:{fields:{name:{type:"string",id:1},fields:{rule:"repeated",type:"Field",id:2},oneofs:{rule:"repeated",type:"string",id:3},options:{rule:"repeated",type:"Option",id:4},sourceContext:{type:"SourceContext",id:5},syntax:{type:"Syntax",id:6}}},Field:{fields:{kind:{type:"Kind",id:1},cardinality:{type:"Cardinality",id:2},number:{type:"int32",id:3},name:{type:"string",id:4},typeUrl:{type:"string",id:6},oneofIndex:{type:"int32",id:7},packed:{type:"bool",id:8},options:{rule:"repeated",type:"Option",id:9},jsonName:{type:"string",id:10},defaultValue:{type:"string",id:11}},nested:{Kind:{values:{TYPE_UNKNOWN:0,TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Cardinality:{values:{CARDINALITY_UNKNOWN:0,CARDINALITY_OPTIONAL:1,CARDINALITY_REQUIRED:2,CARDINALITY_REPEATED:3}}}},Enum:{fields:{name:{type:"string",id:1},enumvalue:{rule:"repeated",type:"EnumValue",id:2},options:{rule:"repeated",type:"Option",id:3},sourceContext:{type:"SourceContext",id:4},syntax:{type:"Syntax",id:5}}},EnumValue:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{rule:"repeated",type:"Option",id:3}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var _0=w(li=>{"use strict";Object.defineProperty(li,"__esModule",{value:!0});li.addCommonProtos=li.loadProtosWithOptionsSync=li.loadProtosWithOptions=void 0;var g0=le("fs"),y0=le("path"),Pr=Fo();function v0(n,e){let t=n.resolvePath;n.resolvePath=(i,r)=>{if(y0.isAbsolute(r))return r;for(let s of e){let a=y0.join(s,r);try{return g0.accessSync(a,g0.constants.R_OK),a}catch{continue}}return process.emitWarning(`${r} not found in any of the include paths ${e}`),t(i,r)}}function iA(n,e){return R(this,null,function*(){let t=new Pr.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))return Promise.reject(new Error("The includeDirs option must be an array"));v0(t,e.includeDirs)}let i=yield t.load(n,e);return i.resolveAll(),i})}li.loadProtosWithOptions=iA;function rA(n,e){let t=new Pr.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))throw new Error("The includeDirs option must be an array");v0(t,e.includeDirs)}let i=t.loadSync(n,e);return i.resolveAll(),i}li.loadProtosWithOptionsSync=rA;function sA(){let n=f0(),e=Gd(),t=p0(),i=m0();Pr.common("api",n.nested.google.nested.protobuf.nested),Pr.common("descriptor",e.nested.google.nested.protobuf.nested),Pr.common("source_context",t.nested.google.nested.protobuf.nested),Pr.common("type",i.nested.google.nested.protobuf.nested)}li.addCommonProtos=sA});var S0=w((b0,jd)=>{"use strict";var T0=function(n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t(d,f,P){this.low=d|0,this.high=f|0,this.unsigned=!!P}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0});function i(d){return(d&&d.__isLong__)===!0}function r(d){var f=Math.clz32(d&-d);return d?31-f:f}t.isLong=i;var s={},a={};function o(d,f){var P,ne,Te;return f?(d>>>=0,(Te=0<=d&&d<256)&&(ne=a[d],ne)?ne:(P=c(d,0,!0),Te&&(a[d]=P),P)):(d|=0,(Te=-128<=d&&d<128)&&(ne=s[d],ne)?ne:(P=c(d,d<0?-1:0,!1),Te&&(s[d]=P),P))}t.fromInt=o;function l(d,f){if(isNaN(d))return f?M:L;if(f){if(d<0)return M;if(d>=C)return y}else{if(d<=-O)return v;if(d+1>=O)return g}return d<0?l(-d,f).neg():c(d%E|0,d/E|0,f)}t.fromNumber=l;function c(d,f,P){return new t(d,f,P)}t.fromBits=c;var u=Math.pow;function m(d,f,P){if(d.length===0)throw Error("empty string");if(typeof f=="number"?(P=f,f=!1):f=!!f,d==="NaN"||d==="Infinity"||d==="+Infinity"||d==="-Infinity")return f?M:L;if(P=P||10,P<2||36<P)throw RangeError("radix");var ne;if((ne=d.indexOf("-"))>0)throw Error("interior hyphen");if(ne===0)return m(d.substring(1),f,P).neg();for(var Te=l(u(P,8)),de=L,Re=0;Re<d.length;Re+=8){var fe=Math.min(8,d.length-Re),rt=parseInt(d.substring(Re,Re+fe),P);if(fe<8){var ke=l(u(P,fe));de=de.mul(ke).add(l(rt))}else de=de.mul(Te),de=de.add(l(rt))}return de.unsigned=f,de}t.fromString=m;function p(d,f){return typeof d=="number"?l(d,f):typeof d=="string"?m(d,f):c(d.low,d.high,typeof f=="boolean"?f:d.unsigned)}t.fromValue=p;var T=65536,S=1<<24,E=T*T,C=E*E,O=C/2,I=o(S),L=o(0);t.ZERO=L;var M=o(0,!0);t.UZERO=M;var j=o(1);t.ONE=j;var G=o(1,!0);t.UONE=G;var _=o(-1);t.NEG_ONE=_;var g=c(-1,2147483647,!1);t.MAX_VALUE=g;var y=c(-1,-1,!0);t.MAX_UNSIGNED_VALUE=y;var v=c(0,-2147483648,!1);t.MIN_VALUE=v;var h=t.prototype;h.toInt=function(){return this.unsigned?this.low>>>0:this.low},h.toNumber=function(){return this.unsigned?(this.high>>>0)*E+(this.low>>>0):this.high*E+(this.low>>>0)},h.toString=function(f){if(f=f||10,f<2||36<f)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(v)){var P=l(f),ne=this.div(P),Te=ne.mul(P).sub(this);return ne.toString(f)+Te.toInt().toString(f)}else return"-"+this.neg().toString(f);for(var de=l(u(f,6),this.unsigned),Re=this,fe="";;){var rt=Re.div(de),ke=Re.sub(rt.mul(de)).toInt()>>>0,we=ke.toString(f);if(Re=rt,Re.isZero())return we+fe;for(;we.length<6;)we="0"+we;fe=""+we+fe}},h.getHighBits=function(){return this.high},h.getHighBitsUnsigned=function(){return this.high>>>0},h.getLowBits=function(){return this.low},h.getLowBitsUnsigned=function(){return this.low>>>0},h.getNumBitsAbs=function(){if(this.isNegative())return this.eq(v)?64:this.neg().getNumBitsAbs();for(var f=this.high!=0?this.high:this.low,P=31;P>0&&!(f&1<<P);P--);return this.high!=0?P+33:P+1},h.isZero=function(){return this.high===0&&this.low===0},h.eqz=h.isZero,h.isNegative=function(){return!this.unsigned&&this.high<0},h.isPositive=function(){return this.unsigned||this.high>=0},h.isOdd=function(){return(this.low&1)===1},h.isEven=function(){return(this.low&1)===0},h.equals=function(f){return i(f)||(f=p(f)),this.unsigned!==f.unsigned&&this.high>>>31===1&&f.high>>>31===1?!1:this.high===f.high&&this.low===f.low},h.eq=h.equals,h.notEquals=function(f){return!this.eq(f)},h.neq=h.notEquals,h.ne=h.notEquals,h.lessThan=function(f){return this.comp(f)<0},h.lt=h.lessThan,h.lessThanOrEqual=function(f){return this.comp(f)<=0},h.lte=h.lessThanOrEqual,h.le=h.lessThanOrEqual,h.greaterThan=function(f){return this.comp(f)>0},h.gt=h.greaterThan,h.greaterThanOrEqual=function(f){return this.comp(f)>=0},h.gte=h.greaterThanOrEqual,h.ge=h.greaterThanOrEqual,h.compare=function(f){if(i(f)||(f=p(f)),this.eq(f))return 0;var P=this.isNegative(),ne=f.isNegative();return P&&!ne?-1:!P&&ne?1:this.unsigned?f.high>>>0>this.high>>>0||f.high===this.high&&f.low>>>0>this.low>>>0?-1:1:this.sub(f).isNegative()?-1:1},h.comp=h.compare,h.negate=function(){return!this.unsigned&&this.eq(v)?v:this.not().add(j)},h.neg=h.negate,h.add=function(f){i(f)||(f=p(f));var P=this.high>>>16,ne=this.high&65535,Te=this.low>>>16,de=this.low&65535,Re=f.high>>>16,fe=f.high&65535,rt=f.low>>>16,ke=f.low&65535,we=0,Ke=0,Ne=0,st=0;return st+=de+ke,Ne+=st>>>16,st&=65535,Ne+=Te+rt,Ke+=Ne>>>16,Ne&=65535,Ke+=ne+fe,we+=Ke>>>16,Ke&=65535,we+=P+Re,we&=65535,c(Ne<<16|st,we<<16|Ke,this.unsigned)},h.subtract=function(f){return i(f)||(f=p(f)),this.add(f.neg())},h.sub=h.subtract,h.multiply=function(f){if(this.isZero())return this;if(i(f)||(f=p(f)),e){var P=e.mul(this.low,this.high,f.low,f.high);return c(P,e.get_high(),this.unsigned)}if(f.isZero())return this.unsigned?M:L;if(this.eq(v))return f.isOdd()?v:L;if(f.eq(v))return this.isOdd()?v:L;if(this.isNegative())return f.isNegative()?this.neg().mul(f.neg()):this.neg().mul(f).neg();if(f.isNegative())return this.mul(f.neg()).neg();if(this.lt(I)&&f.lt(I))return l(this.toNumber()*f.toNumber(),this.unsigned);var ne=this.high>>>16,Te=this.high&65535,de=this.low>>>16,Re=this.low&65535,fe=f.high>>>16,rt=f.high&65535,ke=f.low>>>16,we=f.low&65535,Ke=0,Ne=0,st=0,nr=0;return nr+=Re*we,st+=nr>>>16,nr&=65535,st+=de*we,Ne+=st>>>16,st&=65535,st+=Re*ke,Ne+=st>>>16,st&=65535,Ne+=Te*we,Ke+=Ne>>>16,Ne&=65535,Ne+=de*ke,Ke+=Ne>>>16,Ne&=65535,Ne+=Re*rt,Ke+=Ne>>>16,Ne&=65535,Ke+=ne*we+Te*ke+de*rt+Re*fe,Ke&=65535,c(st<<16|nr,Ke<<16|Ne,this.unsigned)},h.mul=h.multiply,h.divide=function(f){if(i(f)||(f=p(f)),f.isZero())throw Error("division by zero");if(e){if(!this.unsigned&&this.high===-2147483648&&f.low===-1&&f.high===-1)return this;var P=(this.unsigned?e.div_u:e.div_s)(this.low,this.high,f.low,f.high);return c(P,e.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?M:L;var ne,Te,de;if(this.unsigned){if(f.unsigned||(f=f.toUnsigned()),f.gt(this))return M;if(f.gt(this.shru(1)))return G;de=M}else{if(this.eq(v)){if(f.eq(j)||f.eq(_))return v;if(f.eq(v))return j;var Re=this.shr(1);return ne=Re.div(f).shl(1),ne.eq(L)?f.isNegative()?j:_:(Te=this.sub(f.mul(ne)),de=ne.add(Te.div(f)),de)}else if(f.eq(v))return this.unsigned?M:L;if(this.isNegative())return f.isNegative()?this.neg().div(f.neg()):this.neg().div(f).neg();if(f.isNegative())return this.div(f.neg()).neg();de=L}for(Te=this;Te.gte(f);){ne=Math.max(1,Math.floor(Te.toNumber()/f.toNumber()));for(var fe=Math.ceil(Math.log(ne)/Math.LN2),rt=fe<=48?1:u(2,fe-48),ke=l(ne),we=ke.mul(f);we.isNegative()||we.gt(Te);)ne-=rt,ke=l(ne,this.unsigned),we=ke.mul(f);ke.isZero()&&(ke=j),de=de.add(ke),Te=Te.sub(we)}return de},h.div=h.divide,h.modulo=function(f){if(i(f)||(f=p(f)),e){var P=(this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,f.low,f.high);return c(P,e.get_high(),this.unsigned)}return this.sub(this.div(f).mul(f))},h.mod=h.modulo,h.rem=h.modulo,h.not=function(){return c(~this.low,~this.high,this.unsigned)},h.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},h.clz=h.countLeadingZeros,h.countTrailingZeros=function(){return this.low?r(this.low):r(this.high)+32},h.ctz=h.countTrailingZeros,h.and=function(f){return i(f)||(f=p(f)),c(this.low&f.low,this.high&f.high,this.unsigned)},h.or=function(f){return i(f)||(f=p(f)),c(this.low|f.low,this.high|f.high,this.unsigned)},h.xor=function(f){return i(f)||(f=p(f)),c(this.low^f.low,this.high^f.high,this.unsigned)},h.shiftLeft=function(f){return i(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low<<f,this.high<<f|this.low>>>32-f,this.unsigned):c(0,this.low<<f-32,this.unsigned)},h.shl=h.shiftLeft,h.shiftRight=function(f){return i(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low>>>f|this.high<<32-f,this.high>>f,this.unsigned):c(this.high>>f-32,this.high>=0?0:-1,this.unsigned)},h.shr=h.shiftRight,h.shiftRightUnsigned=function(f){return i(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low>>>f|this.high<<32-f,this.high>>>f,this.unsigned):f===32?c(this.high,0,this.unsigned):c(this.high>>>f-32,0,this.unsigned)},h.shru=h.shiftRightUnsigned,h.shr_u=h.shiftRightUnsigned,h.rotateLeft=function(f){var P;return i(f)&&(f=f.toInt()),(f&=63)===0?this:f===32?c(this.high,this.low,this.unsigned):f<32?(P=32-f,c(this.low<<f|this.high>>>P,this.high<<f|this.low>>>P,this.unsigned)):(f-=32,P=32-f,c(this.high<<f|this.low>>>P,this.low<<f|this.high>>>P,this.unsigned))},h.rotl=h.rotateLeft,h.rotateRight=function(f){var P;return i(f)&&(f=f.toInt()),(f&=63)===0?this:f===32?c(this.high,this.low,this.unsigned):f<32?(P=32-f,c(this.high<<P|this.low>>>f,this.low<<P|this.high>>>f,this.unsigned)):(f-=32,P=32-f,c(this.low<<P|this.high>>>f,this.high<<P|this.low>>>f,this.unsigned))},h.rotr=h.rotateRight,h.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},h.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},h.toBytes=function(f){return f?this.toBytesLE():this.toBytesBE()},h.toBytesLE=function(){var f=this.high,P=this.low;return[P&255,P>>>8&255,P>>>16&255,P>>>24,f&255,f>>>8&255,f>>>16&255,f>>>24]},h.toBytesBE=function(){var f=this.high,P=this.low;return[f>>>24,f>>>16&255,f>>>8&255,f&255,P>>>24,P>>>16&255,P>>>8&255,P&255]},t.fromBytes=function(f,P,ne){return ne?t.fromBytesLE(f,P):t.fromBytesBE(f,P)},t.fromBytesLE=function(f,P){return new t(f[0]|f[1]<<8|f[2]<<16|f[3]<<24,f[4]|f[5]<<8|f[6]<<16|f[7]<<24,P)},t.fromBytesBE=function(f,P){return new t(f[4]<<24|f[5]<<16|f[6]<<8|f[7],f[0]<<24|f[1]<<16|f[2]<<8|f[3],P)};var b=t;return n.default=b,"default"in n?n.default:n}({});typeof define=="function"&&define.amd?define([],function(){return T0}):typeof jd=="object"&&typeof b0=="object"&&(jd.exports=T0)});var Qd=w(qe=>{"use strict";Object.defineProperty(qe,"__esModule",{value:!0});qe.loadFileDescriptorSetFromObject=qe.loadFileDescriptorSetFromBuffer=qe.fromJSON=qe.loadSync=qe.load=qe.IdempotencyLevel=qe.isAnyExtension=qe.Long=void 0;var aA=cy(),dn=Fo(),Hd=h0(),Kd=_0(),oA=S0();qe.Long=oA;function lA(n){return"@type"in n&&typeof n["@type"]=="string"}qe.isAnyExtension=lA;var w0;(function(n){n.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",n.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",n.IDEMPOTENT="IDEMPOTENT"})(w0=qe.IdempotencyLevel||(qe.IdempotencyLevel={}));var I0={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function cA(n,e){return n===""?e:n+"."+e}function uA(n){return n instanceof dn.Service||n instanceof dn.Type||n instanceof dn.Enum}function dA(n){return n instanceof dn.Namespace||n instanceof dn.Root}function A0(n,e){let t=cA(e,n.name);return uA(n)?[[t,n]]:dA(n)&&typeof n.nested<"u"?Object.keys(n.nested).map(i=>A0(n.nested[i],t)).reduce((i,r)=>i.concat(r),[]):[]}function C0(n,e){return function(i){return n.toObject(n.decode(i),e)}}function E0(n){return function(t){if(Array.isArray(t))throw new Error(`Failed to serialize message: expected object with ${n.name} structure, got array instead`);let i=n.fromObject(t);return n.encode(i).finish()}}function hA(n){return(n||[]).reduce((e,t)=>{for(let[i,r]of Object.entries(t))switch(i){case"uninterpreted_option":e.uninterpreted_option.push(t.uninterpreted_option);break;default:e[i]=r}return e},{deprecated:!1,idempotency_level:w0.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function fA(n,e,t,i){let r=n.resolvedRequestType,s=n.resolvedResponseType;return{path:"/"+e+"/"+n.name,requestStream:!!n.requestStream,responseStream:!!n.responseStream,requestSerialize:E0(r),requestDeserialize:C0(r,t),responseSerialize:E0(s),responseDeserialize:C0(s,t),originalName:aA(n.name),requestType:Wd(r,i),responseType:Wd(s,i),options:hA(n.parsedOptions)}}function pA(n,e,t,i){let r={};for(let s of n.methodsArray)r[s.name]=fA(s,e,t,i);return r}function Wd(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:t.$type.toObject(t,I0),fileDescriptorProtos:e}}function mA(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:t.$type.toObject(t,I0),fileDescriptorProtos:e}}function gA(n,e,t,i){if(n instanceof dn.Service)return pA(n,e,t,i);if(n instanceof dn.Type)return Wd(n,i);if(n instanceof dn.Enum)return mA(n,i);throw new Error("Type mismatch in reflection object handling")}function Vo(n,e){let t={};n.resolveAll();let r=n.toDescriptor("proto3").file.map(s=>Buffer.from(Hd.FileDescriptorProto.encode(s).finish()));for(let[s,a]of A0(n,""))t[s]=gA(a,s,e,r);return t}function D0(n,e){e=e||{};let t=dn.Root.fromDescriptor(n);return t.resolveAll(),Vo(t,e)}function yA(n,e){return(0,Kd.loadProtosWithOptions)(n,e).then(t=>Vo(t,e))}qe.load=yA;function vA(n,e){let t=(0,Kd.loadProtosWithOptionsSync)(n,e);return Vo(t,e)}qe.loadSync=vA;function _A(n,e){e=e||{};let t=dn.Root.fromJSON(n);return t.resolveAll(),Vo(t,e)}qe.fromJSON=_A;function TA(n,e){let t=Hd.FileDescriptorSet.decode(n);return D0(t,e)}qe.loadFileDescriptorSetFromBuffer=TA;function bA(n,e){let t=Hd.FileDescriptorSet.fromObject(n);return D0(t,e)}qe.loadFileDescriptorSetFromObject=bA;(0,Kd.addCommonProtos)()});var Bi=w(Se=>{"use strict";Object.defineProperty(Se,"__esModule",{value:!0});Se.setup=Se.getChannelzServiceDefinition=Se.getChannelzHandlers=Se.unregisterChannelzRef=Se.registerChannelzSocket=Se.registerChannelzServer=Se.registerChannelzSubchannel=Se.registerChannelzChannel=Se.ChannelzCallTracker=Se.ChannelzChildrenTracker=Se.ChannelzTrace=void 0;var R0=le("net"),zs=Et(),$s=oe(),SA=tn(),CA=ao(),EA=Wu();function Yd(n){return{channel_id:n.id,name:n.name}}function eh(n){return{subchannel_id:n.id,name:n.name}}function wA(n){return{server_id:n.id}}function zo(n){return{socket_id:n.id,name:n.name}}var x0=32,Jd=class{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,i){let r=new Date;this.events.push({description:t,severity:e,timestamp:r,childChannel:i?.kind==="channel"?i:void 0,childSubchannel:i?.kind==="subchannel"?i:void 0}),this.events.length>=x0*2&&(this.events=this.events.slice(x0)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:xn(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:xn(e.timestamp),channel_ref:e.childChannel?Yd(e.childChannel):null,subchannel_ref:e.childSubchannel?eh(e.childSubchannel):null}))}}};Se.ChannelzTrace=Jd;var Xd=class{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,i,r;switch(e.kind){case"channel":{let s=(t=this.channelChildren.get(e.id))!==null&&t!==void 0?t:{ref:e,count:0};s.count+=1,this.channelChildren.set(e.id,s);break}case"subchannel":{let s=(i=this.subchannelChildren.get(e.id))!==null&&i!==void 0?i:{ref:e,count:0};s.count+=1,this.subchannelChildren.set(e.id,s);break}case"socket":{let s=(r=this.socketChildren.get(e.id))!==null&&r!==void 0?r:{ref:e,count:0};s.count+=1,this.socketChildren.set(e.id,s);break}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t));break}}}getChildLists(){let e=[];for(let{ref:r}of this.channelChildren.values())e.push(r);let t=[];for(let{ref:r}of this.subchannelChildren.values())t.push(r);let i=[];for(let{ref:r}of this.socketChildren.values())i.push(r);return{channels:e,subchannels:t,sockets:i}}};Se.ChannelzChildrenTracker=Xd;var Zd=class{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}};Se.ChannelzCallTracker=Zd;var IA=1;function Go(){return IA++}var Gs=[],th=[],ci=[],nh=[];function AA(n,e,t){let i=Go(),r={id:i,name:n,kind:"channel"};return t&&(Gs[i]={ref:r,getInfo:e}),r}Se.registerChannelzChannel=AA;function DA(n,e,t){let i=Go(),r={id:i,name:n,kind:"subchannel"};return t&&(th[i]={ref:r,getInfo:e}),r}Se.registerChannelzSubchannel=DA;function RA(n,e){let t=Go(),i={id:t,kind:"server"};return e&&(ci[t]={ref:i,getInfo:n}),i}Se.registerChannelzServer=RA;function xA(n,e,t){let i=Go(),r={id:i,name:n,kind:"socket"};return t&&(nh[i]={ref:r,getInfo:e}),r}Se.registerChannelzSocket=xA;function OA(n){switch(n.kind){case"channel":delete Gs[n.id];return;case"subchannel":delete th[n.id];return;case"server":delete ci[n.id];return;case"socket":delete nh[n.id];return}}Se.unregisterChannelzRef=OA;function kA(n){let e=Number.parseInt(n,16);return[e/256|0,e%256]}function O0(n){if(n==="")return[];let e=n.split(":").map(i=>kA(i));return[].concat(...e)}function NA(n){if((0,R0.isIPv4)(n))return Buffer.from(Uint8Array.from(n.split(".").map(e=>Number.parseInt(e))));if((0,R0.isIPv6)(n)){let e,t,i=n.indexOf("::");i===-1?(e=n,t=""):(e=n.substring(0,i),t=n.substring(i+2));let r=Buffer.from(O0(e)),s=Buffer.from(O0(t)),a=Buffer.alloc(16-r.length-s.length,0);return Buffer.concat([r,a,s])}else return null}function N0(n){switch(n){case zs.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case zs.ConnectivityState.IDLE:return{state:"IDLE"};case zs.ConnectivityState.READY:return{state:"READY"};case zs.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case zs.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function xn(n){if(!n)return null;let e=n.getTime();return{seconds:e/1e3|0,nanos:e%1e3*1e6}}function M0(n){let e=n.getInfo();return{ref:Yd(n.ref),data:{target:e.target,state:N0(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:xn(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},channel_ref:e.children.channels.map(t=>Yd(t)),subchannel_ref:e.children.subchannels.map(t=>eh(t))}}function MA(n,e){let t=Number.parseInt(n.request.channel_id),i=Gs[t];if(i===void 0){e({code:$s.Status.NOT_FOUND,details:"No channel data found for id "+t});return}e(null,{channel:M0(i)})}function PA(n,e){let t=Number.parseInt(n.request.max_results),i=[],r=Number.parseInt(n.request.start_channel_id);for(;r<Gs.length;r++){let s=Gs[r];if(s!==void 0&&(i.push(M0(s)),i.length>=t))break}e(null,{channel:i,end:r>=ci.length})}function P0(n){let e=n.getInfo();return{ref:wA(n.ref),data:{calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:xn(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},listen_socket:e.listenerChildren.sockets.map(t=>zo(t))}}function LA(n,e){let t=Number.parseInt(n.request.server_id),i=ci[t];if(i===void 0){e({code:$s.Status.NOT_FOUND,details:"No server data found for id "+t});return}e(null,{server:P0(i)})}function FA(n,e){let t=Number.parseInt(n.request.max_results),i=[],r=Number.parseInt(n.request.start_server_id);for(;r<ci.length;r++){let s=ci[r];if(s!==void 0&&(i.push(P0(s)),i.length>=t))break}e(null,{server:i,end:r>=ci.length})}function BA(n,e){let t=Number.parseInt(n.request.subchannel_id),i=th[t];if(i===void 0){e({code:$s.Status.NOT_FOUND,details:"No subchannel data found for id "+t});return}let r=i.getInfo(),s={ref:eh(i.ref),data:{target:r.target,state:N0(r.state),calls_started:r.callTracker.callsStarted,calls_succeeded:r.callTracker.callsSucceeded,calls_failed:r.callTracker.callsFailed,last_call_started_timestamp:xn(r.callTracker.lastCallStartedTimestamp),trace:r.trace.getTraceMessage()},socket_ref:r.children.sockets.map(a=>zo(a))};e(null,{subchannel:s})}function k0(n){var e;return(0,SA.isTcpSubchannelAddress)(n)?{address:"tcpip_address",tcpip_address:{ip_address:(e=NA(n.host))!==null&&e!==void 0?e:void 0,port:n.port}}:{address:"uds_address",uds_address:{filename:n.path}}}function qA(n,e){var t,i,r,s,a;let o=Number.parseInt(n.request.socket_id),l=nh[o];if(l===void 0){e({code:$s.Status.NOT_FOUND,details:"No socket data found for id "+o});return}let c=l.getInfo(),u=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:(t=c.security.cipherSuiteStandardName)!==null&&t!==void 0?t:void 0,other_name:(i=c.security.cipherSuiteOtherName)!==null&&i!==void 0?i:void 0,local_certificate:(r=c.security.localCertificate)!==null&&r!==void 0?r:void 0,remote_certificate:(s=c.security.remoteCertificate)!==null&&s!==void 0?s:void 0}}:null,m={ref:zo(l.ref),local:c.localAddress?k0(c.localAddress):null,remote:c.remoteAddress?k0(c.remoteAddress):null,remote_name:(a=c.remoteName)!==null&&a!==void 0?a:void 0,security:u,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:xn(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:xn(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:xn(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:xn(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}};e(null,{socket:m})}function VA(n,e){let t=Number.parseInt(n.request.server_id),i=ci[t];if(i===void 0){e({code:$s.Status.NOT_FOUND,details:"No server data found for id "+t});return}let r=Number.parseInt(n.request.start_socket_id),s=Number.parseInt(n.request.max_results),o=i.getInfo().sessionChildren.sockets.sort((u,m)=>u.id-m.id),l=[],c=0;for(;c<o.length&&!(o[c].id>=r&&(l.push(zo(o[c])),l.length>=s));c++);e(null,{socket_ref:l,end:c>=o.length})}function L0(){return{GetChannel:MA,GetTopChannels:PA,GetServer:LA,GetServers:FA,GetSubchannel:BA,GetSocket:qA,GetServerSockets:VA}}Se.getChannelzHandlers=L0;var Uo=null;function F0(){if(Uo)return Uo;let n=Qd().loadSync,e=n("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return Uo=(0,EA.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service,Uo}Se.getChannelzServiceDefinition=F0;function UA(){(0,CA.registerAdminService)(F0,L0)}Se.setup=UA});var B0=w(jo=>{"use strict";Object.defineProperty(jo,"__esModule",{value:!0});jo.Subchannel=void 0;var ye=Et(),zA=Cs(),ih=Ie(),$o=oe(),GA=gt(),$A=tn(),Lr=Bi(),jA="subchannel",WA=~(1<<31),rh=class{constructor(e,t,i,r,s){var a;this.channelTarget=e,this.subchannelAddress=t,this.options=i,this.credentials=r,this.connector=s,this.connectivityState=ye.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new Lr.ChannelzCallTracker,this.childrenTracker=new Lr.ChannelzChildrenTracker,this.streamTracker=new Lr.ChannelzCallTracker;let o={initialDelay:i["grpc.initial_reconnect_backoff_ms"],maxDelay:i["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new zA.BackoffTimeout(()=>{this.handleBackoffTimer()},o),this.backoffTimeout.unref(),this.subchannelAddressString=(0,$A.subchannelAddressToString)(t),this.keepaliveTime=(a=i["grpc.keepalive_time_ms"])!==null&&a!==void 0?a:-1,i["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new Lr.ChannelzTrace,this.channelzRef=(0,Lr.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(i,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){ih.trace($o.LogVerbosity.DEBUG,jA,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){ih.trace($o.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([ye.ConnectivityState.TRANSIENT_FAILURE],ye.ConnectivityState.CONNECTING):this.transitionToState([ye.ConnectivityState.TRANSIENT_FAILURE],ye.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,WA);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(t=>{this.transitionToState([ye.ConnectivityState.CONNECTING],ye.ConnectivityState.READY)?(this.transport=t,this.channelzEnabled&&this.childrenTracker.refChild(t.getChannelzRef()),t.addDisconnectListener(i=>{this.transitionToState([ye.ConnectivityState.READY],ye.ConnectivityState.IDLE),i&&this.keepaliveTime>0&&(this.keepaliveTime*=2,ih.log($o.LogVerbosity.ERROR,`Connection to ${(0,GA.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):t.shutdown()},t=>{this.transitionToState([ye.ConnectivityState.CONNECTING],ye.ConnectivityState.TRANSIENT_FAILURE,`${t}`)})}transitionToState(e,t,i){var r,s;if(e.indexOf(this.connectivityState)===-1)return!1;this.trace(ye.ConnectivityState[this.connectivityState]+" -> "+ye.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+ye.ConnectivityState[t]);let a=this.connectivityState;switch(this.connectivityState=t,t){case ye.ConnectivityState.READY:this.stopBackoff();break;case ye.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case ye.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(r=this.transport)===null||r===void 0||r.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case ye.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(s=this.transport)===null||s===void 0||s.shutdown(),this.transport=null;break;default:throw new Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let o of this.stateListeners)o(this,a,t,this.keepaliveTime,i);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,this.refcount===0&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,Lr.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([ye.ConnectivityState.CONNECTING,ye.ConnectivityState.READY],ye.ConnectivityState.IDLE)}))}unrefIfOneRef(){return this.refcount===1?(this.unref(),!0):!1}createCall(e,t,i,r){if(!this.transport)throw new Error("Cannot create call, subchannel not READY");let s;return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),s={onCallEnd:a=>{a.code===$o.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):s={},this.transport.createCall(e,t,i,r,s)}startConnecting(){process.nextTick(()=>{this.transitionToState([ye.ConnectivityState.IDLE],ye.ConnectivityState.CONNECTING)||this.connectivityState===ye.ConnectivityState.TRANSIENT_FAILURE&&(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([ye.ConnectivityState.TRANSIENT_FAILURE],ye.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}};jo.Subchannel=rh});var lh=w(hi=>{"use strict";Object.defineProperty(hi,"__esModule",{value:!0});hi.setup=hi.DEFAULT_PORT=void 0;var q0=Zt(),U0=le("dns"),z0=le("util"),HA=_u(),sh=oe(),ah=dt(),KA=Ie(),QA=oe(),ui=gt(),V0=le("net"),YA=Cs(),JA="dns_resolver";function di(n){KA.trace(QA.LogVerbosity.DEBUG,JA,n)}hi.DEFAULT_PORT=443;var XA=3e4,ZA=z0.promisify(U0.resolveTxt),eD=z0.promisify(U0.lookup);function tD(...n){let e=[];for(let t=0;t<Math.max.apply(null,n.map(i=>i.length));t++)for(let i of n)t<i.length&&e.push(i[t]);return e}var oh=class{constructor(e,t,i){var r,s,a;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,di("Resolver constructed for target "+(0,ui.uriToString)(e));let o=(0,ui.splitHostPort)(e.path);o===null?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,V0.isIPv4)(o.host)||(0,V0.isIPv6)(o.host)?(this.ipResult=[{host:o.host,port:(r=o.port)!==null&&r!==void 0?r:hi.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=o.host,this.port=(s=o.port)!==null&&s!==void 0?s:hi.DEFAULT_PORT),this.percentage=Math.random()*100,i["grpc.service_config_disable_resolution"]===1&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:sh.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,ui.uriToString)(this.target)}`,metadata:new ah.Metadata};let l={initialDelay:i["grpc.initial_reconnect_backoff_ms"],maxDelay:i["grpc.max_reconnect_backoff_ms"]};this.backoff=new YA.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},l),this.backoff.unref(),this.minTimeBetweenResolutionsMs=(a=i["grpc.dns_min_time_between_resolutions_ms"])!==null&&a!==void 0?a:XA,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(this.ipResult!==null){this.returnedIpResult||(di("Returning IP address for target "+(0,ui.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(this.dnsHostname===null)di("Failed to parse DNS address "+(0,ui.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:sh.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,ui.uriToString)(this.target)}`,metadata:new ah.Metadata})}),this.stopNextResolutionTimer();else{if(this.pendingLookupPromise!==null)return;di("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=eD(e,{all:!0}),this.pendingLookupPromise.then(t=>{if(this.pendingLookupPromise===null)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let i=t.filter(a=>a.family===4),r=t.filter(a=>a.family===6);this.latestLookupResult=tD(r,i).map(a=>({host:a.address,port:+this.port}));let s="["+this.latestLookupResult.map(a=>a.host+":"+a.port).join(",")+"]";if(di("Resolved addresses for target "+(0,ui.uriToString)(this.target)+": "+s),this.latestLookupResult.length===0){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},t=>{this.pendingLookupPromise!==null&&(di("Resolution error for target "+(0,ui.uriToString)(this.target)+": "+t.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&this.pendingTxtPromise===null&&(this.pendingTxtPromise=ZA(e),this.pendingTxtPromise.then(t=>{if(this.pendingTxtPromise!==null){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,HA.extractAndSelectServiceConfig)(t,this.percentage)}catch(i){this.latestServiceConfigError={code:sh.Status.UNAVAILABLE,details:`Parsing service config failed with error ${i.message}`,metadata:new ah.Metadata}}this.latestLookupResult!==null&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},t=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)===null||t===void 0?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){this.pendingLookupPromise===null&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){this.pendingLookupPromise===null&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?di('resolution update delayed by "min time between resolutions" rate limit'):di("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}};function nD(){(0,q0.registerResolver)("dns",oh),(0,q0.registerDefaultScheme)("dns")}hi.setup=nD});var ch=w(qr=>{"use strict";Object.defineProperty(qr,"__esModule",{value:!0});qr.getProxiedConnection=qr.mapProxyName=void 0;var js=Ie(),Fr=oe(),iD=Zt(),rD=le("http"),sD=le("tls"),aD=Ie(),G0=tn(),Br=gt(),oD=le("url"),lD=lh(),cD="proxy";function fi(n){aD.trace(Fr.LogVerbosity.DEBUG,cD,n)}function uD(){let n="",e="";if(process.env.grpc_proxy)e="grpc_proxy",n=process.env.grpc_proxy;else if(process.env.https_proxy)e="https_proxy",n=process.env.https_proxy;else if(process.env.http_proxy)e="http_proxy",n=process.env.http_proxy;else return{};let t;try{t=new oD.URL(n)}catch{return(0,js.log)(Fr.LogVerbosity.ERROR,`cannot parse value of "${e}" env var`),{}}if(t.protocol!=="http:")return(0,js.log)(Fr.LogVerbosity.ERROR,`"${t.protocol}" scheme not supported in proxy URI`),{};let i=null;t.username&&(t.password?((0,js.log)(Fr.LogVerbosity.INFO,"userinfo found in proxy URI"),i=`${t.username}:${t.password}`):i=t.username);let r=t.hostname,s=t.port;s===""&&(s="80");let a={address:`${r}:${s}`};return i&&(a.creds=i),fi("Proxy server "+a.address+" set by environment variable "+e),a}function dD(){let n=process.env.no_grpc_proxy,e="no_grpc_proxy";return n||(n=process.env.no_proxy,e="no_proxy"),n?(fi("No proxy server list set by environment variable "+e),n.split(",")):[]}function hD(n,e){var t;let i={target:n,extraOptions:{}};if(((t=e["grpc.enable_http_proxy"])!==null&&t!==void 0?t:1)===0||n.scheme==="unix")return i;let r=uD();if(!r.address)return i;let s=(0,Br.splitHostPort)(n.path);if(!s)return i;let a=s.host;for(let l of dD())if(l===a)return fi("Not using proxy for target in no_proxy list: "+(0,Br.uriToString)(n)),i;let o={"grpc.http_connect_target":(0,Br.uriToString)(n)};return r.creds&&(o["grpc.http_connect_creds"]=r.creds),{target:{scheme:"dns",path:r.address},extraOptions:o}}qr.mapProxyName=hD;function fD(n,e,t){var i;if(!("grpc.http_connect_target"in e))return Promise.resolve({});let r=e["grpc.http_connect_target"],s=(0,Br.parseUri)(r);if(s===null)return Promise.resolve({});let a=(0,Br.splitHostPort)(s.path);if(a===null)return Promise.resolve({});let o=`${a.host}:${(i=a.port)!==null&&i!==void 0?i:lD.DEFAULT_PORT}`,l={method:"CONNECT",path:o},c={Host:o};(0,G0.isTcpSubchannelAddress)(n)?(l.host=n.host,l.port=n.port):l.socketPath=n.path,"grpc.http_connect_creds"in e&&(c["Proxy-Authorization"]="Basic "+Buffer.from(e["grpc.http_connect_creds"]).toString("base64")),l.headers=c;let u=(0,G0.subchannelAddressToString)(n);return fi("Using proxy "+u+" to connect to "+l.path),new Promise((m,p)=>{let T=rD.request(l);T.once("connect",(S,E,C)=>{var O;if(T.removeAllListeners(),E.removeAllListeners(),S.statusCode===200)if(fi("Successfully connected to "+l.path+" through proxy "+u),"secureContext"in t){let I=(0,iD.getDefaultAuthority)(s),L=(0,Br.splitHostPort)(I),M=(O=L?.host)!==null&&O!==void 0?O:I,j=sD.connect(Object.assign({host:M,servername:M,socket:E},t),()=>{fi("Successfully established a TLS connection to "+l.path+" through proxy "+u),m({socket:j,realTarget:s})});j.on("error",G=>{fi("Failed to establish a TLS connection to "+l.path+" through proxy "+u+" with error "+G.message),p()})}else fi("Successfully established a plaintext connection to "+l.path+" through proxy "+u),m({socket:E,realTarget:s});else(0,js.log)(Fr.LogVerbosity.ERROR,"Failed to connect to "+l.path+" through proxy "+u+" with status "+S.statusCode),p()}),T.once("error",S=>{T.removeAllListeners(),(0,js.log)(Fr.LogVerbosity.ERROR,"Failed to connect to proxy "+u+" with error "+S.message),p()}),T.end()})}qr.getProxiedConnection=fD});var dh=w(Wo=>{"use strict";Object.defineProperty(Wo,"__esModule",{value:!0});Wo.StreamDecoder=void 0;var On=function(n){return n[n.NO_DATA=0]="NO_DATA",n[n.READING_SIZE=1]="READING_SIZE",n[n.READING_MESSAGE=2]="READING_MESSAGE",n}(On||{}),uh=class{constructor(e){this.maxReadMessageLength=e,this.readState=On.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t=0,i,r=[];for(;t<e.length;)switch(this.readState){case On.NO_DATA:this.readCompressFlag=e.slice(t,t+1),t+=1,this.readState=On.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case On.READING_SIZE:if(i=Math.min(e.length-t,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,t,t+i),this.readSizeRemaining-=i,t+=i,this.readSizeRemaining===0){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),this.maxReadMessageLength!==-1&&this.readMessageSize>this.maxReadMessageLength)throw new Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=On.READING_MESSAGE;else{let s=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=On.NO_DATA,r.push(s)}}break;case On.READING_MESSAGE:if(i=Math.min(e.length-t,this.readMessageRemaining),this.readPartialMessage.push(e.slice(t,t+i)),this.readMessageRemaining-=i,t+=i,this.readMessageRemaining===0){let s=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),a=Buffer.concat(s,this.readMessageSize+5);this.readState=On.NO_DATA,r.push(a)}break;default:throw new Error("Unexpected read state")}return r}};Wo.StreamDecoder=uh});var $0=w(Ho=>{"use strict";Object.defineProperty(Ho,"__esModule",{value:!0});Ho.Http2SubchannelCall=void 0;var kn=le("http2"),pD=le("os"),ce=oe(),pi=dt(),mD=dh(),gD=Ie(),yD=oe(),vD="subchannel_call";function _D(n){for(let[e,t]of Object.entries(pD.constants.errno))if(t===n)return e;return"Unknown system error "+n}var hh=class{constructor(e,t,i,r,s){var a;this.http2Stream=e,this.callEventTracker=t,this.listener=i,this.transport=r,this.callId=s,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=ce.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;let o=(a=r.getOptions()["grpc.max_receive_message_length"])!==null&&a!==void 0?a:ce.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new mD.StreamDecoder(o),e.on("response",(l,c)=>{let u="";for(let m of Object.keys(l))u+="		"+m+": "+l[m]+`
`;switch(this.trace(`Received server headers:
`+u),l[":status"]){case 400:this.mappedStatusCode=ce.Status.INTERNAL;break;case 401:this.mappedStatusCode=ce.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=ce.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=ce.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=ce.Status.UNAVAILABLE;break;default:this.mappedStatusCode=ce.Status.UNKNOWN}if(c&kn.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(l);else{let m;try{m=pi.Metadata.fromHttp2Headers(l)}catch(p){this.endCall({code:ce.Status.UNKNOWN,details:p.message,metadata:new pi.Metadata});return}this.listener.onReceiveMetadata(m)}}),e.on("trailers",l=>{this.handleTrailers(l)}),e.on("data",l=>{if(this.statusOutput)return;this.trace("receive HTTP/2 data frame of length "+l.length);let c;try{c=this.decoder.write(l)}catch(u){this.cancelWithStatus(ce.Status.RESOURCE_EXHAUSTED,u.message);return}for(let u of c)this.trace("parsed message of length "+u.length),this.callEventTracker.addMessageReceived(),this.tryPush(u)}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var l;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),((l=this.finalStatus)===null||l===void 0?void 0:l.code)===ce.Status.OK)return;let c,u="";switch(e.rstCode){case kn.constants.NGHTTP2_NO_ERROR:if(this.finalStatus!==null)return;c=ce.Status.INTERNAL,u=`Received RST_STREAM with code ${e.rstCode}`;break;case kn.constants.NGHTTP2_REFUSED_STREAM:c=ce.Status.UNAVAILABLE,u="Stream refused by server";break;case kn.constants.NGHTTP2_CANCEL:c=ce.Status.CANCELLED,u="Call cancelled";break;case kn.constants.NGHTTP2_ENHANCE_YOUR_CALM:c=ce.Status.RESOURCE_EXHAUSTED,u="Bandwidth exhausted or memory limit exceeded";break;case kn.constants.NGHTTP2_INADEQUATE_SECURITY:c=ce.Status.PERMISSION_DENIED,u="Protocol not secure enough";break;case kn.constants.NGHTTP2_INTERNAL_ERROR:c=ce.Status.INTERNAL,this.internalError===null?u=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:this.internalError.code==="ECONNRESET"||this.internalError.code==="ETIMEDOUT"?(c=ce.Status.UNAVAILABLE,u=this.internalError.message):u=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:c=ce.Status.INTERNAL,u=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:c,details:u,metadata:new pi.Metadata,rstCode:e.rstCode})})}),e.on("error",l=>{l.code!=="ERR_HTTP2_STREAM_ERROR"&&(this.trace("Node error event: message="+l.message+" code="+l.code+" errno="+_D(l.errno)+" syscall="+l.syscall),this.internalError=l),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:ce.Status.UNAVAILABLE,details:"Connection dropped",metadata:new pi.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){gD.trace(yD.LogVerbosity.DEBUG,vD,"["+this.callId+"] "+e)}endCall(e){(this.finalStatus===null||this.finalStatus.code===ce.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){this.finalStatus!==null&&(this.finalStatus.code!==ce.Status.OK||this.readsClosed&&this.unpushedReadMessages.length===0&&!this.isReadFilterPending&&!this.isPushPending)&&this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,!this.statusOutput&&(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){this.callEventTracker.onStreamEnd(!0);let t="";for(let l of Object.keys(e))t+="		"+l+": "+e[l]+`
`;this.trace(`Received server trailers:
`+t);let i;try{i=pi.Metadata.fromHttp2Headers(e)}catch{i=new pi.Metadata}let r=i.getMap(),s=this.mappedStatusCode;if(s===ce.Status.UNKNOWN&&typeof r["grpc-status"]=="string"){let l=Number(r["grpc-status"]);l in ce.Status&&(s=l,this.trace("received status code "+l+" from server")),i.remove("grpc-status")}let a="";if(typeof r["grpc-message"]=="string"){try{a=decodeURI(r["grpc-message"])}catch{a=r["grpc-message"]}i.remove("grpc-message"),this.trace('received status details string "'+a+'" from server')}let o={code:s,details:a,metadata:i};this.endCall(o)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;((e=this.finalStatus)===null||e===void 0?void 0:e.code)===ce.Status.OK?t=kn.constants.NGHTTP2_NO_ERROR:t=kn.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new pi.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(this.finalStatus!==null&&this.finalStatus.code!==ce.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let i=r=>{process.nextTick(()=>{var s;let a=ce.Status.UNAVAILABLE;r?.code==="ERR_STREAM_WRITE_AFTER_END"&&(a=ce.Status.INTERNAL),r&&this.cancelWithStatus(a,`Write error: ${r.message}`),(s=e.callback)===null||s===void 0||s.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,i)}catch(r){this.endCall({code:ce.Status.UNAVAILABLE,details:`Write failed with error ${r.message}`,metadata:new pi.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}};Ho.Http2SubchannelCall=hh});var fh=w(Ko=>{"use strict";Object.defineProperty(Ko,"__esModule",{value:!0});Ko.getNextCallNumber=void 0;var TD=0;function bD(){return TD++}Ko.getNextCallNumber=bD});var H0=w(Yo=>{"use strict";Object.defineProperty(Yo,"__esModule",{value:!0});Yo.Http2SubchannelConnector=void 0;var vh=le("http2"),j0=le("tls"),ph=Bi(),Ws=oe(),SD=ch(),Ur=Ie(),W0=Zt(),Qo=tn(),Vr=gt(),CD=le("net"),ED=$0(),wD=fh(),mh="transport",ID="transport_flowctrl",AD=tu().version,{HTTP2_HEADER_AUTHORITY:DD,HTTP2_HEADER_CONTENT_TYPE:RD,HTTP2_HEADER_METHOD:xD,HTTP2_HEADER_PATH:OD,HTTP2_HEADER_TE:kD,HTTP2_HEADER_USER_AGENT:ND}=vh.constants,MD=2e4,PD=Buffer.from("too_many_pings","ascii"),gh=class{constructor(e,t,i,r){this.session=e,this.options=i,this.remoteName=r,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=MD,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new ph.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,Qo.subchannelAddressToString)(t),i["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,ph.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[i["grpc.primary_user_agent"],`grpc-node-js/${AD}`,i["grpc.secondary_user_agent"]].filter(s=>s).join(" "),"grpc.keepalive_time_ms"in i&&(this.keepaliveTimeMs=i["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in i&&(this.keepaliveTimeoutMs=i["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in i?this.keepaliveWithoutCalls=i["grpc.keepalive_permit_without_calls"]===1:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(s,a,o)=>{let l=!1;s===vh.constants.NGHTTP2_ENHANCE_YOUR_CALM&&o&&o.equals(PD)&&(l=!0),this.trace("connection closed by GOAWAY with code "+s+" and data "+o?.toString()),this.reportDisconnectToOwner(l)}),e.once("error",s=>{this.trace("connection closed with error "+s.message)}),Ur.isTracerEnabled(mh)&&(e.on("remoteSettings",s=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))}),e.on("localSettings",s=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,i;let r=this.session.socket,s=r.remoteAddress?(0,Qo.stringToSubchannelAddress)(r.remoteAddress,r.remotePort):null,a=r.localAddress?(0,Qo.stringToSubchannelAddress)(r.localAddress,r.localPort):null,o;if(this.session.encrypted){let c=r,u=c.getCipher(),m=c.getCertificate(),p=c.getPeerCertificate();o={cipherSuiteStandardName:(e=u.standardName)!==null&&e!==void 0?e:null,cipherSuiteOtherName:u.standardName?null:u.name,localCertificate:m&&"raw"in m?m.raw:null,remoteCertificate:p&&"raw"in p?p.raw:null}}else o=null;return{remoteAddress:s,localAddress:a,security:o,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:(t=this.session.state.localWindowSize)!==null&&t!==void 0?t:null,remoteFlowControlWindow:(i=this.session.state.remoteWindowSize)!==null&&i!==void 0?i:null}}trace(e){Ur.trace(Ws.LogVerbosity.DEBUG,mh,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){Ur.trace(Ws.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){Ur.trace(Ws.LogVerbosity.DEBUG,ID,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){Ur.trace(Ws.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),(t=(e=this.keepaliveTimeoutId).unref)===null||t===void 0||t.call(e));try{this.session.ping((i,r,s)=>{i&&(this.keepaliveTrace("Ping failed with error "+i.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch{this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):!this.keepaliveTimerId&&!this.keepaliveTimeoutId&&(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)===null||t===void 0?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),this.activeCalls.size===0&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),this.activeCalls.size===1&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,i,r,s){let a=e.toHttp2Headers();a[DD]=t,a[ND]=this.userAgent,a[RD]="application/grpc",a[xD]="POST",a[OD]=i,a[kD]="trailers";let o;try{o=this.session.request(a)}catch(u){throw this.handleDisconnect(),u}this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed);let l,c;return this.channelzEnabled?(this.streamTracker.addCallStarted(),l={addMessageSent:()=>{var u;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var m;(m=s.onCallEnd)===null||m===void 0||m.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var m;u?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),(m=s.onStreamEnd)===null||m===void 0||m.call(s,u)}}):l={addMessageSent:()=>{var u;(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var m;(m=s.onCallEnd)===null||m===void 0||m.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var m;(m=s.onStreamEnd)===null||m===void 0||m.call(s,u)}},c=new ED.Http2SubchannelCall(o,l,r,this,(0,wD.getNextCallNumber)()),this.addActiveCall(c),c}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,ph.unregisterChannelzRef)(this.channelzRef)}},yh=class{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){Ur.trace(Ws.LogVerbosity.DEBUG,mh,(0,Vr.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,i,r){return this.isShutdown?Promise.reject():new Promise((s,a)=>{var o,l,c;let u;r.realTarget?(u=(0,Vr.uriToString)(r.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,Vr.uriToString)(r.realTarget))):(u=null,this.trace("creating HTTP/2 session to "+(0,Qo.subchannelAddressToString)(e)));let m=(0,W0.getDefaultAuthority)((o=r.realTarget)!==null&&o!==void 0?o:this.channelTarget),p=t._getConnectionOptions()||{};p.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in i?p.maxSessionMemory=i["grpc-node.max_session_memory"]:p.maxSessionMemory=Number.MAX_SAFE_INTEGER;let T="http://";if("secureContext"in p){if(T="https://",i["grpc.ssl_target_name_override"]){let C=i["grpc.ssl_target_name_override"];p.checkServerIdentity=(O,I)=>(0,j0.checkServerIdentity)(C,I),p.servername=C}else{let C=(c=(l=(0,Vr.splitHostPort)(m))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";p.servername=C}r.socket&&(p.createConnection=(C,O)=>r.socket)}else p.createConnection=(C,O)=>r.socket?r.socket:CD.connect(e);p=Object.assign(Object.assign(Object.assign({},p),e),{enableTrace:i["grpc-node.tls_enable_trace"]===1});let S=vh.connect(T+m,p);this.session=S;let E="Failed to connect";S.unref(),S.once("connect",()=>{S.removeAllListeners(),s(new gh(S,e,i,u)),this.session=null}),S.once("close",()=>{this.session=null,setImmediate(()=>{a(`${E} (${new Date().toISOString()})`)})}),S.once("error",C=>{E=C.message,this.trace("connection failed with error "+E)})})}connect(e,t,i){var r,s;if(this.isShutdown)return Promise.reject();let a=t._getConnectionOptions()||{};if("secureContext"in a){if(a.ALPNProtocols=["h2"],i["grpc.ssl_target_name_override"]){let o=i["grpc.ssl_target_name_override"];a.checkServerIdentity=(l,c)=>(0,j0.checkServerIdentity)(o,c),a.servername=o}else if("grpc.http_connect_target"in i){let o=(0,W0.getDefaultAuthority)((r=(0,Vr.parseUri)(i["grpc.http_connect_target"]))!==null&&r!==void 0?r:{path:"localhost"}),l=(0,Vr.splitHostPort)(o);a.servername=(s=l?.host)!==null&&s!==void 0?s:o}i["grpc-node.tls_enable_trace"]&&(a.enableTrace=!0)}return(0,SD.getProxiedConnection)(e,i,a).then(o=>this.createSession(e,t,i,o))}shutdown(){var e;this.isShutdown=!0,(e=this.session)===null||e===void 0||e.close(),this.session=null}};Yo.Http2SubchannelConnector=yh});var K0=w(zr=>{"use strict";Object.defineProperty(zr,"__esModule",{value:!0});zr.getSubchannelPool=zr.SubchannelPool=void 0;var LD=Og(),FD=B0(),BD=tn(),qD=gt(),VD=H0(),UD=1e4,Hs=class{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let r=this.pool[t].filter(s=>!s.subchannel.unrefIfOneRef());r.length>0&&(e=!1),this.pool[t]=r}e&&this.cleanupTimer!==null&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;this.cleanupTimer===null&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},UD),(t=(e=this.cleanupTimer).unref)===null||t===void 0||t.call(e))}getOrCreateSubchannel(e,t,i,r){this.ensureCleanupTask();let s=(0,qD.uriToString)(e);if(s in this.pool){let o=this.pool[s];for(let l of o)if((0,BD.subchannelAddressEqual)(t,l.subchannelAddress)&&(0,LD.channelOptionsEqual)(i,l.channelArguments)&&r._equals(l.channelCredentials))return l.subchannel}let a=new FD.Subchannel(e,t,i,r,new VD.Http2SubchannelConnector(e));return s in this.pool||(this.pool[s]=[]),this.pool[s].push({subchannelAddress:t,channelArguments:i,channelCredentials:r,subchannel:a}),a.ref(),a}};zr.SubchannelPool=Hs;var zD=new Hs;function GD(n){return n?zD:new Hs}zr.getSubchannelPool=GD});var Th=w(Gr=>{"use strict";Object.defineProperty(Gr,"__esModule",{value:!0});Gr.FilterStackFactory=Gr.FilterStack=void 0;var Jo=class{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let i=0;i<this.filters.length;i++)t=this.filters[i].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let i=this.filters.length-1;i>=0;i--)t=this.filters[i].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let i=0;i<this.filters.length;i++)t=this.filters[i].sendMessage(t);return t}receiveMessage(e){let t=e;for(let i=this.filters.length-1;i>=0;i--)t=this.filters[i].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let i=this.filters.length-1;i>=0;i--)t=this.filters[i].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}};Gr.FilterStack=Jo;var _h=class n{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new n([...this.factories])}createFilter(){return new Jo(this.factories.map(e=>e.createFilter()))}};Gr.FilterStackFactory=_h});var bh=w(Xo=>{"use strict";Object.defineProperty(Xo,"__esModule",{value:!0});Xo.CompressionAlgorithms=void 0;var Q0=function(n){return n[n.identity=0]="identity",n[n.deflate=1]="deflate",n[n.gzip=2]="gzip",n}(Q0||(Xo.CompressionAlgorithms=Q0={}))});var Ch=w(Zo=>{"use strict";Object.defineProperty(Zo,"__esModule",{value:!0});Zo.BaseFilter=void 0;var Sh=class{sendMetadata(e){return R(this,null,function*(){return e})}receiveMetadata(e){return e}sendMessage(e){return R(this,null,function*(){return e})}receiveMessage(e){return R(this,null,function*(){return e})}receiveTrailers(e){return e}};Zo.BaseFilter=Sh});var X0=w(jr=>{"use strict";Object.defineProperty(jr,"__esModule",{value:!0});jr.CompressionFilterFactory=jr.CompressionFilter=void 0;var el=le("zlib"),J0=bh(),tl=oe(),$D=Ch(),jD=Ie(),WD=n=>typeof n=="number"&&typeof J0.CompressionAlgorithms[n]=="string",$r=class{writeMessage(e,t){return R(this,null,function*(){let i=e;t&&(i=yield this.compressMessage(i));let r=Buffer.allocUnsafe(i.length+5);return r.writeUInt8(t?1:0,0),r.writeUInt32BE(i.length,1),i.copy(r,5),r})}readMessage(e){return R(this,null,function*(){let t=e.readUInt8(0)===1,i=e.slice(5);return t&&(i=yield this.decompressMessage(i)),i})}},qi=class extends $r{compressMessage(e){return R(this,null,function*(){return e})}writeMessage(e,t){return R(this,null,function*(){let i=Buffer.allocUnsafe(e.length+5);return i.writeUInt8(0,0),i.writeUInt32BE(e.length,1),e.copy(i,5),i})}decompressMessage(e){return Promise.reject(new Error('Received compressed message but "grpc-encoding" header was identity'))}},Eh=class extends $r{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,i)=>{el.deflate(e,(r,s)=>{r?i(r):t(s)})})}decompressMessage(e){return new Promise((t,i)=>{let r=0,s=[],a=el.createInflate();a.on("data",o=>{s.push(o),r+=o.byteLength,this.maxRecvMessageLength!==-1&&r>this.maxRecvMessageLength&&(a.destroy(),i({code:tl.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),a.on("end",()=>{t(Buffer.concat(s))}),a.write(e),a.end()})}},wh=class extends $r{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,i)=>{el.gzip(e,(r,s)=>{r?i(r):t(s)})})}decompressMessage(e){return new Promise((t,i)=>{let r=0,s=[],a=el.createGunzip();a.on("data",o=>{s.push(o),r+=o.byteLength,this.maxRecvMessageLength!==-1&&r>this.maxRecvMessageLength&&(a.destroy(),i({code:tl.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),a.on("end",()=>{t(Buffer.concat(s))}),a.write(e),a.end()})}},Ih=class extends $r{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(new Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(new Error(`Compression method not supported: ${this.compressionName}`))}};function Y0(n,e){switch(n){case"identity":return new qi;case"deflate":return new Eh(e);case"gzip":return new wh(e);default:return new Ih(n)}}var nl=class extends $D.BaseFilter{constructor(e,t){var i,r;super(),this.sharedFilterConfig=t,this.sendCompression=new qi,this.receiveCompression=new qi,this.currentCompressionAlgorithm="identity";let s=e["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=(i=e["grpc.max_receive_message_length"])!==null&&i!==void 0?i:tl.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,s!==void 0)if(WD(s)){let a=J0.CompressionAlgorithms[s],o=(r=t.serverSupportedEncodingHeader)===null||r===void 0?void 0:r.split(",");(!o||o.includes(a))&&(this.currentCompressionAlgorithm=a,this.sendCompression=Y0(this.currentCompressionAlgorithm,-1))}else jD.log(tl.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${s}`)}sendMetadata(e){return R(this,null,function*(){let t=yield e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),this.currentCompressionAlgorithm==="identity"?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t})}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let r=t[0];typeof r=="string"&&(this.receiveCompression=Y0(r,this.maxReceiveMessageLength))}e.remove("grpc-encoding");let i=e.get("grpc-accept-encoding")[0];return i&&(this.sharedFilterConfig.serverSupportedEncodingHeader=i,i.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new qi,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}sendMessage(e){return R(this,null,function*(){var t;let i=yield e,r;return this.sendCompression instanceof qi?r=!1:r=(((t=i.flags)!==null&&t!==void 0?t:0)&2)===0,{message:yield this.sendCompression.writeMessage(i.message,r),flags:i.flags}})}receiveMessage(e){return R(this,null,function*(){return this.receiveCompression.readMessage(yield e)})}};jr.CompressionFilter=nl;var Ah=class{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new nl(this.options,this.sharedFilterConfig)}};jr.CompressionFilterFactory=Ah});var il=w(hn=>{"use strict";Object.defineProperty(hn,"__esModule",{value:!0});hn.deadlineToString=hn.getRelativeTimeout=hn.getDeadlineTimeoutString=hn.minDeadline=void 0;function HD(...n){let e=1/0;for(let t of n){let i=t instanceof Date?t.getTime():t;i<e&&(e=i)}return e}hn.minDeadline=HD;var KD=[["m",1],["S",1e3],["M",60*1e3],["H",60*60*1e3]];function QD(n){let e=new Date().getTime();n instanceof Date&&(n=n.getTime());let t=Math.max(n-e,0);for(let[i,r]of KD){let s=t/r;if(s<1e8)return String(Math.ceil(s))+i}throw new Error("Deadline is too far in the future")}hn.getDeadlineTimeoutString=QD;var YD=2147483647;function JD(n){let e=n instanceof Date?n.getTime():n,t=new Date().getTime(),i=e-t;return i<0?0:i>YD?1/0:i}hn.getRelativeTimeout=JD;function XD(n){if(n instanceof Date)return n.toISOString();{let e=new Date(n);return Number.isNaN(e.getTime())?""+n:e.toISOString()}}hn.deadlineToString=XD});var sl=w(rl=>{"use strict";Object.defineProperty(rl,"__esModule",{value:!0});rl.restrictControlPlaneStatusCode=void 0;var fn=oe(),ZD=[fn.Status.OK,fn.Status.INVALID_ARGUMENT,fn.Status.NOT_FOUND,fn.Status.ALREADY_EXISTS,fn.Status.FAILED_PRECONDITION,fn.Status.ABORTED,fn.Status.OUT_OF_RANGE,fn.Status.DATA_LOSS];function eR(n,e){return ZD.includes(n)?{code:fn.Status.INTERNAL,details:`Invalid status from control plane: ${n} ${fn.Status[n]} ${e}`}:{code:n,details:e}}rl.restrictControlPlaneStatusCode=eR});var e_=w(ll=>{"use strict";Object.defineProperty(ll,"__esModule",{value:!0});ll.LoadBalancingCall=void 0;var Z0=Et(),al=oe(),tR=il(),ol=dt(),Ks=Xn(),nR=gt(),iR=Ie(),Dh=sl(),rR=le("http2"),sR="load_balancing_call",Rh=class{constructor(e,t,i,r,s,a,o){var l,c;this.channel=e,this.callConfig=t,this.methodName=i,this.host=r,this.credentials=s,this.deadline=a,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let u=this.methodName.split("/"),m="";u.length>=2&&(m=u[1]);let p=(c=(l=(0,nR.splitHostPort)(this.host))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";this.serviceUrl=`https://${p}/${m}`}trace(e){iR.trace(al.LogVerbosity.DEBUG,sR,"["+this.callNumber+"] "+e)}outputStatus(e,t){var i,r;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let s=Object.assign(Object.assign({},e),{progress:t});(i=this.listener)===null||i===void 0||i.onReceiveStatus(s),(r=this.onCallEnded)===null||r===void 0||r.call(this,s.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw new Error("doPick called before start");this.trace("Pick called");let i=this.channel.doPick(this.metadata,this.callConfig.pickInformation),r=i.subchannel?"("+i.subchannel.getChannelzRef().id+") "+i.subchannel.getAddress():""+i.subchannel;switch(this.trace("Pick result: "+Ks.PickResultType[i.pickResultType]+" subchannel: "+r+" status: "+((e=i.status)===null||e===void 0?void 0:e.code)+" "+((t=i.status)===null||t===void 0?void 0:t.details)),i.pickResultType){case Ks.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(o=>{var l,c,u;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let m=this.metadata.clone();if(m.merge(o),m.get("authorization").length>1&&this.outputStatus({code:al.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new ol.Metadata},"PROCESSED"),i.subchannel.getConnectivityState()!==Z0.ConnectivityState.READY){this.trace("Picked subchannel "+r+" has state "+Z0.ConnectivityState[i.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&m.set("grpc-timeout",(0,tR.getDeadlineTimeoutString)(this.deadline));try{this.child=i.subchannel.getRealSubchannel().createCall(m,this.host,this.methodName,{onReceiveMetadata:p=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(p)},onReceiveMessage:p=>{this.trace("Received message"),this.listener.onReceiveMessage(p)},onReceiveStatus:p=>{this.trace("Received status"),p.rstCode===rR.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(p,"REFUSED"):this.outputStatus(p,"PROCESSED")}})}catch(p){this.trace("Failed to start call on picked subchannel "+r+" with error "+p.message),this.outputStatus({code:al.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+p.message,metadata:new ol.Metadata},"NOT_STARTED");return}(c=(l=this.callConfig).onCommitted)===null||c===void 0||c.call(l),(u=i.onCallStarted)===null||u===void 0||u.call(i),this.onCallEnded=i.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},o=>{let{code:l,details:c}=(0,Dh.restrictControlPlaneStatusCode)(typeof o.code=="number"?o.code:al.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${o.message}`);this.outputStatus({code:l,details:c,metadata:new ol.Metadata},"PROCESSED")});break;case Ks.PickResultType.DROP:let{code:s,details:a}=(0,Dh.restrictControlPlaneStatusCode)(i.status.code,i.status.details);setImmediate(()=>{this.outputStatus({code:s,details:a,metadata:i.status.metadata},"DROP")});break;case Ks.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:o,details:l}=(0,Dh.restrictControlPlaneStatusCode)(i.status.code,i.status.details);setImmediate(()=>{this.outputStatus({code:o,details:l,metadata:i.status.metadata},"PROCESSED")})}break;case Ks.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var i;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(i=this.child)===null||i===void 0||i.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new ol.Metadata},"PROCESSED")}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw new Error("Method not implemented.")}getCallNumber(){return this.callNumber}};ll.LoadBalancingCall=Rh});var n_=w(ul=>{"use strict";Object.defineProperty(ul,"__esModule",{value:!0});ul.ResolvingCall=void 0;var Wr=oe(),cl=il(),t_=dt(),aR=Ie(),oR=sl(),lR="resolving_call",xh=class{constructor(e,t,i,r,s,a){this.channel=e,this.method=t,this.filterStackFactory=r,this.credentials=s,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=i.deadline,this.host=i.host,i.parentCall&&(i.flags&Wr.Propagate.CANCELLATION&&i.parentCall.on("cancelled",()=>{this.cancelWithStatus(Wr.Status.CANCELLED,"Cancelled by parent call")}),i.flags&Wr.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+i.parentCall.getDeadline()),this.deadline=(0,cl.minDeadline)(this.deadline,i.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){aR.trace(Wr.LogVerbosity.DEBUG,lR,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,cl.deadlineToString)(this.deadline));let e=(0,cl.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(Wr.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(i=>i(t)),process.nextTick(()=>{var i;(i=this.listener)===null||i===void 0||i.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw new Error("sendMessageonChild called with child not populated");let i=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(r=>{this.writeFilterPending=!1,i.sendMessageWithContext(e,r.message),this.pendingHalfClose&&i.halfClose()},r=>{this.cancelWithStatus(r.code,r.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw new Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if(e.type==="NONE"){this.channel.queueCallForConfig(this);return}else if(e.type==="ERROR"){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}let t=e.config;if(t.status!==Wr.Status.OK){let{code:i,details:r}=(0,oR.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:i,details:r,metadata:new t_.Metadata});return}if(t.methodConfig.timeout){let i=new Date;i.setSeconds(i.getSeconds()+t.methodConfig.timeout.seconds),i.setMilliseconds(i.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,cl.minDeadline)(this.deadline,i),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(i=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(i,{onReceiveMetadata:r=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(r))},onReceiveMessage:r=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(r).then(s=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(s),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},s=>{this.cancelWithStatus(s.code,s.details)})},onReceiveStatus:r=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=r:this.outputStatus(r)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},i=>{this.outputStatus(i)})}reportResolverError(e){var t;!((t=this.metadata)===null||t===void 0)&&t.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var i;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(i=this.child)===null||i===void 0||i.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new t_.Metadata})}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}};ul.ResolvingCall=xh});var i_=w(mi=>{"use strict";Object.defineProperty(mi,"__esModule",{value:!0});mi.RetryingCall=mi.MessageBufferTracker=mi.RetryThrottler=void 0;var dl=oe(),cR=dt(),uR=Ie(),dR="retrying_call",kh=class{constructor(e,t,i){this.maxTokens=e,this.tokenRatio=t,i?this.tokens=i.tokens*(e/i.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}};mi.RetryThrottler=kh;var Nh=class{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var i;let r=(i=this.allocatedPerCall.get(t))!==null&&i!==void 0?i:0;return this.limitPerCall-r<e||this.totalLimit-this.totalAllocated<e?!1:(this.allocatedPerCall.set(t,r+e),this.totalAllocated+=e,!0)}free(e,t){var i;if(this.totalAllocated<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let r=(i=this.allocatedPerCall.get(t))!==null&&i!==void 0?i:0;if(r<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${r}`);this.allocatedPerCall.set(t,r-e)}freeAll(e){var t;let i=(t=this.allocatedPerCall.get(e))!==null&&t!==void 0?t:0;if(this.totalAllocated<i)throw new Error(`Invalid buffer allocation state: call ${e} allocated ${i} > total allocated ${this.totalAllocated}`);this.totalAllocated-=i,this.allocatedPerCall.delete(e)}};mi.MessageBufferTracker=Nh;var Oh="grpc-previous-rpc-attempts",Mh=class{constructor(e,t,i,r,s,a,o,l,c){if(this.channel=e,this.callConfig=t,this.methodName=i,this.host=r,this.credentials=s,this.deadline=a,this.callNumber=o,this.bufferTracker=l,this.retryThrottler=c,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let u=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(u.initialBackoff.substring(0,u.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){uR.trace(dl.LogVerbosity.DEBUG,dR,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;(t=this.listener)===null||t===void 0||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new cR.Metadata});for(let{call:i}of this.underlyingCalls)i.cancelWithStatus(e,t)}getPeer(){return this.committedCallIndex!==null?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return(t=this.writeBuffer[e-this.writeBufferOffset])!==null&&t!==void 0?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if(this.state!=="COMMITTED")return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let i=this.getBufferEntry(t);i.allocated&&this.bufferTracker.free(i.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if(this.state!=="COMMITTED"&&this.underlyingCalls[e].state!=="COMPLETED"){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&this.underlyingCalls[t].state!=="COMPLETED"&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(dl.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if(this.state==="COMMITTED")return;let e=-1,t=-1;for(let[i,r]of this.underlyingCalls.entries())r.state==="ACTIVE"&&r.nextMessageToSend>e&&(e=r.nextMessageToSend,t=i);t===-1?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(i=>i===t||i.toString().toLowerCase()===dl.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=(e=this.callConfig)===null||e===void 0?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let i=Math.random()*this.nextRetryBackoffSec*1e3,r=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,r),i}maybeRetryCall(e,t){if(this.state!=="RETRY"){t(!1);return}let i=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(i.maxAttempts,5)){t(!1);return}let r;if(e===null)r=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else r=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var s,a;if(this.state!=="RETRY"){t(!1);return}(!((a=(s=this.retryThrottler)===null||s===void 0?void 0:s.canRetryCall())!==null&&a!==void 0)||a)&&(t(!0),this.attempts+=1,this.startNewAttempt())},r)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,i){var r,s,a;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList((r=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)!==null&&r!==void 0?r:[],e.code)){(s=this.retryThrottler)===null||s===void 0||s.addCallFailed();let o;if(i===null)o=0;else if(i<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else o=i;setTimeout(()=>{this.maybeStartHedgingAttempt(),this.countActiveCalls()===0&&(this.commitCall(t),this.reportStatus(e))},o)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?((a=this.retryThrottler)===null||a===void 0||a.addCallFailed(),this.maybeRetryCall(i,o=>{o||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e));break}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(t.length===0)return null;try{return parseInt(t[0])}catch{return-1}}handleChildStatus(e,t){var i;if(this.underlyingCalls[t].state==="COMPLETED")return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===dl.Status.OK){(i=this.retryThrottler)===null||i===void 0||i.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if(this.state==="COMMITTED"){this.reportStatus(e);return}let r=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,r):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,r);break}}maybeStartHedgingAttempt(){if(this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,i;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let r=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(r.maxAttempts,5))return;let s=(e=r.hedgingDelay)!==null&&e!==void 0?e:"0s",a=Number(s.substring(0,s.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},a*1e3),(i=(t=this.hedgingTimer).unref)===null||i===void 0||i.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let i=this.attempts-1,r=this.initialMetadata.clone();i>0&&r.set(Oh,`${i}`);let s=!1;e.start(r,{onReceiveMetadata:a=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),s=!0,i>0&&a.set(Oh,`${i}`),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMetadata(a)},onReceiveMessage:a=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMessage(a)},onReceiveStatus:a=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!s&&i>0&&a.metadata.set(Oh,`${i}`),this.handleChildStatus(a,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,i;let r=this.underlyingCalls[e],s=r.nextMessageToSend;(i=(t=this.getBufferEntry(s)).callback)===null||i===void 0||i.call(t),this.clearSentMessages(),r.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if(t.state!=="COMPLETED"&&this.getBufferEntry(t.nextMessageToSend)){let i=this.getBufferEntry(t.nextMessageToSend);switch(i.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:r=>{this.handleChildWriteCompleted(e)}},i.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose();break;case"FREED":break}}}sendMessageWithContext(e,t){var i;this.trace("write() called with message of length "+t.length);let r={message:t,flags:e.flags},s=this.getNextBufferIndex(),a={entryType:"MESSAGE",message:r,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(a),a.allocated){(i=e.callback)===null||i===void 0||i.call(e);for(let[o,l]of this.underlyingCalls.entries())l.state==="ACTIVE"&&l.nextMessageToSend===s&&l.call.sendMessageWithContext({callback:c=>{this.handleChildWriteCompleted(o)}},t)}else{if(this.commitCallWithMostMessages(),this.committedCallIndex===null)return;let o=this.underlyingCalls[this.committedCallIndex];a.callback=e.callback,o.state==="ACTIVE"&&o.nextMessageToSend===s&&o.call.sendMessageWithContext({callback:l=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){this.trace("startRead called"),this.readStarted=!0;for(let e of this.underlyingCalls)e?.state==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1});for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw new Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}};mi.RetryingCall=Mh});var fl=w(hl=>{"use strict";Object.defineProperty(hl,"__esModule",{value:!0});hl.BaseSubchannelWrapper=void 0;var Ph=class{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}};hl.BaseSubchannelWrapper=Ph});var a_=w(gl=>{"use strict";Object.defineProperty(gl,"__esModule",{value:!0});gl.InternalChannel=void 0;var hR=Ja(),fR=xg(),pR=K0(),r_=Xn(),Qs=oe(),mR=Th(),gR=X0(),s_=Zt(),Lh=Ie(),yR=ch(),pl=gt(),pn=Et(),Ys=Bi(),vR=e_(),_R=il(),TR=n_(),Fh=fh(),bR=sl(),Bh=i_(),SR=fl(),CR=2147483647,ER=1e3,wR=30*60*1e3,ml=new Map,IR=1<<24,AR=1<<20,qh=class extends SR.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(i,r,s,a)=>{t.throttleKeepalive(a)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}},Vh=class{constructor(e,t,i){var r,s,a,o,l,c,u,m;if(this.credentials=t,this.options=i,this.connectivityState=pn.ConnectivityState.IDLE,this.currentPicker=new r_.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new Ys.ChannelzCallTracker,this.childrenTracker=new Ys.ChannelzChildrenTracker,typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof hR.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(i&&typeof i!="object")throw new TypeError("Channel options must be an object");this.originalTarget=e;let p=(0,pl.parseUri)(e);if(p===null)throw new Error(`Could not parse target name "${e}"`);let T=(0,s_.mapUriDefaultScheme)(p);if(T===null)throw new Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},CR),(s=(r=this.callRefTimer).unref)===null||s===void 0||s.call(r),this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new Ys.ChannelzTrace,this.channelzRef=(0,Ys.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,s_.getDefaultAuthority)(T);let S=(0,yR.mapProxyName)(T,i);this.target=S.target,this.options=Object.assign({},this.options,S.extraOptions),this.subchannelPool=(0,pR.getSubchannelPool)(((a=i["grpc.use_local_subchannel_pool"])!==null&&a!==void 0?a:0)===0),this.retryBufferTracker=new Bh.MessageBufferTracker((o=i["grpc.retry_buffer_size"])!==null&&o!==void 0?o:IR,(l=i["grpc.per_rpc_retry_buffer_size"])!==null&&l!==void 0?l:AR),this.keepaliveTime=(c=i["grpc.keepalive_time_ms"])!==null&&c!==void 0?c:-1,this.idleTimeoutMs=Math.max((u=i["grpc.client_idle_timeout_ms"])!==null&&u!==void 0?u:wR,ER);let E={createSubchannel:(O,I)=>{let L=this.subchannelPool.getOrCreateSubchannel(this.target,O,Object.assign({},this.options,I),this.credentials);L.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",L.getChannelzRef());let M=new qh(L,this);return this.wrappedSubchannels.add(M),M},updateState:(O,I)=>{this.currentPicker=I;let L=this.pickQueue.slice();this.pickQueue=[],L.length>0&&this.callRefTimerUnref();for(let M of L)M.doPick();this.updateState(O)},requestReresolution:()=>{throw new Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:O=>{this.channelzEnabled&&this.childrenTracker.refChild(O)},removeChannelzChild:O=>{this.channelzEnabled&&this.childrenTracker.unrefChild(O)}};this.resolvingLoadBalancer=new fR.ResolvingLoadBalancer(this.target,E,i,(O,I)=>{O.retryThrottling?ml.set(this.getTarget(),new Bh.RetryThrottler(O.retryThrottling.maxTokens,O.retryThrottling.tokenRatio,ml.get(this.getTarget()))):ml.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=I,this.currentResolutionError=null,process.nextTick(()=>{let L=this.configSelectionQueue;this.configSelectionQueue=[],L.length>0&&this.callRefTimerUnref();for(let M of L)M.getConfig()})},O=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+O.code+' and details "'+O.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),this.configSelector===null&&(this.currentResolutionError=Object.assign(Object.assign({},(0,bR.restrictControlPlaneStatusCode)(O.code,O.details)),{metadata:O.metadata}));let I=this.configSelectionQueue;this.configSelectionQueue=[],I.length>0&&this.callRefTimerUnref();for(let L of I)L.reportResolverError(O)}),this.filterStackFactory=new mR.FilterStackFactory([new gR.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(i,void 0,2));let C=new Error;(0,Lh.trace)(Qs.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+`) Channel constructed 
`+((m=C.stack)===null||m===void 0?void 0:m.substring(C.stack.indexOf(`
`)+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,Lh.trace)(t??Qs.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,pl.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,i,r;!((t=(e=this.callRefTimer).hasRef)===null||t===void 0)&&t.call(e)||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(r=(i=this.callRefTimer).ref)===null||r===void 0||r.call(i))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(t=(e=this.callRefTimer).unref)===null||t===void 0||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(i=>i===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){(0,Lh.trace)(Qs.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,pl.uriToString)(this.target)+" "+pn.ConnectivityState[this.connectivityState]+" -> "+pn.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+pn.ConnectivityState[e]),this.connectivityState=e;let t=this.connectivityStateWatchers.slice();for(let i of t)e!==i.currentState&&(i.timer&&clearTimeout(i.timer),this.removeConnectivityStateWatcher(i),i.callback());e!==pn.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime){this.keepaliveTime=e;for(let t of this.wrappedSubchannels)t.throttleKeepalive(e)}}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return this.resolvingLoadBalancer.exitIdle(),this.configSelector?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(pn.ConnectivityState.IDLE),this.currentPicker=new r_.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,i;this.idleTimer=setTimeout(()=>{if(this.callCount>0){this.startIdleTimeout(this.idleTimeoutMs);return}let s=new Date().valueOf()-this.lastActivityTimestamp.valueOf();s>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-s)},e),(i=(t=this.idleTimer).unref)===null||i===void 0||i.call(t)}maybeStartIdleTimer(){this.connectivityState!==pn.ConnectivityState.SHUTDOWN&&!this.idleTimer&&this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===Qs.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,i,r,s){let a=(0,Fh.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+a+'] method="'+t+'"'),new vR.LoadBalancingCall(this,e,t,i,r,s,a)}createRetryingCall(e,t,i,r,s){let a=(0,Fh.getNextCallNumber)();return this.trace("createRetryingCall ["+a+'] method="'+t+'"'),new Bh.RetryingCall(this,e,t,i,r,s,a,this.retryBufferTracker,ml.get(this.getTarget()))}createInnerCall(e,t,i,r,s){return this.options["grpc.enable_retries"]===0?this.createLoadBalancingCall(e,t,i,r,s):this.createRetryingCall(e,t,i,r,s)}createResolvingCall(e,t,i,r,s){let a=(0,Fh.getNextCallNumber)();this.trace("createResolvingCall ["+a+'] method="'+e+'", deadline='+(0,_R.deadlineToString)(t));let o={deadline:t,flags:s??Qs.Propagate.DEFAULTS,host:i??this.defaultAuthority,parentCall:r},l=new TR.ResolvingCall(this,e,o,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),a);return this.onCallStart(),l.addStatusWatcher(c=>{this.onCallEnd(c)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(pn.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,Ys.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,pl.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,i){if(this.connectivityState===pn.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");let r=null;if(t!==1/0){let a=t instanceof Date?t:new Date(t),o=new Date;if(t===-1/0||a<=o){process.nextTick(i,new Error("Deadline passed without connectivity state change"));return}r=setTimeout(()=>{this.removeConnectivityStateWatcher(s),i(new Error("Deadline passed without connectivity state change"))},a.getTime()-o.getTime())}let s={currentState:e,callback:i,timer:r};this.connectivityStateWatchers.push(s)}getChannelzRef(){return this.channelzRef}createCall(e,t,i,r,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===pn.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");return this.createResolvingCall(e,t,i,r,s)}};gl.InternalChannel=Vh});var $u=w(yl=>{"use strict";Object.defineProperty(yl,"__esModule",{value:!0});yl.ChannelImplementation=void 0;var DR=Ja(),RR=a_(),Uh=class{constructor(e,t,i){if(typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof DR.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(i&&typeof i!="object")throw new TypeError("Channel options must be an object");this.internalChannel=new RR.InternalChannel(e,t,i)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,i){this.internalChannel.watchConnectivityState(e,t,i)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,i,r,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,i,r,s)}};yl.ChannelImplementation=Uh});var m_=w(Nt=>{"use strict";Object.defineProperty(Nt,"__esModule",{value:!0});Nt.Http2ServerCallStream=Nt.ServerDuplexStreamImpl=Nt.ServerWritableStreamImpl=Nt.ServerReadableStreamImpl=Nt.ServerUnaryCallImpl=void 0;var h_=le("events"),Hr=le("http2"),$h=le("stream"),o_=le("zlib"),_e=oe(),jh=dt(),xR=dh(),f_=Ie(),Xs=ja(),p_="server_call";function Js(n){f_.trace(_e.LogVerbosity.DEBUG,p_,n)}var OR="grpc-accept-encoding",kR="grpc-encoding",l_="grpc-message",c_="grpc-status",u_="grpc-timeout",NR=/(\d{1,8})\s*([HMSmun])/,MR={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},PR={[OR]:"identity,deflate,gzip",[kR]:"identity"},d_={[Hr.constants.HTTP2_HEADER_STATUS]:Hr.constants.HTTP_STATUS_OK,[Hr.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},LR={waitForTrailers:!0},zh=class extends h_.EventEmitter{constructor(e,t,i){super(),this.call=e,this.metadata=t,this.request=i,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};Nt.ServerUnaryCallImpl=zh;var vl=class extends $h.Readable{constructor(e,t,i,r){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=i,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,r)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};Nt.ServerReadableStreamImpl=vl;var Zs=class extends $h.Writable{constructor(e,t,i,r){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=i,this.request=r,this.cancelled=!1,this.trailingMetadata=new jh.Metadata,this.call.setupSurfaceCall(this),this.on("error",s=>{this.call.sendError(s),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,i){try{let r=this.call.serializeMessage(e);if(!this.call.write(r)){this.call.once("drain",i);return}}catch(r){this.emit("error",{details:(0,Xs.getErrorMessage)(r),code:_e.Status.INTERNAL})}i()}_final(e){this.call.sendStatus({code:_e.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}};Nt.ServerWritableStreamImpl=Zs;var Kr=class extends $h.Duplex{constructor(e,t,i,r,s){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=i,this.deserialize=r,this.cancelled=!1,this.trailingMetadata=new jh.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,s),this.on("error",a=>{this.call.sendError(a),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}};Nt.ServerDuplexStreamImpl=Kr;Kr.prototype._read=vl.prototype._read;Kr.prototype._write=Zs.prototype._write;Kr.prototype._final=Zs.prototype._final;var Gh=class extends h_.EventEmitter{constructor(e,t,i){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=_e.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=_e.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",r=>{}),this.stream.once("close",()=>{var r;Js("Request to method "+((r=this.handler)===null||r===void 0?void 0:r.path)+" stream closed with rstCode "+this.stream.rstCode),this.statusSent||(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:_e.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in i&&(this.maxSendMessageSize=i["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in i&&(this.maxReceiveMessageSize=i["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){let i=e.subarray(5);if(t==="identity")return i;if(t==="deflate"||t==="gzip"){let r;return t==="deflate"?r=o_.createInflate():r=o_.createGunzip(),new Promise((s,a)=>{let o=0,l=[];r.on("data",c=>{l.push(c),o+=c.byteLength,this.maxReceiveMessageSize!==-1&&o>this.maxReceiveMessageSize&&(r.destroy(),a({code:_e.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),r.on("end",()=>{s(Buffer.concat(l))}),r.write(i),r.end()})}else return Promise.reject({code:_e.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`})}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,i=Object.assign(Object.assign(Object.assign({},d_),PR),t);this.stream.respond(i,LR)}receiveMetadata(e){let t=jh.Metadata.fromHttp2Headers(e);f_.isTracerEnabled(p_)&&Js("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let i=t.get(u_);if(i.length>0){let r=i[0].toString().match(NR);if(r===null){let o=new Error("Invalid deadline");return o.code=_e.Status.OUT_OF_RANGE,this.sendError(o),t}let s=+r[1]*MR[r[2]]|0,a=new Date;this.deadline=a.setMilliseconds(a.getMilliseconds()+s),this.deadlineTimer=setTimeout(FR,s,this),t.remove(u_)}return t.remove(Hr.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(Hr.constants.HTTP2_HEADER_TE),t.remove(Hr.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,i)=>{let{stream:r}=this,s=0,a=this,o=[],l=this.maxReceiveMessageSize;this.stream.on("data",c),this.stream.on("end",u),this.stream.on("error",u);function c(m){if(s+=m.byteLength,l!==-1&&s>l){r.removeListener("data",c),r.removeListener("end",u),r.removeListener("error",u),i({code:_e.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${s} vs. ${l})`});return}o.push(m)}function u(m){if(r.removeListener("data",c),r.removeListener("end",u),r.removeListener("error",u),m!==void 0){i({code:_e.Status.INTERNAL,details:m.message});return}if(s===0){i({code:_e.Status.INTERNAL,details:"received empty unary message"});return}a.emit("receiveMessage");let p=Buffer.concat(o,s),S=p.readUInt8(0)===1?e:"identity",E=a.getDecompressedMessage(p,S);if(Buffer.isBuffer(E)){t(a.deserializeMessageWithInternalError(E));return}E.then(C=>t(a.deserializeMessageWithInternalError(C)),C=>i(C.code?C:{code:_e.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}})}deserializeMessageWithInternalError(e){return R(this,null,function*(){try{return this.deserializeMessage(e)}catch(t){throw{details:(0,Xs.getErrorMessage)(t),code:_e.Status.INTERNAL}}})}serializeMessage(e){let t=this.handler.serialize(e),i=t.byteLength,r=Buffer.allocUnsafe(i+5);return r.writeUInt8(0,0),r.writeUInt32BE(i,1),t.copy(r,5),r}deserializeMessage(e){return this.handler.deserialize(e)}sendUnaryMessage(e,t,i,r){return R(this,null,function*(){if(!this.checkCancelled()){if(i===void 0&&(i=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&i&&(e.metadata=i),this.sendError(e);return}try{let s=this.serializeMessage(t);this.write(s),this.sendStatus({code:_e.Status.OK,details:"OK",metadata:i})}catch(s){this.sendError({details:(0,Xs.getErrorMessage)(s),code:_e.Status.INTERNAL})}}})}sendStatus(e){var t,i;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===_e.Status.OK),!this.checkCancelled())if(Js("Request to method "+((t=this.handler)===null||t===void 0?void 0:t.path)+" ended with status code: "+_e.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var r;let s=Object.assign({[c_]:e.code,[l_]:encodeURI(e.details)},(r=e.metadata)===null||r===void 0?void 0:r.toHttp2Headers());this.stream.sendTrailers(s),this.statusSent=!0}),this.stream.end());else{let r=Object.assign(Object.assign({[c_]:e.code,[l_]:encodeURI(e.details)},d_),(i=e.metadata)===null||i===void 0?void 0:i.toHttp2Headers());this.stream.respond(r,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:_e.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&e.metadata!==void 0?e.metadata:null};"code"in e&&typeof e.code=="number"&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&typeof e.details=="string"&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled()){if(this.maxSendMessageSize!==-1&&e.length>this.maxSendMessageSize){this.sendError({code:_e.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e)}}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let i=new xR.StreamDecoder(this.maxReceiveMessageSize),r=!1,s=!1,a=!1,o=()=>R(this,null,function*(){!a&&r&&!s&&(a=!0,yield this.pushOrBufferMessage(e,null))});this.stream.on("data",l=>R(this,null,function*(){let c;try{c=i.write(l)}catch(u){this.sendError({code:_e.Status.RESOURCE_EXHAUSTED,details:u.message});return}s=!0,this.stream.pause();for(let u of c){this.emit("receiveMessage");let p=u.readUInt8(0)===1?t:"identity",T;try{T=yield this.getDecompressedMessage(u,p)}catch(S){this.sendError(S);return}if(!T)return;yield this.pushOrBufferMessage(e,T)}s=!1,this.stream.resume(),yield o()})),this.stream.once("end",()=>R(this,null,function*(){r=!0,yield o()}))}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),i=e.push(t);if(t===null||i===!1){this.canPush=!1;break}}return this.canPush}pushOrBufferMessage(e,t){return R(this,null,function*(){this.isPushPending?this.bufferedMessages.push(t):yield this.pushMessage(e,t)})}pushMessage(e,t){return R(this,null,function*(){if(t===null){Js("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}Js("Received message of length "+t.length),this.isPushPending=!0;try{let i=yield this.deserializeMessage(t);this.canPush?e.push(i)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(i)}catch(i){this.bufferedMessages.length=0;let r=(0,Xs.getErrorCode)(i);(r===null||r<_e.Status.OK||r>_e.Status.UNAUTHENTICATED)&&(r=_e.Status.INTERNAL),e.emit("error",{details:(0,Xs.getErrorMessage)(i),code:r})}this.isPushPending=!1,this.bufferedMessages.length>0&&(yield this.pushMessage(e,this.bufferedMessages.shift()))})}getPeer(){var e;let t=(e=this.stream.session)===null||e===void 0?void 0:e.socket;return t?.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}};Nt.Http2ServerCallStream=Gh;function FR(n){let e=new Error("Deadline exceeded");e.code=_e.Status.DEADLINE_EXCEEDED,n.sendError(e),n.cancelled=!0,n.emit("cancelled","deadline")}});var Kh=w(_l=>{"use strict";Object.defineProperty(_l,"__esModule",{value:!0});_l.ServerCredentials=void 0;var g_=pu(),ea=class{static createInsecure(){return new Wh}static createSsl(e,t,i=!1){if(e!==null&&!Buffer.isBuffer(e))throw new TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw new TypeError("keyCertPairs must be an array");if(typeof i!="boolean")throw new TypeError("checkClientCertificate must be a boolean");let r=[],s=[];for(let a=0;a<t.length;a++){let o=t[a];if(o===null||typeof o!="object")throw new TypeError(`keyCertPair[${a}] must be an object`);if(!Buffer.isBuffer(o.private_key))throw new TypeError(`keyCertPair[${a}].private_key must be a Buffer`);if(!Buffer.isBuffer(o.cert_chain))throw new TypeError(`keyCertPair[${a}].cert_chain must be a Buffer`);r.push(o.cert_chain),s.push(o.private_key)}return new Hh({ca:e||(0,g_.getDefaultRootsData)()||void 0,cert:r,key:s,requestCert:i,ciphers:g_.CIPHER_SUITES})}};_l.ServerCredentials=ea;var Wh=class extends ea{_isSecure(){return!1}_getSettings(){return null}},Hh=class extends ea{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}});var __=w(Sl=>{"use strict";Object.defineProperty(Sl,"__esModule",{value:!0});Sl.Server=void 0;var gi=le("http2"),Nn=oe(),Vi=m_(),BR=Kh(),y_=Zt(),Tl=Ie(),Gt=tn(),qR=gt(),pt=Bi(),bl=~(1<<31),VR=~(1<<31),UR=2e4,{HTTP2_HEADER_PATH:v_}=gi.constants,zR="server";function GR(){}function Qh(n){return{code:Nn.Status.UNIMPLEMENTED,details:`The server does not implement the method ${n}`}}function $R(n,e){let t=Qh(e);switch(n){case"unary":return(i,r)=>{r(t,null)};case"clientStream":return(i,r)=>{r(t,null)};case"serverStream":return i=>{i.emit("error",t)};case"bidi":return i=>{i.emit("error",t)};default:throw new Error(`Invalid handlerType ${n}`)}}var Yh=class{constructor(e){var t,i,r,s;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new pt.ChannelzTrace,this.callTracker=new pt.ChannelzCallTracker,this.listenerChildrenTracker=new pt.ChannelzChildrenTracker,this.sessionChildrenTracker=new pt.ChannelzChildrenTracker,this.options=e??{},this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,pt.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=(t=this.options["grpc.max_connection_age_ms"])!==null&&t!==void 0?t:bl,this.maxConnectionAgeGraceMs=(i=this.options["grpc.max_connection_age_grace_ms"])!==null&&i!==void 0?i:bl,this.keepaliveTimeMs=(r=this.options["grpc.keepalive_time_ms"])!==null&&r!==void 0?r:VR,this.keepaliveTimeoutMs=(s=this.options["grpc.keepalive_timeout_ms"])!==null&&s!==void 0?s:UR,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,i,r;let s=this.sessions.get(e),a=e.socket,o=a.remoteAddress?(0,Gt.stringToSubchannelAddress)(a.remoteAddress,a.remotePort):null,l=a.localAddress?(0,Gt.stringToSubchannelAddress)(a.localAddress,a.localPort):null,c;if(e.encrypted){let m=a,p=m.getCipher(),T=m.getCertificate(),S=m.getPeerCertificate();c={cipherSuiteStandardName:(t=p.standardName)!==null&&t!==void 0?t:null,cipherSuiteOtherName:p.standardName?null:p.name,localCertificate:T&&"raw"in T?T.raw:null,remoteCertificate:S&&"raw"in S?S.raw:null}}else c=null;return{remoteAddress:o,localAddress:l,security:c,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:(i=e.state.localWindowSize)!==null&&i!==void 0?i:null,remoteFlowControlWindow:(r=e.state.remoteWindowSize)!==null&&r!==void 0?r:null}}}trace(e){Tl.trace(Nn.LogVerbosity.DEBUG,zR,"("+this.channelzRef.id+") "+e)}addProtoService(){throw new Error("Not implemented. Use addService() instead")}addService(e,t){if(e===null||typeof e!="object"||t===null||typeof t!="object")throw new Error("addService() requires two objects as arguments");let i=Object.keys(e);if(i.length===0)throw new Error("Cannot add an empty service to a server");i.forEach(r=>{let s=e[r],a;s.requestStream?s.responseStream?a="bidi":a="clientStream":s.responseStream?a="serverStream":a="unary";let o=t[r],l;if(o===void 0&&typeof s.originalName=="string"&&(o=t[s.originalName]),o!==void 0?l=o.bind(t):l=$R(a,r),this.register(s.path,l,s.responseSerialize,s.requestDeserialize,a)===!1)throw new Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(e===null||typeof e!="object")throw new Error("removeService() requires object as argument");Object.keys(e).forEach(i=>{let r=e[i];this.unregister(r.path)})}bind(e,t){throw new Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,i){if(this.started===!0)throw new Error("server is already started");if(this.shutdown)throw new Error("bindAsync called after shutdown");if(typeof e!="string")throw new TypeError("port must be a string");if(t===null||!(t instanceof BR.ServerCredentials))throw new TypeError("creds must be a ServerCredentials object");if(typeof i!="function")throw new TypeError("callback must be a function");let r=(0,qR.parseUri)(e);if(r===null)throw new Error(`Could not parse port "${e}"`);let s=(0,y_.mapUriDefaultScheme)(r);if(s===null)throw new Error(`Could not get a default scheme for port "${e}"`);let a={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?a.maxSessionMemory=this.options["grpc-node.max_session_memory"]:a.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(a.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let o=(T,S)=>{process.nextTick(()=>i(T,S))},l=()=>{let T;if(t._isSecure()){let S=Object.assign(a,t._getSettings());S.enableTrace=this.options["grpc-node.tls_enable_trace"]===1,T=gi.createSecureServer(S),T.on("secureConnection",E=>{E.on("error",C=>{this.trace("An incoming TLS connection closed with error: "+C.message)})})}else T=gi.createServer(a);return T.setTimeout(0,GR),this._setupHandlers(T),T},c=(T,S,E)=>T.length===0?Promise.resolve({port:S,count:E}):Promise.all(T.map(C=>{this.trace("Attempting to bind "+(0,Gt.subchannelAddressToString)(C));let O;(0,Gt.isTcpSubchannelAddress)(C)?O={host:C.host,port:S}:O=C;let I=l();return new Promise((L,M)=>{let j=G=>{this.trace("Failed to bind "+(0,Gt.subchannelAddressToString)(C)+" with error "+G.message),L(G)};I.once("error",j),I.listen(O,()=>{if(this.shutdown){I.close(),L(new Error("bindAsync failed because server is shutdown"));return}let G=I.address(),_;typeof G=="string"?_={path:G}:_={host:G.address,port:G.port};let g=(0,pt.registerChannelzSocket)((0,Gt.subchannelAddressToString)(_),()=>({localAddress:_,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(g),this.http2ServerList.push({server:I,channelzRef:g}),this.trace("Successfully bound "+(0,Gt.subchannelAddressToString)(_)),L("port"in _?_.port:S),I.removeListener("error",j)})})})).then(C=>{let O=0;for(let I of C)if(typeof I=="number"&&(O+=1,I!==S))throw new Error("Invalid state: multiple port numbers added from single address");return{port:S,count:O+E}}),u=T=>{if(T.length===0)return Promise.resolve({port:0,count:0});let S=T[0],E=l();return new Promise((C,O)=>{let I=L=>{this.trace("Failed to bind "+(0,Gt.subchannelAddressToString)(S)+" with error "+L.message),C(u(T.slice(1)))};E.once("error",I),E.listen(S,()=>{if(this.shutdown){E.close(),C({port:0,count:0});return}let L=E.address(),M={host:L.address,port:L.port},j=(0,pt.registerChannelzSocket)((0,Gt.subchannelAddressToString)(M),()=>({localAddress:M,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(j),this.http2ServerList.push({server:E,channelzRef:j}),this.trace("Successfully bound "+(0,Gt.subchannelAddressToString)(M)),C(c(T.slice(1),L.port,1)),E.removeListener("error",I)})})},m={onSuccessfulResolution:(T,S,E)=>{if(m.onSuccessfulResolution=()=>{},this.shutdown&&o(new Error("bindAsync failed because server is shutdown"),0),T.length===0){o(new Error(`No addresses resolved for port ${e}`),0);return}let C;(0,Gt.isTcpSubchannelAddress)(T[0])?T[0].port===0?C=u(T):C=c(T,T[0].port,0):C=c(T,1,0),C.then(O=>{if(O.count===0){let I=`No address added out of total ${T.length} resolved`;Tl.log(Nn.LogVerbosity.ERROR,I),o(new Error(I),0)}else O.count<T.length&&Tl.log(Nn.LogVerbosity.INFO,`WARNING Only ${O.count} addresses added out of total ${T.length} resolved`),o(null,O.port)},O=>{let I=`No address added out of total ${T.length} resolved`;Tl.log(Nn.LogVerbosity.ERROR,I),o(new Error(I),0)})},onError:T=>{o(new Error(T.details),0)}};(0,y_.createResolver)(s,m,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,pt.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(gi.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,pt.unregisterChannelzRef)(this.channelzRef)}register(e,t,i,r,s){return this.handlers.has(e)?!1:(this.handlers.set(e,{func:t,serialize:i,deserialize:r,type:s,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(this.http2ServerList.length===0||this.http2ServerList.every(({server:e})=>e.listening!==!0))throw new Error("server must be bound in order to start");if(this.started===!0)throw new Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=s=>{this.channelzEnabled&&(0,pt.unregisterChannelzRef)(this.channelzRef),e(s)},i=0;function r(){i--,i===0&&t()}this.started=!1,this.shutdown=!0;for(let{server:s,channelzRef:a}of this.http2ServerList)s.listening&&(i++,s.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(a),(0,pt.unregisterChannelzRef)(a)),r()}));this.sessions.forEach((s,a)=>{a.closed||(i+=1,a.close(r))}),i===0&&t()}addHttp2Port(){throw new Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let i=t[gi.constants.HTTP2_HEADER_CONTENT_TYPE];return typeof i!="string"||!i.startsWith("application/grpc")?(e.respond({[gi.constants.HTTP2_HEADER_STATUS]:gi.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1):!0}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return t===void 0?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,i=null){let r=new Vi.Http2ServerCallStream(t,null,this.options);e.code===void 0&&(e.code=Nn.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),i?.streamTracker.addCallFailed()),r.sendError(e)}_channelzHandler(e,t){let i=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),i?.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),i?.streamTracker.addCallFailed();return}let r=t[v_],s=this._retrieveHandler(r);if(!s){this._respondWithError(Qh(r),e,i);return}let a=new Vi.Http2ServerCallStream(e,s,this.options);a.once("callEnd",o=>{o===Nn.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),i&&(a.once("streamEnd",o=>{o?i.streamTracker.addCallSucceeded():i.streamTracker.addCallFailed()}),a.on("sendMessage",()=>{i.messagesSent+=1,i.lastMessageSentTimestamp=new Date}),a.on("receiveMessage",()=>{i.messagesReceived+=1,i.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(a,s,t)||(this.callTracker.addCallFailed(),i?.streamTracker.addCallFailed(),a.sendError({code:Nn.Status.INTERNAL,details:`Unknown handler type: ${s.type}`}))}_streamHandler(e,t){if(this._verifyContentType(e,t)!==!0)return;let i=t[v_],r=this._retrieveHandler(i);if(!r){this._respondWithError(Qh(i),e,null);return}let s=new Vi.Http2ServerCallStream(e,r,this.options);this._runHandlerForCall(s,r,t)||s.sendError({code:Nn.Status.INTERNAL,details:`Unknown handler type: ${r.type}`})}_runHandlerForCall(e,t,i){var r;let s=e.receiveMetadata(i),a=(r=s.get("grpc-encoding")[0])!==null&&r!==void 0?r:"identity";s.remove("grpc-encoding");let{type:o}=t;if(o==="unary")jR(e,t,s,a);else if(o==="clientStream")WR(e,t,s,a);else if(o==="serverStream")HR(e,t,s,a);else if(o==="bidi")KR(e,t,s,a);else return!1;return!0}_setupHandlers(e){if(e===null)return;let t=e.address(),i="null";t&&(typeof t=="string"?i=t:i=t.address+":"+t.port),this.serverAddressString=i;let r=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",r.bind(this)),e.on("session",s=>{var a,o,l,c,u;if(!this.started){s.destroy();return}let m=(0,pt.registerChannelzSocket)((a=s.socket.remoteAddress)!==null&&a!==void 0?a:"unknown",this.getChannelzSessionInfoGetter(s),this.channelzEnabled),p={ref:m,streamTracker:new pt.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(s,p);let T=s.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+T),this.sessionChildrenTracker.refChild(m));let S=null,E=null,C=!1;if(this.maxConnectionAgeMs!==bl){let I=this.maxConnectionAgeMs/10,L=Math.random()*I*2-I;S=(l=(o=setTimeout(()=>{var M,j;C=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+T);try{s.goaway(gi.constants.NGHTTP2_NO_ERROR,~(1<<31),Buffer.from("max_age"))}catch{s.destroy();return}s.close(),this.maxConnectionAgeGraceMs!==bl&&(E=(j=(M=setTimeout(()=>{s.destroy()},this.maxConnectionAgeGraceMs)).unref)===null||j===void 0?void 0:j.call(M))},this.maxConnectionAgeMs+L)).unref)===null||l===void 0?void 0:l.call(o)}let O=(u=(c=setInterval(()=>{var I,L;let M=(L=(I=setTimeout(()=>{C=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+T),s.close()},this.keepaliveTimeoutMs)).unref)===null||L===void 0?void 0:L.call(I);try{s.ping((j,G,_)=>{clearTimeout(M)})}catch{s.destroy()}},this.keepaliveTimeMs)).unref)===null||u===void 0?void 0:u.call(c);s.on("close",()=>{this.channelzEnabled&&(C||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+T),this.sessionChildrenTracker.unrefChild(m),(0,pt.unregisterChannelzRef)(m)),S&&clearTimeout(S),E&&clearTimeout(E),O&&clearTimeout(O),this.sessions.delete(s)})})}};Sl.Server=Yh;function jR(n,e,t,i){return R(this,null,function*(){try{let r=yield n.receiveUnaryMessage(i);if(r===void 0||n.cancelled)return;let s=new Vi.ServerUnaryCallImpl(n,t,r);e.func(s,(a,o,l,c)=>{n.sendUnaryMessage(a,o,l,c)})}catch(r){n.sendError(r)}})}function WR(n,e,t,i){let r=new Vi.ServerReadableStreamImpl(n,t,e.deserialize,i);function s(a,o,l,c){r.destroy(),n.sendUnaryMessage(a,o,l,c)}n.cancelled||(r.on("error",s),e.func(r,s))}function HR(n,e,t,i){return R(this,null,function*(){try{let r=yield n.receiveUnaryMessage(i);if(r===void 0||n.cancelled)return;let s=new Vi.ServerWritableStreamImpl(n,t,e.serialize,r);e.func(s)}catch(r){n.sendError(r)}})}function KR(n,e,t,i){let r=new Vi.ServerDuplexStreamImpl(n,t,e.serialize,e.deserialize,i);n.cancelled||e.func(r)}});var T_=w(Cl=>{"use strict";Object.defineProperty(Cl,"__esModule",{value:!0});Cl.StatusBuilder=void 0;var Jh=class{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return this.code!==null&&(e.code=this.code),this.details!==null&&(e.details=this.details),this.metadata!==null&&(e.metadata=this.metadata),e}};Cl.StatusBuilder=Jh});var Xh=w(yi=>{"use strict";Object.defineProperty(yi,"__esModule",{value:!0});yi.isDuration=yi.durationToMs=yi.msToDuration=void 0;function QR(n){return{seconds:n/1e3|0,nanos:n%1e3*1e6|0}}yi.msToDuration=QR;function YR(n){return n.seconds*1e3+n.nanos/1e6|0}yi.durationToMs=YR;function JR(n){return typeof n.seconds=="number"&&typeof n.nanos=="number"}yi.isDuration=JR});var of=w(vi=>{"use strict";var Zh;Object.defineProperty(vi,"__esModule",{value:!0});vi.setup=vi.OutlierDetectionLoadBalancer=vi.OutlierDetectionLoadBalancingConfig=void 0;var wl=Et(),S_=oe(),Ui=Xh(),C_=lf(),E_=Kn(),XR=ro(),ZR=Xn(),b_=tn(),ex=fl(),tx=Ie(),nx="outlier_detection";function je(n){tx.trace(S_.LogVerbosity.DEBUG,nx,n)}var af="outlier_detection",ix=((Zh=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)!==null&&Zh!==void 0?Zh:"true")==="true",rx={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},sx={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function Qr(n,e,t,i){if(e in n&&typeof n[e]!==t){let r=i?`${i}.${e}`:e;throw new Error(`outlier detection config ${r} parse error: expected ${t}, got ${typeof n[e]}`)}}function ef(n,e,t){let i=t?`${t}.${e}`:e;if(e in n){if(!(0,Ui.isDuration)(n[e]))throw new Error(`outlier detection config ${i} parse error: expected Duration, got ${typeof n[e]}`);if(!(n[e].seconds>=0&&n[e].seconds<=315576e6&&n[e].nanos>=0&&n[e].nanos<=999999999))throw new Error(`outlier detection config ${i} parse error: values out of range for non-negative Duaration`)}}function El(n,e,t){let i=t?`${t}.${e}`:e;if(Qr(n,e,"number",t),e in n&&!(n[e]>=0&&n[e]<=100))throw new Error(`outlier detection config ${i} parse error: value out of range for percentage (0-100)`)}var ta=class n{constructor(e,t,i,r,s,a,o){if(this.childPolicy=o,o.length>0&&o[0].getLoadBalancerName()==="pick_first")throw new Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=e??1e4,this.baseEjectionTimeMs=t??3e4,this.maxEjectionTimeMs=i??3e5,this.maxEjectionPercent=r??10,this.successRateEjection=s?Object.assign(Object.assign({},rx),s):null,this.failurePercentageEjection=a?Object.assign(Object.assign({},sx),a):null}getLoadBalancerName(){return af}toJsonObject(){return{interval:(0,Ui.msToDuration)(this.intervalMs),base_ejection_time:(0,Ui.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,Ui.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new n(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(ef(e,"interval"),ef(e,"base_ejection_time"),ef(e,"max_ejection_time"),El(e,"max_ejection_percent"),"success_rate_ejection"in e){if(typeof e.success_rate_ejection!="object")throw new Error("outlier detection config success_rate_ejection must be an object");Qr(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),El(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),Qr(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),Qr(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if(typeof e.failure_percentage_ejection!="object")throw new Error("outlier detection config failure_percentage_ejection must be an object");El(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),El(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),Qr(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),Qr(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new n(e.interval?(0,Ui.durationToMs)(e.interval):null,e.base_ejection_time?(0,Ui.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,Ui.durationToMs)(e.max_ejection_time):null,(t=e.max_ejection_percent)!==null&&t!==void 0?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(E_.validateLoadBalancingConfig))}};vi.OutlierDetectionLoadBalancingConfig=ta;var nf=class extends ex.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((i,r,s,a)=>{if(this.childSubchannelState=s,!this.ejected)for(let o of this.stateListeners)o(this,r,s,a)})}getConnectivityState(){return this.ejected?wl.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){this.ejected=!0;for(let e of this.stateListeners)e(this,this.childSubchannelState,wl.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){this.ejected=!1;for(let e of this.stateListeners)e(this,wl.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}};function tf(){return{success:0,failure:0}}var rf=class{constructor(){this.activeBucket=tf(),this.inactiveBucket=tf()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=tf()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}},sf=class{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType===ZR.PickResultType.COMPLETE){let i=t.subchannel,r=i.getMapEntry();if(r){let s=t.onCallEnded;return this.countCalls&&(s=a=>{var o;a===S_.Status.OK?r.counter.addSuccess():r.counter.addFailure(),(o=t.onCallEnded)===null||o===void 0||o.call(t,a)}),Object.assign(Object.assign({},t),{subchannel:i.getWrappedSubchannel(),onCallEnded:s})}else return Object.assign(Object.assign({},t),{subchannel:i.getWrappedSubchannel()})}else return t}},Il=class{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new XR.ChildLoadBalancerHandler((0,C_.createChildChannelControlHelper)(e,{createSubchannel:(t,i)=>{let r=e.createSubchannel(t,i),s=this.addressMap.get((0,b_.subchannelAddressToString)(t)),a=new nf(r,s);return s?.currentEjectionTimestamp!==null&&a.eject(),s?.subchannelWrappers.push(a),a},updateState:(t,i)=>{t===wl.ConnectivityState.READY?e.updateState(t,new sf(i,this.isCountingEnabled())):e.updateState(t,i)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return this.latestConfig!==null&&(this.latestConfig.getSuccessRateEjectionConfig()!==null||this.latestConfig.getFailurePercentageEjectionConfig()!==null)}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())t.currentEjectionTimestamp!==null&&(e+=1);return e*100/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;je("Running success rate check");let i=t.request_volume,r=0,s=[];for(let[m,p]of this.addressMap){let T=p.counter.getLastSuccesses(),S=p.counter.getLastFailures();je("Stats for "+m+": successes="+T+" failures="+S+" targetRequestVolume="+i),T+S>=i&&(r+=1,s.push(T/(T+S)))}if(je("Found "+r+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+s+"]"),r<t.minimum_hosts)return;let a=s.reduce((m,p)=>m+p)/s.length,o=0;for(let m of s){let p=m-a;o+=p*p}let l=o/s.length,c=Math.sqrt(l),u=a-c*(t.stdev_factor/1e3);je("stdev="+c+" ejectionThreshold="+u);for(let[m,p]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let T=p.counter.getLastSuccesses(),S=p.counter.getLastFailures();if(T+S<i)continue;let E=T/(T+S);if(je("Checking candidate "+m+" successRate="+E),E<u){let C=Math.random()*100;je("Candidate "+m+" randomNumber="+C+" enforcement_percentage="+t.enforcement_percentage),C<t.enforcement_percentage&&(je("Ejecting candidate "+m),this.eject(p,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;je("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let i=0;for(let r of this.addressMap.values()){let s=r.counter.getLastSuccesses(),a=r.counter.getLastFailures();s+a>=t.request_volume&&(i+=1)}if(!(i<t.minimum_hosts))for(let[r,s]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let a=s.counter.getLastSuccesses(),o=s.counter.getLastFailures();if(je("Candidate successes="+a+" failures="+o),a+o<t.request_volume)continue;if(o*100/(o+a)>t.threshold){let c=Math.random()*100;je("Candidate "+r+" randomNumber="+c+" enforcement_percentage="+t.enforcement_percentage),c<t.enforcement_percentage&&(je("Ejecting candidate "+r),this.eject(s,e))}}}eject(e,t){e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1;for(let i of e.subchannelWrappers)i.eject()}uneject(e){e.currentEjectionTimestamp=null;for(let t of e.subchannelWrappers)t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,i;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),(i=(t=this.ejectionTimer).unref)===null||i===void 0||i.call(t)}runChecks(){let e=new Date;if(je("Ejection timer running"),this.switchAllBuckets(),!!this.latestConfig){this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e);for(let[t,i]of this.addressMap.entries())if(i.currentEjectionTimestamp===null)i.ejectionTimeMultiplier>0&&(i.ejectionTimeMultiplier-=1);else{let r=this.latestConfig.getBaseEjectionTimeMs(),s=this.latestConfig.getMaxEjectionTimeMs(),a=new Date(i.currentEjectionTimestamp.getTime());a.setMilliseconds(a.getMilliseconds()+Math.min(r*i.ejectionTimeMultiplier,Math.max(r,s))),a<new Date&&(je("Unejecting "+t),this.uneject(i))}}}updateAddressList(e,t,i){if(!(t instanceof ta))return;let r=new Set;for(let a of e)r.add((0,b_.subchannelAddressToString)(a));for(let a of r)this.addressMap.has(a)||(je("Adding map entry for "+a),this.addressMap.set(a,{counter:new rf,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let a of this.addressMap.keys())r.has(a)||(je("Removing map entry for "+a),this.addressMap.delete(a));let s=(0,E_.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,s,i),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){je("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let a=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(a)}else je("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else{je("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer);for(let a of this.addressMap.values())this.uneject(a),a.ejectionTimeMultiplier=0}this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return af}};vi.OutlierDetectionLoadBalancer=Il;function ax(){ix&&(0,C_.registerLoadBalancerType)(af,Il,ta)}vi.setup=ax});var lf=w(H=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0});H.OutlierDetectionLoadBalancingConfig=H.BaseSubchannelWrapper=H.registerAdminService=H.FilterStackFactory=H.BaseFilter=H.PickResultType=H.QueuePicker=H.UnavailablePicker=H.ChildLoadBalancerHandler=H.subchannelAddressToString=H.validateLoadBalancingConfig=H.getFirstUsableConfig=H.registerLoadBalancerType=H.createChildChannelControlHelper=H.BackoffTimeout=H.durationToMs=H.uriToString=H.createResolver=H.registerResolver=H.log=H.trace=void 0;var w_=Ie();Object.defineProperty(H,"trace",{enumerable:!0,get:function(){return w_.trace}});Object.defineProperty(H,"log",{enumerable:!0,get:function(){return w_.log}});var I_=Zt();Object.defineProperty(H,"registerResolver",{enumerable:!0,get:function(){return I_.registerResolver}});Object.defineProperty(H,"createResolver",{enumerable:!0,get:function(){return I_.createResolver}});var ox=gt();Object.defineProperty(H,"uriToString",{enumerable:!0,get:function(){return ox.uriToString}});var lx=Xh();Object.defineProperty(H,"durationToMs",{enumerable:!0,get:function(){return lx.durationToMs}});var cx=Cs();Object.defineProperty(H,"BackoffTimeout",{enumerable:!0,get:function(){return cx.BackoffTimeout}});var Al=Kn();Object.defineProperty(H,"createChildChannelControlHelper",{enumerable:!0,get:function(){return Al.createChildChannelControlHelper}});Object.defineProperty(H,"registerLoadBalancerType",{enumerable:!0,get:function(){return Al.registerLoadBalancerType}});Object.defineProperty(H,"getFirstUsableConfig",{enumerable:!0,get:function(){return Al.getFirstUsableConfig}});Object.defineProperty(H,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return Al.validateLoadBalancingConfig}});var ux=tn();Object.defineProperty(H,"subchannelAddressToString",{enumerable:!0,get:function(){return ux.subchannelAddressToString}});var dx=ro();Object.defineProperty(H,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return dx.ChildLoadBalancerHandler}});var cf=Xn();Object.defineProperty(H,"UnavailablePicker",{enumerable:!0,get:function(){return cf.UnavailablePicker}});Object.defineProperty(H,"QueuePicker",{enumerable:!0,get:function(){return cf.QueuePicker}});Object.defineProperty(H,"PickResultType",{enumerable:!0,get:function(){return cf.PickResultType}});var hx=Ch();Object.defineProperty(H,"BaseFilter",{enumerable:!0,get:function(){return hx.BaseFilter}});var fx=Th();Object.defineProperty(H,"FilterStackFactory",{enumerable:!0,get:function(){return fx.FilterStackFactory}});var px=ao();Object.defineProperty(H,"registerAdminService",{enumerable:!0,get:function(){return px.registerAdminService}});var mx=fl();Object.defineProperty(H,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return mx.BaseSubchannelWrapper}});var gx=of();Object.defineProperty(H,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return gx.OutlierDetectionLoadBalancingConfig}})});var A_=w(Dl=>{"use strict";Object.defineProperty(Dl,"__esModule",{value:!0});Dl.setup=void 0;var yx=Zt(),uf=class{constructor(e,t,i){this.listener=t,this.addresses=[],this.hasReturnedResult=!1;let r;e.authority===""?r="/"+e.path:r=e.path,this.addresses=[{path:r}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}};function vx(){(0,yx.registerResolver)("unix",uf)}Dl.setup=vx});var k_=w(Ol=>{"use strict";Object.defineProperty(Ol,"__esModule",{value:!0});Ol.setup=void 0;var D_=le("net"),Rl=oe(),df=dt(),R_=Zt(),x_=gt(),_x=Ie(),Tx="ip_resolver";function O_(n){_x.trace(Rl.LogVerbosity.DEBUG,Tx,n)}var hf="ipv4",ff="ipv6",bx=443,xl=class{constructor(e,t,i){var r;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,O_("Resolver constructed for target "+(0,x_.uriToString)(e));let s=[];if(!(e.scheme===hf||e.scheme===ff)){this.error={code:Rl.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new df.Metadata};return}let a=e.path.split(",");for(let o of a){let l=(0,x_.splitHostPort)(o);if(l===null){this.error={code:Rl.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${o}`,metadata:new df.Metadata};return}if(e.scheme===hf&&!(0,D_.isIPv4)(l.host)||e.scheme===ff&&!(0,D_.isIPv6)(l.host)){this.error={code:Rl.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${o}`,metadata:new df.Metadata};return}s.push({host:l.host,port:(r=l.port)!==null&&r!==void 0?r:bx})}this.addresses=s,O_("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}};function Sx(){(0,R_.registerResolver)(hf,xl),(0,R_.registerResolver)(ff,xl)}Ol.setup=Sx});var P_=w(mn=>{"use strict";Object.defineProperty(mn,"__esModule",{value:!0});mn.setup=mn.PickFirstLoadBalancer=mn.shuffled=mn.PickFirstLoadBalancingConfig=void 0;var N_=Kn(),et=Et(),kl=Xn(),Cx=Ie(),Ex=oe(),wx="pick_first";function pf(n){Cx.trace(Ex.LogVerbosity.DEBUG,wx,n)}var na="pick_first",Ix=250,ia=class n{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return na}toJsonObject(){return{[na]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&typeof e.shuffleAddressList!="boolean")throw new Error("pick_first config field shuffleAddressList must be a boolean if provided");return new n(e.shuffleAddressList===!0)}};mn.PickFirstLoadBalancingConfig=ia;var mf=class{constructor(e){this.subchannel=e}pick(e){return{pickResultType:kl.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}};function M_(n){let e=n.slice();for(let t=e.length-1;t>1;t--){let i=Math.floor(Math.random()*(t+1)),r=e[t];e[t]=e[i],e[i]=r}return e}mn.shuffled=M_;var Nl=class{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=et.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(t,i,r,s,a)=>{this.onSubchannelStateUpdate(t,i,r,a)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(et.ConnectivityState.READY,new mf(this.currentPick)):this.children.length===0?this.updateState(et.ConnectivityState.IDLE,new kl.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(et.ConnectivityState.TRANSIENT_FAILURE,new kl.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(et.ConnectivityState.CONNECTING,new kl.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){this.stickyTransientFailureMode=!0;for(let{subchannel:e}of this.children)e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(this.currentPick!==null){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,i,r){var s;if(!((s=this.currentPick)===null||s===void 0)&&s.realSubchannelEquals(e)){i!==et.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[a,o]of this.children.entries())if(e.realSubchannelEquals(o.subchannel)){i===et.ConnectivityState.READY&&this.pickSubchannel(o.subchannel),i===et.ConnectivityState.TRANSIENT_FAILURE&&(o.hasReportedTransientFailure=!0,r&&(this.lastError=r),this.maybeEnterStickyTransientFailureMode(),a===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(a+1)),o.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,i]of this.children.entries())if(t>=e){let r=i.subchannel.getConnectivityState();if(r===et.ConnectivityState.IDLE||r===et.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,i;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===et.ConnectivityState.IDLE&&(pf("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var r;(r=this.children[e])===null||r===void 0||r.subchannel.startConnecting()})),this.connectionDelayTimeout=(i=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},Ix)).unref)===null||i===void 0?void 0:i.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(pf("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,this.currentPick!==null&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){pf(et.ConnectivityState[this.currentState]+" -> "+et.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(i=>({subchannel:this.channelControlHelper.createSubchannel(i,{}),hasReportedTransientFailure:!1}));for(let{subchannel:i}of t)i.ref(),this.channelControlHelper.addChannelzChild(i.getChannelzRef());this.resetSubchannelList(),this.children=t;for(let{subchannel:i}of this.children)if(i.addConnectivityStateListener(this.subchannelStateListener),i.getConnectivityState()===et.ConnectivityState.READY){this.pickSubchannel(i);return}for(let i of this.children)i.subchannel.getConnectivityState()===et.ConnectivityState.TRANSIENT_FAILURE&&(i.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof ia&&(t.getShuffleAddressList()&&(e=M_(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===et.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return na}};mn.PickFirstLoadBalancer=Nl;function Ax(){(0,N_.registerLoadBalancerType)(na,Nl,ia),(0,N_.registerDefaultLoadBalancerType)(na)}mn.setup=Ax});var F_=w(Yr=>{"use strict";Object.defineProperty(Yr,"__esModule",{value:!0});Yr.setup=Yr.RoundRobinLoadBalancer=void 0;var Dx=Kn(),tt=Et(),Ml=Xn(),Rx=tn(),xx=Ie(),Ox=oe(),kx="round_robin";function L_(n){xx.trace(Ox.LogVerbosity.DEBUG,kx,n)}var Pl="round_robin",gf=class n{getLoadBalancerName(){return Pl}constructor(){}toJsonObject(){return{[Pl]:{}}}static createFromJson(e){return new n}},yf=class{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:Ml.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}},Ll=class{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=tt.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(t,i,r,s,a)=>{this.calculateAndUpdateState(),(r===tt.ConnectivityState.TRANSIENT_FAILURE||r===tt.ConnectivityState.IDLE)&&(a&&(this.lastError=a),this.channelControlHelper.requestReresolution(),t.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(tt.ConnectivityState.READY)>0){let e=this.subchannels.filter(i=>i.getConnectivityState()===tt.ConnectivityState.READY),t=0;this.currentReadyPicker!==null&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()),t<0&&(t=0)),this.updateState(tt.ConnectivityState.READY,new yf(e,t))}else this.countSubchannelsWithState(tt.ConnectivityState.CONNECTING)>0?this.updateState(tt.ConnectivityState.CONNECTING,new Ml.QueuePicker(this)):this.countSubchannelsWithState(tt.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(tt.ConnectivityState.TRANSIENT_FAILURE,new Ml.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(tt.ConnectivityState.IDLE,new Ml.QueuePicker(this))}updateState(e,t){L_(tt.ConnectivityState[this.currentState]+" -> "+tt.ConnectivityState[e]),e===tt.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){this.resetSubchannelList(),L_("Connect to address list "+e.map(i=>(0,Rx.subchannelAddressToString)(i))),this.subchannels=e.map(i=>this.channelControlHelper.createSubchannel(i,{}));for(let i of this.subchannels){i.ref(),i.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(i.getChannelzRef());let r=i.getConnectivityState();(r===tt.ConnectivityState.IDLE||r===tt.ConnectivityState.TRANSIENT_FAILURE)&&i.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return Pl}};Yr.RoundRobinLoadBalancer=Ll;function Nx(){(0,Dx.registerLoadBalancerType)(Pl,Ll,gf)}Yr.setup=Nx});var U_=w(F=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0});F.experimental=F.addAdminServicesToServer=F.getChannelzHandlers=F.getChannelzServiceDefinition=F.InterceptorConfigurationError=F.InterceptingCall=F.RequesterBuilder=F.ListenerBuilder=F.StatusBuilder=F.getClientChannel=F.ServerCredentials=F.Server=F.setLogVerbosity=F.setLogger=F.load=F.loadObject=F.CallCredentials=F.ChannelCredentials=F.waitForClientReady=F.closeClient=F.Channel=F.makeGenericClientConstructor=F.makeClientConstructor=F.loadPackageDefinition=F.Client=F.compressionAlgorithms=F.propagate=F.connectivityState=F.status=F.logVerbosity=F.Metadata=F.credentials=void 0;var Fl=hu();Object.defineProperty(F,"CallCredentials",{enumerable:!0,get:function(){return Fl.CallCredentials}});var Mx=$u();Object.defineProperty(F,"Channel",{enumerable:!0,get:function(){return Mx.ChannelImplementation}});var Px=bh();Object.defineProperty(F,"compressionAlgorithms",{enumerable:!0,get:function(){return Px.CompressionAlgorithms}});var Lx=Et();Object.defineProperty(F,"connectivityState",{enumerable:!0,get:function(){return Lx.ConnectivityState}});var Bl=Ja();Object.defineProperty(F,"ChannelCredentials",{enumerable:!0,get:function(){return Bl.ChannelCredentials}});var B_=Gu();Object.defineProperty(F,"Client",{enumerable:!0,get:function(){return B_.Client}});var vf=oe();Object.defineProperty(F,"logVerbosity",{enumerable:!0,get:function(){return vf.LogVerbosity}});Object.defineProperty(F,"status",{enumerable:!0,get:function(){return vf.Status}});Object.defineProperty(F,"propagate",{enumerable:!0,get:function(){return vf.Propagate}});var q_=Ie(),_f=Wu();Object.defineProperty(F,"loadPackageDefinition",{enumerable:!0,get:function(){return _f.loadPackageDefinition}});Object.defineProperty(F,"makeClientConstructor",{enumerable:!0,get:function(){return _f.makeClientConstructor}});Object.defineProperty(F,"makeGenericClientConstructor",{enumerable:!0,get:function(){return _f.makeClientConstructor}});var Fx=dt();Object.defineProperty(F,"Metadata",{enumerable:!0,get:function(){return Fx.Metadata}});var Bx=__();Object.defineProperty(F,"Server",{enumerable:!0,get:function(){return Bx.Server}});var qx=Kh();Object.defineProperty(F,"ServerCredentials",{enumerable:!0,get:function(){return qx.ServerCredentials}});var Vx=T_();Object.defineProperty(F,"StatusBuilder",{enumerable:!0,get:function(){return Vx.StatusBuilder}});F.credentials={combineChannelCredentials:(n,...e)=>e.reduce((t,i)=>t.compose(i),n),combineCallCredentials:(n,...e)=>e.reduce((t,i)=>t.compose(i),n),createInsecure:Bl.ChannelCredentials.createInsecure,createSsl:Bl.ChannelCredentials.createSsl,createFromSecureContext:Bl.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:Fl.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:Fl.CallCredentials.createFromGoogleCredential,createEmpty:Fl.CallCredentials.createEmpty};var Ux=n=>n.close();F.closeClient=Ux;var zx=(n,e,t)=>n.waitForReady(e,t);F.waitForClientReady=zx;var Gx=(n,e)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};F.loadObject=Gx;var $x=(n,e,t)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};F.load=$x;var jx=n=>{q_.setLogger(n)};F.setLogger=jx;var Wx=n=>{q_.setLoggerVerbosity(n)};F.setLogVerbosity=Wx;var Hx=n=>B_.Client.prototype.getChannel.call(n);F.getClientChannel=Hx;var ql=Vu();Object.defineProperty(F,"ListenerBuilder",{enumerable:!0,get:function(){return ql.ListenerBuilder}});Object.defineProperty(F,"RequesterBuilder",{enumerable:!0,get:function(){return ql.RequesterBuilder}});Object.defineProperty(F,"InterceptingCall",{enumerable:!0,get:function(){return ql.InterceptingCall}});Object.defineProperty(F,"InterceptorConfigurationError",{enumerable:!0,get:function(){return ql.InterceptorConfigurationError}});var V_=Bi();Object.defineProperty(F,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return V_.getChannelzServiceDefinition}});Object.defineProperty(F,"getChannelzHandlers",{enumerable:!0,get:function(){return V_.getChannelzHandlers}});var Kx=ao();Object.defineProperty(F,"addAdminServicesToServer",{enumerable:!0,get:function(){return Kx.addAdminServicesToServer}});var Qx=lf();F.experimental=Qx;var Yx=lh(),Jx=A_(),Xx=k_(),Zx=P_(),eO=F_(),tO=of(),nO=Bi();Yx.setup(),Jx.setup(),Xx.setup(),Zx.setup(),eO.setup(),tO.setup(),nO.setup()});var dS=["*"];function hS(n,e){n&1&&St(0)}function fS(n,e){if(n&1&&(pe(0,"div",4),ve(1,hS,1,0,"ng-container",5),me()),n&2){let t=he();be("data-pc-section","start"),ae(),X("ngTemplateOutlet",t.startTemplate)}}function pS(n,e){n&1&&St(0)}function mS(n,e){if(n&1&&(pe(0,"div",6),ve(1,pS,1,0,"ng-container",5),me()),n&2){let t=he();be("data-pc-section","center"),ae(),X("ngTemplateOutlet",t.centerTemplate)}}function gS(n,e){n&1&&St(0)}function yS(n,e){if(n&1&&(pe(0,"div",7),ve(1,gS,1,0,"ng-container",5),me()),n&2){let t=he();be("data-pc-section","end"),ae(),X("ngTemplateOutlet",t.endTemplate)}}var B2=(()=>{class n{el;style;styleClass;ariaLabelledBy;templates;startTemplate;endTemplate;centerTemplate;constructor(t){this.el=t}getBlockableElement(){return this.el.nativeElement.children[0]}ngAfterContentInit(){this.templates.forEach(t=>{switch(t.getType()){case"start":case"left":this.startTemplate=t.template;break;case"end":case"right":this.endTemplate=t.template;break;case"center":this.centerTemplate=t.template;break}})}static \u0275fac=function(i){return new(i||n)(Fe(Qt))};static \u0275cmp=at({type:n,selectors:[["p-toolbar"]],contentQueries:function(i,r,s){if(i&1&&Ai(s,Oi,4),i&2){let a;Di(a=Ri())&&(r.templates=a)}},hostAttrs:[1,"p-element"],inputs:{style:"style",styleClass:"styleClass",ariaLabelledBy:"ariaLabelledBy"},ngContentSelectors:dS,decls:5,vars:9,consts:[["role","toolbar",3,"ngClass","ngStyle"],["class","p-toolbar-group-left p-toolbar-group-start",4,"ngIf"],["class","p-toolbar-group-center",4,"ngIf"],["class","p-toolbar-group-right p-toolbar-group-end",4,"ngIf"],[1,"p-toolbar-group-left","p-toolbar-group-start"],[4,"ngTemplateOutlet"],[1,"p-toolbar-group-center"],[1,"p-toolbar-group-right","p-toolbar-group-end"]],template:function(i,r){i&1&&(qn(),pe(0,"div",0),Vn(1),ve(2,fS,2,2,"div",1)(3,mS,2,2,"div",2)(4,yS,2,2,"div",3),me()),i&2&&(Je(r.styleClass),X("ngClass","p-toolbar p-component")("ngStyle",r.style),be("aria-labelledby",r.ariaLabelledBy)("data-pc-name","toolbar"),ae(2),X("ngIf",r.startTemplate),ae(),X("ngIf",r.centerTemplate),ae(),X("ngIf",r.endTemplate))},dependencies:[zn,Gn,Va,$n],styles:[`@layer primeng{.p-toolbar{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap}.p-toolbar-group-start,.p-toolbar-group-center,.p-toolbar-group-end,.p-toolbar-group-left,.p-toolbar-group-right{display:flex;align-items:center}}
`],encapsulation:2,changeDetection:0})}return n})(),Hc=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=ze({type:n});static \u0275inj=Ue({imports:[Me,Be,Be]})}return n})();var vS=["*"];function _S(n,e){if(n&1&&(pe(0,"span",4),xi(1),me()),n&2){let t=he();ae(),ar(t.label)}}function TS(n,e){if(n&1&&Pt(0,"span",6),n&2){let t=he(2);Je(t.icon),X("ngClass","p-avatar-icon")}}function bS(n,e){if(n&1&&ve(0,TS,1,3,"span",5),n&2){let t=he(),i=sr(6);X("ngIf",t.icon)("ngIfElse",i)}}function SS(n,e){if(n&1){let t=Ii();pe(0,"img",8),Sn("error",function(r){Ht(t);let s=he(2);return Kt(s.imageError(r))}),me()}if(n&2){let t=he(2);X("src",t.image,Nc),be("aria-label",t.ariaLabel)}}function CS(n,e){if(n&1&&ve(0,SS,1,2,"img",7),n&2){let t=he();X("ngIf",t.image)}}var K2=(()=>{class n{label;icon;image;size="normal";shape="square";style;styleClass;ariaLabel;ariaLabelledBy;onImageError=new ir;containerClass(){return{"p-avatar p-component":!0,"p-avatar-image":this.image!=null,"p-avatar-circle":this.shape==="circle","p-avatar-lg":this.size==="large","p-avatar-xl":this.size==="xlarge"}}imageError(t){this.onImageError.emit(t)}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=at({type:n,selectors:[["p-avatar"]],hostAttrs:[1,"p-element"],inputs:{label:"label",icon:"icon",image:"image",size:"size",shape:"shape",style:"style",styleClass:"styleClass",ariaLabel:"ariaLabel",ariaLabelledBy:"ariaLabelledBy"},outputs:{onImageError:"onImageError"},ngContentSelectors:vS,decls:7,vars:9,consts:[["iconTemplate",""],["imageTemplate",""],[3,"ngClass","ngStyle"],["class","p-avatar-text",4,"ngIf","ngIfElse"],[1,"p-avatar-text"],[3,"class","ngClass",4,"ngIf","ngIfElse"],[3,"ngClass"],[3,"src","error",4,"ngIf"],[3,"error","src"]],template:function(i,r){if(i&1&&(qn(),pe(0,"div",2),Vn(1),ve(2,_S,2,1,"span",3)(3,bS,1,2,"ng-template",null,0,or)(5,CS,1,1,"ng-template",null,1,or),me()),i&2){let s=sr(4);Je(r.styleClass),X("ngClass",r.containerClass())("ngStyle",r.style),be("aria-labelledby",r.ariaLabelledBy)("aria-label",r.ariaLabel)("data-pc-name","avatar"),ae(2),X("ngIf",r.label)("ngIfElse",s)}},dependencies:[zn,Gn,$n],styles:[`@layer primeng{.p-avatar{display:inline-flex;align-items:center;justify-content:center;width:2rem;height:2rem;font-size:1rem}.p-avatar.p-avatar-image{background-color:transparent}.p-avatar.p-avatar-circle{border-radius:50%;overflow:hidden}.p-avatar .p-avatar-icon{font-size:1rem}.p-avatar img{width:100%;height:100%}}
`],encapsulation:2,changeDetection:0})}return n})(),Kc=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=ze({type:n});static \u0275inj=Ue({imports:[Me]})}return n})();function ES(n,e){if(n&1&&(pe(0,"span",1),xi(1),me()),n&2){let t=he();Je(t.styleClass),X("ngClass",t.containerClass())("ngStyle",t.style),ae(),ar(t.value)}}var aL=(()=>{class n{styleClass;style;badgeSize;severity;value;badgeDisabled=!1;set size(t){this._size=t,console.warn("size property is deprecated and will removed in v18, use badgeSize instead.")}get size(){return this._size}_size;containerClass(){return{"p-badge p-component":!0,"p-badge-no-gutter":this.value!=null&&String(this.value).length===1,"p-badge-lg":this.badgeSize==="large"||this.size==="large","p-badge-xl":this.badgeSize==="xlarge"||this.size==="xlarge",[`p-badge-${this.severity}`]:this.severity}}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=at({type:n,selectors:[["p-badge"]],hostAttrs:[1,"p-element"],inputs:{styleClass:"styleClass",style:"style",badgeSize:"badgeSize",severity:"severity",value:"value",badgeDisabled:[2,"badgeDisabled","badgeDisabled",ut],size:"size"},features:[Bn],decls:1,vars:1,consts:[[3,"ngClass","class","ngStyle",4,"ngIf"],[3,"ngClass","ngStyle"]],template:function(i,r){i&1&&ve(0,ES,2,5,"span",0),i&2&&X("ngIf",!r.badgeDisabled)},dependencies:[zn,Gn,$n],styles:[`@layer primeng{.p-badge{display:inline-block;border-radius:10px;text-align:center;padding:0 .5rem}.p-overlay-badge{position:relative}.p-overlay-badge .p-badge{position:absolute;top:0;right:0;transform:translate(50%,-50%);transform-origin:100% 0;margin:0}.p-badge-dot{width:.5rem;min-width:.5rem;height:.5rem;border-radius:50%;padding:0}.p-badge-no-gutter{padding:0;border-radius:50%}}
`],encapsulation:2,changeDetection:0})}return n})(),Qc=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=ze({type:n});static \u0275inj=Ue({imports:[Me,Be]})}return n})();var IS=["*"],AS=(n,e,t,i,r,s)=>({"p-sidebar":!0,"p-sidebar-active":n,"p-sidebar-left":e,"p-sidebar-right":t,"p-sidebar-top":i,"p-sidebar-bottom":r,"p-sidebar-full":s}),DS=(n,e)=>({transform:n,transition:e}),RS=n=>({value:"visible",params:n});function xS(n,e){n&1&&St(0)}function OS(n,e){if(n&1&&(bs(0),ve(1,xS,1,0,"ng-container",5),Ss()),n&2){let t=he(2);ae(),X("ngTemplateOutlet",t.headlessTemplate)}}function kS(n,e){n&1&&St(0)}function NS(n,e){n&1&&Pt(0,"TimesIcon",13),n&2&&(X("styleClass","p-sidebar-close-icon"),be("data-pc-section","closeicon"))}function MS(n,e){}function PS(n,e){n&1&&ve(0,MS,0,0,"ng-template")}function LS(n,e){if(n&1&&(pe(0,"span",14),ve(1,PS,1,0,null,5),me()),n&2){let t=he(4);be("data-pc-section","closeicon"),ae(),X("ngTemplateOutlet",t.closeIconTemplate)}}function FS(n,e){if(n&1){let t=Ii();pe(0,"button",10),Sn("click",function(r){Ht(t);let s=he(3);return Kt(s.close(r))})("keydown.enter",function(r){Ht(t);let s=he(3);return Kt(s.close(r))}),ve(1,NS,1,2,"TimesIcon",11)(2,LS,2,2,"span",12),me()}if(n&2){let t=he(3);be("aria-label",t.ariaCloseLabel)("data-pc-section","closebutton")("data-pc-group-section","iconcontainer"),ae(),X("ngIf",!t.closeIconTemplate),ae(),X("ngIf",t.closeIconTemplate)}}function BS(n,e){n&1&&St(0)}function qS(n,e){n&1&&St(0)}function VS(n,e){if(n&1&&(bs(0),pe(1,"div",15),ve(2,qS,1,0,"ng-container",5),me(),Ss()),n&2){let t=he(3);ae(),be("data-pc-section","footer"),ae(),X("ngTemplateOutlet",t.footerTemplate)}}function US(n,e){if(n&1&&(pe(0,"div",6),ve(1,kS,1,0,"ng-container",5)(2,FS,3,5,"button",7),me(),pe(3,"div",8),Vn(4),ve(5,BS,1,0,"ng-container",5),me(),ve(6,VS,3,2,"ng-container",9)),n&2){let t=he(2);be("data-pc-section","header"),ae(),X("ngTemplateOutlet",t.headerTemplate),ae(),X("ngIf",t.showCloseIcon),ae(),be("data-pc-section","content"),ae(2),X("ngTemplateOutlet",t.contentTemplate),ae(),X("ngIf",t.footerTemplate)}}function zS(n,e){if(n&1){let t=Ii();pe(0,"div",3,0),Sn("@panelState.start",function(r){Ht(t);let s=he();return Kt(s.onAnimationStart(r))})("@panelState.done",function(r){Ht(t);let s=he();return Kt(s.onAnimationEnd(r))})("keydown",function(r){Ht(t);let s=he();return Kt(s.onKeyDown(r))}),ve(2,OS,2,1,"ng-container",4)(3,US,7,6,"ng-template",null,1,or),me()}if(n&2){let t=sr(4),i=he();Je(i.styleClass),X("ngClass",jm(9,AS,i.visible,i.position==="left"&&!i.fullScreen,i.position==="right"&&!i.fullScreen,i.position==="top"&&!i.fullScreen,i.position==="bottom"&&!i.fullScreen,i.fullScreen))("@panelState",La(19,RS,Fa(16,DS,i.transformOptions,i.transitionOptions)))("ngStyle",i.style),be("data-pc-name","sidebar")("data-pc-section","root"),ae(2),X("ngIf",i.headlessTemplate)("ngIfElse",t)}}var GS=Bc([Lc({transform:"{{transform}}",opacity:0}),Pc("{{transition}}")]),$S=Bc([Pc("{{transition}}",Lc({transform:"{{transform}}",opacity:0}))]),wL=(()=>{class n{document;el;renderer;cd;config;appendTo;blockScroll=!1;style;styleClass;ariaCloseLabel;autoZIndex=!0;baseZIndex=0;modal=!0;dismissible=!0;showCloseIcon=!0;closeOnEscape=!0;transitionOptions="150ms cubic-bezier(0, 0, 0.2, 1)";get visible(){return this._visible}set visible(t){this._visible=t}get position(){return this._position}set position(t){switch(this._position=t,t){case"left":this.transformOptions="translate3d(-100%, 0px, 0px)";break;case"right":this.transformOptions="translate3d(100%, 0px, 0px)";break;case"bottom":this.transformOptions="translate3d(0px, 100%, 0px)";break;case"top":this.transformOptions="translate3d(0px, -100%, 0px)";break}}get fullScreen(){return this._fullScreen}set fullScreen(t){this._fullScreen=t,t&&(this.transformOptions="none")}templates;onShow=new ir;onHide=new ir;visibleChange=new ir;initialized;_visible;_position="left";_fullScreen=!1;container;transformOptions="translate3d(-100%, 0px, 0px)";mask;maskClickListener;documentEscapeListener;animationEndListener;contentTemplate;headerTemplate;footerTemplate;closeIconTemplate;headlessTemplate;constructor(t,i,r,s,a){this.document=t,this.el=i,this.renderer=r,this.cd=s,this.config=a}ngAfterViewInit(){this.initialized=!0}ngAfterContentInit(){this.templates?.forEach(t=>{switch(t.getType()){case"content":this.contentTemplate=t.template;break;case"header":this.headerTemplate=t.template;break;case"footer":this.footerTemplate=t.template;break;case"closeicon":this.closeIconTemplate=t.template;break;case"headless":this.headlessTemplate=t.template;break;default:this.contentTemplate=t.template;break}})}onKeyDown(t){t.code==="Escape"&&this.hide(!1)}show(){this.autoZIndex&&En.set("modal",this.container,this.baseZIndex||this.config.zIndex.modal),this.modal&&this.enableModality(),this.onShow.emit({}),this.visibleChange.emit(!0)}hide(t=!0){t&&this.onHide.emit({}),this.modal&&this.disableModality()}close(t){this.hide(!1),this.visibleChange.emit(!1),t.preventDefault()}enableModality(){let t=this.document.querySelectorAll(".p-sidebar-active"),r=t.length==1?String(parseInt(this.container.style.zIndex)-1):String(parseInt(t[0].style.zIndex)-1);this.mask||(this.mask=this.renderer.createElement("div"),this.renderer.setStyle(this.mask,"zIndex",r),ee.addMultipleClasses(this.mask,"p-component-overlay p-sidebar-mask p-component-overlay p-component-overlay-enter"),this.dismissible&&(this.maskClickListener=this.renderer.listen(this.mask,"click",s=>{this.dismissible&&this.close(s)})),this.renderer.appendChild(this.document.body,this.mask),this.blockScroll&&ee.blockBodyScroll())}disableModality(){this.mask&&(ee.addClass(this.mask,"p-component-overlay-leave"),this.animationEndListener=this.renderer.listen(this.mask,"animationend",this.destroyModal.bind(this)))}destroyModal(){this.unbindMaskClickListener(),this.mask&&this.renderer.removeChild(this.document.body,this.mask),this.blockScroll&&ee.unblockBodyScroll(),this.unbindAnimationEndListener(),this.mask=null}onAnimationStart(t){switch(t.toState){case"visible":this.container=t.element,this.appendContainer(),this.show(),this.closeOnEscape&&this.bindDocumentEscapeListener();break}}onAnimationEnd(t){switch(t.toState){case"void":this.hide(!0),En.clear(this.container),this.unbindGlobalListeners();break}}appendContainer(){this.appendTo&&(this.appendTo==="body"?this.renderer.appendChild(this.document.body,this.container):ee.appendChild(this.container,this.appendTo))}bindDocumentEscapeListener(){let t=this.el?this.el.nativeElement.ownerDocument:this.document;this.documentEscapeListener=this.renderer.listen(t,"keydown",i=>{i.which==27&&parseInt(this.container.style.zIndex)===En.get(this.container)&&this.close(i)})}unbindDocumentEscapeListener(){this.documentEscapeListener&&(this.documentEscapeListener(),this.documentEscapeListener=null)}unbindMaskClickListener(){this.maskClickListener&&(this.maskClickListener(),this.maskClickListener=null)}unbindGlobalListeners(){this.unbindMaskClickListener(),this.unbindDocumentEscapeListener()}unbindAnimationEndListener(){this.animationEndListener&&this.mask&&(this.animationEndListener(),this.animationEndListener=null)}ngOnDestroy(){this.initialized=!1,this.visible&&this.modal&&this.destroyModal(),this.appendTo&&this.container&&this.renderer.appendChild(this.el.nativeElement,this.container),this.container&&this.autoZIndex&&En.clear(this.container),this.container=null,this.unbindGlobalListeners(),this.unbindAnimationEndListener()}static \u0275fac=function(i){return new(i||n)(Fe(qa),Fe(Qt),Fe(rr),Fe(Ba),Fe(Ga))};static \u0275cmp=at({type:n,selectors:[["p-sidebar"]],contentQueries:function(i,r,s){if(i&1&&Ai(s,Oi,4),i&2){let a;Di(a=Ri())&&(r.templates=a)}},hostAttrs:[1,"p-element"],inputs:{appendTo:"appendTo",blockScroll:[2,"blockScroll","blockScroll",ut],style:"style",styleClass:"styleClass",ariaCloseLabel:"ariaCloseLabel",autoZIndex:[2,"autoZIndex","autoZIndex",ut],baseZIndex:[2,"baseZIndex","baseZIndex",Un],modal:[2,"modal","modal",ut],dismissible:[2,"dismissible","dismissible",ut],showCloseIcon:[2,"showCloseIcon","showCloseIcon",ut],closeOnEscape:[2,"closeOnEscape","closeOnEscape",ut],transitionOptions:"transitionOptions",visible:"visible",position:"position",fullScreen:"fullScreen"},outputs:{onShow:"onShow",onHide:"onHide",visibleChange:"visibleChange"},features:[Bn],ngContentSelectors:IS,decls:1,vars:1,consts:[["container",""],["notHeadless",""],["role","complementary",3,"ngClass","ngStyle","class","keydown",4,"ngIf"],["role","complementary",3,"keydown","ngClass","ngStyle"],[4,"ngIf","ngIfElse"],[4,"ngTemplateOutlet"],[1,"p-sidebar-header"],["type","button","class","p-sidebar-close p-sidebar-icon p-link","pRipple","",3,"click","keydown.enter",4,"ngIf"],[1,"p-sidebar-content"],[4,"ngIf"],["type","button","pRipple","",1,"p-sidebar-close","p-sidebar-icon","p-link",3,"click","keydown.enter"],[3,"styleClass",4,"ngIf"],["class","p-sidebar-close-icon",4,"ngIf"],[3,"styleClass"],[1,"p-sidebar-close-icon"],[1,"p-sidebar-footer"]],template:function(i,r){i&1&&(qn(),ve(0,zS,5,21,"div",2)),i&2&&X("ngIf",r.visible)},dependencies:()=>[zn,Gn,Va,$n,lg,jc],styles:[`@layer primeng{.p-sidebar{position:fixed;transition:transform .3s;display:flex;flex-direction:column}.p-sidebar-content{position:relative;overflow-y:auto;flex-grow:1}.p-sidebar-header{display:flex;align-items:center}.p-sidebar-footer{margin-top:auto}.p-sidebar-icon{display:flex;align-items:center;justify-content:center;margin-left:auto}.p-sidebar-left{top:0;left:0;width:20rem;height:100%}.p-sidebar-right{top:0;right:0;width:20rem;height:100%}.p-sidebar-top{top:0;left:0;width:100%;height:10rem}.p-sidebar-bottom{bottom:0;left:0;width:100%;height:10rem}.p-sidebar-full{width:100%;height:100%;top:0;left:0;-webkit-transition:none;transition:none}.p-sidebar-left.p-sidebar-sm,.p-sidebar-right.p-sidebar-sm{width:20rem}.p-sidebar-left.p-sidebar-md,.p-sidebar-right.p-sidebar-md{width:40rem}.p-sidebar-left.p-sidebar-lg,.p-sidebar-right.p-sidebar-lg{width:60rem}.p-sidebar-top.p-sidebar-sm,.p-sidebar-bottom.p-sidebar-sm{height:10rem}.p-sidebar-top.p-sidebar-md,.p-sidebar-bottom.p-sidebar-md{height:20rem}.p-sidebar-top.p-sidebar-lg,.p-sidebar-bottom.p-sidebar-lg{height:30rem}@media screen and (max-width: 64em){.p-sidebar-left.p-sidebar-lg,.p-sidebar-left.p-sidebar-md,.p-sidebar-right.p-sidebar-lg,.p-sidebar-right.p-sidebar-md{width:20rem}}}
`],encapsulation:2,data:{animation:[Wm("panelState",[Fc("void => visible",[qc(GS)]),Fc("visible => void",[qc($S)])])]},changeDetection:0})}return n})(),Yc=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=ze({type:n});static \u0275inj=Ue({imports:[Me,ur,Be,jc,Be]})}return n})();var ug=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=ze({type:n});static \u0275inj=Ue({imports:[Me,Be]})}return n})();var dg=(()=>{class n extends $a{static \u0275fac=(()=>{let t;return function(r){return(t||(t=ka(n)))(r||n)}})();static \u0275cmp=at({type:n,selectors:[["MinusIcon"]],standalone:!0,features:[Ma,Pa],decls:2,vars:5,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M13.2222 7.77778H0.777778C0.571498 7.77778 0.373667 7.69584 0.227806 7.54998C0.0819442 7.40412 0 7.20629 0 7.00001C0 6.79373 0.0819442 6.5959 0.227806 6.45003C0.373667 6.30417 0.571498 6.22223 0.777778 6.22223H13.2222C13.4285 6.22223 13.6263 6.30417 13.7722 6.45003C13.9181 6.5959 14 6.79373 14 7.00001C14 7.20629 13.9181 7.40412 13.7722 7.54998C13.6263 7.69584 13.4285 7.77778 13.2222 7.77778Z","fill","currentColor"]],template:function(i,r){i&1&&(Oa(),pe(0,"svg",0),Pt(1,"path",1),me()),i&2&&(Je(r.getClassNames()),be("aria-label",r.ariaLabel)("aria-hidden",r.ariaHidden)("role",r.role))},dependencies:[Me],encapsulation:2})}return n})();var hg=(()=>{class n extends $a{pathId;ngOnInit(){this.pathId="url(#"+za()+")"}static \u0275fac=(()=>{let t;return function(r){return(t||(t=ka(n)))(r||n)}})();static \u0275cmp=at({type:n,selectors:[["PlusIcon"]],standalone:!0,features:[Ma,Pa],decls:6,vars:7,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M7.67742 6.32258V0.677419C7.67742 0.497757 7.60605 0.325452 7.47901 0.198411C7.35197 0.0713707 7.17966 0 7 0C6.82034 0 6.64803 0.0713707 6.52099 0.198411C6.39395 0.325452 6.32258 0.497757 6.32258 0.677419V6.32258H0.677419C0.497757 6.32258 0.325452 6.39395 0.198411 6.52099C0.0713707 6.64803 0 6.82034 0 7C0 7.17966 0.0713707 7.35197 0.198411 7.47901C0.325452 7.60605 0.497757 7.67742 0.677419 7.67742H6.32258V13.3226C6.32492 13.5015 6.39704 13.6725 6.52358 13.799C6.65012 13.9255 6.82106 13.9977 7 14C7.17966 14 7.35197 13.9286 7.47901 13.8016C7.60605 13.6745 7.67742 13.5022 7.67742 13.3226V7.67742H13.3226C13.5022 7.67742 13.6745 7.60605 13.8016 7.47901C13.9286 7.35197 14 7.17966 14 7C13.9977 6.82106 13.9255 6.65012 13.799 6.52358C13.6725 6.39704 13.5015 6.32492 13.3226 6.32258H7.67742Z","fill","currentColor"],[3,"id"],["width","14","height","14","fill","white"]],template:function(i,r){i&1&&(Oa(),pe(0,"svg",0)(1,"g"),Pt(2,"path",1),me(),pe(3,"defs")(4,"clipPath",2),Pt(5,"rect",3),me()()()),i&2&&(Je(r.getClassNames()),be("aria-label",r.ariaLabel)("aria-hidden",r.ariaHidden)("role",r.role),ae(),be("clip-path",r.pathId),ae(3),X("id",r.pathId))},encapsulation:2})}return n})();var Jc=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=ze({type:n});static \u0275inj=Ue({imports:[Me,Be,ur,hg,dg,Be]})}return n})();var ZL=(()=>{class n{platformId;el;zone;config;renderer;viewContainer;tooltipPosition;tooltipEvent="hover";appendTo;positionStyle;tooltipStyleClass;tooltipZIndex;escape=!0;showDelay;hideDelay;life;positionTop;positionLeft;autoHide=!0;fitContent=!0;hideOnEscape=!0;content;get disabled(){return this._disabled}set disabled(t){this._disabled=t,this.deactivate()}tooltipOptions;_tooltipOptions={tooltipLabel:null,tooltipPosition:"right",tooltipEvent:"hover",appendTo:"body",positionStyle:null,tooltipStyleClass:null,tooltipZIndex:"auto",escape:!0,disabled:null,showDelay:null,hideDelay:null,positionTop:null,positionLeft:null,life:null,autoHide:!0,hideOnEscape:!0,id:za()+"_tooltip"};_disabled;container;styleClass;tooltipText;showTimeout;hideTimeout;active;mouseEnterListener;mouseLeaveListener;containerMouseleaveListener;clickListener;focusListener;blurListener;scrollHandler;resizeListener;interactionInProgress=!1;constructor(t,i,r,s,a,o){this.platformId=t,this.el=i,this.zone=r,this.config=s,this.renderer=a,this.viewContainer=o}ngAfterViewInit(){Mc(this.platformId)&&this.zone.runOutsideAngular(()=>{let t=this.getOption("tooltipEvent");if((t==="hover"||t==="both")&&(this.mouseEnterListener=this.onMouseEnter.bind(this),this.mouseLeaveListener=this.onMouseLeave.bind(this),this.clickListener=this.onInputClick.bind(this),this.el.nativeElement.addEventListener("mouseenter",this.mouseEnterListener),this.el.nativeElement.addEventListener("click",this.clickListener),this.el.nativeElement.addEventListener("mouseleave",this.mouseLeaveListener)),t==="focus"||t==="both"){this.focusListener=this.onFocus.bind(this),this.blurListener=this.onBlur.bind(this);let i=this.el.nativeElement.querySelector(".p-component");i||(i=this.getTarget(this.el.nativeElement)),i.addEventListener("focus",this.focusListener),i.addEventListener("blur",this.blurListener)}})}ngOnChanges(t){t.tooltipPosition&&this.setOption({tooltipPosition:t.tooltipPosition.currentValue}),t.tooltipEvent&&this.setOption({tooltipEvent:t.tooltipEvent.currentValue}),t.appendTo&&this.setOption({appendTo:t.appendTo.currentValue}),t.positionStyle&&this.setOption({positionStyle:t.positionStyle.currentValue}),t.tooltipStyleClass&&this.setOption({tooltipStyleClass:t.tooltipStyleClass.currentValue}),t.tooltipZIndex&&this.setOption({tooltipZIndex:t.tooltipZIndex.currentValue}),t.escape&&this.setOption({escape:t.escape.currentValue}),t.showDelay&&this.setOption({showDelay:t.showDelay.currentValue}),t.hideDelay&&this.setOption({hideDelay:t.hideDelay.currentValue}),t.life&&this.setOption({life:t.life.currentValue}),t.positionTop&&this.setOption({positionTop:t.positionTop.currentValue}),t.positionLeft&&this.setOption({positionLeft:t.positionLeft.currentValue}),t.disabled&&this.setOption({disabled:t.disabled.currentValue}),t.content&&(this.setOption({tooltipLabel:t.content.currentValue}),this.active&&(t.content.currentValue?this.container&&this.container.offsetParent?(this.updateText(),this.align()):this.show():this.hide())),t.autoHide&&this.setOption({autoHide:t.autoHide.currentValue}),t.id&&this.setOption({id:t.id.currentValue}),t.tooltipOptions&&(this._tooltipOptions=_s(_s({},this._tooltipOptions),t.tooltipOptions.currentValue),this.deactivate(),this.active&&(this.getOption("tooltipLabel")?this.container&&this.container.offsetParent?(this.updateText(),this.align()):this.show():this.hide()))}isAutoHide(){return this.getOption("autoHide")}onMouseEnter(t){!this.container&&!this.showTimeout&&this.activate()}onMouseLeave(t){this.isAutoHide()?this.deactivate():!(ee.hasClass(t.relatedTarget,"p-tooltip")||ee.hasClass(t.relatedTarget,"p-tooltip-text")||ee.hasClass(t.relatedTarget,"p-tooltip-arrow"))&&this.deactivate()}onFocus(t){this.activate()}onBlur(t){this.deactivate()}onInputClick(t){this.deactivate()}onPressEscape(){this.hideOnEscape&&this.deactivate()}activate(){if(!this.interactionInProgress&&(this.active=!0,this.clearHideTimeout(),this.getOption("showDelay")?this.showTimeout=setTimeout(()=>{this.show()},this.getOption("showDelay")):this.show(),this.getOption("life"))){let t=this.getOption("showDelay")?this.getOption("life")+this.getOption("showDelay"):this.getOption("life");this.hideTimeout=setTimeout(()=>{this.hide()},t)}this.interactionInProgress=!0}deactivate(){this.interactionInProgress=!1,this.active=!1,this.clearShowTimeout(),this.getOption("hideDelay")?(this.clearHideTimeout(),this.hideTimeout=setTimeout(()=>{this.hide()},this.getOption("hideDelay"))):this.hide()}create(){this.container&&(this.clearHideTimeout(),this.remove()),this.container=document.createElement("div"),this.container.setAttribute("id",this.getOption("id")),this.container.setAttribute("role","tooltip");let t=document.createElement("div");t.className="p-tooltip-arrow",this.container.appendChild(t),this.tooltipText=document.createElement("div"),this.tooltipText.className="p-tooltip-text",this.updateText(),this.getOption("positionStyle")&&(this.container.style.position=this.getOption("positionStyle")),this.container.appendChild(this.tooltipText),this.getOption("appendTo")==="body"?document.body.appendChild(this.container):this.getOption("appendTo")==="target"?ee.appendChild(this.container,this.el.nativeElement):ee.appendChild(this.container,this.getOption("appendTo")),this.container.style.display="inline-block",this.fitContent&&(this.container.style.width="fit-content"),this.isAutoHide()?this.container.style.pointerEvents="none":(this.container.style.pointerEvents="unset",this.bindContainerMouseleaveListener())}bindContainerMouseleaveListener(){if(!this.containerMouseleaveListener){let t=this.container??this.container.nativeElement;this.containerMouseleaveListener=this.renderer.listen(t,"mouseleave",i=>{this.deactivate()})}}unbindContainerMouseleaveListener(){this.containerMouseleaveListener&&(this.bindContainerMouseleaveListener(),this.containerMouseleaveListener=null)}show(){if(!this.getOption("tooltipLabel")||this.getOption("disabled"))return;this.create(),this.el.nativeElement.closest("p-dialog")?setTimeout(()=>{this.container&&this.align()},100):this.align(),ee.fadeIn(this.container,250),this.getOption("tooltipZIndex")==="auto"?En.set("tooltip",this.container,this.config.zIndex.tooltip):this.container.style.zIndex=this.getOption("tooltipZIndex"),this.bindDocumentResizeListener(),this.bindScrollListener()}hide(){this.getOption("tooltipZIndex")==="auto"&&En.clear(this.container),this.remove()}updateText(){let t=this.getOption("tooltipLabel");if(t instanceof Gm){let i=this.viewContainer.createEmbeddedView(t);i.detectChanges(),i.rootNodes.forEach(r=>this.tooltipText.appendChild(r))}else this.getOption("escape")?(this.tooltipText.innerHTML="",this.tooltipText.appendChild(document.createTextNode(t))):this.tooltipText.innerHTML=t}align(){switch(this.getOption("tooltipPosition")){case"top":this.alignTop(),this.isOutOfBounds()&&(this.alignBottom(),this.isOutOfBounds()&&(this.alignRight(),this.isOutOfBounds()&&this.alignLeft()));break;case"bottom":this.alignBottom(),this.isOutOfBounds()&&(this.alignTop(),this.isOutOfBounds()&&(this.alignRight(),this.isOutOfBounds()&&this.alignLeft()));break;case"left":this.alignLeft(),this.isOutOfBounds()&&(this.alignRight(),this.isOutOfBounds()&&(this.alignTop(),this.isOutOfBounds()&&this.alignBottom()));break;case"right":this.alignRight(),this.isOutOfBounds()&&(this.alignLeft(),this.isOutOfBounds()&&(this.alignTop(),this.isOutOfBounds()&&this.alignBottom()));break}}getHostOffset(){if(this.getOption("appendTo")==="body"||this.getOption("appendTo")==="target"){let t=this.el.nativeElement.getBoundingClientRect(),i=t.left+ee.getWindowScrollLeft(),r=t.top+ee.getWindowScrollTop();return{left:i,top:r}}else return{left:0,top:0}}alignRight(){this.preAlign("right");let t=this.activeElement,i=this.getHostOffset(),r=i.left+ee.getOuterWidth(t),s=i.top+(ee.getOuterHeight(t)-ee.getOuterHeight(this.container))/2;this.container.style.left=r+this.getOption("positionLeft")+"px",this.container.style.top=s+this.getOption("positionTop")+"px"}get activeElement(){return this.el.nativeElement.nodeName.includes("P-")?ee.findSingle(this.el.nativeElement,".p-component")||this.el.nativeElement:this.el.nativeElement}alignLeft(){this.preAlign("left");let t=this.getHostOffset(),i=t.left-ee.getOuterWidth(this.container),r=t.top+(ee.getOuterHeight(this.el.nativeElement)-ee.getOuterHeight(this.container))/2;this.container.style.left=i+this.getOption("positionLeft")+"px",this.container.style.top=r+this.getOption("positionTop")+"px"}alignTop(){this.preAlign("top");let t=this.getHostOffset(),i=t.left+(ee.getOuterWidth(this.el.nativeElement)-ee.getOuterWidth(this.container))/2,r=t.top-ee.getOuterHeight(this.container);this.container.style.left=i+this.getOption("positionLeft")+"px",this.container.style.top=r+this.getOption("positionTop")+"px"}alignBottom(){this.preAlign("bottom");let t=this.getHostOffset(),i=t.left+(ee.getOuterWidth(this.el.nativeElement)-ee.getOuterWidth(this.container))/2,r=t.top+ee.getOuterHeight(this.el.nativeElement);this.container.style.left=i+this.getOption("positionLeft")+"px",this.container.style.top=r+this.getOption("positionTop")+"px"}setOption(t){this._tooltipOptions=_s(_s({},this._tooltipOptions),t)}getOption(t){return this._tooltipOptions[t]}getTarget(t){return ee.hasClass(t,"p-inputwrapper")?ee.findSingle(t,"input"):t}preAlign(t){this.container.style.left="-999px",this.container.style.top="-999px";let i="p-tooltip p-component p-tooltip-"+t;this.container.className=this.getOption("tooltipStyleClass")?i+" "+this.getOption("tooltipStyleClass"):i}isOutOfBounds(){let t=this.container.getBoundingClientRect(),i=t.top,r=t.left,s=ee.getOuterWidth(this.container),a=ee.getOuterHeight(this.container),o=ee.getViewport();return r+s>o.width||r<0||i<0||i+a>o.height}onWindowResize(t){this.hide()}bindDocumentResizeListener(){this.zone.runOutsideAngular(()=>{this.resizeListener=this.onWindowResize.bind(this),window.addEventListener("resize",this.resizeListener)})}unbindDocumentResizeListener(){this.resizeListener&&(window.removeEventListener("resize",this.resizeListener),this.resizeListener=null)}bindScrollListener(){this.scrollHandler||(this.scrollHandler=new og(this.el.nativeElement,()=>{this.container&&this.hide()})),this.scrollHandler.bindScrollListener()}unbindScrollListener(){this.scrollHandler&&this.scrollHandler.unbindScrollListener()}unbindEvents(){let t=this.getOption("tooltipEvent");if((t==="hover"||t==="both")&&(this.el.nativeElement.removeEventListener("mouseenter",this.mouseEnterListener),this.el.nativeElement.removeEventListener("mouseleave",this.mouseLeaveListener),this.el.nativeElement.removeEventListener("click",this.clickListener)),t==="focus"||t==="both"){let i=this.el.nativeElement.querySelector(".p-component");i||(i=this.getTarget(this.el.nativeElement))}this.unbindDocumentResizeListener()}remove(){this.container&&this.container.parentElement&&(this.getOption("appendTo")==="body"?document.body.removeChild(this.container):this.getOption("appendTo")==="target"?this.el.nativeElement.removeChild(this.container):ee.removeChild(this.container,this.getOption("appendTo"))),this.unbindDocumentResizeListener(),this.unbindScrollListener(),this.unbindContainerMouseleaveListener(),this.clearTimeouts(),this.container=null,this.scrollHandler=null}clearShowTimeout(){this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=null)}clearHideTimeout(){this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null)}clearTimeouts(){this.clearShowTimeout(),this.clearHideTimeout()}ngOnDestroy(){this.unbindEvents(),this.container&&En.clear(this.container),this.remove(),this.scrollHandler&&(this.scrollHandler.destroy(),this.scrollHandler=null)}static \u0275fac=function(i){return new(i||n)(Fe(Um),Fe(Qt),Fe(Na),Fe(Ga),Fe(rr),Fe($m))};static \u0275dir=Oc({type:n,selectors:[["","pTooltip",""]],hostAttrs:[1,"p-element"],hostBindings:function(i,r){i&1&&Sn("keydown.escape",function(a){return r.onPressEscape(a)},!1,zm)},inputs:{tooltipPosition:"tooltipPosition",tooltipEvent:"tooltipEvent",appendTo:"appendTo",positionStyle:"positionStyle",tooltipStyleClass:"tooltipStyleClass",tooltipZIndex:"tooltipZIndex",escape:[2,"escape","escape",ut],showDelay:[2,"showDelay","showDelay",Un],hideDelay:[2,"hideDelay","hideDelay",Un],life:[2,"life","life",Un],positionTop:[2,"positionTop","positionTop",Un],positionLeft:[2,"positionLeft","positionLeft",Un],autoHide:[2,"autoHide","autoHide",ut],fitContent:[2,"fitContent","fitContent",ut],hideOnEscape:[2,"hideOnEscape","hideOnEscape",ut],content:[0,"pTooltip","content"],disabled:[0,"tooltipDisabled","disabled"],tooltipOptions:"tooltipOptions"},features:[Bn,kc]})}return n})(),Xc=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=ze({type:n});static \u0275inj=Ue({imports:[Me]})}return n})();var Zc=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=ze({type:n});static \u0275inj=Ue({imports:[Me,lr,ur,Xc,Be,lr,Xc,Be]})}return n})();var fg=class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=ze({type:n});static \u0275inj=Ue({imports:[Me,lr,Yc,cg,Hc,$c,ug,Jc,Kc,Qc,Zc,Be,rg,Yc,Hc,$c,lr,Jc,Kc,Qc,Zc,Be]})};var oB=xc(uS(),1);import{inspect as iO,TextEncoder as rO,TextDecoder as Rq}from"util";import{randomBytes as sO}from"crypto";var pg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},mg={};var jn,eu;(function(){var n;function e(_,g){function y(){}y.prototype=g.prototype,_.D=g.prototype,_.prototype=new y,_.prototype.constructor=_,_.C=function(v,h,b){for(var d=Array(arguments.length-2),f=2;f<arguments.length;f++)d[f-2]=arguments[f];return g.prototype[h].apply(v,d)}}function t(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(i,t),i.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(_,g,y){y||(y=0);var v=Array(16);if(typeof g=="string")for(var h=0;16>h;++h)v[h]=g.charCodeAt(y++)|g.charCodeAt(y++)<<8|g.charCodeAt(y++)<<16|g.charCodeAt(y++)<<24;else for(h=0;16>h;++h)v[h]=g[y++]|g[y++]<<8|g[y++]<<16|g[y++]<<24;g=_.g[0],y=_.g[1],h=_.g[2];var b=_.g[3],d=g+(b^y&(h^b))+v[0]+3614090360&4294967295;g=y+(d<<7&4294967295|d>>>25),d=b+(h^g&(y^h))+v[1]+3905402710&4294967295,b=g+(d<<12&4294967295|d>>>20),d=h+(y^b&(g^y))+v[2]+606105819&4294967295,h=b+(d<<17&4294967295|d>>>15),d=y+(g^h&(b^g))+v[3]+3250441966&4294967295,y=h+(d<<22&4294967295|d>>>10),d=g+(b^y&(h^b))+v[4]+4118548399&4294967295,g=y+(d<<7&4294967295|d>>>25),d=b+(h^g&(y^h))+v[5]+1200080426&4294967295,b=g+(d<<12&4294967295|d>>>20),d=h+(y^b&(g^y))+v[6]+2821735955&4294967295,h=b+(d<<17&4294967295|d>>>15),d=y+(g^h&(b^g))+v[7]+4249261313&4294967295,y=h+(d<<22&4294967295|d>>>10),d=g+(b^y&(h^b))+v[8]+1770035416&4294967295,g=y+(d<<7&4294967295|d>>>25),d=b+(h^g&(y^h))+v[9]+2336552879&4294967295,b=g+(d<<12&4294967295|d>>>20),d=h+(y^b&(g^y))+v[10]+4294925233&4294967295,h=b+(d<<17&4294967295|d>>>15),d=y+(g^h&(b^g))+v[11]+2304563134&4294967295,y=h+(d<<22&4294967295|d>>>10),d=g+(b^y&(h^b))+v[12]+1804603682&4294967295,g=y+(d<<7&4294967295|d>>>25),d=b+(h^g&(y^h))+v[13]+4254626195&4294967295,b=g+(d<<12&4294967295|d>>>20),d=h+(y^b&(g^y))+v[14]+2792965006&4294967295,h=b+(d<<17&4294967295|d>>>15),d=y+(g^h&(b^g))+v[15]+1236535329&4294967295,y=h+(d<<22&4294967295|d>>>10),d=g+(h^b&(y^h))+v[1]+4129170786&4294967295,g=y+(d<<5&4294967295|d>>>27),d=b+(y^h&(g^y))+v[6]+3225465664&4294967295,b=g+(d<<9&4294967295|d>>>23),d=h+(g^y&(b^g))+v[11]+643717713&4294967295,h=b+(d<<14&4294967295|d>>>18),d=y+(b^g&(h^b))+v[0]+3921069994&4294967295,y=h+(d<<20&4294967295|d>>>12),d=g+(h^b&(y^h))+v[5]+3593408605&4294967295,g=y+(d<<5&4294967295|d>>>27),d=b+(y^h&(g^y))+v[10]+38016083&4294967295,b=g+(d<<9&4294967295|d>>>23),d=h+(g^y&(b^g))+v[15]+3634488961&4294967295,h=b+(d<<14&4294967295|d>>>18),d=y+(b^g&(h^b))+v[4]+3889429448&4294967295,y=h+(d<<20&4294967295|d>>>12),d=g+(h^b&(y^h))+v[9]+568446438&4294967295,g=y+(d<<5&4294967295|d>>>27),d=b+(y^h&(g^y))+v[14]+3275163606&4294967295,b=g+(d<<9&4294967295|d>>>23),d=h+(g^y&(b^g))+v[3]+4107603335&4294967295,h=b+(d<<14&4294967295|d>>>18),d=y+(b^g&(h^b))+v[8]+1163531501&4294967295,y=h+(d<<20&4294967295|d>>>12),d=g+(h^b&(y^h))+v[13]+2850285829&4294967295,g=y+(d<<5&4294967295|d>>>27),d=b+(y^h&(g^y))+v[2]+4243563512&4294967295,b=g+(d<<9&4294967295|d>>>23),d=h+(g^y&(b^g))+v[7]+1735328473&4294967295,h=b+(d<<14&4294967295|d>>>18),d=y+(b^g&(h^b))+v[12]+2368359562&4294967295,y=h+(d<<20&4294967295|d>>>12),d=g+(y^h^b)+v[5]+4294588738&4294967295,g=y+(d<<4&4294967295|d>>>28),d=b+(g^y^h)+v[8]+2272392833&4294967295,b=g+(d<<11&4294967295|d>>>21),d=h+(b^g^y)+v[11]+1839030562&4294967295,h=b+(d<<16&4294967295|d>>>16),d=y+(h^b^g)+v[14]+4259657740&4294967295,y=h+(d<<23&4294967295|d>>>9),d=g+(y^h^b)+v[1]+2763975236&4294967295,g=y+(d<<4&4294967295|d>>>28),d=b+(g^y^h)+v[4]+1272893353&4294967295,b=g+(d<<11&4294967295|d>>>21),d=h+(b^g^y)+v[7]+4139469664&4294967295,h=b+(d<<16&4294967295|d>>>16),d=y+(h^b^g)+v[10]+3200236656&4294967295,y=h+(d<<23&4294967295|d>>>9),d=g+(y^h^b)+v[13]+681279174&4294967295,g=y+(d<<4&4294967295|d>>>28),d=b+(g^y^h)+v[0]+3936430074&4294967295,b=g+(d<<11&4294967295|d>>>21),d=h+(b^g^y)+v[3]+3572445317&4294967295,h=b+(d<<16&4294967295|d>>>16),d=y+(h^b^g)+v[6]+76029189&4294967295,y=h+(d<<23&4294967295|d>>>9),d=g+(y^h^b)+v[9]+3654602809&4294967295,g=y+(d<<4&4294967295|d>>>28),d=b+(g^y^h)+v[12]+3873151461&4294967295,b=g+(d<<11&4294967295|d>>>21),d=h+(b^g^y)+v[15]+530742520&4294967295,h=b+(d<<16&4294967295|d>>>16),d=y+(h^b^g)+v[2]+3299628645&4294967295,y=h+(d<<23&4294967295|d>>>9),d=g+(h^(y|~b))+v[0]+4096336452&4294967295,g=y+(d<<6&4294967295|d>>>26),d=b+(y^(g|~h))+v[7]+1126891415&4294967295,b=g+(d<<10&4294967295|d>>>22),d=h+(g^(b|~y))+v[14]+2878612391&4294967295,h=b+(d<<15&4294967295|d>>>17),d=y+(b^(h|~g))+v[5]+4237533241&4294967295,y=h+(d<<21&4294967295|d>>>11),d=g+(h^(y|~b))+v[12]+1700485571&4294967295,g=y+(d<<6&4294967295|d>>>26),d=b+(y^(g|~h))+v[3]+2399980690&4294967295,b=g+(d<<10&4294967295|d>>>22),d=h+(g^(b|~y))+v[10]+4293915773&4294967295,h=b+(d<<15&4294967295|d>>>17),d=y+(b^(h|~g))+v[1]+2240044497&4294967295,y=h+(d<<21&4294967295|d>>>11),d=g+(h^(y|~b))+v[8]+1873313359&4294967295,g=y+(d<<6&4294967295|d>>>26),d=b+(y^(g|~h))+v[15]+4264355552&4294967295,b=g+(d<<10&4294967295|d>>>22),d=h+(g^(b|~y))+v[6]+2734768916&4294967295,h=b+(d<<15&4294967295|d>>>17),d=y+(b^(h|~g))+v[13]+1309151649&4294967295,y=h+(d<<21&4294967295|d>>>11),d=g+(h^(y|~b))+v[4]+4149444226&4294967295,g=y+(d<<6&4294967295|d>>>26),d=b+(y^(g|~h))+v[11]+3174756917&4294967295,b=g+(d<<10&4294967295|d>>>22),d=h+(g^(b|~y))+v[2]+718787259&4294967295,h=b+(d<<15&4294967295|d>>>17),d=y+(b^(h|~g))+v[9]+3951481745&4294967295,_.g[0]=_.g[0]+g&4294967295,_.g[1]=_.g[1]+(h+(d<<21&4294967295|d>>>11))&4294967295,_.g[2]=_.g[2]+h&4294967295,_.g[3]=_.g[3]+b&4294967295}i.prototype.u=function(_,g){g===void 0&&(g=_.length);for(var y=g-this.blockSize,v=this.B,h=this.h,b=0;b<g;){if(h==0)for(;b<=y;)r(this,_,b),b+=this.blockSize;if(typeof _=="string"){for(;b<g;)if(v[h++]=_.charCodeAt(b++),h==this.blockSize){r(this,v),h=0;break}}else for(;b<g;)if(v[h++]=_[b++],h==this.blockSize){r(this,v),h=0;break}}this.h=h,this.o+=g},i.prototype.v=function(){var _=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);_[0]=128;for(var g=1;g<_.length-8;++g)_[g]=0;var y=8*this.o;for(g=_.length-8;g<_.length;++g)_[g]=y&255,y/=256;for(this.u(_),_=Array(16),g=y=0;4>g;++g)for(var v=0;32>v;v+=8)_[y++]=this.g[g]>>>v&255;return _};function s(_,g){var y=o;return Object.prototype.hasOwnProperty.call(y,_)?y[_]:y[_]=g(_)}function a(_,g){this.h=g;for(var y=[],v=!0,h=_.length-1;0<=h;h--){var b=_[h]|0;v&&b==g||(y[h]=b,v=!1)}this.g=y}var o={};function l(_){return-128<=_&&128>_?s(_,function(g){return new a([g|0],0>g?-1:0)}):new a([_|0],0>_?-1:0)}function c(_){if(isNaN(_)||!isFinite(_))return m;if(0>_)return C(c(-_));for(var g=[],y=1,v=0;_>=y;v++)g[v]=_/y|0,y*=4294967296;return new a(g,0)}function u(_,g){if(_.length==0)throw Error("number format error: empty string");if(g=g||10,2>g||36<g)throw Error("radix out of range: "+g);if(_.charAt(0)=="-")return C(u(_.substring(1),g));if(0<=_.indexOf("-"))throw Error('number format error: interior "-" character');for(var y=c(Math.pow(g,8)),v=m,h=0;h<_.length;h+=8){var b=Math.min(8,_.length-h),d=parseInt(_.substring(h,h+b),g);8>b?(b=c(Math.pow(g,b)),v=v.j(b).add(c(d))):(v=v.j(y),v=v.add(c(d)))}return v}var m=l(0),p=l(1),T=l(16777216);n=a.prototype,n.m=function(){if(E(this))return-C(this).m();for(var _=0,g=1,y=0;y<this.g.length;y++){var v=this.i(y);_+=(0<=v?v:4294967296+v)*g,g*=4294967296}return _},n.toString=function(_){if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(S(this))return"0";if(E(this))return"-"+C(this).toString(_);for(var g=c(Math.pow(_,6)),y=this,v="";;){var h=M(y,g).g;y=O(y,h.j(g));var b=((0<y.g.length?y.g[0]:y.h)>>>0).toString(_);if(y=h,S(y))return b+v;for(;6>b.length;)b="0"+b;v=b+v}},n.i=function(_){return 0>_?0:_<this.g.length?this.g[_]:this.h};function S(_){if(_.h!=0)return!1;for(var g=0;g<_.g.length;g++)if(_.g[g]!=0)return!1;return!0}function E(_){return _.h==-1}n.l=function(_){return _=O(this,_),E(_)?-1:S(_)?0:1};function C(_){for(var g=_.g.length,y=[],v=0;v<g;v++)y[v]=~_.g[v];return new a(y,~_.h).add(p)}n.abs=function(){return E(this)?C(this):this},n.add=function(_){for(var g=Math.max(this.g.length,_.g.length),y=[],v=0,h=0;h<=g;h++){var b=v+(this.i(h)&65535)+(_.i(h)&65535),d=(b>>>16)+(this.i(h)>>>16)+(_.i(h)>>>16);v=d>>>16,b&=65535,d&=65535,y[h]=d<<16|b}return new a(y,y[y.length-1]&-2147483648?-1:0)};function O(_,g){return _.add(C(g))}n.j=function(_){if(S(this)||S(_))return m;if(E(this))return E(_)?C(this).j(C(_)):C(C(this).j(_));if(E(_))return C(this.j(C(_)));if(0>this.l(T)&&0>_.l(T))return c(this.m()*_.m());for(var g=this.g.length+_.g.length,y=[],v=0;v<2*g;v++)y[v]=0;for(v=0;v<this.g.length;v++)for(var h=0;h<_.g.length;h++){var b=this.i(v)>>>16,d=this.i(v)&65535,f=_.i(h)>>>16,P=_.i(h)&65535;y[2*v+2*h]+=d*P,I(y,2*v+2*h),y[2*v+2*h+1]+=b*P,I(y,2*v+2*h+1),y[2*v+2*h+1]+=d*f,I(y,2*v+2*h+1),y[2*v+2*h+2]+=b*f,I(y,2*v+2*h+2)}for(v=0;v<g;v++)y[v]=y[2*v+1]<<16|y[2*v];for(v=g;v<2*g;v++)y[v]=0;return new a(y,0)};function I(_,g){for(;(_[g]&65535)!=_[g];)_[g+1]+=_[g]>>>16,_[g]&=65535,g++}function L(_,g){this.g=_,this.h=g}function M(_,g){if(S(g))throw Error("division by zero");if(S(_))return new L(m,m);if(E(_))return g=M(C(_),g),new L(C(g.g),C(g.h));if(E(g))return g=M(_,C(g)),new L(C(g.g),g.h);if(30<_.g.length){if(E(_)||E(g))throw Error("slowDivide_ only works with positive integers.");for(var y=p,v=g;0>=v.l(_);)y=j(y),v=j(v);var h=G(y,1),b=G(v,1);for(v=G(v,2),y=G(y,2);!S(v);){var d=b.add(v);0>=d.l(_)&&(h=h.add(y),b=d),v=G(v,1),y=G(y,1)}return g=O(_,h.j(g)),new L(h,g)}for(h=m;0<=_.l(g);){for(y=Math.max(1,Math.floor(_.m()/g.m())),v=Math.ceil(Math.log(y)/Math.LN2),v=48>=v?1:Math.pow(2,v-48),b=c(y),d=b.j(g);E(d)||0<d.l(_);)y-=v,b=c(y),d=b.j(g);S(b)&&(b=p),h=h.add(b),_=O(_,d)}return new L(h,_)}n.A=function(_){return M(this,_).h},n.and=function(_){for(var g=Math.max(this.g.length,_.g.length),y=[],v=0;v<g;v++)y[v]=this.i(v)&_.i(v);return new a(y,this.h&_.h)},n.or=function(_){for(var g=Math.max(this.g.length,_.g.length),y=[],v=0;v<g;v++)y[v]=this.i(v)|_.i(v);return new a(y,this.h|_.h)},n.xor=function(_){for(var g=Math.max(this.g.length,_.g.length),y=[],v=0;v<g;v++)y[v]=this.i(v)^_.i(v);return new a(y,this.h^_.h)};function j(_){for(var g=_.g.length+1,y=[],v=0;v<g;v++)y[v]=_.i(v)<<1|_.i(v-1)>>>31;return new a(y,_.h)}function G(_,g){var y=g>>5;g%=32;for(var v=_.g.length-y,h=[],b=0;b<v;b++)h[b]=0<g?_.i(b+y)>>>g|_.i(b+y+1)<<32-g:_.i(b+y);return new a(h,_.h)}i.prototype.digest=i.prototype.v,i.prototype.reset=i.prototype.s,i.prototype.update=i.prototype.u,eu=mg.Md5=i,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=c,a.fromString=u,jn=mg.Integer=a}).apply(typeof pg<"u"?pg:typeof self<"u"?self:typeof window<"u"?window:{});var $i=xc(U_(),1),CT=xc(Qd(),1);var z_="@firebase/firestore",G_="4.7.3";var He=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};He.UNAUTHENTICATED=new He(null);He.GOOGLE_CREDENTIALS=new He("google-credentials-uid");He.FIRST_PARTY=new He("first-party-uid");He.MOCK_USER=new He("mock-user");var aO="10.14.0";var ys=aO;function oO(n){ys=n}function lO(n){return iO(n,{depth:100})}var ji=new Zm("@firebase/firestore");function ra(){return ji.logLevel}function V(n,...e){if(ji.logLevel<=Cn.DEBUG){let t=e.map(sm);ji.debug(`Firestore (${ys}): ${n}`,...t)}}function jt(n,...e){if(ji.logLevel<=Cn.ERROR){let t=e.map(sm);ji.error(`Firestore (${ys}): ${n}`,...t)}}function ts(n,...e){if(ji.logLevel<=Cn.WARN){let t=e.map(sm);ji.warn(`Firestore (${ys}): ${n}`,...t)}}function sm(n){if(typeof n=="string")return n;try{return lO(n)}catch{return n}}function W(n="Unexpected state"){let e=`FIRESTORE (${ys}) INTERNAL ASSERTION FAILED: `+n;throw jt(e),new Error(e)}function ue(n,e){n||W()}function K(n,e){return n}var x={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},z=class extends Jm{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var yn=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var $l=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Af=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(He.UNAUTHENTICATED))}shutdown(){}},Df=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Rf=class{constructor(e){this.authProvider=e,this.currentUser=He.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){ue(this.tokenListener===void 0);let i=this.tokenCounter,r=l=>this.tokenCounter!==i?(i=this.tokenCounter,t(l)):Promise.resolve(),s=new yn;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),s.resolve(),s=new yn,e.enqueueRetryable(()=>r(this.currentUser))};let a=()=>{let l=s;e.enqueueRetryable(()=>R(this,null,function*(){yield l.promise,yield r(this.currentUser)}))},o=l=>{V("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),a())};this.authProvider.onInit(l=>o(l)),setTimeout(()=>{if(!this.auth){let l=this.authProvider.getImmediate({optional:!0});l?o(l):(V("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new yn)}},0),a()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(i=>this.tokenCounter!==e?(V("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(ue(typeof i.accessToken=="string"),new $l(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){let e=this.auth&&this.auth.getUid();return ue(e===null||typeof e=="string"),new He(e)}},xf=class{constructor(e,t,i){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=i,this.type="FirstParty",this.user=He.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}},Of=class{constructor(e,t,i){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=i}getToken(){return Promise.resolve(new xf(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(He.FIRST_PARTY))}shutdown(){}invalidateToken(){}},kf=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Nf=class{constructor(e){this.appCheckProvider=e,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null}start(e,t){ue(this.tokenListener===void 0);let i=s=>{s.error!=null&&V("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let a=s.token!==this.latestAppCheckToken;return this.latestAppCheckToken=s.token,V("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.tokenListener=s=>{e.enqueueRetryable(()=>i(s))};let r=s=>{V("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){let s=this.appCheckProvider.getImmediate({optional:!0});s?r(s):V("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(ue(typeof t.token=="string"),this.latestAppCheckToken=t.token,new kf(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}};function cO(n){if(!n)return new Af;switch(n.type){case"firstParty":return new Of(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new z(x.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}function uO(n){return sO(n)}var jl=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,i="",r=20;for(;i.length<r;){let s=uO(40);for(let a=0;a<s.length;++a)i.length<r&&s[a]<t&&(i+=e.charAt(s[a]%e.length))}return i}};function se(n,e){return n<e?-1:n>e?1:0}function Wi(n,e,t){return n.length!==e.length?!1:n.every((i,r)=>t(i,e[r]))}var $_=-62135596800,j_=1e6,Qe=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new z(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new z(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<$_)throw new z(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new z(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),i=Math.floor((e-t*1e3)*j_);return new n(t,i)}toDate(){return new Date(this.toMillis())}toMillis(){return this.seconds*1e3+this.nanoseconds/j_}_compareTo(e){return this.seconds===e.seconds?se(this.nanoseconds,e.nanoseconds):se(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-$_,t=String(e).padStart(12,"0"),i=String(this.nanoseconds).padStart(9,"0");return t+"."+i}};var Q=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new Qe(0,0))}static max(){return new n(new Qe(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return this.timestamp.seconds*1e6+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var W_="__name__",Wl=class n{constructor(e,t,i){t===void 0?t=0:t>e.length&&W(),i===void 0?i=e.length-t:i>e.length-t&&W(),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(i=>{t.push(i)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let i=Math.min(e.length,t.length);for(let r=0;r<i;r++){let s=e.get(r),a=t.get(r);if(s<a)return-1;if(s>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},Ae=class n extends Wl{construct(e,t,i){return new n(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let i of e){if(i.indexOf("//")>=0)throw new z(x.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter(r=>r.length>0))}return new n(t)}static emptyPath(){return new n([])}},dO=/^[_a-zA-Z][_a-zA-Z0-9]*$/,bt=class n extends Wl{construct(e,t,i){return new n(e,t,i)}static isValidIdentifier(e){return dO.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===W_}static keyField(){return new n([W_])}static fromServerFormat(e){let t=[],i="",r=0,s=()=>{if(i.length===0)throw new z(x.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""},a=!1;for(;r<e.length;){let o=e[r];if(o==="\\"){if(r+1===e.length)throw new z(x.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[r+1];if(!(l==="\\"||l==="."||l==="`"))throw new z(x.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=l,r+=2}else o==="`"?(a=!a,r++):o==="."&&!a?(s(),r++):(i+=o,r++)}if(s(),a)throw new z(x.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var $=class n{constructor(e){this.path=e}static fromPath(e){return new n(Ae.fromString(e))}static fromName(e){return new n(Ae.fromString(e).popFirst(5))}static empty(){return new n(Ae.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ae.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Ae.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2===0}static fromSegments(e){return new n(new Ae(e.slice()))}};var ca=-1;function hO(n,e){let t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,r=Q.fromTimestamp(i===1e9?new Qe(t+1,0):new Qe(t,i));return new Hi(r,$.empty(),e)}function fO(n){return new Hi(n.readTime,n.key,ca)}var Hi=class n{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new n(Q.min(),$.empty(),ca)}static max(){return new n(Q.max(),$.empty(),ca)}};function pO(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0||(t=$.comparator(n.documentKey,e.documentKey),t!==0)?t:se(n.largestBatchId,e.largestBatchId)}var mO="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Mf=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Ea(n){return R(this,null,function*(){if(n.code===x.FAILED_PRECONDITION&&n.message===mO)V("LocalStore","Unexpectedly lost primary lease");else throw n})}var k=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&W(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((i,r)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(i,r)},this.catchCallback=s=>{this.wrapFailure(t,s).next(i,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,i)=>{t(e)})}static reject(e){return new n((t,i)=>{i(e)})}static waitFor(e){return new n((t,i)=>{let r=0,s=0,a=!1;e.forEach(o=>{++r,o.next(()=>{++s,a&&s===r&&t()},l=>i(l))}),a=!0,s===r&&t()})}static or(e){let t=n.resolve(!1);for(let i of e)t=t.next(r=>r?n.resolve(r):i());return t}static forEach(e,t){let i=[];return e.forEach((r,s)=>{i.push(t.call(this,r,s))}),this.waitFor(i)}static mapArray(e,t){return new n((i,r)=>{let s=e.length,a=new Array(s),o=0;for(let l=0;l<s;l++){let c=l;t(e[c]).next(u=>{a[c]=u,++o,o===s&&i(a)},u=>r(u))}})}static doWhile(e,t){return new n((i,r)=>{let s=()=>{e()===!0?t().next(()=>{s()},r):i()};s()})}};function gO(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function wa(n){return n.name==="IndexedDbTransactionError"}var Nq=15*1e3,Mq=60*1e3;var ET=(()=>{class n{constructor(t,i){this.previousValue=t,i&&(i.sequenceNumberHandler=r=>this.setPreviousValue(r),this.writeNewSequenceNumber=r=>i.writeSequenceNumber(r))}setPreviousValue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t}}n.INVALID=-1;return n})();var yO="remoteDocuments";var wT="owner";var IT="mutationQueues";var AT="mutations";var DT="documentMutations",vO="remoteDocumentsV14";var RT="remoteDocumentGlobal";var xT="targets";var OT="targetDocuments";var kT="targetGlobal",NT="collectionParents";var MT="clientMetadata";var PT="bundles";var LT="namedQueries";var _O="indexConfiguration";var TO="indexState";var bO="indexEntries";var FT="documentOverlays";var SO="globals";var CO=[IT,AT,DT,yO,xT,wT,kT,OT],EO=CO,wO=[...EO,MT],IO=[...wO,RT],AO=[...IO,NT],DO=[...AO,PT,LT],Pq=[...DO,FT],RO=[IT,AT,DT,vO,xT,wT,kT,OT,MT,RT,NT,PT,LT,FT],xO=RO,OO=[...xO,_O,TO,bO];var Lq=[...OO,SO];function H_(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function er(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function BT(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var De=class n{constructor(e,t){this.comparator=e,this.root=t||aa.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,aa.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,aa.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){let r=this.comparator(e,i.key);if(r===0)return t+i.left.size;r<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,i)=>(e(t,i),!1))}toString(){let e=[];return this.inorderTraversal((t,i)=>(e.push(`${t}:${i}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Zr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Zr(this.root,e,this.comparator,!1)}getReverseIterator(){return new Zr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Zr(this.root,e,this.comparator,!0)}},Zr=class{constructor(e,t,i,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?i(e.key,t):1,t&&r&&(s*=-1),s<0)this.isReverse?e=e.left:e=e.right;else if(s===0){this.nodeStack.push(e);break}else this.nodeStack.push(e),this.isReverse?e=e.right:e=e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},aa=(()=>{class n{constructor(t,i,r,s,a){this.key=t,this.value=i,this.color=r??n.RED,this.left=s??n.EMPTY,this.right=a??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,i,r,s,a){return new n(t??this.key,i??this.value,r??this.color,s??this.left,a??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,i,r){let s=this,a=r(t,s.key);return a<0?s=s.copy(null,null,null,s.left.insert(t,i,r),null):a===0?s=s.copy(null,i,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,i,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return!t.left.isRed()&&!t.left.left.isRed()&&(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,i){let r,s=this;if(i(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed()&&!s.left.left.isRed()&&(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,i),null);else{if(s.left.isRed()&&(s=s.rotateRight()),!s.right.isEmpty()&&!s.right.isRed()&&!s.right.left.isRed()&&(s=s.moveRedRight()),i(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,i))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw W();let t=this.left.check();if(t!==this.right.check())throw W();return t+(this.isRed()?0:1)}}return n.EMPTY=null,n.RED=!0,n.BLACK=!1,n})(),Pf=class{constructor(){this.size=0}get key(){throw W()}get value(){throw W()}get color(){throw W()}get left(){throw W()}get right(){throw W()}copy(e,t,i,r,s){return this}insert(e,t,i){return new aa(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};aa.EMPTY=new Pf;var nt=class n{constructor(e){this.comparator=e,this.data=new De(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,i)=>(e(t),!1))}forEachInRange(e,t){let i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){let r=i.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let i;for(t!==void 0?i=this.data.getIteratorFrom(t):i=this.data.getIterator();i.hasNext();){let r=i.getNext();if(!e(r.key))return}}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Hl(this.data.getIterator())}getIteratorFrom(e){return new Hl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(i=>{t=t.add(i)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){let r=t.getNext().key,s=i.getNext().key;if(this.comparator(r,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Hl=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var Mt=class n{constructor(e){this.fields=e,e.sort(bt.comparator)}static empty(){return new n([])}unionWith(e){let t=new nt(bt.comparator);for(let i of this.fields)t=t.add(i);for(let i of e)t=t.add(i);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Wi(this.fields,e.fields,(t,i)=>t.isEqual(i))}};function kO(n){return Buffer.from(n,"base64").toString("binary")}function NO(n){return Buffer.from(n,"binary").toString("base64")}var it=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=kO(e);return new n(t)}static fromUint8Array(e){let t=MO(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return NO(this.binaryString)}toUint8Array(){return PO(this.binaryString)}approximateByteSize(){return this.binaryString.length*2}compareTo(e){return se(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};it.EMPTY_BYTE_STRING=new it("");function MO(n){let e="";for(let t=0;t<n.length;++t)e+=String.fromCharCode(n[t]);return e}function PO(n){let e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}var LO=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Pn(n){if(ue(!!n),typeof n=="string"){let e=0,t=LO.exec(n);if(ue(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}let i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}else{let e=Ce(n.seconds),t=Ce(n.nanos);return{seconds:e,nanos:t}}}function Ce(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function bi(n){return typeof n=="string"?it.fromBase64String(n):it.fromUint8Array(n)}var qT="server_timestamp",VT="__type__",UT="__previous_value__",zT="__local_write_time__";function am(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[VT])===null||t===void 0?void 0:t.stringValue)===qT}function FO(n,e){let t={fields:{[VT]:{stringValue:qT},[zT]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}};return e&&am(e)&&(e=om(e)),e&&(t.fields[UT]=e),{mapValue:t}}function om(n){let e=n.mapValue.fields[UT];return am(e)?om(e):e}function ua(n){let e=Pn(n.mapValue.fields[zT].timestampValue);return new Qe(e.seconds,e.nanos)}var Lf=class{constructor(e,t,i,r,s,a,o,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=r,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=o,this.longPollingOptions=l,this.useFetchStreams=c}},Ff="(default)",Kl=class n{constructor(e,t){this.projectId=e,this.database=t||Ff}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===Ff}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};function BO(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new z(x.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Kl(n.options.projectId,e)}var lm=-1;function _c(n){return n==null}function da(n){return n===0&&1/n===-1/0}function qO(n){return typeof n=="number"&&Number.isInteger(n)&&!da(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var cm="__type__",GT="__max__",Vl={mapValue:{fields:{__type__:{stringValue:GT}}}},um="__vector__",is="value";function Ki(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?am(n)?4:WT(n)?9007199254740991:jT(n)?10:11:W()}function $t(n,e){if(n===e)return!0;let t=Ki(n),i=Ki(e);if(t!==i)return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return ua(n).isEqual(ua(e));case 3:return VO(n,e);case 5:return n.stringValue===e.stringValue;case 6:return zO(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return UO(n,e);case 2:return GO(n,e);case 9:return Wi(n.arrayValue.values||[],e.arrayValue.values||[],$t);case 10:case 11:return $O(n,e);case 9007199254740991:return!0;default:return W()}}function VO(n,e){if(typeof n.timestampValue=="string"&&typeof e.timestampValue=="string"&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;let t=Pn(n.timestampValue),i=Pn(e.timestampValue);return t.seconds===i.seconds&&t.nanos===i.nanos}function UO(n,e){return Ce(n.geoPointValue.latitude)===Ce(e.geoPointValue.latitude)&&Ce(n.geoPointValue.longitude)===Ce(e.geoPointValue.longitude)}function zO(n,e){return bi(n.bytesValue).isEqual(bi(e.bytesValue))}function GO(n,e){if("integerValue"in n&&"integerValue"in e)return Ce(n.integerValue)===Ce(e.integerValue);if("doubleValue"in n&&"doubleValue"in e){let t=Ce(n.doubleValue),i=Ce(e.doubleValue);return t===i?da(t)===da(i):isNaN(t)&&isNaN(i)}return!1}function $O(n,e){let t=n.mapValue.fields||{},i=e.mapValue.fields||{};if(H_(t)!==H_(i))return!1;for(let r in t)if(t.hasOwnProperty(r)&&(i[r]===void 0||!$t(t[r],i[r])))return!1;return!0}function ha(n,e){return(n.values||[]).find(t=>$t(t,e))!==void 0}function rs(n,e){if(n===e)return 0;let t=Ki(n),i=Ki(e);if(t!==i)return se(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return se(n.booleanValue,e.booleanValue);case 2:return jO(n,e);case 3:return K_(n.timestampValue,e.timestampValue);case 4:return K_(ua(n),ua(e));case 5:return se(n.stringValue,e.stringValue);case 6:return KO(n.bytesValue,e.bytesValue);case 7:return WO(n.referenceValue,e.referenceValue);case 8:return HO(n.geoPointValue,e.geoPointValue);case 9:return $T(n.arrayValue,e.arrayValue);case 10:return QO(n.mapValue,e.mapValue);case 11:return YO(n.mapValue,e.mapValue);default:throw W()}}function jO(n,e){let t=Ce(n.integerValue||n.doubleValue),i=Ce(e.integerValue||e.doubleValue);return t<i?-1:t>i?1:t===i?0:isNaN(t)?isNaN(i)?0:-1:1}function K_(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return se(n,e);let t=Pn(n),i=Pn(e),r=se(t.seconds,i.seconds);return r!==0?r:se(t.nanos,i.nanos)}function WO(n,e){let t=n.split("/"),i=e.split("/");for(let r=0;r<t.length&&r<i.length;r++){let s=se(t[r],i[r]);if(s!==0)return s}return se(t.length,i.length)}function HO(n,e){let t=se(Ce(n.latitude),Ce(e.latitude));return t!==0?t:se(Ce(n.longitude),Ce(e.longitude))}function KO(n,e){let t=bi(n),i=bi(e);return t.compareTo(i)}function $T(n,e){let t=n.values||[],i=e.values||[];for(let r=0;r<t.length&&r<i.length;++r){let s=rs(t[r],i[r]);if(s)return s}return se(t.length,i.length)}function QO(n,e){var t,i,r,s;let a=n.fields||{},o=e.fields||{},l=(t=a[is])===null||t===void 0?void 0:t.arrayValue,c=(i=o[is])===null||i===void 0?void 0:i.arrayValue,u=se(((r=l?.values)===null||r===void 0?void 0:r.length)||0,((s=c?.values)===null||s===void 0?void 0:s.length)||0);return u!==0?u:$T(l,c)}function YO(n,e){if(n===Vl.mapValue&&e===Vl.mapValue)return 0;if(n===Vl.mapValue)return 1;if(e===Vl.mapValue)return-1;let t=n.fields||{},i=Object.keys(t),r=e.fields||{},s=Object.keys(r);i.sort(),s.sort();for(let a=0;a<i.length&&a<s.length;++a){let o=se(i[a],s[a]);if(o!==0)return o;let l=rs(t[i[a]],r[s[a]]);if(l!==0)return l}return se(i.length,s.length)}function ss(n){return dm(n)}function dm(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?XO(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?JO(n.bytesValue):"referenceValue"in n?ek(n.referenceValue):"geoPointValue"in n?ZO(n.geoPointValue):"arrayValue"in n?nk(n.arrayValue):"mapValue"in n?tk(n.mapValue):W()}function JO(n){return bi(n).toBase64()}function XO(n){let e=Pn(n);return`time(${e.seconds},${e.nanos})`}function ZO(n){return`geo(${n.latitude},${n.longitude})`}function ek(n){return $.fromName(n).toString()}function tk(n){let e=Object.keys(n.fields||{}).sort(),t="{",i=!0;for(let r of e)i?i=!1:t+=",",t+=`${r}:${dm(n.fields[r])}`;return t+"}"}function nk(n){let e="[",t=!0;for(let i of n.values||[])t?t=!1:e+=",",e+=dm(i);return e+"]"}function Bf(n){return!!n&&"integerValue"in n}function ik(n){return!!n&&"doubleValue"in n}function rk(n){return Bf(n)||ik(n)}function hm(n){return!!n&&"arrayValue"in n}function Q_(n){return!!n&&"nullValue"in n}function Y_(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function zl(n){return!!n&&"mapValue"in n}function jT(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[cm])===null||t===void 0?void 0:t.stringValue)===um}function oa(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return er(n.mapValue.fields,(t,i)=>e.mapValue.fields[t]=oa(i)),e}else if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=oa(n.arrayValue.values[t]);return e}else return Object.assign({},n)}function WT(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===GT}var Fq={mapValue:{fields:{[cm]:{stringValue:um},[is]:{arrayValue:{}}}}};var _t=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!zl(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){let i=this.getFieldsMap(e.popLast());i[e.lastSegment()]=oa(t)}setAll(e){let t=bt.emptyPath(),i={},r=[];e.forEach((a,o)=>{if(!t.isImmediateParentOf(o)){let l=this.getFieldsMap(t);this.applyChanges(l,i,r),i={},r=[],t=o.popLast()}a?i[o.lastSegment()]=oa(a):r.push(o.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,i,r)}delete(e){let t=this.field(e.popLast());zl(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return $t(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let r=t.mapValue.fields[e.get(i)];(!zl(r)||!r.mapValue.fields)&&(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,i){er(t,(r,s)=>e[r]=s);for(let r of i)delete e[r]}clone(){return new n(oa(this.value))}};function HT(n){let e=[];return er(n.fields,(t,i)=>{let r=new bt([t]);if(zl(i)){let a=HT(i.mapValue).fields;if(a.length===0)e.push(r);else for(let o of a)e.push(r.child(o))}else e.push(r)}),new Mt(e)}var Wt=class n{constructor(e,t,i,r,s,a,o){this.key=e,this.documentType=t,this.version=i,this.readTime=r,this.createTime=s,this.data=a,this.documentState=o}static newInvalidDocument(e){return new n(e,0,Q.min(),Q.min(),Q.min(),_t.empty(),0)}static newFoundDocument(e,t,i,r){return new n(e,1,t,Q.min(),i,r,0)}static newNoDocument(e,t){return new n(e,2,t,Q.min(),Q.min(),_t.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,Q.min(),Q.min(),_t.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(Q.min())&&(this.documentType===2||this.documentType===0)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=_t.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=_t.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Q.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};function sk(n,e,t){let i=e.data.field(n),r=t.data.field(n);return i!==null&&r!==null?rs(i,r):W()}var as=class{constructor(e,t){this.position=e,this.inclusive=t}};function KT(n,e,t){let i=0;for(let r=0;r<n.position.length;r++){let s=e[r],a=n.position[r];if(s.field.isKeyField())i=$.comparator($.fromName(a.referenceValue),t.key);else{let o=t.data.field(s.field);i=rs(a,o)}if(s.dir==="desc"&&(i=i*-1),i!==0)break}return i}function ak(n,e,t){let i=KT(n,e,t);return n.inclusive?i>=0:i>0}function ok(n,e,t){let i=KT(n,e,t);return n.inclusive?i<=0:i<0}function J_(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++){let i=n.position[t],r=e.position[t];if(!$t(i,r))return!1}return!0}var os=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function lk(n){return n.field.canonicalString()+n.dir}function ck(n){return`${n.field.canonicalString()} (${n.dir})`}function uk(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var Ql=class{},Ve=class n extends Ql{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,i):new Vf(e,t,i):t==="array-contains"?new Gf(e,i):t==="in"?new $f(e,i):t==="not-in"?new jf(e,i):t==="array-contains-any"?new Wf(e,i):new n(e,t,i)}static createKeyFieldInFilter(e,t,i){return t==="in"?new Uf(e,i):new zf(e,i)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(rs(t,this.value)):t!==null&&Ki(this.value)===Ki(t)&&this.matchesComparison(rs(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return W()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Tn=class n extends Ql{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new n(e,t)}matches(e){return QT(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.memoizedFlattenedFilters!==null?this.memoizedFlattenedFilters:(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[]),this.memoizedFlattenedFilters)}getFilters(){return Object.assign([],this.filters)}};function QT(n){return n.op==="and"}function YT(n){return dk(n)&&QT(n)}function dk(n){for(let e of n.filters)if(e instanceof Tn)return!1;return!0}function qf(n){if(n instanceof Ve)return n.field.canonicalString()+n.op.toString()+ss(n.value);if(YT(n))return n.filters.map(e=>qf(e)).join(",");{let e=n.filters.map(t=>qf(t)).join(",");return`${n.op}(${e})`}}function JT(n,e){if(n instanceof Ve)return hk(n,e);if(n instanceof Tn)return fk(n,e);W()}function hk(n,e){return e instanceof Ve&&n.op===e.op&&n.field.isEqual(e.field)&&$t(n.value,e.value)}function fk(n,e){return e instanceof Tn&&n.op===e.op&&n.filters.length===e.filters.length?n.filters.reduce((i,r,s)=>i&&JT(r,e.filters[s]),!0):!1}function XT(n){return n instanceof Ve?mk(n):n instanceof Tn?pk(n):"Filter"}function pk(n){return n.op.toString()+" {"+n.getFilters().map(XT).join(" ,")+"}"}function mk(n){return`${n.field.canonicalString()} ${n.op} ${ss(n.value)}`}var Vf=class extends Ve{constructor(e,t,i){super(e,t,i),this.key=$.fromName(i.referenceValue)}matches(e){let t=$.comparator(e.key,this.key);return this.matchesComparison(t)}},Uf=class extends Ve{constructor(e,t){super(e,"in",t),this.keys=ZT("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},zf=class extends Ve{constructor(e,t){super(e,"not-in",t),this.keys=ZT("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function ZT(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(i=>$.fromName(i.referenceValue))}var Gf=class extends Ve{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return hm(t)&&ha(t.arrayValue,this.value)}},$f=class extends Ve{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&ha(this.value.arrayValue,t)}},jf=class extends Ve{constructor(e,t){super(e,"not-in",t)}matches(e){if(ha(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!ha(this.value.arrayValue,t)}},Wf=class extends Ve{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!hm(t)||!t.arrayValue.values?!1:t.arrayValue.values.some(i=>ha(this.value.arrayValue,i))}};var Hf=class{constructor(e,t=null,i=[],r=[],s=null,a=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=r,this.limit=s,this.startAt=a,this.endAt=o,this.memoizedCanonicalId=null}};function X_(n,e=null,t=[],i=[],r=null,s=null,a=null){return new Hf(n,e,t,i,r,s,a)}function fm(n){let e=K(n);if(e.memoizedCanonicalId===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(i=>qf(i)).join(","),t+="|ob:",t+=e.orderBy.map(i=>lk(i)).join(","),_c(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>ss(i)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>ss(i)).join(",")),e.memoizedCanonicalId=t}return e.memoizedCanonicalId}function gk(n){let e=n.path.canonicalString();return n.collectionGroup!==null&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>XT(t)).join(", ")}]`),_c(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>ck(t)).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>ss(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>ss(t)).join(",")),`Target(${e})`}function pm(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!uk(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!JT(n.filters[t],e.filters[t]))return!1;return n.collectionGroup!==e.collectionGroup||!n.path.isEqual(e.path)||!J_(n.startAt,e.startAt)?!1:J_(n.endAt,e.endAt)}function Kf(n){return $.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var ls=class{constructor(e,t=null,i=[],r=[],s=null,a="F",o=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=r,this.limit=s,this.limitType=a,this.startAt=o,this.endAt=l,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}};function yk(n,e,t,i,r,s,a,o){return new ls(n,e,t,i,r,s,a,o)}function mm(n){return new ls(n)}function vk(n,e){return new ls(e,null,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function Z_(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function _k(n){let e=new nt(bt.comparator);return n.filters.forEach(t=>{t.getFlattenedFilters().forEach(r=>{r.isInequality()&&(e=e.add(r.field))})}),e}function Tk(n){return $.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function bk(n){return n.collectionGroup!==null}function fa(n){let e=K(n);if(e.memoizedNormalizedOrderBy===null){e.memoizedNormalizedOrderBy=[];let t=new Set;for(let s of e.explicitOrderBy)e.memoizedNormalizedOrderBy.push(s),t.add(s.field.canonicalString());let i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";_k(e).forEach(s=>{!t.has(s.canonicalString())&&!s.isKeyField()&&e.memoizedNormalizedOrderBy.push(new os(s,i))}),t.has(bt.keyField().canonicalString())||e.memoizedNormalizedOrderBy.push(new os(bt.keyField(),i))}return e.memoizedNormalizedOrderBy}function vn(n){let e=K(n);return e.memoizedTarget||(e.memoizedTarget=Sk(e,fa(n))),e.memoizedTarget}function Sk(n,e){if(n.limitType==="F")return X_(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(r=>{let s=r.dir==="desc"?"asc":"desc";return new os(r.field,s)});let t=n.endAt?new as(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new as(n.startAt.position,n.startAt.inclusive):null;return X_(n.path,n.collectionGroup,e,n.filters,n.limit,t,i)}}function Qf(n,e,t){return new ls(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Tc(n,e){return pm(vn(n),vn(e))&&n.limitType===e.limitType}function eb(n){return`${fm(vn(n))}|lt:${n.limitType}`}function Jr(n){return`Query(target=${gk(vn(n))}; limitType=${n.limitType})`}function bc(n,e){return e.isFoundDocument()&&Ck(n,e)&&Ek(n,e)&&wk(n,e)&&Ik(n,e)}function Ck(n,e){let t=e.key.path;return n.collectionGroup!==null?e.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(t):$.isDocumentKey(n.path)?n.path.isEqual(t):n.path.isImmediateParentOf(t)}function Ek(n,e){for(let t of fa(n))if(!t.field.isKeyField()&&e.data.field(t.field)===null)return!1;return!0}function wk(n,e){for(let t of n.filters)if(!t.matches(e))return!1;return!0}function Ik(n,e){return!(n.startAt&&!ok(n.startAt,fa(n),e)||n.endAt&&!ak(n.endAt,fa(n),e))}function Ak(n){return n.collectionGroup||(n.path.length%2===1?n.path.lastSegment():n.path.get(n.path.length-2))}function tb(n){return(e,t)=>{let i=!1;for(let r of fa(n)){let s=Dk(r,e,t);if(s!==0)return s;i=i||r.field.isKeyField()}return 0}}function Dk(n,e,t){let i=n.field.isKeyField()?$.comparator(e.key,t.key):sk(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return W()}}var Si=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(let[r,s]of i)if(this.equalsFn(r,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let i=this.mapKeyFn(e),r=this.inner[i];if(r===void 0){this.inner[i]=[[e,t]],this.innerSize++;return}for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e)){r[s]=[e,t];return}r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return i.length===1?delete this.inner[t]:i.splice(r,1),this.innerSize--,!0;return!1}forEach(e){er(this.inner,(t,i)=>{for(let[r,s]of i)e(r,s)})}isEmpty(){return BT(this.inner)}size(){return this.innerSize}};var Rk=new De($.comparator);function Ln(){return Rk}var nb=new De($.comparator);function sa(...n){let e=nb;for(let t of n)e=e.insert(t.key,t);return e}function xk(){return pa()}function ib(n){let e=nb;return n.forEach((t,i)=>e=e.insert(t,i.overlayedDocument)),e}function zi(){return pa()}function rb(){return pa()}function pa(){return new Si(n=>n.toString(),(n,e)=>n.isEqual(e))}var Ok=new De($.comparator);function kk(){return Ok}var Nk=new nt($.comparator);function Z(...n){let e=Nk;for(let t of n)e=e.add(t);return e}var Mk=new nt(se);function Pk(){return Mk}function gm(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:da(e)?"-0":e}}function sb(n){return{integerValue:""+n}}function Lk(n,e){return qO(e)?sb(e):gm(n,e)}var cs=class{constructor(){this._=void 0}};function Fk(n,e,t){return n instanceof us?FO(t,e):n instanceof Qi?ob(n,e):n instanceof Yi?lb(n,e):Vk(n,e)}function Bk(n,e,t){return n instanceof Qi?ob(n,e):n instanceof Yi?lb(n,e):t}function ab(n,e){return n instanceof ds?rk(e)?e:{integerValue:0}:null}function qk(n,e){return n instanceof Qi&&e instanceof Qi||n instanceof Yi&&e instanceof Yi?Wi(n.elements,e.elements,$t):n instanceof ds&&e instanceof ds?$t(n.operand,e.operand):n instanceof us&&e instanceof us}var us=class extends cs{},Qi=class extends cs{constructor(e){super(),this.elements=e}};function ob(n,e){let t=cb(e);for(let i of n.elements)t.some(r=>$t(r,i))||t.push(i);return{arrayValue:{values:t}}}var Yi=class extends cs{constructor(e){super(),this.elements=e}};function lb(n,e){let t=cb(e);for(let i of n.elements)t=t.filter(r=>!$t(r,i));return{arrayValue:{values:t}}}var ds=class extends cs{constructor(e,t){super(),this.serializer=e,this.operand=t}};function Vk(n,e){let t=ab(n,e),i=eT(t)+eT(n.operand);return Bf(t)&&Bf(n.operand)?sb(i):gm(n.serializer,i)}function eT(n){return Ce(n.integerValue||n.doubleValue)}function cb(n){return hm(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function Uk(n,e){return n.field.isEqual(e.field)&&qk(n.transform,e.transform)}function zk(n,e){return n===void 0&&e===void 0?!0:n&&e?Wi(n,e,(t,i)=>Uk(t,i)):!1}var Yf=class{constructor(e,t){this.version=e,this.transformResults=t}},Mn=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Sc(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists!==void 0?n.exists===e.isFoundDocument():!0}var hs=class{};function ub(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new ma(n.key,Mn.none()):new Ji(n.key,n.data,Mn.none());{let t=n.data,i=_t.empty(),r=new nt(bt.comparator);for(let s of e.fields)if(!r.has(s)){let a=t.field(s);a===null&&s.length>1&&(s=s.popLast(),a=t.field(s)),a===null?i.delete(s):i.set(s,a),r=r.add(s)}return new bn(n.key,i,new Mt(r.toArray()),Mn.none())}}function Gk(n,e,t){n instanceof Ji?jk(n,e,t):n instanceof bn?Hk(n,e,t):Qk(n,e,t)}function la(n,e,t,i){return n instanceof Ji?Wk(n,e,t,i):n instanceof bn?Kk(n,e,t,i):Yk(n,e,t)}function $k(n,e){let t=null;for(let i of n.fieldTransforms){let r=e.data.field(i.field),s=ab(i.transform,r||null);s!=null&&(t===null&&(t=_t.empty()),t.set(i.field,s))}return t||null}function tT(n,e){return n.type!==e.type||!n.key.isEqual(e.key)||!n.precondition.isEqual(e.precondition)||!zk(n.fieldTransforms,e.fieldTransforms)?!1:n.type===0?n.value.isEqual(e.value):n.type===1?n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask):!0}var Ji=class extends hs{constructor(e,t,i,r=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}};function jk(n,e,t){let i=n.value.clone(),r=hb(n.fieldTransforms,e,t.transformResults);i.setAll(r),e.convertToFoundDocument(t.version,i).setHasCommittedMutations()}function Wk(n,e,t,i){if(!Sc(n.precondition,e))return t;let r=n.value.clone(),s=fb(n.fieldTransforms,i,e);return r.setAll(s),e.convertToFoundDocument(e.version,r).setHasLocalMutations(),null}var bn=class extends hs{constructor(e,t,i,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function Hk(n,e,t){if(!Sc(n.precondition,e)){e.convertToUnknownDocument(t.version);return}let i=hb(n.fieldTransforms,e,t.transformResults),r=e.data;r.setAll(db(n)),r.setAll(i),e.convertToFoundDocument(t.version,r).setHasCommittedMutations()}function Kk(n,e,t,i){if(!Sc(n.precondition,e))return t;let r=fb(n.fieldTransforms,i,e),s=e.data;return s.setAll(db(n)),s.setAll(r),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),t===null?null:t.unionWith(n.fieldMask.fields).unionWith(n.fieldTransforms.map(a=>a.field))}function db(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let i=n.data.field(t);e.set(t,i)}}),e}function hb(n,e,t){let i=new Map;ue(n.length===t.length);for(let r=0;r<t.length;r++){let s=n[r],a=s.transform,o=e.data.field(s.field);i.set(s.field,Bk(a,o,t[r]))}return i}function fb(n,e,t){let i=new Map;for(let r of n){let s=r.transform,a=t.data.field(r.field);i.set(r.field,Fk(s,a,e))}return i}var ma=class extends hs{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}};function Qk(n,e,t){e.convertToNoDocument(t.version).setHasCommittedMutations()}function Yk(n,e,t){return Sc(n.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):t}var Jf=class extends hs{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Xf=class{constructor(e,t,i,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=r}applyToRemoteDocument(e,t){let i=t.mutationResults;for(let r=0;r<this.mutations.length;r++){let s=this.mutations[r];if(s.key.isEqual(e.key)){let a=i[r];Gk(s,e,a)}}}applyToLocalView(e,t){for(let i of this.baseMutations)i.key.isEqual(e.key)&&(t=la(i,e,t,this.localWriteTime));for(let i of this.mutations)i.key.isEqual(e.key)&&(t=la(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let i=rb();return this.mutations.forEach(r=>{let s=e.get(r.key),a=s.overlayedDocument,o=this.applyToLocalView(a,s.mutatedFields);o=t.has(r.key)?null:o;let l=ub(a,o);l!==null&&i.set(r.key,l),a.isValidDocument()||a.convertToNoDocument(Q.min())}),i}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Z())}isEqual(e){return this.batchId===e.batchId&&Wi(this.mutations,e.mutations,(t,i)=>tT(t,i))&&Wi(this.baseMutations,e.baseMutations,(t,i)=>tT(t,i))}},Zf=class n{constructor(e,t,i,r){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=r}static from(e,t,i){ue(e.mutations.length===i.length);let r=kk(),s=e.mutations;for(let a=0;a<s.length;a++)r=r.insert(s[a].key,i[a].version);return new n(e,t,i,r)}};var ep=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var tp=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var We=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n}(We||{});function Jk(n){switch(n){case x.OK:return W();case x.CANCELLED:case x.UNKNOWN:case x.DEADLINE_EXCEEDED:case x.RESOURCE_EXHAUSTED:case x.INTERNAL:case x.UNAVAILABLE:case x.UNAUTHENTICATED:return!1;case x.INVALID_ARGUMENT:case x.NOT_FOUND:case x.ALREADY_EXISTS:case x.PERMISSION_DENIED:case x.FAILED_PRECONDITION:case x.ABORTED:case x.OUT_OF_RANGE:case x.UNIMPLEMENTED:case x.DATA_LOSS:return!0;default:return W()}}function Xk(n){return Jk(n)&&n!==x.ABORTED}function Gl(n){if(n===void 0)return jt("GRPC error has no .code"),x.UNKNOWN;switch(n){case We.OK:return x.OK;case We.CANCELLED:return x.CANCELLED;case We.UNKNOWN:return x.UNKNOWN;case We.DEADLINE_EXCEEDED:return x.DEADLINE_EXCEEDED;case We.RESOURCE_EXHAUSTED:return x.RESOURCE_EXHAUSTED;case We.INTERNAL:return x.INTERNAL;case We.UNAVAILABLE:return x.UNAVAILABLE;case We.UNAUTHENTICATED:return x.UNAUTHENTICATED;case We.INVALID_ARGUMENT:return x.INVALID_ARGUMENT;case We.NOT_FOUND:return x.NOT_FOUND;case We.ALREADY_EXISTS:return x.ALREADY_EXISTS;case We.PERMISSION_DENIED:return x.PERMISSION_DENIED;case We.FAILED_PRECONDITION:return x.FAILED_PRECONDITION;case We.ABORTED:return x.ABORTED;case We.OUT_OF_RANGE:return x.OUT_OF_RANGE;case We.UNIMPLEMENTED:return x.UNIMPLEMENTED;case We.DATA_LOSS:return x.DATA_LOSS;default:return W()}}var np=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Tf=null;function Zk(){return new rO}var eN=new jn([4294967295,4294967295],0);function nT(n){let e=Zk().encode(n),t=new eu;return t.update(e),new Uint8Array(t.digest())}function iT(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),i=e.getUint32(4,!0),r=e.getUint32(8,!0),s=e.getUint32(12,!0),a=new jn([t,i],0),o=new jn([r,s],0);return[a,o]}var ip=class n{constructor(e,t,i){if(this.bitmap=e,this.padding=t,this.hashCount=i,t<0||t>=8)throw new Gi(`Invalid padding: ${t}`);if(i<0)throw new Gi(`Invalid hash count: ${i}`);if(e.length>0&&this.hashCount===0)throw new Gi(`Invalid hash count: ${i}`);if(e.length===0&&t!==0)throw new Gi(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=e.length*8-t,this.bitCountInInteger=jn.fromNumber(this.bitCount)}getBitIndex(e,t,i){let r=e.add(t.multiply(jn.fromNumber(i)));return r.compare(eN)===1&&(r=new jn([r.getBits(0),r.getBits(1)],0)),r.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){let t=this.bitmap[Math.floor(e/8)],i=e%8;return(t&1<<i)!==0}mightContain(e){if(this.bitCount===0)return!1;let t=nT(e),[i,r]=iT(t);for(let s=0;s<this.hashCount;s++){let a=this.getBitIndex(i,r,s);if(!this.isBitSet(a))return!1}return!0}static create(e,t,i){let r=e%8===0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new n(s,r,t);return i.forEach(o=>a.insert(o)),a}insert(e){if(this.bitCount===0)return;let t=nT(e),[i,r]=iT(t);for(let s=0;s<this.hashCount;s++){let a=this.getBitIndex(i,r,s);this.setBit(a)}}setBit(e){let t=Math.floor(e/8),i=e%8;this.bitmap[t]|=1<<i}},Gi=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Yl=class n{constructor(e,t,i,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,i){let r=new Map;return r.set(e,ga.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new n(Q.min(),r,new De(se),Ln(),Z())}},ga=class n{constructor(e,t,i,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new n(i,t,Z(),Z(),Z())}};var ns=class{constructor(e,t,i,r){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=i,this.newDoc=r}},Jl=class{constructor(e,t){this.targetId=e,this.existenceFilter=t}},Xl=class{constructor(e,t,i=it.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=r}},Zl=class{constructor(){this.pendingResponses=0,this.documentChanges=sT(),this._resumeToken=it.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return this.pendingResponses!==0}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=Z(),t=Z(),i=Z();return this.documentChanges.forEach((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:i=i.add(r);break;default:W()}}),new ga(this._resumeToken,this._current,e,t,i)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=sT()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,ue(this.pendingResponses>=0)}markCurrent(){this._hasPendingChanges=!0,this._current=!0}},tN="WatchChangeAggregator",rp=class{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=Ln(),this.pendingDocumentTargetMapping=rT(),this.pendingTargetResets=new De(se)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let i=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&i.updateResumeToken(e.resumeToken);break;case 1:i.recordTargetResponse(),i.isPending||i.clearPendingChanges(),i.updateResumeToken(e.resumeToken);break;case 2:i.recordTargetResponse(),i.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(i.markCurrent(),i.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),i.updateResumeToken(e.resumeToken));break;default:W()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((i,r)=>{this.isActiveTarget(r)&&t(r)})}handleExistenceFilter(e){let t=e.targetId,i=e.existenceFilter.count,r=this.targetDataForActiveTarget(t);if(r){let s=r.target;if(Kf(s))if(i===0){let a=new $(s.path);this.removeDocumentFromTarget(t,a,Wt.newNoDocument(a,Q.min()))}else ue(i===1);else{let a=this.getCurrentDocumentCountForTarget(t);if(a!==i){let o=this.parseBloomFilter(e),l=o?this.applyBloomFilter(o,e,a):1;if(l!==0){this.resetTarget(t);let c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,c)}Tf?.notifyOnExistenceFilterMismatch(nN(a,e.existenceFilter,this.metadataProvider.getDatabaseId(),o,l))}}}}parseBloomFilter(e){let t=e.existenceFilter.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:i="",padding:r=0},hashCount:s=0}=t,a;try{a=bi(i).toUint8Array()}catch(l){if(l instanceof np)return ts("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}let o;try{o=new ip(a,r,s)}catch(l){return l instanceof Gi?ts("BloomFilter error: ",l):ts("Applying bloom filter failed: ",l),null}return o.bitCount===0?null:o}applyBloomFilter(e,t,i){let r=t.existenceFilter.count,s=this.filterRemovedDocuments(e,t.targetId);return r===i-s?0:2}filterRemovedDocuments(e,t){let i=this.metadataProvider.getRemoteKeysForTarget(t),r=0;return i.forEach(s=>{let a=this.metadataProvider.getDatabaseId(),o=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(o)||(this.removeDocumentFromTarget(t,s,null),r++)}),r}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((s,a)=>{let o=this.targetDataForActiveTarget(a);if(o){if(s.current&&Kf(o.target)){let l=new $(o.target.path);this.pendingDocumentUpdates.get(l)===null&&!this.targetContainsDocument(a,l)&&this.removeDocumentFromTarget(a,l,Wt.newNoDocument(l,e))}s.hasPendingChanges&&(t.set(a,s.toTargetChange()),s.clearPendingChanges())}});let i=Z();this.pendingDocumentTargetMapping.forEach((s,a)=>{let o=!0;a.forEachWhile(l=>{let c=this.targetDataForActiveTarget(l);return c&&c.purpose!=="TargetPurposeLimboResolution"?(o=!1,!1):!0}),o&&(i=i.add(s))}),this.pendingDocumentUpdates.forEach((s,a)=>a.setReadTime(e));let r=new Yl(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,i);return this.pendingDocumentUpdates=Ln(),this.pendingDocumentTargetMapping=rT(),this.pendingTargetResets=new De(se),r}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let i=this.targetContainsDocument(e,t.key)?2:0;this.ensureTargetState(e).addDocumentChange(t.key,i),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,i){if(!this.isActiveTarget(e))return;let r=this.ensureTargetState(e);this.targetContainsDocument(e,t)?r.addDocumentChange(t,1):r.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),i&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,i))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let i=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+i.addedDocuments.size-i.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new Zl,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new nt(se),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}isActiveTarget(e){let t=this.targetDataForActiveTarget(e)!==null;return t||V(tN,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new Zl),this.metadataProvider.getRemoteKeysForTarget(e).forEach(i=>{this.removeDocumentFromTarget(e,i,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}};function rT(){return new De($.comparator)}function sT(){return new De($.comparator)}function nN(n,e,t,i,r){var s,a,o,l,c,u;let m={localCacheCount:n,existenceFilterCount:e.count,databaseId:t.database,projectId:t.projectId},p=e.unchangedNames;return p&&(m.bloomFilter={applied:r===0,hashCount:(s=p?.hashCount)!==null&&s!==void 0?s:0,bitmapLength:(l=(o=(a=p?.bits)===null||a===void 0?void 0:a.bitmap)===null||o===void 0?void 0:o.length)!==null&&l!==void 0?l:0,padding:(u=(c=p?.bits)===null||c===void 0?void 0:c.padding)!==null&&u!==void 0?u:0,mightContain:T=>{var S;return(S=i?.mightContain(T))!==null&&S!==void 0?S:!1}}),m}var iN=(()=>{let n={};return n.asc="ASCENDING",n.desc="DESCENDING",n})(),rN=(()=>{let n={};return n["<"]="LESS_THAN",n["<="]="LESS_THAN_OR_EQUAL",n[">"]="GREATER_THAN",n[">="]="GREATER_THAN_OR_EQUAL",n["=="]="EQUAL",n["!="]="NOT_EQUAL",n["array-contains"]="ARRAY_CONTAINS",n.in="IN",n["not-in"]="NOT_IN",n["array-contains-any"]="ARRAY_CONTAINS_ANY",n})(),sN=(()=>{let n={};return n.and="AND",n.or="OR",n})();var sp=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function aN(n){let e=n.code===void 0?x.UNKNOWN:Gl(n.code);return new z(e,n.message||"")}function ap(n,e){return n.useProto3Json||_c(e)?e:{value:e}}function oN(n){let e;return typeof n=="object"?e=n.value:e=n,_c(e)?null:e}function ec(n,e){if(n.useProto3Json){let i=new Date(e.seconds*1e3).toISOString().replace(/\.\d*/,"").replace("Z",""),r=("000000000"+e.nanoseconds).slice(-9);return`${i}.${r}Z`}else return{seconds:""+e.seconds,nanos:e.nanoseconds}}function lN(n){let e=Pn(n);return new Qe(e.seconds,e.nanos)}function pb(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function cN(n,e){return n.useProto3Json?(ue(e===void 0||typeof e=="string"),it.fromBase64String(e||"")):(ue(e===void 0||e instanceof Buffer||e instanceof Uint8Array),it.fromUint8Array(e||new Uint8Array))}function uN(n,e){return ec(n,e.toTimestamp())}function _n(n){return ue(!!n),Q.fromTimestamp(lN(n))}function ym(n,e){return op(n,e).canonicalString()}function op(n,e){let t=hN(n).child("documents");return e===void 0?t:t.child(e)}function mb(n){let e=Ae.fromString(n);return ue(Tb(e)),e}function lp(n,e){return ym(n.databaseId,e.path)}function bf(n,e){let t=mb(e);if(t.get(1)!==n.databaseId.projectId)throw new z(x.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new z(x.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new $(yb(t))}function gb(n,e){return ym(n.databaseId,e)}function dN(n){let e=mb(n);return e.length===4?Ae.emptyPath():yb(e)}function cp(n){return new Ae(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function hN(n){return new Ae(["projects",n.projectId,"databases",n.database])}function yb(n){return ue(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function aT(n,e,t){return{name:lp(n,e),fields:t.value.mapValue.fields}}function fN(n,e){let t;if("targetChange"in e){e.targetChange;let i=pN(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],s=cN(n,e.targetChange.resumeToken),a=e.targetChange.cause,o=a&&aN(a);t=new Xl(i,r,s,o||null)}else if("documentChange"in e){e.documentChange;let i=e.documentChange;i.document,i.document.name,i.document.updateTime;let r=bf(n,i.document.name),s=_n(i.document.updateTime),a=i.document.createTime?_n(i.document.createTime):Q.min(),o=new _t({mapValue:{fields:i.document.fields}}),l=Wt.newFoundDocument(r,s,a,o),c=i.targetIds||[],u=i.removedTargetIds||[];t=new ns(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;let i=e.documentDelete;i.document;let r=bf(n,i.document),s=i.readTime?_n(i.readTime):Q.min(),a=Wt.newNoDocument(r,s),o=i.removedTargetIds||[];t=new ns([],o,a.key,a)}else if("documentRemove"in e){e.documentRemove;let i=e.documentRemove;i.document;let r=bf(n,i.document),s=i.removedTargetIds||[];t=new ns([],s,r,null)}else if("filter"in e){e.filter;let i=e.filter;i.targetId;let{count:r=0,unchangedNames:s}=i,a=new tp(r,s),o=i.targetId;t=new Jl(o,a)}else return W();return t}function pN(n){return n==="NO_CHANGE"?0:n==="ADD"?1:n==="REMOVE"?2:n==="CURRENT"?3:n==="RESET"?4:W()}function mN(n){if(!("targetChange"in n))return Q.min();let e=n.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?Q.min():_n(e.readTime)}function gN(n,e){let t;if(e instanceof Ji)t={update:aT(n,e.key,e.value)};else if(e instanceof ma)t={delete:lp(n,e.key)};else if(e instanceof bn)t={update:aT(n,e.key,e.data),updateMask:KN(e.fieldMask)};else if(e instanceof Jf)t={verify:lp(n,e.key)};else return W();return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(i=>TN(n,i))),e.precondition.isNone||(t.currentDocument=yN(n,e.precondition)),t}function yN(n,e){return e.updateTime!==void 0?{updateTime:uN(n,e.updateTime)}:e.exists!==void 0?{exists:e.exists}:W()}function vN(n,e){let t=n.updateTime?_n(n.updateTime):_n(e);return t.isEqual(Q.min())&&(t=_n(e)),new Yf(t,n.transformResults||[])}function _N(n,e){return n&&n.length>0?(ue(e!==void 0),n.map(t=>vN(t,e))):[]}function TN(n,e){let t=e.transform;if(t instanceof us)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof Qi)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof Yi)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof ds)return{fieldPath:e.field.canonicalString(),increment:t.operand};throw W()}function bN(n,e){return{documents:[gb(n,e.path)]}}function SN(n,e){let t={structuredQuery:{}},i=e.path,r;e.collectionGroup!==null?(r=i,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=i.popLast(),t.structuredQuery.from=[{collectionId:i.lastSegment()}]),t.parent=gb(n,r);let s=AN(e.filters);s&&(t.structuredQuery.where=s);let a=RN(e.orderBy);a&&(t.structuredQuery.orderBy=a);let o=ap(n,e.limit);return o!==null&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt=ON(e.startAt)),e.endAt&&(t.structuredQuery.endAt=kN(e.endAt)),{queryTarget:t,parent:r}}function CN(n){let e=dN(n.parent),t=n.structuredQuery,i=t.from?t.from.length:0,r=null;if(i>0){ue(i===1);let u=t.from[0];u.allDescendants?r=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=DN(t.where));let a=[];t.orderBy&&(a=xN(t.orderBy));let o=null;t.limit&&(o=oN(t.limit));let l=null;t.startAt&&(l=NN(t.startAt));let c=null;return t.endAt&&(c=MN(t.endAt)),yk(e,r,a,s,o,"F",l,c)}function EN(n,e){let t=wN(e.purpose);return t==null?null:{"goog-listen-tags":t}}function wN(n){switch(n){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return W()}}function IN(n,e){let t,i=e.target;if(Kf(i)?t={documents:bN(n,i)}:t={query:SN(n,i).queryTarget},t.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){t.resumeToken=pb(n,e.resumeToken);let r=ap(n,e.expectedCount);r!==null&&(t.expectedCount=r)}else if(e.snapshotVersion.compareTo(Q.min())>0){t.readTime=ec(n,e.snapshotVersion.toTimestamp());let r=ap(n,e.expectedCount);r!==null&&(t.expectedCount=r)}return t}function AN(n){if(n.length!==0)return _b(Tn.create(n,"and"))}function DN(n){let e=vb(n);return e instanceof Tn&&YT(e)?e.getFilters():[e]}function vb(n){return n.unaryFilter!==void 0?jN(n):n.fieldFilter!==void 0?WN(n):n.compositeFilter!==void 0?HN(n):W()}function RN(n){if(n.length!==0)return n.map(e=>UN(e))}function xN(n){return n.map(e=>zN(e))}function ON(n){return{before:n.inclusive,values:n.position}}function kN(n){return{before:!n.inclusive,values:n.position}}function NN(n){let e=!!n.before,t=n.values||[];return new as(t,e)}function MN(n){let e=!n.before,t=n.values||[];return new as(t,e)}function PN(n){return iN[n]}function LN(n){switch(n){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function FN(n){return rN[n]}function BN(n){return sN[n]}function qN(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return W();default:return W()}}function VN(n){switch(n){case"AND":return"and";case"OR":return"or";default:return W()}}function Xr(n){return{fieldPath:n.canonicalString()}}function es(n){return bt.fromServerFormat(n.fieldPath)}function UN(n){return{field:Xr(n.field),direction:PN(n.dir)}}function zN(n){return new os(es(n.field),LN(n.direction))}function _b(n){return n instanceof Ve?$N(n):n instanceof Tn?GN(n):W()}function GN(n){let e=n.getFilters().map(t=>_b(t));return e.length===1?e[0]:{compositeFilter:{op:BN(n.op),filters:e}}}function $N(n){if(n.op==="=="){if(Y_(n.value))return{unaryFilter:{field:Xr(n.field),op:"IS_NAN"}};if(Q_(n.value))return{unaryFilter:{field:Xr(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(Y_(n.value))return{unaryFilter:{field:Xr(n.field),op:"IS_NOT_NAN"}};if(Q_(n.value))return{unaryFilter:{field:Xr(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Xr(n.field),op:FN(n.op),value:n.value}}}function jN(n){switch(n.unaryFilter.op){case"IS_NAN":let e=es(n.unaryFilter.field);return Ve.create(e,"==",{doubleValue:NaN});case"IS_NULL":let t=es(n.unaryFilter.field);return Ve.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let i=es(n.unaryFilter.field);return Ve.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let r=es(n.unaryFilter.field);return Ve.create(r,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return W();default:return W()}}function WN(n){return Ve.create(es(n.fieldFilter.field),qN(n.fieldFilter.op),n.fieldFilter.value)}function HN(n){return Tn.create(n.compositeFilter.filters.map(e=>vb(e)),VN(n.compositeFilter.op))}function KN(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Tb(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var ya=class n{constructor(e,t,i,r,s=Q.min(),a=Q.min(),o=it.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=o,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var up=class{constructor(e){this.remoteSerializer=e}};function QN(n){let e=CN({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Qf(e,e.limit,"L"):e}function YN(n){return{name:n.name,query:QN(n.bundledQuery),readTime:_n(n.readTime)}}function JN(n){return{id:n.id,version:n.version,createTime:_n(n.createTime)}}var XN=5,ZN=10,eM=13,Sf=15,tM=20,nM=25,iM=30,rM=37,sM=45,aM=50,oM=53,lM=55,cM=60,uM=2,tc=class{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,XN);else if("booleanValue"in e)this.writeValueTypeLabel(t,ZN),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,Sf),t.writeNumber(Ce(e.integerValue));else if("doubleValue"in e){let i=Ce(e.doubleValue);isNaN(i)?this.writeValueTypeLabel(t,eM):(this.writeValueTypeLabel(t,Sf),da(i)?t.writeNumber(0):t.writeNumber(i))}else if("timestampValue"in e){let i=e.timestampValue;this.writeValueTypeLabel(t,tM),typeof i=="string"&&(i=Pn(i)),t.writeString(`${i.seconds||""}`),t.writeNumber(i.nanos||0)}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,iM),t.writeBytes(bi(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let i=e.geoPointValue;this.writeValueTypeLabel(t,sM),t.writeNumber(i.latitude||0),t.writeNumber(i.longitude||0)}else"mapValue"in e?WT(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):jT(e)?this.writeIndexVector(e.mapValue,t):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):W()}writeIndexString(e,t){this.writeValueTypeLabel(t,nM),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let i=e.fields||{};this.writeValueTypeLabel(t,lM);for(let r of Object.keys(i))this.writeIndexString(r,t),this.writeIndexValueAux(i[r],t)}writeIndexVector(e,t){var i,r;let s=e.fields||{};this.writeValueTypeLabel(t,oM);let a=is,o=((r=(i=s[a].arrayValue)===null||i===void 0?void 0:i.values)===null||r===void 0?void 0:r.length)||0;this.writeValueTypeLabel(t,Sf),t.writeNumber(Ce(o)),this.writeIndexString(a,t),this.writeIndexValueAux(s[a],t)}writeIndexArray(e,t){let i=e.values||[];this.writeValueTypeLabel(t,aM);for(let r of i)this.writeIndexValueAux(r,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,rM),$.fromName(e).path.forEach(r=>{this.writeValueTypeLabel(t,cM),this.writeUnlabeledIndexString(r,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(uM)}};tc.INSTANCE=new tc;var dp=class{constructor(){this.collectionParentIndex=new hp}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),k.resolve()}getCollectionParents(e,t){return k.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return k.resolve()}deleteFieldIndex(e,t){return k.resolve()}deleteAllFieldIndexes(e){return k.resolve()}createTargetIndexes(e,t){return k.resolve()}getDocumentsMatchingTarget(e,t){return k.resolve(null)}getIndexType(e,t){return k.resolve(0)}getFieldIndexes(e,t){return k.resolve([])}getNextCollectionGroupToUpdate(e){return k.resolve(null)}getMinOffset(e,t){return k.resolve(Hi.min())}getMinOffsetFromCollectionGroup(e,t){return k.resolve(Hi.min())}updateCollectionGroup(e,t,i){return k.resolve()}updateIndexEntries(e,t){return k.resolve()}},hp=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),i=e.popLast(),r=this.index[t]||new nt(Ae.comparator),s=!r.has(i);return this.index[t]=r.add(i),s}has(e){let t=e.lastSegment(),i=e.popLast(),r=this.index[t];return r&&r.has(i)}getEntries(e){return(this.index[e]||new nt(Ae.comparator)).toArray()}};var Bq=new Uint8Array(0);var Cf=2,va=class n{constructor(e){this.lastId=e}next(){return this.lastId+=Cf,this.lastId}static forTargetCache(){return new n(2-Cf)}static forSyncEngine(){return new n(1-Cf)}};var bb=-1,Sb=40*1024*1024,gn=class n{constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};gn.DEFAULT_COLLECTION_PERCENTILE=10;gn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3;gn.DEFAULT=new gn(Sb,gn.DEFAULT_COLLECTION_PERCENTILE,gn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);gn.DISABLED=new gn(bb,0,0);var oT=1*1024*1024,qq=1*60*1e3,Vq=5*60*1e3;var fp=class{constructor(){this.changes=new Si(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Wt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let i=this.changes.get(t);return i!==void 0?k.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var pp=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var mp=class{constructor(e,t,i,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=r}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(i=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(i!==null&&la(i.mutation,r,Mt.empty(),Qe.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.getLocalViewOfDocuments(e,i,Z()).next(()=>i))}getLocalViewOfDocuments(e,t,i=Z()){let r=zi();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,i).next(s=>{let a=sa();return s.forEach((o,l)=>{a=a.insert(o,l.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){let i=zi();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,Z()))}populateOverlays(e,t,i){let r=[];return i.forEach(s=>{t.has(s)||r.push(s)}),this.documentOverlayCache.getOverlays(e,r).next(s=>{s.forEach((a,o)=>{t.set(a,o)})})}computeViews(e,t,i,r){let s=Ln(),a=pa(),o=xk();return t.forEach((l,c)=>{let u=i.get(c.key);r.has(c.key)&&(u===void 0||u.mutation instanceof bn)?s=s.insert(c.key,c):u!==void 0?(a.set(c.key,u.mutation.getFieldMask()),la(u.mutation,c,u.mutation.getFieldMask(),Qe.now())):a.set(c.key,Mt.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((c,u)=>a.set(c,u)),t.forEach((c,u)=>{var m;return o.set(c,new pp(u,(m=a.get(c))!==null&&m!==void 0?m:null))}),o))}recalculateAndSaveOverlays(e,t){let i=pa(),r=new De((a,o)=>a-o),s=Z();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(let o of a)o.keys().forEach(l=>{let c=t.get(l);if(c===null)return;let u=i.get(l)||Mt.empty();u=o.applyToLocalView(c,u),i.set(l,u);let m=(r.get(o.batchId)||Z()).add(l);r=r.insert(o.batchId,m)})}).next(()=>{let a=[],o=r.getReverseIterator();for(;o.hasNext();){let l=o.getNext(),c=l.key,u=l.value,m=rb();u.forEach(p=>{if(!s.has(p)){let T=ub(t.get(p),i.get(p));T!==null&&m.set(p,T),s=s.add(p)}}),a.push(this.documentOverlayCache.saveOverlays(e,c,m))}return k.waitFor(a)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.recalculateAndSaveOverlays(e,i))}getDocumentsMatchingQuery(e,t,i,r){return Tk(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):bk(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i,r):this.getDocumentsMatchingCollectionQuery(e,t,i,r)}getNextDocuments(e,t,i,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,r).next(s=>{let a=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,r-s.size):k.resolve(zi()),o=ca,l=s;return a.next(c=>k.forEach(c,(u,m)=>(o<m.largestBatchId&&(o=m.largestBatchId),s.get(u)?k.resolve():this.remoteDocumentCache.getEntry(e,u).next(p=>{l=l.insert(u,p)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,l,c,Z())).next(u=>({batchId:o,changes:ib(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new $(t)).next(i=>{let r=sa();return i.isFoundDocument()&&(r=r.insert(i.key,i)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,i,r){let s=t.collectionGroup,a=sa();return this.indexManager.getCollectionParents(e,s).next(o=>k.forEach(o,l=>{let c=vk(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,i,r).next(u=>{u.forEach((m,p)=>{a=a.insert(m,p)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,i,r){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,s,r))).next(a=>{s.forEach((l,c)=>{let u=c.getKey();a.get(u)===null&&(a=a.insert(u,Wt.newInvalidDocument(u)))});let o=sa();return a.forEach((l,c)=>{let u=s.get(l);u!==void 0&&la(u.mutation,c,Mt.empty(),Qe.now()),bc(t,c)&&(o=o.insert(l,c))}),o})}};var gp=class{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return k.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,JN(t)),k.resolve()}getNamedQuery(e,t){return k.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,YN(t)),k.resolve()}};var yp=class{constructor(){this.overlays=new De($.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return k.resolve(this.overlays.get(t))}getOverlays(e,t){let i=zi();return k.forEach(t,r=>this.getOverlay(e,r).next(s=>{s!==null&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){return i.forEach((r,s)=>{this.saveOverlay(e,t,s)}),k.resolve()}removeOverlaysForBatchId(e,t,i){let r=this.overlayByBatchId.get(i);return r!==void 0&&(r.forEach(s=>this.overlays=this.overlays.remove(s)),this.overlayByBatchId.delete(i)),k.resolve()}getOverlaysForCollection(e,t,i){let r=zi(),s=t.length+1,a=new $(t.child("")),o=this.overlays.getIteratorFrom(a);for(;o.hasNext();){let c=o.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>i&&r.set(c.getKey(),c)}return k.resolve(r)}getOverlaysForCollectionGroup(e,t,i,r){let s=new De((c,u)=>c-u),a=this.overlays.getIterator();for(;a.hasNext();){let u=a.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>i){let p=s.get(u.largestBatchId);p===null&&(p=zi(),s=s.insert(u.largestBatchId,p)),p.set(u.getKey(),u)}}let o=zi(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((m,p)=>o.set(m,p)),!(o.size()>=r)););return k.resolve(o)}saveOverlay(e,t,i){let r=this.overlays.get(i.key);if(r!==null){let a=this.overlayByBatchId.get(r.largestBatchId).delete(i.key);this.overlayByBatchId.set(r.largestBatchId,a)}this.overlays=this.overlays.insert(i.key,new ep(t,i));let s=this.overlayByBatchId.get(t);s===void 0&&(s=Z(),this.overlayByBatchId.set(t,s)),this.overlayByBatchId.set(t,s.add(i.key))}};var vp=class{constructor(){this.sessionToken=it.EMPTY_BYTE_STRING}getSessionToken(e){return k.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,k.resolve()}};var _a=class{constructor(){this.refsByKey=new nt(Le.compareByKey),this.refsByTarget=new nt(Le.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let i=new Le(e,t);this.refsByKey=this.refsByKey.add(i),this.refsByTarget=this.refsByTarget.add(i)}addReferences(e,t){e.forEach(i=>this.addReference(i,t))}removeReference(e,t){this.removeRef(new Le(e,t))}removeReferences(e,t){e.forEach(i=>this.removeReference(i,t))}removeReferencesForId(e){let t=new $(new Ae([])),i=new Le(t,e),r=new Le(t,e+1),s=[];return this.refsByTarget.forEachInRange([i,r],a=>{this.removeRef(a),s.push(a.key)}),s}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new $(new Ae([])),i=new Le(t,e),r=new Le(t,e+1),s=Z();return this.refsByTarget.forEachInRange([i,r],a=>{s=s.add(a.key)}),s}containsKey(e){let t=new Le(e,0),i=this.refsByKey.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}},Le=class{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return $.comparator(e.key,t.key)||se(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return se(e.targetOrBatchId,t.targetOrBatchId)||$.comparator(e.key,t.key)}};var _p=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new nt(Le.compareByKey)}checkEmpty(e){return k.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,r){let s=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new Xf(s,t,i,r);this.mutationQueue.push(a);for(let o of r)this.batchesByDocumentKey=this.batchesByDocumentKey.add(new Le(o.key,s)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return k.resolve(a)}lookupMutationBatch(e,t){return k.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let i=t+1,r=this.indexOfBatchId(i),s=r<0?0:r;return k.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return k.resolve(this.mutationQueue.length===0?lm:this.nextBatchId-1)}getAllMutationBatches(e){return k.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let i=new Le(t,0),r=new Le(t,Number.POSITIVE_INFINITY),s=[];return this.batchesByDocumentKey.forEachInRange([i,r],a=>{let o=this.findMutationBatch(a.targetOrBatchId);s.push(o)}),k.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new nt(se);return t.forEach(r=>{let s=new Le(r,0),a=new Le(r,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([s,a],o=>{i=i.add(o.targetOrBatchId)})}),k.resolve(this.findMutationBatches(i))}getAllMutationBatchesAffectingQuery(e,t){let i=t.path,r=i.length+1,s=i;$.isDocumentKey(s)||(s=s.child(""));let a=new Le(new $(s),0),o=new nt(se);return this.batchesByDocumentKey.forEachWhile(l=>{let c=l.key.path;return i.isPrefixOf(c)?(c.length===r&&(o=o.add(l.targetOrBatchId)),!0):!1},a),k.resolve(this.findMutationBatches(o))}findMutationBatches(e){let t=[];return e.forEach(i=>{let r=this.findMutationBatch(i);r!==null&&t.push(r)}),t}removeMutationBatch(e,t){let i=this.indexOfExistingBatchId(t.batchId,"removed");ue(i===0),this.mutationQueue.shift();let r=this.batchesByDocumentKey;return k.forEach(t.mutations,s=>{let a=new Le(s.key,t.batchId);return r=r.delete(a),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.batchesByDocumentKey=r})}removeCachedMutationKeys(e){}containsKey(e,t){let i=new Le(t,0),r=this.batchesByDocumentKey.firstAfterOrEqual(i);return k.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,k.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){if(this.mutationQueue.length===0)return 0;let t=this.mutationQueue[0].batchId;return e-t}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};function dM(){return new De($.comparator)}var Tp=class{constructor(e){this.sizer=e,this.docs=dM(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let i=t.key,r=this.docs.get(i),s=r?r.size:0,a=this.sizer(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let i=this.docs.get(t);return k.resolve(i?i.document.mutableCopy():Wt.newInvalidDocument(t))}getEntries(e,t){let i=Ln();return t.forEach(r=>{let s=this.docs.get(r);i=i.insert(r,s?s.document.mutableCopy():Wt.newInvalidDocument(r))}),k.resolve(i)}getDocumentsMatchingQuery(e,t,i,r){let s=Ln(),a=t.path,o=new $(a.child("")),l=this.docs.getIteratorFrom(o);for(;l.hasNext();){let{key:c,value:{document:u}}=l.getNext();if(!a.isPrefixOf(c.path))break;c.path.length>a.length+1||pO(fO(u),i)<=0||!r.has(u.key)&&!bc(t,u)||(s=s.insert(u.key,u.mutableCopy()))}return k.resolve(s)}getAllFromCollectionGroup(e,t,i,r){W()}forEachDocumentKey(e,t){return k.forEach(this.docs,i=>t(i))}newChangeBuffer(e){return new bp(this)}getSize(e){return k.resolve(this.size)}};function hM(n){return new Tp(n)}var bp=class extends fp{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((i,r)=>{r.isValidDocument()?t.push(this.documentCache.addEntry(e,r)):this.documentCache.removeEntry(i)}),k.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}};var Sp=class{constructor(e){this.persistence=e,this.targets=new Si(t=>fm(t),pm),this.lastRemoteSnapshotVersion=Q.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new _a,this.targetCount=0,this.targetIdGenerator=va.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((i,r)=>t(r)),k.resolve()}getLastRemoteSnapshotVersion(e){return k.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return k.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),k.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),k.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new va(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,k.resolve()}updateTargetData(e,t){return this.saveTargetData(t),k.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,k.resolve()}removeTargets(e,t,i){let r=0,s=[];return this.targets.forEach((a,o)=>{o.sequenceNumber<=t&&i.get(o.targetId)===null&&(this.targets.delete(a),s.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),k.waitFor(s).next(()=>r)}getTargetCount(e){return k.resolve(this.targetCount)}getTargetData(e,t){let i=this.targets.get(t)||null;return k.resolve(i)}addMatchingKeys(e,t,i){return this.references.addReferences(t,i),k.resolve()}removeMatchingKeys(e,t,i){this.references.removeReferences(t,i);let r=this.persistence.referenceDelegate,s=[];return r&&t.forEach(a=>{s.push(r.markPotentiallyOrphaned(e,a))}),k.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),k.resolve()}getMatchingKeysForTargetId(e,t){let i=this.references.referencesForId(t);return k.resolve(i)}containsKey(e,t){return k.resolve(this.references.containsKey(t))}};var fM="MemoryPersistence",Cp=class{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new ET(0),this._started=!1,this._started=!0,this.globalsCache=new vp,this.referenceDelegate=e(this),this.targetCache=new Sp(this);let i=r=>this.referenceDelegate.documentSize(r);this.indexManager=new dp,this.remoteDocumentCache=hM(i),this.serializer=new up(t),this.bundleCache=new gp(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new yp,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.mutationQueues[e.toKey()];return i||(i=new _p(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=i),i}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,i){V(fM,"Starting transaction:",e);let r=new Ep(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),i(r).next(s=>this.referenceDelegate.onTransactionCommitted(r).next(()=>s)).toPromise().then(s=>(r.raiseOnCommittedEvent(),s))}mutationQueuesContainKey(e,t){return k.or(Object.values(this.mutationQueues).map(i=>()=>i.containsKey(e,t)))}},Ep=class extends Mf{constructor(e){super(),this.currentSequenceNumber=e}},wp=class n{constructor(e){this.persistence=e,this.localViewReferences=new _a,this._orphanedDocuments=null}static factory(e){return new n(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw W()}addReference(e,t,i){return this.localViewReferences.addReference(i,t),this.orphanedDocuments.delete(i.toString()),k.resolve()}removeReference(e,t,i){return this.localViewReferences.removeReference(i,t),this.orphanedDocuments.add(i.toString()),k.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),k.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(s=>this.orphanedDocuments.add(s.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(a=>this.orphanedDocuments.add(a.toString()))}).next(()=>r.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return k.forEach(this.orphanedDocuments,r=>{let s=$.fromPath(r);return this.isReferenced(e,s).next(a=>{a||i.removeEntry(s,Q.min())})}).next(()=>(this._orphanedDocuments=null,i.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(i=>{i?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return k.or([()=>k.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}};var Uq=30*60*1e3;function pM(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}var vm="LocalStore",mM=5*60*1e6,Ip=class{constructor(e,t,i,r){this.persistence=e,this.queryEngine=t,this.serializer=r,this.targetDataByTarget=new De(se),this.targetIdByTarget=new Si(s=>fm(s),pm),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(i)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new mp(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}};function gM(n,e,t,i){return new Ip(n,e,t,i)}function Cb(n,e){return R(this,null,function*(){let t=K(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(a=>(s=a,t.initializeUserComponents(e),t.mutationQueue.getAllMutationBatches(r))).next(a=>{let o=[],l=[],c=Z();for(let u of s){o.push(u.batchId);for(let m of u.mutations)c=c.add(m.key)}for(let u of a){l.push(u.batchId);for(let m of u.mutations)c=c.add(m.key)}return t.localDocuments.getDocuments(r,c).next(u=>({affectedDocuments:u,removedBatchIds:o,addedBatchIds:l}))})})})}function yM(n,e){let t=K(n),i=Qe.now(),r=e.reduce((o,l)=>o.add(l.key),Z()),s,a;return t.persistence.runTransaction("Locally write mutations","readwrite",o=>{let l=Ln(),c=Z();return t.remoteDocuments.getEntries(o,r).next(u=>{l=u,l.forEach((m,p)=>{p.isValidDocument()||(c=c.add(m))})}).next(()=>t.localDocuments.getOverlayedDocuments(o,l)).next(u=>{s=u;let m=[];for(let p of e){let T=$k(p,s.get(p.key).overlayedDocument);T!=null&&m.push(new bn(p.key,T,HT(T.value.mapValue),Mn.exists(!0)))}return t.mutationQueue.addMutationBatch(o,i,m,e)}).next(u=>{a=u;let m=u.applyToLocalDocumentSet(s,c);return t.documentOverlayCache.saveOverlays(o,u.batchId,m)})}).then(()=>({batchId:a.batchId,changes:ib(s)}))}function vM(n,e){let t=K(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{let r=e.batch.keys(),s=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});return DM(t,i,e,s).next(()=>s.apply(i)).next(()=>t.mutationQueue.performConsistencyCheck(i)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(i,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,_M(e))).next(()=>t.localDocuments.getDocuments(i,r))})}function _M(n){let e=Z();for(let t=0;t<n.mutationResults.length;++t)n.mutationResults[t].transformResults.length>0&&(e=e.add(n.batch.mutations[t].key));return e}function TM(n,e){let t=K(n);return t.persistence.runTransaction("Reject batch","readwrite-primary",i=>{let r;return t.mutationQueue.lookupMutationBatch(i,e).next(s=>(ue(s!==null),r=s.keys(),t.mutationQueue.removeMutationBatch(i,s))).next(()=>t.mutationQueue.performConsistencyCheck(i)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(i,r,e)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,r)).next(()=>t.localDocuments.getDocuments(i,r))})}function Eb(n){let e=K(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.targetCache.getLastRemoteSnapshotVersion(t))}function bM(n,e){let t=K(n),i=e.snapshotVersion,r=t.targetDataByTarget;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let a=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});r=t.targetDataByTarget;let o=[];e.targetChanges.forEach((u,m)=>{let p=r.get(m);if(!p)return;o.push(t.targetCache.removeMatchingKeys(s,u.removedDocuments,m).next(()=>t.targetCache.addMatchingKeys(s,u.addedDocuments,m)));let T=p.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(m)!==null?T=T.withResumeToken(it.EMPTY_BYTE_STRING,Q.min()).withLastLimboFreeSnapshotVersion(Q.min()):u.resumeToken.approximateByteSize()>0&&(T=T.withResumeToken(u.resumeToken,i)),r=r.insert(m,T),CM(p,T,u)&&o.push(t.targetCache.updateTargetData(s,T))});let l=Ln(),c=Z();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&o.push(t.persistence.referenceDelegate.updateLimboDocument(s,u))}),o.push(SM(s,a,e.documentUpdates).next(u=>{l=u.changedDocuments,c=u.existenceChangedKeys})),!i.isEqual(Q.min())){let u=t.targetCache.getLastRemoteSnapshotVersion(s).next(m=>t.targetCache.setTargetsMetadata(s,s.currentSequenceNumber,i));o.push(u)}return k.waitFor(o).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,c)).next(()=>l)}).then(s=>(t.targetDataByTarget=r,s))}function SM(n,e,t){let i=Z(),r=Z();return t.forEach(s=>i=i.add(s)),e.getEntries(n,i).next(s=>{let a=Ln();return t.forEach((o,l)=>{let c=s.get(o);l.isFoundDocument()!==c.isFoundDocument()&&(r=r.add(o)),l.isNoDocument()&&l.version.isEqual(Q.min())?(e.removeEntry(o,l.readTime),a=a.insert(o,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),a=a.insert(o,l)):V(vm,"Ignoring outdated watch update for ",o,". Current version:",c.version," Watch version:",l.version)}),{changedDocuments:a,existenceChangedKeys:r}})}function CM(n,e,t){return n.resumeToken.approximateByteSize()===0||e.snapshotVersion.toMicroseconds()-n.snapshotVersion.toMicroseconds()>=mM?!0:t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size>0}function EM(n,e){return R(this,null,function*(){let t=K(n);try{yield t.persistence.runTransaction("notifyLocalViewChanges","readwrite",i=>k.forEach(e,r=>k.forEach(r.addedKeys,s=>t.persistence.referenceDelegate.addReference(i,r.targetId,s)).next(()=>k.forEach(r.removedKeys,s=>t.persistence.referenceDelegate.removeReference(i,r.targetId,s)))))}catch(i){if(wa(i))V(vm,"Failed to update sequence numbers: "+i);else throw i}for(let i of e){let r=i.targetId;if(!i.fromCache){let s=t.targetDataByTarget.get(r),a=s.snapshotVersion,o=s.withLastLimboFreeSnapshotVersion(a);t.targetDataByTarget=t.targetDataByTarget.insert(r,o)}}})}function wM(n,e){let t=K(n);return t.persistence.runTransaction("Get next mutation batch","readonly",i=>(e===void 0&&(e=lm),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e)))}function IM(n,e){let t=K(n);return t.persistence.runTransaction("Allocate target","readwrite",i=>{let r;return t.targetCache.getTargetData(i,e).next(s=>s?(r=s,k.resolve(r)):t.targetCache.allocateTargetId(i).next(a=>(r=new ya(e,a,"TargetPurposeListen",i.currentSequenceNumber),t.targetCache.addTargetData(i,r).next(()=>r))))}).then(i=>{let r=t.targetDataByTarget.get(i.targetId);return(r===null||i.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.targetDataByTarget=t.targetDataByTarget.insert(i.targetId,i),t.targetIdByTarget.set(e,i.targetId)),i})}function AM(n,e,t){let i=K(n),r=i.targetIdByTarget.get(t);return r!==void 0?k.resolve(i.targetDataByTarget.get(r)):i.targetCache.getTargetData(e,t)}function Ap(n,e,t){return R(this,null,function*(){let i=K(n),r=i.targetDataByTarget.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield i.persistence.runTransaction("Release target",s,a=>i.persistence.referenceDelegate.removeTarget(a,r)))}catch(a){if(wa(a))V(vm,`Failed to update sequence numbers for target ${e}: ${a}`);else throw a}i.targetDataByTarget=i.targetDataByTarget.remove(e),i.targetIdByTarget.delete(r.target)})}function wb(n,e,t){let i=K(n),r=Q.min(),s=Z();return i.persistence.runTransaction("Execute query","readwrite",a=>AM(i,a,vn(e)).next(o=>{if(o)return r=o.lastLimboFreeSnapshotVersion,i.targetCache.getMatchingKeysForTargetId(a,o.targetId).next(l=>{s=l})}).next(()=>i.queryEngine.getDocumentsMatchingQuery(a,e,t?r:Q.min(),t?s:Z())).next(o=>(RM(i,Ak(e),o),{documents:o,remoteKeys:s})))}function DM(n,e,t,i){let r=t.batch,s=r.keys(),a=k.resolve();return s.forEach(o=>{a=a.next(()=>i.getEntry(e,o)).next(l=>{let c=t.docVersions.get(o);ue(c!==null),l.version.compareTo(c)<0&&(r.applyToRemoteDocument(l,t),l.isValidDocument()&&(l.setReadTime(t.commitVersion),i.addEntry(l)))})}),a.next(()=>n.mutationQueue.removeMutationBatch(e,r))}function RM(n,e,t){let i=n.collectionGroupReadTime.get(e)||Q.min();t.forEach((r,s)=>{s.readTime.compareTo(i)>0&&(i=s.readTime)}),n.collectionGroupReadTime.set(e,i)}var Dp=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var xM=100;function OM(){return Ym()?8:gO(Qm())>0?6:4}var Rp=class{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=xM,this.relativeIndexReadCostPerDocument=OM()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,i,r){let s={result:null};return this.performQueryUsingIndex(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.performQueryUsingRemoteKeys(e,t,r,i).next(a=>{s.result=a})}).next(()=>{if(s.result)return;let a=new Dp;return this.executeFullCollectionScan(e,t,a).next(o=>{if(s.result=o,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,a,o.size)})}).next(()=>s.result)}createCacheIndexes(e,t,i,r){return i.documentReadCount<this.indexAutoCreationMinCollectionSize?(ra()<=Cn.DEBUG&&V("QueryEngine","SDK will not create cache indexes for query:",Jr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),k.resolve()):(ra()<=Cn.DEBUG&&V("QueryEngine","Query:",Jr(t),"scans",i.documentReadCount,"local documents and returns",r,"documents as results."),i.documentReadCount>this.relativeIndexReadCostPerDocument*r?(ra()<=Cn.DEBUG&&V("QueryEngine","The SDK decides to create cache indexes for query:",Jr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,vn(t))):k.resolve())}performQueryUsingIndex(e,t){if(Z_(t))return k.resolve(null);let i=vn(t);return this.indexManager.getIndexType(e,i).next(r=>r===0?null:(t.limit!==null&&r===1&&(t=Qf(t,null,"F"),i=vn(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next(s=>{let a=Z(...s);return this.localDocumentsView.getDocuments(e,a).next(o=>this.indexManager.getMinOffset(e,i).next(l=>{let c=this.applyQuery(t,o);return this.needsRefill(t,c,a,l.readTime)?this.performQueryUsingIndex(e,Qf(t,null,"F")):this.appendRemainingResults(e,c,t,l)}))})))}performQueryUsingRemoteKeys(e,t,i,r){return Z_(t)||r.isEqual(Q.min())?k.resolve(null):this.localDocumentsView.getDocuments(e,i).next(s=>{let a=this.applyQuery(t,s);return this.needsRefill(t,a,i,r)?k.resolve(null):(ra()<=Cn.DEBUG&&V("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Jr(t)),this.appendRemainingResults(e,a,t,hO(r,ca)).next(o=>o))})}applyQuery(e,t){let i=new nt(tb(e));return t.forEach((r,s)=>{bc(e,s)&&(i=i.add(s))}),i}needsRefill(e,t,i,r){if(e.limit===null)return!1;if(i.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return s?s.hasPendingWrites||s.version.compareTo(r)>0:!1}executeFullCollectionScan(e,t,i){return ra()<=Cn.DEBUG&&V("QueryEngine","Using full collection scan to execute query:",Jr(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,Hi.min(),i)}appendRemainingResults(e,t,i,r){return this.localDocumentsView.getDocumentsMatchingQuery(e,i,r).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}};var nc=class{constructor(){this.activeTargetIds=Pk()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var xp=class{constructor(){this.localState=new nc,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e,t=!0){return t&&this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,i){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new nc,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Op=class{addCallback(e){}shutdown(){}};var kp=class{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onConnected(e){this.wrappedOnConnected=e}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}};var Ul=null;function kM(){return 268435456+Math.round(2147483648*Math.random())}function Ef(){return Ul===null?Ul=kM():Ul++,"0x"+Ul.toString(16)}function NM(n){return new Promise((e,t)=>{n((i,r)=>{i?t(i):e(r)})})}var MM="1.9.1",ct="GrpcConnection",PM=`gl-node/${process.versions.node} fire/${ys} grpc/${MM}`;function wf(n,e,t,i){ue(e===null||e.type==="OAuth");let r=new $i.Metadata;return e&&e.headers.forEach((s,a)=>r.set(a,s)),t&&t.headers.forEach((s,a)=>r.set(a,s)),i&&r.set("X-Firebase-GMPID",i),r.set("X-Goog-Api-Client",PM),r.set("Google-Cloud-Resource-Prefix",n),r.set("x-goog-request-params",n),r}var Np=class{constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}get shouldResourcePathBeIncludedInRequest(){return!0}ensureActiveStub(){if(!this.cachedStub){V(ct,"Creating Firestore stub.");let e=this.databaseInfo.ssl?$i.credentials.createSsl():$i.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,i,r,s){let a=Ef(),o=this.ensureActiveStub(),l=wf(this.databasePath,r,s,this.databaseInfo.appId),c=Object.assign({database:this.databasePath},i);return NM(u=>(V(ct,`RPC '${e}' ${a} invoked with request:`,i),o[e](c,l,(m,p)=>{m?(V(ct,`RPC '${e}' ${a} failed with error:`,m),u(new z(Gl(m.code),m.message))):(V(ct,`RPC '${e}' ${a} completed with response:`,p),u(void 0,p))})))}invokeStreamingRPC(e,t,i,r,s,a){let o=Ef(),l=[],c=new yn;V(ct,`RPC '${e}' ${o} invoked (streaming) with request:`,i);let u=this.ensureActiveStub(),m=wf(this.databasePath,r,s,this.databaseInfo.appId),p=Object.assign(Object.assign({},i),{database:this.databasePath}),T=u[e](p,m),S=!1;return T.on("data",E=>{V(ct,`RPC ${e} ${o} received result:`,E),l.push(E),a!==void 0&&l.length===a&&(S=!0,c.resolve(l))}),T.on("end",()=>{V(ct,`RPC '${e}' ${o} completed.`),S||(S=!0,c.resolve(l))}),T.on("error",E=>{V(ct,`RPC '${e}' ${o} failed with error:`,E);let C=Gl(E.code);c.reject(new z(C,E.message))}),c.promise}openStream(e,t,i){let r=Ef(),s=this.ensureActiveStub(),a=wf(this.databasePath,t,i,this.databaseInfo.appId),o=s[e](a),l=!1,c=p=>{l||(l=!0,u.callOnClose(p),o.end())},u=new kp({sendFn:p=>{if(l)V(ct,`RPC '${e}' stream ${r} not sending because gRPC stream is closed:`,p);else{V(ct,`RPC '${e}' stream ${r} sending:`,p);try{o.write(p)}catch(T){throw jt("Failure sending:",p),jt("Error:",T),T}}},closeFn:()=>{V(ct,`RPC '${e}' stream ${r} closed locally via close().`),c()}}),m=!1;return o.on("data",p=>{l||(V(ct,`RPC '${e}' stream ${r} received:`,p),m||(u.callOnConnected(),m=!0),u.callOnMessage(p))}),o.on("end",()=>{V(ct,`RPC '${e}' stream ${r} ended.`),c()}),o.on("error",p=>{if(!l){ts(ct,`RPC '${e}' stream ${r} error. Code:`,p.code,"Message:",p.message);let T=Gl(p.code);c(new z(T,p.message))}}),V(ct,`Opening RPC '${e}' stream ${r} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}},Ib={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}},LM={nested:Ib},FM=Object.freeze({__proto__:null,nested:Ib,default:LM});var BM={longs:String,enums:String,defaults:!0,oneofs:!1};function qM(){let n=CT.fromJSON(FM,BM);return $i.loadPackageDefinition(n)}function VM(n){let e=qM();return new Np(e,n)}function UM(){return new Op}function Cc(n){return new sp(n,!1)}var zM="ExponentialBackoff",GM=1e3,$M=1.5,jM=60*1e3,ic=class{constructor(e,t,i=GM,r=$M,s=jM){this.queue=e,this.timerId=t,this.initialDelayMs=i,this.backoffFactor=r,this.maxDelayMs=s,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),i=Math.max(0,Date.now()-this.lastAttemptTime),r=Math.max(0,t-i);r>0&&V(zM,`Backing off for ${r} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,r,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){this.timerPromise!==null&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){this.timerPromise!==null&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}};var lT="PersistentStream",WM=60*1e3,HM=10*1e3,rc=class{constructor(e,t,i,r,s,a,o,l){this.queue=e,this.idleTimerId=i,this.healthTimerId=r,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=o,this.listener=l,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new ic(e,t)}isStarted(){return this.state===1||this.state===5||this.isOpen()}isOpen(){return this.state===2||this.state===3}start(){if(this.responseCount=0,this.state===4){this.performBackoff();return}this.auth()}stop(){return R(this,null,function*(){this.isStarted()&&(yield this.close(0))})}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&this.idleTimer===null&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,WM,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}handleIdleCloseTimer(){return R(this,null,function*(){if(this.isOpen())return this.close(0)})}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}close(e,t){return R(this,null,function*(){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,e!==4?this.backoff.reset():t&&t.code===x.RESOURCE_EXHAUSTED?(jt(t.toString()),jt("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===x.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.onClose(t)})}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,r])=>{this.closeCount===t&&this.startStream(i,r)},i=>{e(()=>{let r=new z(x.UNKNOWN,"Fetching auth token failed: "+i.message);return this.handleStreamClose(r)})})}startStream(e,t){let i=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onConnected(()=>{i(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{i(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,HM,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(r=>{i(()=>this.handleStreamClose(r))}),this.stream.onMessage(r=>{i(()=>++this.responseCount===1?this.onFirst(r):this.onNext(r))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(()=>R(this,null,function*(){this.state=0,this.start()}))}handleStreamClose(e){return V(lT,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(V(lT,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Mp=class extends rc{constructor(e,t,i,r,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,r,a),this.serializer=s}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onFirst(e){return this.onNext(e)}onNext(e){this.backoff.reset();let t=fN(this.serializer,e),i=mN(e);return this.listener.onWatchChange(t,i)}watch(e){let t={};t.database=cp(this.serializer),t.addTarget=IN(this.serializer,e);let i=EN(this.serializer,e);i&&(t.labels=i),this.sendRequest(t)}unwatch(e){let t={};t.database=cp(this.serializer),t.removeTarget=e,this.sendRequest(t)}},Pp=class extends rc{constructor(e,t,i,r,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,r,a),this.serializer=s}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onFirst(e){return ue(!!e.streamToken),this.lastStreamToken=e.streamToken,ue(!e.writeResults||e.writeResults.length===0),this.listener.onHandshakeComplete()}onNext(e){ue(!!e.streamToken),this.lastStreamToken=e.streamToken,this.backoff.reset();let t=_N(e.writeResults,e.commitTime),i=_n(e.commitTime);return this.listener.onMutationResult(i,t)}writeHandshake(){let e={};e.database=cp(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(i=>gN(this.serializer,i))};this.sendRequest(t)}};var Lp=class{},Fp=class extends Lp{constructor(e,t,i,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.serializer=r,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new z(x.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,i,r){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.invokeRPC(e,op(t,i),r,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new z(x.UNKNOWN,s.toString())})}invokeStreamingRPC(e,t,i,r,s){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,o])=>this.connection.invokeStreamingRPC(e,op(t,i),r,a,o,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new z(x.UNKNOWN,a.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}};function KM(n,e,t,i){return new Fp(n,e,t,i)}function QM(n,e,t){let i=K(n);return i.verifyInitialized(),new Pp(e,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,t)}function YM(n,e,t){let i=K(n);return i.verifyInitialized(),new Mp(e,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,t)}var JM="OnlineStateTracker",cT=1,uT=10*1e3,Bp=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){this.watchStreamFailures===0&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",uT,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${uT/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){this.state==="Online"?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=cT&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${cT} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,e==="Online"&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(jt(t),this.shouldWarnClientIsOffline=!1):V(JM,t)}clearOnlineStateTimer(){this.onlineStateTimer!==null&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}};var Xi="RemoteStore",XM=10,qp=class{constructor(e,t,i,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=s,this.connectivityMonitor.addCallback(a=>{i.enqueueAndForget(()=>R(this,null,function*(){tr(this)&&(V(Xi,"Restarting streams for network reachability change."),yield pP(this))}))}),this.onlineStateTracker=new Bp(i,r)}};function ZM(n,e,t,i,r){return new qp(n,e,t,i,r)}function Ec(n){return R(this,null,function*(){if(tr(n))for(let e of n.onNetworkStatusChange)yield e(!0)})}function Ia(n){return R(this,null,function*(){for(let e of n.onNetworkStatusChange)yield e(!1)})}function eP(n){return R(this,null,function*(){let e=K(n);V(Xi,"RemoteStore shutting down."),e.offlineCauses.add(5),yield Ia(e),e.connectivityMonitor.shutdown(),e.onlineStateTracker.set("Unknown")})}function Ab(n,e){let t=K(n);t.listenTargets.has(e.targetId)||(t.listenTargets.set(e.targetId,e),Sm(t)?bm(t):vs(t).isOpen()&&Tm(t,e))}function _m(n,e){let t=K(n),i=vs(t);t.listenTargets.delete(e),i.isOpen()&&Db(t,e),t.listenTargets.size===0&&(i.isOpen()?i.markIdle():tr(t)&&t.onlineStateTracker.set("Unknown"))}function Tm(n,e){if(n.watchChangeAggregator.recordPendingTargetRequest(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Q.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}vs(n).watch(e)}function Db(n,e){n.watchChangeAggregator.recordPendingTargetRequest(e),vs(n).unwatch(e)}function bm(n){n.watchChangeAggregator=new rp({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),getTargetDataForTarget:e=>n.listenTargets.get(e)||null,getDatabaseId:()=>n.datastore.serializer.databaseId}),vs(n).start(),n.onlineStateTracker.handleWatchStreamStart()}function Sm(n){return tr(n)&&!vs(n).isStarted()&&n.listenTargets.size>0}function tr(n){return K(n).offlineCauses.size===0}function Rb(n){n.watchChangeAggregator=void 0}function tP(n){return R(this,null,function*(){n.onlineStateTracker.set("Online")})}function nP(n){return R(this,null,function*(){n.listenTargets.forEach((e,t)=>{Tm(n,e)})})}function iP(n,e){return R(this,null,function*(){Rb(n),Sm(n)?(n.onlineStateTracker.handleWatchStreamFailure(e),bm(n)):n.onlineStateTracker.set("Unknown")})}function rP(n,e,t){return R(this,null,function*(){if(n.onlineStateTracker.set("Online"),e instanceof Xl&&e.state===2&&e.cause){try{yield aP(n,e)}catch(i){V(Xi,"Failed to remove targets %s: %s ",e.targetIds.join(","),i),yield sc(n,i)}return}if(e instanceof ns?n.watchChangeAggregator.handleDocumentChange(e):e instanceof Jl?n.watchChangeAggregator.handleExistenceFilter(e):n.watchChangeAggregator.handleTargetChange(e),!t.isEqual(Q.min()))try{let i=yield Eb(n.localStore);t.compareTo(i)>=0&&(yield sP(n,t))}catch(i){V(Xi,"Failed to raise snapshot:",i),yield sc(n,i)}})}function sc(n,e,t){return R(this,null,function*(){if(wa(e))n.offlineCauses.add(1),yield Ia(n),n.onlineStateTracker.set("Offline"),t||(t=()=>Eb(n.localStore)),n.asyncQueue.enqueueRetryable(()=>R(this,null,function*(){V(Xi,"Retrying IndexedDB access"),yield t(),n.offlineCauses.delete(1),yield Ec(n)}));else throw e})}function xb(n,e){return e().catch(t=>sc(n,t,e))}function sP(n,e){let t=n.watchChangeAggregator.createRemoteEvent(e);return t.targetChanges.forEach((i,r)=>{if(i.resumeToken.approximateByteSize()>0){let s=n.listenTargets.get(r);s&&n.listenTargets.set(r,s.withResumeToken(i.resumeToken,e))}}),t.targetMismatches.forEach((i,r)=>{let s=n.listenTargets.get(i);if(!s)return;n.listenTargets.set(i,s.withResumeToken(it.EMPTY_BYTE_STRING,s.snapshotVersion)),Db(n,i);let a=new ya(s.target,i,r,s.sequenceNumber);Tm(n,a)}),n.remoteSyncer.applyRemoteEvent(t)}function aP(n,e){return R(this,null,function*(){let t=e.cause;for(let i of e.targetIds)n.listenTargets.has(i)&&(yield n.remoteSyncer.rejectListen(i,t),n.listenTargets.delete(i),n.watchChangeAggregator.removeTarget(i))})}function wc(n){return R(this,null,function*(){let e=K(n),t=wi(e),i=e.writePipeline.length>0?e.writePipeline[e.writePipeline.length-1].batchId:lm;for(;oP(e);)try{let r=yield wM(e.localStore,i);if(r===null){e.writePipeline.length===0&&t.markIdle();break}else i=r.batchId,lP(e,r)}catch(r){yield sc(e,r)}Ob(e)&&kb(e)})}function oP(n){return tr(n)&&n.writePipeline.length<XM}function lP(n,e){n.writePipeline.push(e);let t=wi(n);t.isOpen()&&t.handshakeComplete&&t.writeMutations(e.mutations)}function Ob(n){return tr(n)&&!wi(n).isStarted()&&n.writePipeline.length>0}function kb(n){wi(n).start()}function cP(n){return R(this,null,function*(){wi(n).writeHandshake()})}function uP(n){return R(this,null,function*(){let e=wi(n);for(let t of n.writePipeline)e.writeMutations(t.mutations)})}function dP(n,e,t){return R(this,null,function*(){let i=n.writePipeline.shift(),r=Zf.from(i,e,t);yield xb(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),yield wc(n)})}function hP(n,e){return R(this,null,function*(){e&&wi(n).handshakeComplete&&(yield fP(n,e)),Ob(n)&&kb(n)})}function fP(n,e){return R(this,null,function*(){if(Xk(e.code)){let t=n.writePipeline.shift();wi(n).inhibitBackoff(),yield xb(n,()=>n.remoteSyncer.rejectFailedWrite(t.batchId,e)),yield wc(n)}})}function pP(n){return R(this,null,function*(){let e=K(n);e.offlineCauses.add(4),yield Ia(e),e.onlineStateTracker.set("Unknown"),e.offlineCauses.delete(4),yield Ec(e)})}function dT(n,e){return R(this,null,function*(){let t=K(n);t.asyncQueue.verifyOperationInProgress(),V(Xi,"RemoteStore received new credentials");let i=tr(t);t.offlineCauses.add(3),yield Ia(t),i&&t.onlineStateTracker.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.offlineCauses.delete(3),yield Ec(t)})}function mP(n,e){return R(this,null,function*(){let t=K(n);e?(t.offlineCauses.delete(2),yield Ec(t)):e||(t.offlineCauses.add(2),yield Ia(t),t.onlineStateTracker.set("Unknown"))})}function vs(n){return n.watchStream||(n.watchStream=YM(n.datastore,n.asyncQueue,{onConnected:tP.bind(null,n),onOpen:nP.bind(null,n),onClose:iP.bind(null,n),onWatchChange:rP.bind(null,n)}),n.onNetworkStatusChange.push(e=>R(this,null,function*(){e?(n.watchStream.inhibitBackoff(),Sm(n)?bm(n):n.onlineStateTracker.set("Unknown")):(yield n.watchStream.stop(),Rb(n))}))),n.watchStream}function wi(n){return n.writeStream||(n.writeStream=QM(n.datastore,n.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:cP.bind(null,n),onClose:hP.bind(null,n),onHandshakeComplete:uP.bind(null,n),onMutationResult:dP.bind(null,n)}),n.onNetworkStatusChange.push(e=>R(this,null,function*(){e?(n.writeStream.inhibitBackoff(),yield wc(n)):(yield n.writeStream.stop(),n.writePipeline.length>0&&(V(Xi,`Stopping write stream with ${n.writePipeline.length} pending writes`),n.writePipeline=[]))}))),n.writeStream}var gP="AsyncQueue",Vp=class n{constructor(e,t,i,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=r,this.removalCallback=s,this.deferred=new yn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,r,s){let a=Date.now()+i,o=new n(e,t,a,r,s);return o.start(i),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new z(x.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Cm(n,e){if(jt(gP,`${e}: ${n}`),wa(n))return new z(x.UNAVAILABLE,`${e}: ${n}`);throw n}var ac=class n{constructor(e){e?this.comparator=(t,i)=>e(t,i)||$.comparator(t.key,i.key):this.comparator=(t,i)=>$.comparator(t.key,i.key),this.keyedMap=sa(),this.sortedSet=new De(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,i)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){let r=t.getNext().key,s=i.getNext().key;if(!r.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let i=new n;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}};var oc=class{constructor(){this.changeMap=new De($.comparator)}track(e){let t=e.doc.key,i=this.changeMap.get(t);if(!i){this.changeMap=this.changeMap.insert(t,e);return}e.type!==0&&i.type===3?this.changeMap=this.changeMap.insert(t,e):e.type===3&&i.type!==1?this.changeMap=this.changeMap.insert(t,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.changeMap=this.changeMap.remove(t):e.type===1&&i.type===2?this.changeMap=this.changeMap.insert(t,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):W()}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,i)=>{e.push(i)}),e}},fs=class n{constructor(e,t,i,r,s,a,o,l,c){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=r,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=o,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,i,r,s){let a=[];return t.forEach(o=>{a.push({type:0,doc:o})}),new n(e,t,ac.emptySet(t),a,i,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!Tc(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==i[r].type||!t[r].doc.isEqual(i[r].doc))return!1;return!0}};var Up=class{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}};function yP(){return new zp}var zp=class{constructor(){this.queries=Nb(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){CP(this,new z(x.ABORTED,"Firestore shutting down"))}};function Nb(){return new Si(n=>eb(n),Tc)}function vP(n,e){return R(this,null,function*(){let t=K(n),i=3,r=e.query,s=t.queries.get(r);s?!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(i=2):(s=new Up,i=e.listensToRemoteStore()?0:1);try{switch(i){case 0:s.viewSnap=yield t.onListen(r,!0);break;case 1:s.viewSnap=yield t.onListen(r,!1);break;case 2:yield t.onFirstRemoteStoreListen(r);break;default:break}}catch(a){let o=Cm(a,`Initialization of query '${Jr(e.query)}' failed`);e.onError(o);return}t.queries.set(r,s),s.listeners.push(e),e.applyOnlineStateChange(t.onlineState),s.viewSnap&&e.onViewSnapshot(s.viewSnap)&&Em(t)})}function _P(n,e){return R(this,null,function*(){let t=K(n),i=e.query,r=3,s=t.queries.get(i);if(s){let a=s.listeners.indexOf(e);a>=0&&(s.listeners.splice(a,1),s.listeners.length===0?r=e.listensToRemoteStore()?0:1:!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(r=2))}switch(r){case 0:return t.queries.delete(i),t.onUnlisten(i,!0);case 1:return t.queries.delete(i),t.onUnlisten(i,!1);case 2:return t.onLastRemoteStoreUnlisten(i);default:return}})}function TP(n,e){let t=K(n),i=!1;for(let r of e){let s=r.query,a=t.queries.get(s);if(a){for(let o of a.listeners)o.onViewSnapshot(r)&&(i=!0);a.viewSnap=r}}i&&Em(t)}function bP(n,e,t){let i=K(n),r=i.queries.get(e);if(r)for(let s of r.listeners)s.onError(t);i.queries.delete(e)}function SP(n,e){let t=K(n);t.onlineState=e;let i=!1;t.queries.forEach((r,s)=>{for(let a of s.listeners)a.applyOnlineStateChange(e)&&(i=!0)}),i&&Em(t)}function CP(n,e){let t=K(n),i=t.queries;t.queries=Nb(),i.forEach((r,s)=>{for(let a of s.listeners)a.onError(e)})}function Em(n){n.snapshotsInSyncListeners.forEach(e=>{e.next()})}var Mb=function(n){return n.Default="default",n.Cache="cache",n}(Mb||{}),Gp=class{constructor(e,t,i){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=i||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let i=[];for(let r of e.docChanges)r.type!==3&&i.push(r);e=new fs(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;let i=t!=="Offline";return this.options.waitForSyncWhenOnline&&i?!1:!e.docs.isEmpty()||e.hasCachedResults||t==="Offline"}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return e.syncStateChanged||t?this.options.includeMetadataChanges===!0:!1}raiseInitialEvent(e){e=fs.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==Mb.Cache}};var $p=class n{constructor(e,t,i,r){this.targetId=e,this.fromCache=t,this.addedKeys=i,this.removedKeys=r}static fromSnapshot(e,t){let i=Z(),r=Z();for(let s of t.docChanges)switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:r=r.add(s.doc.key);break}return new n(e,t.fromCache,i,r)}};var lc=class{constructor(e){this.key=e}},cc=class{constructor(e){this.key=e}},jp=class{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=Z(),this.mutatedKeys=Z(),this.docComparator=tb(e),this.documentSet=new ac(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let i=t?t.changeSet:new oc,r=t?t.documentSet:this.documentSet,s=t?t.mutatedKeys:this.mutatedKeys,a=r,o=!1,l=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,c=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((u,m)=>{let p=r.get(u),T=bc(this.query,m)?m:null,S=p?this.mutatedKeys.has(p.key):!1,E=T?T.hasLocalMutations||this.mutatedKeys.has(T.key)&&T.hasCommittedMutations:!1,C=!1;p&&T?p.data.isEqual(T.data)?S!==E&&(i.track({type:3,doc:T}),C=!0):this.shouldWaitForSyncedDocument(p,T)||(i.track({type:2,doc:T}),C=!0,(l&&this.docComparator(T,l)>0||c&&this.docComparator(T,c)<0)&&(o=!0)):!p&&T?(i.track({type:0,doc:T}),C=!0):p&&!T&&(i.track({type:1,doc:p}),C=!0,(l||c)&&(o=!0)),C&&(T?(a=a.add(T),E?s=s.add(u):s=s.delete(u)):(a=a.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let u=this.query.limitType==="F"?a.last():a.first();a=a.delete(u.key),s=s.delete(u.key),i.track({type:1,doc:u})}return{documentSet:a,changeSet:i,needsRefill:o,mutatedKeys:s}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i,r){let s=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let a=e.changeSet.getChanges();a.sort((m,p)=>EP(m.type,p.type)||this.docComparator(m.doc,p.doc)),this.applyTargetChange(i),r=r??!1;let o=t&&!r?this.updateLimboDocuments():[],c=this.limboDocuments.size===0&&this.current&&!r?1:0,u=c!==this.syncState;return this.syncState=c,a.length===0&&!u?{limboChanges:o}:{snapshot:new fs(this.query,e.documentSet,s,a,e.mutatedKeys,c===0,u,!1,i?i.resumeToken.approximateByteSize()>0:!1),limboChanges:o}}applyOnlineStateChange(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new oc,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!(this._syncedDocuments.has(e)||!this.documentSet.has(e)||this.documentSet.get(e).hasLocalMutations)}applyTargetChange(e){e&&(e.addedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.delete(t)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=Z(),this.documentSet.forEach(i=>{this.shouldBeInLimbo(i.key)&&(this.limboDocuments=this.limboDocuments.add(i.key))});let t=[];return e.forEach(i=>{this.limboDocuments.has(i)||t.push(new cc(i))}),this.limboDocuments.forEach(i=>{e.has(i)||t.push(new lc(i))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=Z();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return fs.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===0,this.hasCachedResults)}};function EP(n,e){let t=i=>{switch(i){case 0:return 1;case 2:return 2;case 3:return 2;case 1:return 0;default:return W()}};return t(n)-t(e)}var wm="SyncEngine",Wp=class{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}},Hp=class{constructor(e){this.key=e,this.receivedDocument=!1}},Kp=class{constructor(e,t,i,r,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.syncEngineListener={},this.queryViewsByQuery=new Si(o=>eb(o),Tc),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new De($.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new _a,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=va.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return this._isPrimaryClient===!0}};function wP(n,e,t,i,r,s,a){let o=new Kp(n,e,t,i,r,s);return a&&(o._isPrimaryClient=!0),o}function IP(n,e,t=!0){return R(this,null,function*(){let i=Ub(n),r,s=i.queryViewsByQuery.get(e);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.computeInitialSnapshot()):r=yield Pb(i,e,t,!0),r})}function AP(n,e){return R(this,null,function*(){let t=Ub(n);yield Pb(t,e,!0,!1)})}function Pb(n,e,t,i){return R(this,null,function*(){let r=yield IM(n.localStore,vn(e)),s=r.targetId,a=n.sharedClientState.addLocalQueryTarget(s,t),o;return i&&(o=yield DP(n,e,s,a==="current",r.resumeToken)),n.isPrimaryClient&&t&&Ab(n.remoteStore,r),o})}function DP(n,e,t,i,r){return R(this,null,function*(){n.applyDocChanges=(m,p,T)=>BP(n,m,p,T);let s=yield wb(n.localStore,e,!0),a=new jp(e,s.remoteKeys),o=a.computeDocChanges(s.documents),l=ga.createSynthesizedTargetChangeForCurrentChange(t,i&&n.onlineState!=="Offline",r),c=a.applyChanges(o,n.isPrimaryClient,l);Vb(n,t,c.limboChanges);let u=new Wp(e,t,a);return n.queryViewsByQuery.set(e,u),n.queriesByTarget.has(t)?n.queriesByTarget.get(t).push(e):n.queriesByTarget.set(t,[e]),c.snapshot})}function RP(n,e,t){return R(this,null,function*(){let i=K(n),r=i.queryViewsByQuery.get(e),s=i.queriesByTarget.get(r.targetId);if(s.length>1){i.queriesByTarget.set(r.targetId,s.filter(a=>!Tc(a,e))),i.queryViewsByQuery.delete(e);return}i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(r.targetId),i.sharedClientState.isActiveQueryTarget(r.targetId)||(yield Ap(i.localStore,r.targetId,!1).then(()=>{i.sharedClientState.clearQueryState(r.targetId),t&&_m(i.remoteStore,r.targetId),Qp(i,r.targetId)}).catch(Ea))):(Qp(i,r.targetId),yield Ap(i.localStore,r.targetId,!0))})}function xP(n,e){return R(this,null,function*(){let t=K(n),i=t.queryViewsByQuery.get(e),r=t.queriesByTarget.get(i.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(i.targetId),_m(t.remoteStore,i.targetId))})}function OP(n,e,t){return R(this,null,function*(){let i=UP(n);try{let r=yield yM(i.localStore,e);i.sharedClientState.addPendingMutation(r.batchId),LP(i,r.batchId,t),yield Aa(i,r.changes),yield wc(i.remoteStore)}catch(r){let s=Cm(r,"Failed to persist write");t.reject(s)}})}function Lb(n,e){return R(this,null,function*(){let t=K(n);try{let i=yield bM(t.localStore,e);e.targetChanges.forEach((r,s)=>{let a=t.activeLimboResolutionsByTarget.get(s);a&&(ue(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1),r.addedDocuments.size>0?a.receivedDocument=!0:r.modifiedDocuments.size>0?ue(a.receivedDocument):r.removedDocuments.size>0&&(ue(a.receivedDocument),a.receivedDocument=!1))}),yield Aa(t,i,e)}catch(i){yield Ea(i)}})}function hT(n,e,t){let i=K(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){let r=[];i.queryViewsByQuery.forEach((s,a)=>{let o=a.view.applyOnlineStateChange(e);o.snapshot&&r.push(o.snapshot)}),SP(i.eventManager,e),r.length&&i.syncEngineListener.onWatchChange(r),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}function kP(n,e,t){return R(this,null,function*(){let i=K(n);i.sharedClientState.updateQueryState(e,"rejected",t);let r=i.activeLimboResolutionsByTarget.get(e),s=r&&r.key;if(s){let a=new De($.comparator);a=a.insert(s,Wt.newNoDocument(s,Q.min()));let o=Z().add(s),l=new Yl(Q.min(),new Map,new De(se),a,o);yield Lb(i,l),i.activeLimboTargetsByKey=i.activeLimboTargetsByKey.remove(s),i.activeLimboResolutionsByTarget.delete(e),Im(i)}else yield Ap(i.localStore,e,!1).then(()=>Qp(i,e,t)).catch(Ea)})}function NP(n,e){return R(this,null,function*(){let t=K(n),i=e.batch.batchId;try{let r=yield vM(t.localStore,e);Bb(t,i,null),Fb(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),yield Aa(t,r)}catch(r){yield Ea(r)}})}function MP(n,e,t){return R(this,null,function*(){let i=K(n);try{let r=yield TM(i.localStore,e);Bb(i,e,t),Fb(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),yield Aa(i,r)}catch(r){yield Ea(r)}})}function Fb(n,e){(n.pendingWritesCallbacks.get(e)||[]).forEach(t=>{t.resolve()}),n.pendingWritesCallbacks.delete(e)}function PP(n,e){n.pendingWritesCallbacks.forEach(t=>{t.forEach(i=>{i.reject(new z(x.CANCELLED,e))})}),n.pendingWritesCallbacks.clear()}function LP(n,e,t){let i=n.mutationUserCallbacks[n.currentUser.toKey()];i||(i=new De(se)),i=i.insert(e,t),n.mutationUserCallbacks[n.currentUser.toKey()]=i}function Bb(n,e,t){let i=K(n),r=i.mutationUserCallbacks[i.currentUser.toKey()];if(r){let s=r.get(e);s&&(t?s.reject(t):s.resolve(),r=r.remove(e)),i.mutationUserCallbacks[i.currentUser.toKey()]=r}}function Qp(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let i of n.queriesByTarget.get(e))n.queryViewsByQuery.delete(i),t&&n.syncEngineListener.onWatchError(i,t);n.queriesByTarget.delete(e),n.isPrimaryClient&&n.limboDocumentRefs.removeReferencesForId(e).forEach(r=>{n.limboDocumentRefs.containsKey(r)||qb(n,r)})}function qb(n,e){n.enqueuedLimboResolutions.delete(e.path.canonicalString());let t=n.activeLimboTargetsByKey.get(e);t!==null&&(_m(n.remoteStore,t),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(e),n.activeLimboResolutionsByTarget.delete(t),Im(n))}function Vb(n,e,t){for(let i of t)i instanceof lc?(n.limboDocumentRefs.addReference(i.key,e),FP(n,i)):i instanceof cc?(V(wm,"Document no longer in limbo: "+i.key),n.limboDocumentRefs.removeReference(i.key,e),n.limboDocumentRefs.containsKey(i.key)||qb(n,i.key)):W()}function FP(n,e){let t=e.key,i=t.path.canonicalString();!n.activeLimboTargetsByKey.get(t)&&!n.enqueuedLimboResolutions.has(i)&&(V(wm,"New document in limbo: "+t),n.enqueuedLimboResolutions.add(i),Im(n))}function Im(n){for(;n.enqueuedLimboResolutions.size>0&&n.activeLimboTargetsByKey.size<n.maxConcurrentLimboResolutions;){let e=n.enqueuedLimboResolutions.values().next().value;n.enqueuedLimboResolutions.delete(e);let t=new $(Ae.fromString(e)),i=n.limboTargetIdGenerator.next();n.activeLimboResolutionsByTarget.set(i,new Hp(t)),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.insert(t,i),Ab(n.remoteStore,new ya(vn(mm(t.path)),i,"TargetPurposeLimboResolution",ET.INVALID))}}function Aa(n,e,t){return R(this,null,function*(){let i=K(n),r=[],s=[],a=[];i.queryViewsByQuery.isEmpty()||(i.queryViewsByQuery.forEach((o,l)=>{a.push(i.applyDocChanges(l,e,t).then(c=>{var u;if((c||t)&&i.isPrimaryClient){let m=c?!c.fromCache:(u=t?.targetChanges.get(l.targetId))===null||u===void 0?void 0:u.current;i.sharedClientState.updateQueryState(l.targetId,m?"current":"not-current")}if(c){r.push(c);let m=$p.fromSnapshot(l.targetId,c);s.push(m)}}))}),yield Promise.all(a),i.syncEngineListener.onWatchChange(r),yield EM(i.localStore,s))})}function BP(n,e,t,i){return R(this,null,function*(){let r=e.view.computeDocChanges(t);r.needsRefill&&(r=yield wb(n.localStore,e.query,!1).then(({documents:l})=>e.view.computeDocChanges(l,r)));let s=i&&i.targetChanges.get(e.targetId),a=i&&i.targetMismatches.get(e.targetId)!=null,o=e.view.applyChanges(r,n.isPrimaryClient,s,a);return Vb(n,e.targetId,o.limboChanges),o.snapshot})}function qP(n,e){return R(this,null,function*(){let t=K(n);if(!t.currentUser.isEqual(e)){V(wm,"User change. New user:",e.toKey());let r=yield Cb(t.localStore,e);t.currentUser=e,PP(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Aa(t,r.affectedDocuments)}})}function VP(n,e){let t=K(n),i=t.activeLimboResolutionsByTarget.get(e);if(i&&i.receivedDocument)return Z().add(i.key);{let r=Z(),s=t.queriesByTarget.get(e);if(!s)return r;for(let a of s){let o=t.queryViewsByQuery.get(a);r=r.unionWith(o.view.syncedDocuments)}return r}}function Ub(n){let e=K(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Lb.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=VP.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=kP.bind(null,e),e.syncEngineListener.onWatchChange=TP.bind(null,e.eventManager),e.syncEngineListener.onWatchError=bP.bind(null,e.eventManager),e}function UP(n){let e=K(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=NP.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=MP.bind(null,e),e}var fT=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return R(this,null,function*(){this.serializer=Cc(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),yield this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)})}createGarbageCollectionScheduler(t,i){return null}createIndexBackfillerScheduler(t,i){return null}createLocalStore(t){return gM(this.persistence,new Rp,t.initialUser,this.serializer)}createPersistence(t){return new Cp(wp.factory,this.serializer)}createSharedClientState(t){return new xp}terminate(){return R(this,null,function*(){var t,i;(t=this.gcScheduler)===null||t===void 0||t.stop(),(i=this.indexBackfillerScheduler)===null||i===void 0||i.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})();var zP=(()=>{class n{initialize(t,i){return R(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>hT(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=qP.bind(null,this.syncEngine),yield mP(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return yP()}createDatastore(t){let i=Cc(t.databaseInfo.databaseId),r=VM(t.databaseInfo);return KM(t.authCredentials,t.appCheckCredentials,r,i)}createRemoteStore(t){return ZM(this.localStore,this.datastore,t.asyncQueue,i=>hT(this.syncEngine,i,0),UM())}createSyncEngine(t,i){return wP(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,i)}terminate(){return R(this,null,function*(){var t,i;yield eP(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(i=this.eventManager)===null||i===void 0||i.terminate()})}}n.provider={build:()=>new n};return n})();function zb(n,e,t){if(!t)throw new z(x.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function GP(n,e,t,i){if(e===!0&&i===!0)throw new z(x.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function pT(n){if(!$.isDocumentKey(n))throw new z(x.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function mT(n){if($.isDocumentKey(n))throw new z(x.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function $P(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Am(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=jP(n);return e?`a custom ${e} object`:"an object"}}else return typeof n=="function"?"a function":W()}function jP(n){return n.constructor?n.constructor.name:null}function _i(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new z(x.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Am(n);throw new z(x.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}var Yp=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.scheduleEvent(this.observer.error,e):jt("Uncaught Error in snapshot listener:",e.toString()))}mute(){this.muted=!0}scheduleEvent(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var Ci="FirestoreClient",WP=100,HP=11,KP=20,QP=22,Jp=class{constructor(e,t,i,r,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=r,this.user=He.UNAUTHENTICATED,this.clientId=jl.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(i,a=>R(this,null,function*(){V(Ci,"Received user=",a.uid),yield this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(i,a=>(V(Ci,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:WP}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new yn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>R(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let i=Cm(t,"Failed to shutdown persistence");e.reject(i)}})),e.promise}};function If(n,e){return R(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),V(Ci,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener(r=>R(this,null,function*(){i.isEqual(r)||(yield Cb(e.localStore,r),i=r)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function gT(n,e){return R(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield JP(n);V(Ci,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(i=>dT(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,r)=>dT(e.remoteStore,r)),n._onlineComponents=e})}function YP(n){return n.name==="FirebaseError"?n.code===x.FAILED_PRECONDITION||n.code===x.UNIMPLEMENTED:typeof DOMException<"u"&&n instanceof DOMException?n.code===QP||n.code===KP||n.code===HP:!0}function JP(n){return R(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){V(Ci,"Using user provided OfflineComponentProvider");try{yield If(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!YP(t))throw t;ts("Error using user provided cache. Falling back to memory cache: "+t),yield If(n,new fT)}}else V(Ci,"Using default OfflineComponentProvider"),yield If(n,new fT);return n._offlineComponents})}function Gb(n){return R(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(V(Ci,"Using user provided OnlineComponentProvider"),yield gT(n,n._uninitializedComponentsProvider._online)):(V(Ci,"Using default OnlineComponentProvider"),yield gT(n,new zP))),n._onlineComponents})}function XP(n){return Gb(n).then(e=>e.syncEngine)}function yT(n){return R(this,null,function*(){let e=yield Gb(n),t=e.eventManager;return t.onListen=IP.bind(null,e.syncEngine),t.onUnlisten=RP.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=AP.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=xP.bind(null,e.syncEngine),t})}function ZP(n,e,t,i){let r=new Yp(i),s=new Gp(e,r,t);return n.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){let a=yield yT(n);return vP(a,s)})),()=>{r.mute(),n.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){let a=yield yT(n);return _P(a,s)}))}}function e2(n,e){let t=new yn;return n.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){let i=yield XP(n);return OP(i,e,t)})),t.promise}function t2(n,e){return n.timeoutSeconds===e.timeoutSeconds}function $b(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var n2="ComponentProvider",vT=new Map;function i2(n){let e=vT.get(n);e&&(V(n2,"Removing Datastore"),vT.delete(n),e.terminate())}function r2(n,e,t,i){return new Lf(n,e,t,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,$b(i.experimentalLongPollingOptions),i.useFetchStreams)}var jb="firestore.googleapis.com",_T=!0,TT=5,bT=30,s2=!0,uc=class{constructor(e){var t,i;if(e.host===void 0){if(e.ssl!==void 0)throw new z(x.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=jb,this.ssl=_T}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:_T;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Sb;else{if(e.cacheSizeBytes!==bb&&e.cacheSizeBytes<oT)throw new z(x.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${oT}`);this.cacheSizeBytes=e.cacheSizeBytes}GP("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=s2:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=$b((i=e.experimentalLongPollingOptions)!==null&&i!==void 0?i:{}),a2(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&t2(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}};function a2(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new z(x.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<TT)throw new z(x.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is ${TT})`);if(n.timeoutSeconds>bT)throw new z(x.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is ${bT})`)}}var ps=class{constructor(e,t,i,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new uc({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new z(x.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new z(x.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new uc(e),e.credentials!==void 0&&(this._authCredentials=cO(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return R(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return i2(this),Promise.resolve()}};function Wb(n,e,t,i={}){var r;n=_i(n,ps);let s=n._getSettings(),a=`${e}:${t}`;if(s.host!==jb&&s.host!==a&&ts("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),i.mockUserToken){let o,l;if(typeof i.mockUserToken=="string")o=i.mockUserToken,l=He.MOCK_USER;else{o=Km(i.mockUserToken,(r=n._app)===null||r===void 0?void 0:r.options.projectId);let c=i.mockUserToken.sub||i.mockUserToken.user_id;if(!c)throw new z(x.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new He(c)}n._authCredentials=new Df(new $l(o,l))}}var dc=class n{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},Tt=class n{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ti(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},Ti=class n extends dc{constructor(e,t,i){super(e,t,mm(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Tt(this.firestore,null,new $(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function Hb(n,e,...t){if(n=Yt(n),zb("collection","path",e),n instanceof ps){let i=Ae.fromString(e,...t);return mT(i),new Ti(n,null,i)}else{if(!(n instanceof Tt)&&!(n instanceof Ti))throw new z(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=n._path.child(Ae.fromString(e,...t));return mT(i),new Ti(n.firestore,null,i)}}function Dm(n,e,...t){if(n=Yt(n),arguments.length===1&&(e=jl.newId()),zb("doc","path",e),n instanceof ps){let i=Ae.fromString(e,...t);return pT(i),new Tt(n,null,new $(i))}else{if(!(n instanceof Tt)&&!(n instanceof Ti))throw new z(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=n._path.child(Ae.fromString(e,...t));return pT(i),new Tt(n.firestore,n instanceof Ti?n.converter:null,new $(i))}}var o2="AsyncQueue",hc=class{constructor(e=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new ic(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=e}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new yn;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}retryNextOp(){return R(this,null,function*(){if(this.retryableOps.length!==0){try{yield this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(wa(e))V(o2,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}})}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(i=>{this.failure=i,this.operationInProgress=!1;let r=l2(i);throw jt("INTERNAL UNHANDLED ERROR: ",r),i}).then(i=>(this.operationInProgress=!1,i))));return this.tail=t,t}enqueueAfterDelay(e,t,i){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let r=Vp.createAndSchedule(this,e,t,i,s=>this.removeDelayedOperation(s));return this.delayedOperations.push(r),r}verifyNotFailed(){this.failure&&W()}verifyOperationInProgress(){}drain(){return R(this,null,function*(){let e;do e=this.tail,yield e;while(e!==this.tail)})}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{this.delayedOperations.sort((t,i)=>t.targetTimeMs-i.targetTimeMs);for(let t of this.delayedOperations)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}};function l2(n){let e=n.message||"";return n.stack&&(n.stack.includes(n.message)?e=n.stack:e=n.message+`
`+n.stack),e}var Ei=class extends ps{constructor(e,t,i,r){super(e,t,i,r),this.type="firestore",this._queue=new hc,this._persistenceKey=r?.name||"[DEFAULT]"}_terminate(){return R(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new hc(e),this._firestoreClient=void 0,yield e}})}};function Kb(n,e){let t=typeof n=="object"?n:ig(),i=typeof n=="string"?n:e||Ff,r=tg(t,"firestore").getImmediate({identifier:i});if(!r._initialized){let s=Hm("firestore");s&&Wb(r,...s)}return r}function Qb(n){if(n._terminated)throw new z(x.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||c2(n),n._firestoreClient}function c2(n){var e,t,i;let r=n._freezeSettings(),s=r2(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,r);n._componentsProvider||!((t=r.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((i=r.localCache)===null||i===void 0)&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider}),n._firestoreClient=new Jp(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&u2(n._componentsProvider))}function u2(n){let e=n?._online.build();return{_offline:n?._offline.build(e),_online:e}}function d2(n,e=!0){oO(ng),eg(new Xm("firestore",(t,{instanceIdentifier:i,options:r})=>{let s=t.getProvider("app").getImmediate(),a=new Ei(new Rf(t.getProvider("auth-internal")),new Nf(t.getProvider("app-check-internal")),BO(s,i),s);return r=Object.assign({useFetchStreams:e},r),a._setSettings(r),a},"PUBLIC").setMultipleInstances(!0)),cr(z_,G_,n),cr(z_,G_,"esm2017")}var Ta=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(it.fromBase64String(e))}catch(t){throw new z(x.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(it.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var ms=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new z(x.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new bt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var ba=class{constructor(e){this._methodName=e}};var Sa=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new z(x.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new z(x.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return se(this._lat,e._lat)||se(this._long,e._long)}};var Ca=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return pM(this._values,e._values)}};var h2=/^__.*__$/,Xp=class{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new bn(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ji(e,this.data,t,this.fieldTransforms)}},fc=class{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return new bn(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function Yb(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw W()}}var Zp=class n{constructor(e,t,i,r,s,a){this.settings=e,this.databaseId=t,this.serializer=i,this.ignoreUndefinedProperties=r,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;let i=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.contextWith({path:i,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){var t;let i=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.contextWith({path:i,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return mc(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(Yb(this.dataSource)&&h2.test(e))throw this.createError('Document fields cannot begin and end with "__"')}},em=class{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=i||Cc(e)}createContext(e,t,i,r=!1){return new Zp({dataSource:e,methodName:t,targetDoc:i,path:bt.emptyPath(),arrayElement:!1,hasConverter:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Jb(n){let e=n._freezeSettings(),t=Cc(n._databaseId);return new em(n._databaseId,!!e.ignoreUndefinedProperties,t)}function f2(n,e,t,i,r,s={}){let a=n.createContext(s.merge||s.mergeFields?2:0,e,t,r);Rm("Data must be an object, but it was:",a,i);let o=Xb(i,a),l,c;if(s.merge)l=new Mt(a.fieldMask),c=a.fieldTransforms;else if(s.mergeFields){let u=[];for(let m of s.mergeFields){let p=tm(e,m,t);if(!a.contains(p))throw new z(x.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);eS(u,p)||u.push(p)}l=new Mt(u),c=a.fieldTransforms.filter(m=>l.covers(m.field))}else l=null,c=a.fieldTransforms;return new Xp(new _t(o),l,c)}var pc=class n extends ba{_toFieldTransform(e){if(e.dataSource===2)e.fieldMask.push(e.path);else throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof n}};function p2(n,e,t,i){let r=n.createContext(1,e,t);Rm("Data must be an object, but it was:",r,i);let s=[],a=_t.empty();er(i,(l,c)=>{let u=xm(e,l,t);c=Yt(c);let m=r.childContextForFieldPath(u);if(c instanceof pc)s.push(u);else{let p=Ic(c,m);p!=null&&(s.push(u),a.set(u,p))}});let o=new Mt(s);return new fc(a,o,r.fieldTransforms)}function m2(n,e,t,i,r,s){let a=n.createContext(1,e,t),o=[tm(e,i,t)],l=[r];if(s.length%2!==0)throw new z(x.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<s.length;p+=2)o.push(tm(e,s[p])),l.push(s[p+1]);let c=[],u=_t.empty();for(let p=o.length-1;p>=0;--p)if(!eS(c,o[p])){let T=o[p],S=l[p];S=Yt(S);let E=a.childContextForFieldPath(T);if(S instanceof pc)c.push(T);else{let C=Ic(S,E);C!=null&&(c.push(T),u.set(T,C))}}let m=new Mt(c);return new fc(u,m,a.fieldTransforms)}function Ic(n,e){if(n=Yt(n),Zb(n))return Rm("Unsupported field value:",e,n),Xb(n,e);if(n instanceof ba)return y2(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return g2(n,e)}else return v2(n,e)}function Xb(n,e){let t={};return BT(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):er(n,(i,r)=>{let s=Ic(r,e.childContextForField(i));s!=null&&(t[i]=s)}),{mapValue:{fields:t}}}function g2(n,e){let t=[],i=0;for(let r of n){let s=Ic(r,e.childContextForArray(i));s==null&&(s={nullValue:"NULL_VALUE"}),t.push(s),i++}return{arrayValue:{values:t}}}function y2(n,e){if(!Yb(e.dataSource))throw e.createError(`${n._methodName}() can only be used with update() and set()`);if(!e.path)throw e.createError(`${n._methodName}() is not currently supported inside arrays`);let t=n._toFieldTransform(e);t&&e.fieldTransforms.push(t)}function v2(n,e){if(n=Yt(n),n===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return Lk(e.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let t=Qe.fromDate(n);return{timestampValue:ec(e.serializer,t)}}else if(n instanceof Qe){let t=new Qe(n.seconds,Math.floor(n.nanoseconds/1e3)*1e3);return{timestampValue:ec(e.serializer,t)}}else{if(n instanceof Sa)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Ta)return{bytesValue:pb(e.serializer,n._byteString)};if(n instanceof Tt){let t=e.databaseId,i=n.firestore._databaseId;if(!i.isEqual(t))throw e.createError(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${t.projectId}/${t.database}`);return{referenceValue:ym(n.firestore._databaseId||e.databaseId,n._key.path)}}else{if(n instanceof Ca)return _2(n,e);throw e.createError(`Unsupported field value: ${Am(n)}`)}}}function _2(n,e){return{mapValue:{fields:{[cm]:{stringValue:um},[is]:{arrayValue:{values:n.toArray().map(i=>{if(typeof i!="number")throw e.createError("VectorValues must only contain numeric values.");return gm(e.serializer,i)})}}}}}}function Zb(n){return typeof n=="object"&&n!==null&&!(n instanceof Array)&&!(n instanceof Date)&&!(n instanceof Qe)&&!(n instanceof Sa)&&!(n instanceof Ta)&&!(n instanceof Tt)&&!(n instanceof ba)&&!(n instanceof Ca)}function Rm(n,e,t){if(!Zb(t)||!$P(t)){let i=Am(t);throw i==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+i)}}function tm(n,e,t){if(e=Yt(e),e instanceof ms)return e._internalPath;if(typeof e=="string")return xm(n,e);throw mc("Field path arguments must be of type string or ",n,!1,void 0,t)}var T2=new RegExp("[~\\*/\\[\\]]");function xm(n,e,t){if(e.search(T2)>=0)throw mc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new ms(...e.split("."))._internalPath}catch{throw mc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function mc(n,e,t,i,r){let s=i&&!i.isEmpty(),a=r!==void 0,o=`Function ${e}() called with invalid data`;t&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${i}`),a&&(l+=` in document ${r}`),l+=")"),new z(x.INVALID_ARGUMENT,o+n+l)}function eS(n,e){return n.some(t=>t.isEqual(e))}var gc=class{constructor(e,t,i,r,s){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Tt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document)if(this._converter){let e=new nm(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}else return this._userDataWriter.convertValue(this._document.data.value);else return}get(e){if(this._document){let t=this._document.data.field(tS("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},nm=class extends gc{data(){return super.data()}};function tS(n,e){return typeof e=="string"?xm(n,e):e instanceof ms?e._internalPath:e._delegate._internalPath}function b2(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new z(x.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var im=class{convertValue(e,t="none"){switch(Ki(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ce(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(bi(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw W()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let i={};return er(e,(r,s)=>{i[r]=this.convertValue(s,t)}),i}convertVectorValue(e){var t,i,r;let s=(r=(i=(t=e.fields)===null||t===void 0?void 0:t[is].arrayValue)===null||i===void 0?void 0:i.values)===null||r===void 0?void 0:r.map(a=>Ce(a.doubleValue));return new Ca(s)}convertGeoPoint(e){return new Sa(Ce(e.latitude),Ce(e.longitude))}convertArray(e,t){return(e.values||[]).map(i=>this.convertValue(i,t))}convertServerTimestamp(e,t){switch(t){case"previous":let i=om(e);return i==null?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(ua(e));default:return null}}convertTimestamp(e){let t=Pn(e);return new Qe(t.seconds,t.nanos)}convertDocumentKey(e,t){let i=Ae.fromString(e);ue(Tb(i));let r=new Kl(i.get(1),i.get(3)),s=new $(i.popFirst(5));return r.isEqual(t)||jt(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function S2(n,e,t){let i;return n?t&&(t.merge||t.mergeFields)?i=n.toFirestore(e,t):i=n.toFirestore(e):i=e,i}function ST(n){return C2(n,["next","error","complete"])}function C2(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let i of e)if(i in t&&typeof t[i]=="function")return!0;return!1}var Zi=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},yc=class extends gc{constructor(e,t,i,r,s,a){super(e,t,i,r,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document)if(this._converter){let t=new gs(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}else return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);else return}get(e,t={}){if(this._document){let i=this._document.data.field(tS("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}},gs=class extends yc{data(e={}){return super.data(e)}},rm=class{constructor(e,t,i,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Zi(r.hasPendingWrites,r.fromCache),this.query=i}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(i=>{e.call(t,new gs(this._firestore,this._userDataWriter,i.key,i,new Zi(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new z(x.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return(!this._cachedChanges||this._cachedChangesIncludeMetadataChanges!==t)&&(this._cachedChanges=E2(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function E2(n,e){if(n._snapshot.oldDocs.isEmpty()){let t=0;return n._snapshot.docChanges.map(i=>{let r=new gs(n._firestore,n._userDataWriter,i.doc.key,i.doc,new Zi(n._snapshot.mutatedKeys.has(i.doc.key),n._snapshot.fromCache),n.query.converter);return i.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}else{let t=n._snapshot.oldDocs;return n._snapshot.docChanges.filter(i=>e||i.type!==3).map(i=>{let r=new gs(n._firestore,n._userDataWriter,i.doc.key,i.doc,new Zi(n._snapshot.mutatedKeys.has(i.doc.key),n._snapshot.fromCache),n.query.converter),s=-1,a=-1;return i.type!==0&&(s=t.indexOf(i.doc.key),t=t.delete(i.doc.key)),i.type!==1&&(t=t.add(i.doc),a=t.indexOf(i.doc.key)),{type:w2(i.type),doc:r,oldIndex:s,newIndex:a}})}}function w2(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return W()}}var vc=class extends im{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ta(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Tt(this.firestore,null,t)}};function nS(n,e,t,...i){n=_i(n,Tt);let r=_i(n.firestore,Ei),s=Jb(r);e=Yt(e);let a;typeof e=="string"||e instanceof ms?a=m2(s,"updateDoc",n._key,e,t,i):a=p2(s,"updateDoc",n._key,e);let o=a.toMutation(n._key,Mn.exists(!0));return km(r,[o])}function iS(n){let e=_i(n.firestore,Ei),t=[new ma(n._key,Mn.none())];return km(e,t)}function rS(n,e){let t=_i(n.firestore,Ei),i=Dm(n),r=S2(n.converter,e),s=Jb(n.firestore),o=f2(s,"addDoc",i._key,r,n.converter!==null,{}).toMutation(i._key,Mn.exists(!1));return km(t,[o]).then(()=>i)}function Om(n,...e){var t,i,r;n=Yt(n);let s={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]=="object"&&!ST(e[a])&&(s=e[a],a++);let o={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(ST(e[a])){let p=e[a];e[a]=(t=p.next)===null||t===void 0?void 0:t.bind(p),e[a+1]=(i=p.error)===null||i===void 0?void 0:i.bind(p),e[a+2]=(r=p.complete)===null||r===void 0?void 0:r.bind(p)}let l,c,u;if(n instanceof Tt)c=_i(n.firestore,Ei),u=mm(n._key.path),l={next:p=>{e[a]&&e[a](I2(c,n,p))},error:e[a+1],complete:e[a+2]};else{let p=_i(n,dc);c=_i(p.firestore,Ei),u=p._query;let T=new vc(c);l={next:S=>{e[a]&&e[a](new rm(c,T,p,S))},error:e[a+1],complete:e[a+2]},b2(n._query)}let m=Qb(c);return ZP(m,u,o,l)}function km(n,e){let t=Qb(n);return e2(t,e)}function I2(n,e,t){let i=t.docs.get(e._key),r=new vc(n);return new yc(n,r,e._key,i,new Zi(t.hasPendingWrites,t.fromCache),e.converter)}d2("node");var Kq={firebase:{apiKey:"AIzaSyCyDosyJxwuY7Oz7Xa4v9Y5Ej06CsSMtNw",authDomain:"testangular-3bb36.firebaseapp.com",projectId:"testangular-3bb36",storageBucket:"testangular-3bb36.firebasestorage.app",messagingSenderId:"469852807387",appId:"1:469852807387:web:c7758a95d63b133b15ecfe",measurementId:"G-FXSN1FRE0E"},defaultAvatar:"https://www.w3schools.com/w3images/avatar2.png"};var A2="auth";var Ac=class{constructor(){return Ua(A2)}};var Dc=function(){return Dc=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++){t=arguments[i];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},Dc.apply(this,arguments)};var x2={includeMetadataChanges:!1};function Nm(n,e){return e===void 0&&(e=x2),new Fm(function(t){var i=Om(n,e,{next:t.next.bind(t),error:t.error.bind(t),complete:t.complete.bind(t)});return{unsubscribe:i}})}function sS(n){return Nm(n,{includeMetadataChanges:!0})}function aS(n,e){return e===void 0&&(e={}),sS(n).pipe(xa(function(t){return Mm(t,e)}))}function Mm(n,e){var t;e===void 0&&(e={});var i=n.data(e);return!n.exists()||typeof i!="object"||i===null||!e.idField?i:Dc(Dc({},i),(t={},t[e.idField]=n.id,t))}function oS(n){return Nm(n,{includeMetadataChanges:!0}).pipe(xa(function(e){return e.docs}))}function lS(n,e){return e===void 0&&(e={}),oS(n).pipe(xa(function(t){return t.map(function(i){return Mm(i,e)})}))}var Da=class{constructor(e){return e}},cS="firestore",Pm=class{constructor(){return Ua(cS)}};var Lm=new Bm("angularfire2.firestore-instances");function O2(n,e){let t=Uc(cS,n,e);return t&&new Da(t)}function k2(n){return(e,t)=>{let i=e.runOutsideAngular(()=>n(t));return new Da(i)}}var N2={provide:Pm,deps:[[new Ts,Lm]]},M2={provide:Da,useFactory:O2,deps:[[new Ts,Lm],sg]};function RV(n,...e){return cr("angularfire",Vc.full,"fst"),qm([M2,N2,{provide:Lm,useFactory:k2(n),multi:!0,deps:[Na,Vm,Gc,ag,[new Ts,Ac],[new Ts,zc],...e]}])}var xV=Jt(lS,!0);var OV=Jt(aS,!0);var kV=Jt(rS,!0);var NV=Jt(Hb,!0);var MV=Jt(iS,!0);var PV=Jt(Dm,!0);var LV=Jt(Kb,!0);var FV=Jt(nS,!0);export{Qe as a,Kq as b,B2 as c,Hc as d,K2 as e,Kc as f,wL as g,ZL as h,Xc as i,Da as j,RV as k,xV as l,OV as m,kV as n,NV as o,MV as p,PV as q,LV as r,FV as s,hg as t,aL as u,Qc as v,fg as w};
